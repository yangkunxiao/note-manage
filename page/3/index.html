<!DOCTYPE html>


<html lang="zh-CN" >


<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="javascript typescript php node html html5 css linux vue react ç®—æ³• æ•°æ®ç»“æ„" />
   
  <meta name="description" content="å‰ç«¯å·¥ç¨‹å¸ˆ" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Walter
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  <link rel="stylesheet" href="/dist/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  
  

  

<link rel="alternate" href="/atom.xml" title="Walter" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

</html>

<body>
  <div id="app">
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/yangkunxiao"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover4.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Walter</a></h1>
      <div id="subtitle-box">
        
          <span id="subtitle">é¢æœå¤§æµ· æ˜¥æš–èŠ±å¼€</span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" target="_blank" rel="noopener" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-JavaScript/process-thread" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/19/JavaScript/process-thread/"
    >æµè§ˆå™¨è¿›ç¨‹ä¸çº¿ç¨‹</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/19/JavaScript/process-thread/" class="article-date">
  <time datetime="2020-01-19T14:20:00.000Z" itemprop="datePublished">2020-01-19</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹"></a>æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹</h1><h1 id="æµè§ˆå™¨"><a href="#æµè§ˆå™¨" class="headerlink" title="æµè§ˆå™¨"></a>æµè§ˆå™¨</h1><p>æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ã€‚æ¯ä¸€ä¸ªTabé¡µå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚</p>
<ul>
<li>æµè§ˆå™¨è¿›ç¨‹ï¼ˆä¸»è¿›ç¨‹ï¼‰ï¼šä¸ªäººç†è§£ä¸ºâ€œç®¡å®¶â€çš„è§’è‰²ï¼Œå®ƒæ§åˆ¶ç€æµè§ˆå™¨çš„å„ä¸ªä»»åŠ¡ï¼Œé¡µé¢å±•ç¤ºã€ç½‘ç»œè¯·æ±‚ã€å†å²å›é€€ã€å‰è¿›ç­‰ç­‰</li>
<li>ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹ï¼šç®¡ç†ç¬¬ä¸‰æ–¹æ’ä»¶</li>
<li>GPUçº¿ç¨‹ï¼šç”¨äº3Dç»˜åˆ¶</li>
<li>æ¸²æŸ“è¿›ç¨‹ï¼šæµè§ˆå™¨å†…æ ¸ï¼Œå¤šçº¿ç¨‹ã€‚ä¸»è¦è´Ÿè´£é¡µé¢æ¸²æŸ“ã€è„šæœ¬æ‰§è¡Œã€äº‹ä»¶å¾ªç¯ç­‰ã€‚å¯¹å‰ç«¯æ¥è¯´ï¼Œæœ€é‡è¦çš„è¿›ç¨‹ã€‚</li>
</ul>
<h4 id="æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š"><a href="#æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š" class="headerlink" title="æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š"></a>æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š</h4><ul>
<li>é˜²æ­¢å•ä¸ªé¡µé¢æˆ–è€…æ’ä»¶å´©æºƒå½±å“æ•´ä¸ªæµè§ˆå™¨çš„è¿è¡Œã€‚</li>
<li>å¯ä»¥å……åˆ†åˆ©ç”¨æµè§ˆå™¨å¤šæ ¸çš„ä¼˜åŠ¿ã€‚</li>
<li>æ–¹ä¾¿ä½¿ç”¨æ²™ç›’æ¨¡å‹éš”ç¦»æ’ä»¶ç­‰è¿›ç¨‹ï¼Œæé«˜æµè§ˆå™¨ç¨³å®šæ€§ã€‚</li>
</ul>
<h1 id="æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰"><a href="#æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰" class="headerlink" title="æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰"></a>æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰</h1><p>æ¸²æŸ“è¿›ç¨‹æ˜¯å¤šçº¿ç¨‹çš„ã€‚å®ƒåŒ…å«ä¸€ä¸‹å‡ å¤§çº¿ç¨‹ï¼š</p>
<ul>
<li>GUIçº¿ç¨‹<ul>
<li>å®ƒè´Ÿè´£é¡µé¢çš„æ¸²æŸ“ã€å¸ƒå±€ã€è§£æHTMLã€CSSã€æ¸²æŸ“DOMæ ‘ã€‚</li>
<li>å½“é¡µé¢å‘ç”Ÿé‡ç»˜æˆ–è€…å›æµçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘è¯¥çº¿ç¨‹</li>
<li>å®ƒå’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥</li>
</ul>
</li>
<li>JSå¼•æ“çº¿ç¨‹<ul>
<li>è´Ÿè´£ç¨‹åºçš„è§£æå’Œæ‰§è¡Œ</li>
</ul>
</li>
<li>äº‹ä»¶è§¦å‘çº¿ç¨‹<ul>
<li>å®ƒæ§åˆ¶äº‹ä»¶å¾ªç¯ï¼Œç®¡ç†ç€ä¸€ä¸ªäº‹ä»¶<code>ä»»åŠ¡é˜Ÿåˆ—</code>TaskQueue</li>
<li>å½“å¼‚æ­¥ä»»åŠ¡æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¼šå°†è¯¥å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒå‡½æ•°æ”¾å…¥åˆ°JSå¼•æ“çº¿ç¨‹æ‰€åœ¨çš„<code>æ‰§è¡Œæ ˆ</code>ä¸­æ‰§è¡Œ</li>
</ul>
</li>
<li>å®šæ—¶è§¦å‘å™¨çº¿ç¨‹<ul>
<li>setTimeOut å’Œ setInterval æ‰€åœ¨çš„çº¿ç¨‹</li>
<li>å®šæ—¶å™¨ä»»åŠ¡çš„è®¡æ—¶ä¸æ˜¯ç”±JSå¼•æ“è®¡æ—¶çš„ï¼Œè€Œæ˜¯ç”±è¯¥çº¿ç¨‹æ§åˆ¶</li>
<li>å½“å®šæ—¶ä»»åŠ¡è®¡æ—¶å®Œæˆä¹‹åï¼Œä¼šé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹</li>
<li>W3Cåœ¨HTMLæ ‡å‡†ä¸­è§„å®šï¼Œè§„å®šè¦æ±‚setTimeoutä¸­ä½äº4msçš„æ—¶é—´é—´éš”ç®—ä¸º4msã€‚</li>
</ul>
</li>
<li>å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹<ul>
<li>ä¸€ä¸ªç‹¬ç«‹çš„ajaxè¯·æ±‚çº¿ç¨‹</li>
<li>å½“è¯·æ±‚å®Œæˆä¹‹åï¼Œä¼šé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹</li>
</ul>
</li>
</ul>
<h4 id="ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥"><a href="#ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥" class="headerlink" title="ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥"></a>ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥</h4><p>å› ä¸ºJSæ˜¯å¯ä»¥æ“ä½œDOMçš„ï¼Œå¦‚æœä½¿ç”¨JSæ“ä½œDOMçš„åŒæ—¶ï¼ŒGUIçº¿ç¨‹ä¹Ÿåœ¨æ¸²æŸ“DOMï¼Œé‚£ä¹ˆæ¸²æŸ“å®Œæˆä¹‹åçš„å…ƒç´ å¯èƒ½å°±ä¸æ˜¯ä¹‹å‰çš„å…ƒç´ äº†</p>
<h4 id="ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹"><a href="#ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹"></a>ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹</h4><ul>
<li>åˆ›å»ºJavaScriptè¯­è¨€çš„æ—¶å€™ï¼Œå¤šè¿›ç¨‹å¤šçº¿ç¨‹çš„æ¶æ„å¹¶ä¸æµè¡Œï¼Œç¡¬ä»¶æ”¯æŒåº¦ä¸é«˜</li>
<li>å¤šè¿›ç¨‹å¤šçº¿ç¨‹æ“ä½œéœ€è¦åŠ é”ï¼Œæ“ä½œæˆæœ¬è¾ƒé«˜ï¼Œè¾ƒä¸ºå¤æ‚</li>
<li>å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªDOMï¼Œé‚£ä¹ˆç»“æœä¼šæ˜¯ä¸å¯é¢„æ–™çš„</li>
<li>çº¿ç¨‹ä¹‹é—´èµ„æºå…±äº«</li>
</ul>
<h1 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h1><ul>
<li>JSçš„ä»»åŠ¡åˆ†ä¸ºåŒæ­¥ä»»ä½•å’Œå¼‚æ­¥ä»»åŠ¡çš„</li>
<li>åŒæ­¥ä»»åŠ¡éƒ½åœ¨JSå¼•æ“çš„æ‰§è¡Œæ ˆä¸Šæ‰§è¡Œ</li>
<li>äº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ŒTaskQueueï¼Œå½“å¼‚æ­¥ä»»åŠ¡æ»¡è¶³æ¡ä»¶æ—¶ï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹ä¼šå°†å…¶æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­ï¼Œå½“ä¸»çº¿ç¨‹ï¼ˆJSå¼•æ“çº¿ç¨‹ï¼‰æ‰§è¡Œå®Œæ‰§è¡Œæ ˆä¸­çš„ä»»åŠ¡ä¹‹åï¼Œä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼Œå°±å°†å¯æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒå‡½æ•°æ¨å…¥åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™å†æ¬¡å‘äº‹ä»¶è§¦å‘çº¿ç¨‹å‘èµ·è¯¢é—®ï¼Œç›´åˆ°æœ‰ä¸ºæ­¢ã€‚</li>
</ul>
<p><img src="http://cdn.yangkunxiao.cn/EventLoop.png#align=left&display=inline&height=706&originHeight=706&originWidth=1278&status=done&style=none&width=1278" alt=""></p>
<p>ä»£ç è§£é‡Šï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> timerCallback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timerCallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> httpCallback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'httpCallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'åŒæ­¥ä»»åŠ¡1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>
<span class="token comment" spellcheck="true">// é€šçŸ¥å®šæ—¶å™¨çº¿ç¨‹ 1s åå°† timerCallback äº¤ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç†</span>
<span class="token comment" spellcheck="true">// 1s åäº‹ä»¶è§¦å‘çº¿ç¨‹å°† timerCallback åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>timerCallback<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>
<span class="token comment" spellcheck="true">// é€šçŸ¥å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹å‘é€ç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚æˆåŠŸåå°† httpCallback äº¤ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç†</span>
<span class="token comment" spellcheck="true">// è¯·æ±‚æˆåŠŸåäº‹ä»¶è§¦å‘çº¿ç¨‹å°† httpCallback åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­</span>
$<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'www.xxxx.com'</span><span class="token punctuation">,</span>httpCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'åŒæ­¥ä»»åŠ¡2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//...</span>
<span class="token comment" spellcheck="true">// æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œå</span>
<span class="token comment" spellcheck="true">// è¯¢é—®äº‹ä»¶è§¦å‘çº¿ç¨‹åœ¨äº‹ä»¶äº‹ä»¶é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°</span>
<span class="token comment" spellcheck="true">// å¦‚æœæ²¡æœ‰ï¼Œä¸€ç›´è¯¢é—®ï¼Œç›´åˆ°æœ‰ä¸ºæ­¢</span>
<span class="token comment" spellcheck="true">// å¦‚æœæœ‰ï¼Œå°†å›è°ƒäº‹ä»¶åŠ å…¥æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œå›è°ƒä»£ç </span></code></pre>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>JSå¼•æ“çº¿ç¨‹åªæ‰§è¡Œæ‰§è¡Œæ ˆä¸­çš„äº‹ä»¶</li>
<li>æ‰§è¡Œæ ˆä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šè¯»å–äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶</li>
<li>äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒäº‹ä»¶ï¼Œæ˜¯ç”±å„è‡ªçº¿ç¨‹æ’å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­çš„</li>
<li>å¦‚æ­¤å¾ªç¯</li>
</ul>
<h4 id="å®ä»»åŠ¡ã€å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡ã€å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡ã€å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡ã€å¾®ä»»åŠ¡</h4><p>å®ä»»åŠ¡ï¼šå¯ä»¥ç†è§£ä¸ºæµè§ˆå™¨çº§åˆ«çš„ä»»åŠ¡ã€‚ä¸»ä»£ç å—ï¼ŒsetTimeoutï¼ŒsetIntervalç­‰ï¼Œéƒ½å±äºå®ä»»åŠ¡</p>
<p>å¾®ä»»åŠ¡ï¼šJSå¼•æ“çº§åˆ«çš„ä»»åŠ¡ã€‚Promiseï¼Œprocess.nextTickç­‰ï¼Œå±äº<code>å¾®ä»»åŠ¡</code>ã€‚</p>
<p>æ‰§è¡Œé¡ºåºï¼š</p>
<ul>
<li>å½“å‰ä»£ç å—å¯¹åº”çš„å®ä»»åŠ¡</li>
<li>å½“å‰å®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹ä¹‹å‰ï¼Œæ‰§è¡Œå½“å‰å¯¹åˆ—çš„å¾®ä»»åŠ¡</li>
<li>GUIå¼•æ“æ¸²æŸ“</li>
<li>ä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Koa2/ Onion-Model" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/16/Koa2/%20Onion-Model/"
    >Koa2æ´‹è‘±æ¨¡å‹</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/16/Koa2/%20Onion-Model/" class="article-date">
  <time datetime="2020-01-16T03:30:00.000Z" itemprop="datePublished">2020-01-16</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Koa2/">Koa2</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="æµ…è§£ææ´‹è‘±æ¨¡å‹"><a href="#æµ…è§£ææ´‹è‘±æ¨¡å‹" class="headerlink" title="æµ…è§£ææ´‹è‘±æ¨¡å‹"></a>æµ…è§£ææ´‹è‘±æ¨¡å‹</h1><p>koa2æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ç‹¬ç‰¹çš„ä¸­é—´ä»¶æ§åˆ¶æµç¨‹ã€‚koa2åŸºäºNodeV7.6.0ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨async/awaitæ¥æ›¿ä»£generatorï¼Œä½¿å¾—ä»£ç å½»åº•æ‘†è„±â€œå›è°ƒåœ°ç‹±â€ï¼Œå¯è¯»æ€§æ›´ä½³ã€‚<br><a name="KlEWq"></a></p>
<h3 id="æ´‹è‘±æ¨¡å‹"><a href="#æ´‹è‘±æ¨¡å‹" class="headerlink" title="æ´‹è‘±æ¨¡å‹"></a>æ´‹è‘±æ¨¡å‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€å¼ ä¸­é—´ä»¶çš„â€œç¥å›¾â€ï¼Œå®ƒå¯ä»¥æ¸…æ™°çš„è¡¨ç¤ºå‡ºï¼šä»ä»£ç è¯·æ±‚åˆ°å“åº”çš„è¿‡ç¨‹ä¸­ï¼Œä¸­é—´ä»¶çš„å·¥ä½œæµç¨‹ã€‚<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579140335664-560c41e9-c60c-4004-9c8d-8991f1396ccf.png#align=left&display=inline&height=347&name=image.png&originHeight=694&originWidth=1034&size=342796&status=done&style=none&width=517" alt="image.png"><br><a name="FNydJ"></a></p>
<h4 id="å°demo"><a href="#å°demo" class="headerlink" title="å°demo"></a>å°demo</h4><p>å…ˆçœ‹ä¸ªå°ğŸŒ°å§ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'koaæœåŠ¡å™¨å·²å¯åŠ¨'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//1 3 5 4 2</span></code></pre>
<p>å¯åŠ¨demoï¼Œè®¿é—®æœåŠ¡å™¨åœ°å€ï¼Œæ§åˆ¶å°å°±ä¼šè¾“å‡ºç­”æ¡ˆï¼š 1ã€3ã€5ã€4ã€2 ã€‚<br />ä»è¿™ä¸ªğŸŒ°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“ç¨‹åºæ‰§è¡Œé‡åˆ°await next() çš„æ—¶å€™ï¼Œä¼šæš‚åœæ‰§è¡Œå½“å‰ä»£ç å—ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œç­‰ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œå®Œä¹‹åå†å›è¿‡å¤´æ¥ç»§ç»­å¤„ç†ã€‚<br><a name="QoOvG"></a></p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å½“åœ¨ä¸€ä¸ªä¸­é—´ä»¶ä¸­è°ƒç”¨await next()æ—¶ï¼Œå½“å‰ä¸­é—´ä»¶å°±ä¼šæŠŠç¨‹åºçš„æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚å½“ä¸‹æ¸¸æ²¡æœ‰ä¸­é—´ä»¶ç­‰å¾…æ‰§è¡Œçš„æ—¶å€™ï¼Œç¨‹åºå°±ä¼šå›æº¯ä¸Šæ¸¸ï¼Œæ‰§è¡Œä¸Šæ¸¸ä¸­é—´ä»¶ç­‰å¾…æ‰§è¡Œçš„è¡Œä¸ºã€‚<br><a name="7htbI"></a></p>
<h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><p>koa2çš„æºç åªæœ‰å››ä¸ªæ–‡ä»¶ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹<a href="https://github.com/koajs/koa" target="_blank" rel="noopener">Koa2æºç </a></p>
<ul>
<li>application.jsï¼šå…¥å£æ–‡ä»¶ã€‚</li>
<li>context.jsï¼šåº”ç”¨ä¸Šä¸‹æ–‡æ–‡ä»¶ã€‚</li>
<li>request.jsï¼šè¯·æ±‚å¤„ç†æ–‡ä»¶ã€‚</li>
<li>response.jsï¼šå“åº”å¤„ç†æ–‡ä»¶ã€‚</li>
</ul>
<p>å…ˆä»å…¥å£æ–‡ä»¶çœ‹èµ·ï¼š<br><a name="M2Hls"></a></p>
<h4 id="application-js"><a href="#application-js" class="headerlink" title="application.js"></a>application.js</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
     * Shorthand for:
     *
     *    http.createServer(app.callback()).listen(...)
     *
     * @param {Mixed} ...
     * @return {Server}
     * @api public
     */</span>

<span class="token function">listen</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'listen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>åœ¨å…¥å£æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„<code>app.listen(port)</code>ï¼Œåªæ˜¯ä¸€ä¸ªâ€œè¯­æ³•ç³–â€ï¼Œå®ƒåªæ˜¯ä½¿ç”¨æ¥ <code>this.callback()</code> æ¥ç”Ÿæˆ<code>node</code>çš„<code>httpServer</code>çš„å›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹<code>this.callback()</code></p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
     * Return a request handler callback
     * for node's native http server.
     *
     * @return {Function}
     * @api public
     */</span>

<span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listenerCount</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> handleRequest <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> handleRequest<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œé¦–å…ˆä½¿ç”¨<code>compose</code>å°†ä¸­é—´ä»¶ç»„åˆèµ·æ¥ï¼Œ<code>compose</code>å°±æ˜¯ä¸€ä¸ªæŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œå®ƒæ¥å—ä¸­é—´ä»¶æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿”å›å‡½æ•°ä¸­ï¼Œæ¥å—åº”ç”¨ä¸Šä¸‹æ–‡<code>ctxå’Œnext</code>ï¼Œè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ã€‚<br /><a href="https://github.com/koajs/compose/blob/master/index.js" target="_blank" rel="noopener">composeæºç </a>ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token string">'use strict'</span>

<span class="token comment" spellcheck="true">/**
 * Expose compositor.
 */</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> compose

<span class="token comment" spellcheck="true">/**
 * Compose `middleware` returning
 * a fully valid middleware comprised
 * of all those which are passed.
 *
 * @param {Array} middleware
 * @return {Function}
 * @api public
 */</span>

<span class="token keyword">function</span> compose <span class="token punctuation">(</span>middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Middleware stack must be an array!'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> fn <span class="token keyword">of</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Middleware must be composed of functions!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">/**
   * @param {Object} context
   * @return {Promise}
   * @api public
   */</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// last called middleware #</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span> dispatch <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'next() called multiple times'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      index <span class="token operator">=</span> i
      <span class="token keyword">let</span> fn <span class="token operator">=</span> middleware<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> middleware<span class="token punctuation">.</span>length<span class="token punctuation">)</span> fn <span class="token operator">=</span> next
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> dispatch<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>åœ¨<code>compose</code>å‡½æ•°ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯ä½¿ç”¨<code>diapatch()</code>å‡½æ•°ï¼Œéå†ä¸­é—´ä»¶æ•°ç»„ï¼Œç„¶åå°†<code>ctxå’Œdispatch(i + 1)</code>ä¼ é€’ç»™ä¸­é—´ä»¶çš„æ–¹æ³•ä¸­ã€‚å®ƒåšåˆ°äº†ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ul>
<li>å°†ctxåº”ç”¨æ–‡å¯¹è±¡ä¸€ç›´ä¼ é€’ä¸‹å»ã€‚</li>
<li>å°†ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ä½œä¸ºæœªæ¥çš„nextçš„è¿”å›å€¼ã€‚</li>
</ul>
<p>åœ¨<code>this.callback()</code>ä¸­ä¹Ÿä½¿ç”¨äº†<code>createContext()</code> å’Œ <code>handleRequest()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒä»¬åšæ¥ä»€ä¹ˆã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
     * Handle request in callback.
     *
     * @api private
     */</span>

    <span class="token function">handleRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fnMiddleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> onerror <span class="token operator">=</span> err <span class="token operator">=</span><span class="token operator">></span> ctx<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> handleResponse <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">respond</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onFinished</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">fnMiddleware</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Initialize a new context.
     *
     * @api private
     */</span>

    <span class="token function">createContext</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span>request <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> context<span class="token punctuation">.</span>response <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>app <span class="token operator">=</span> request<span class="token punctuation">.</span>app <span class="token operator">=</span> response<span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>req <span class="token operator">=</span> request<span class="token punctuation">.</span>req <span class="token operator">=</span> response<span class="token punctuation">.</span>req <span class="token operator">=</span> req<span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>res <span class="token operator">=</span> request<span class="token punctuation">.</span>res <span class="token operator">=</span> response<span class="token punctuation">.</span>res <span class="token operator">=</span> res<span class="token punctuation">;</span>
        request<span class="token punctuation">.</span>ctx <span class="token operator">=</span> response<span class="token punctuation">.</span>ctx <span class="token operator">=</span> context<span class="token punctuation">;</span>
        request<span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
        response<span class="token punctuation">.</span>request <span class="token operator">=</span> request<span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>originalUrl <span class="token operator">=</span> request<span class="token punctuation">.</span>originalUrl <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>åœ¨<code>createContext()</code>ä¸­ï¼Œè¿”å›ä¸€ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡<code>context</code>ã€‚åœ¨<code>handleRequest()</code>ä¸­ï¼Œå°†åº”ç”¨ä¸Šä¸‹æ–‡ctxå’Œä¸­é—´ä»¶è¿›è¡Œç»‘å®šã€‚<br />åœ¨Koa2ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸­é—´ä»¶çš„æ—¶å€™éœ€è¦ä½¿ç”¨<code>app.use()</code>æ¥æ³¨å†Œä¸­é—´ä»¶ï¼Œé‚£ä¹ˆ<code>app.use()</code>åˆ°åº•åšæ¥ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token comment" spellcheck="true">/**
     * Use the given middleware `fn`.
     *
     * Old-style middleware will be converted.
     *
     * @param {Function} fn
     * @return {Application} self
     * @api public
     */</span>

<span class="token function">use</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'middleware must be a function!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isGeneratorFunction</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token string">'Support for generators will be removed in v3. '</span> <span class="token operator">+</span>
              <span class="token string">'See the documentation for examples of how to convert old middleware '</span> <span class="token operator">+</span>
              <span class="token string">'https://github.com/koajs/koa/blob/master/docs/migration.md'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fn <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'use %s'</span><span class="token punctuation">,</span> fn<span class="token punctuation">.</span>_name <span class="token operator">||</span> fn<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>å»é™¤æ³¨é‡Šå’ŒéªŒè¯ï¼Œå®ƒåªåšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>å°†ä¸­é—´ä»¶å‡½æ•°pushåˆ°ä¸­é—´ä»¶æ•°ç»„(æ ˆ)ã€‚</li>
<li>è¿”å›koaå®ä¾‹å¯¹è±¡ã€‚<pre class=" language-javascript"><code class="language-javascript"><span class="token function">use</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
<p><a name="er16I"></a></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‰€è°“â€œæ´‹è‘±æ¨¡å‹â€ï¼Œå°±æ˜¯å½“æ‰§è¡Œä¸­é—´ä»¶å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœç¢°åˆ°<code>await next()</code>ï¼Œå°±ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼ˆä¸Šé¢è¯´è¿‡ï¼Œä¸­é—´ä»¶æ³¨å†Œçš„æ—¶å€™ï¼Œä¼šæŠŠä¸‹ä¸€ä¸ªä¸­é—´ä»¶å½“ä½œæœªæ¥çš„next()å‡½æ•°ï¼‰ï¼Œè¿™é‡Œnext()å°±æ˜¯ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Koa2/" rel="tag">Koa2</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Koa2/base" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/16/Koa2/base/"
    >Koa2åŸºç¡€</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/16/Koa2/base/" class="article-date">
  <time datetime="2020-01-16T03:20:00.000Z" itemprop="datePublished">2020-01-16</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Koa2/">Koa2</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="Koa2å­¦ä¹ ç¬”è®°"><a href="#Koa2å­¦ä¹ ç¬”è®°" class="headerlink" title="Koa2å­¦ä¹ ç¬”è®°"></a>Koa2å­¦ä¹ ç¬”è®°</h1><p><a name="1wfVW"></a></p>
<h2 id="Koa2ç®€ä»‹"><a href="#Koa2ç®€ä»‹" class="headerlink" title="Koa2ç®€ä»‹"></a>Koa2ç®€ä»‹</h2><p>Koaæ˜¯ä¸€æ¬¾æ–°çš„webæ¡†æ¶ï¼Œå®ƒæ˜¯ç”±ExpressåŸç­äººé©¬æ‰“é€ ï¼Œç›¸æ¯”ä¸Expressï¼ŒKoaæ›´åŠ miniã€ç®€æ´ã€å¥å£®ã€‚å®ƒæ²¡æœ‰ç»‘å®šä»»ä½•ä¸­é—´ä»¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ‰‹æ’¸ä»»ä½•ä¸­é—´ä»¶ã€‚è€Œä¸”ï¼ŒKoa2é€šè¿‡ä½¿ç”¨async/awaitï¼Œä½¿å¾—ä»£ç çš„å¯è¯»æ€§æ›´ä½³ã€‚<br><a name="XZjHi"></a></p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Koa2ä¾èµ–äºnodeV7.6.0æˆ–è€…ES2015åŠæ›´é«˜çš„ç‰ˆæœ¬å’Œasyncçš„æ”¯æŒã€‚</p>
<pre class=" language-javascript"><code class="language-javascript">#åˆå§‹åŒ–<span class="token keyword">package</span><span class="token punctuation">.</span>json
npm init
#å®‰è£…npm7
npm install <span class="token number">7</span>
#å®‰è£…koa2
npm install koa</code></pre>
<p><a name="2FIV5"></a></p>
<h3 id="async-await-å°demo"><a href="#async-await-å°demo" class="headerlink" title="async/await å°demo"></a>async/await å°demo</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test async'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>time<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'something'</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//async awaitç®€å•æ¡ˆä¾‹</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>2sä¹‹åï¼Œä¾æ¬¡æ‰“å°<code>test async something</code>ã€‚<br />awaitå¿…é¡»å­˜åœ¨äºasyncå‡½æ•°ä¹‹å†…ï¼Œä¸”awaitåé¢çš„ä»£ç ä¼šè¢«â€œé˜»å¡â€ï¼Œç­‰å¾…awaitåé¢çš„promiseæ‰§è¡Œã€‚</p>
<ul>
<li>å¯ä»¥è®©å¼‚æ­¥é€»è¾‘ç”¨åŒæ­¥å†™æ³•å®ç°</li>
<li>awaitè¿”å›çš„éœ€è¦æ˜¯promiseå¯¹è±¡</li>
<li>å¯ä»¥é€šè¿‡å¤šå±‚ async function çš„åŒæ­¥å†™æ³•ä»£æ›¿ä¼ ç»Ÿçš„callbackåµŒå¥—<br><a name="O7S0g"></a><h3 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h3></li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//å…¥é—¨ğŸŒ°</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello kaka'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello koa'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre>
<p>å¯åŠ¨demoï¼Œ<code>node app.js</code>ï¼Œæ‰“å¼€<a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a>ï¼Œå³å¯çœ‹åˆ°:<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579095453796-e8cb2c09-b080-429f-a755-a6cd34c2899e.png#align=left&display=inline&height=128&name=image.png&originHeight=256&originWidth=2130&size=92159&status=done&style=none&width=1065" alt="image.png"><br><a name="3vqTK"></a></p>
<h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><p><a name="kcrwS"></a></p>
<h3 id="kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨"><a href="#kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨" class="headerlink" title="kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨"></a>kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨</h3><p>ä¸­é—´ä»¶çš„ç±»å‹æœ‰ä¸€ä¸‹å››ç§ï¼š</p>
<ul>
<li>åº”ç”¨çº§ä¸­é—´ä»¶</li>
<li>è·¯ç”±çº§ä¸­é—´ä»¶</li>
<li>é”™è¯¯å¤„ç†ä¸­é—´ä»¶</li>
<li>ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶<br><a name="TRa97"></a><h4 id="æ´‹è‘±æ¨¡å‹"><a href="#æ´‹è‘±æ¨¡å‹" class="headerlink" title="æ´‹è‘±æ¨¡å‹"></a>æ´‹è‘±æ¨¡å‹</h4>å½“ä¸€ä¸ªä¸­é—´ä»¶è°ƒç”¨ next() åˆ™è¯¥å‡½æ•°æš‚åœå¹¶å°†æ§åˆ¶ä¼ é€’ç»™å®šä¹‰çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚<br />å½“åœ¨ä¸‹æ¸¸æ²¡æœ‰æ›´å¤šçš„ä¸­é—´ä»¶æ‰§è¡Œåï¼Œå †æ ˆå°†å±•å¼€å¹¶ä¸”æ¯ä¸ªä¸­é—´ä»¶æ¢å¤æ‰§è¡Œå…¶ä¸Šæ¸¸è¡Œä¸ºã€‚<br />çœ‹ğŸŒ°ï¼š</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//æ´‹è‘±æ¨¡å‹</span>

<span class="token comment" spellcheck="true">// #1</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// #2</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'koaæœåŠ¡å™¨å·²å¯åŠ¨'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//1 3 5 4 2</span></code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579098156840-d6938d82-0e6c-4268-bd66-8e6cf529ae30.png#align=left&display=inline&height=457&name=image.png&originHeight=914&originWidth=1194&size=499102&status=done&style=none&width=597" alt="image.png"><br /></p>
<p><a name="8UENn"></a></p>
<h4 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//middleware/logger.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>commondata <span class="token operator">=</span> <span class="token string">'æˆ‘æ˜¯åº”ç”¨çº§ä¸­é—´ä»¶'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"åº”ç”¨çº§ä¸­é—´ä»¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p><a name="PwNgl"></a></p>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//app.js</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./middleware/logger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//åº”ç”¨çº§ä¸­é—´ä»¶</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'koaæœåŠ¡å™¨å·²å¯åŠ¨'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><a name="zy98m"></a></p>
<h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p><a name="JZ0Uj"></a></p>
<h3 id="åŸç”Ÿå®ç°"><a href="#åŸç”Ÿå®ç°" class="headerlink" title="åŸç”Ÿå®ç°"></a>åŸç”Ÿå®ç°</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyparser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyparser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * @param { string } æ–‡ä»¶å
 * @return { promise } è¿”å›æ–‡ä»¶
 * 
 */</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> pagePath <span class="token operator">=</span> <span class="token template-string"><span class="token string">`./html/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pagePath<span class="token punctuation">)</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pagePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * @param { string } è®¿é—®è·¯ç”±
 * @return { string }  html
*/</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getHtml</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token string">'404.html'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'/'</span><span class="token punctuation">:</span>
            <span class="token punctuation">{</span>
                page <span class="token operator">=</span> <span class="token string">'index.html'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">'/list'</span><span class="token punctuation">:</span>
            <span class="token punctuation">{</span>
                page <span class="token operator">=</span> <span class="token string">'list.html'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token punctuation">{</span>
                page <span class="token operator">=</span> <span class="token string">'404.html'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">render</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> html
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//è¯»å–æ–‡ä»¶æ˜¯å¼‚æ­¥</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getHtml</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> html<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server is running at http://127.0.0.1:3000"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>å¯åŠ¨demoä¹‹åï¼Œè®¿é—®<a href="http://localhost:3000/ï¼Œ" target="_blank" rel="noopener">http://localhost:3000/</a>å³å¯<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579097257575-a5314b89-8a2d-465b-80a2-89b043ea75c2.png#align=left&display=inline&height=297&name=image.png&originHeight=594&originWidth=2136&size=160514&status=done&style=none&width=1068" alt="image.png"><br><a name="Vkn9O"></a></p>
<h3 id="koa-router"><a href="#koa-router" class="headerlink" title="koa-router"></a>koa-router</h3><p>å®‰è£…å¯¹åº”çš„koa-routerä¸­é—´ä»¶ï¼š<br /><code>npm install koa-router</code><br /><a href="https://github.com/yangkunxiao/koa2/blob/master/demo05.js" target="_blank" rel="noopener">demoæºç </a></p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyparser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//è®¾ç½®è·¯ç”±å‰ç¼€ </span>
    prefix<span class="token punctuation">:</span><span class="token string">'/kaka'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span>next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server is running at http://127.0.0.1:3000"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><a name="OQeoY"></a></p>
<h2 id="è¯·æ±‚æ•°æ®å¤„ç†"><a href="#è¯·æ±‚æ•°æ®å¤„ç†" class="headerlink" title="è¯·æ±‚æ•°æ®å¤„ç†"></a>è¯·æ±‚æ•°æ®å¤„ç†</h2><p><a name="LLtOO"></a></p>
<h3 id="Getè¯·æ±‚"><a href="#Getè¯·æ±‚" class="headerlink" title="Getè¯·æ±‚"></a>Getè¯·æ±‚</h3><p>åœ¨koaä¸­ï¼Œè·å–GETè¯·æ±‚æ•°æ®æºå¤´æ˜¯koaä¸­requestå¯¹è±¡ä¸­çš„queryæ–¹æ³•æˆ–querystringæ–¹æ³•ï¼Œqueryè¿”å›æ˜¯æ ¼å¼åŒ–å¥½çš„å‚æ•°å¯¹è±¡ï¼Œquerystringè¿”å›çš„æ˜¯è¯·æ±‚å­—ç¬¦ä¸²ï¼Œç”±äºctxå¯¹requestçš„APIæœ‰ç›´æ¥å¼•ç”¨çš„æ–¹å¼ï¼Œæ‰€ä»¥è·å–GETè¯·æ±‚æ•°æ®æœ‰ä¸¤ä¸ªé€”å¾„ã€‚</p>
<ul>
<li>æ˜¯ä»ä¸Šä¸‹æ–‡ä¸­ç›´æ¥è·å–</li>
<li>æ˜¯ä»ä¸Šä¸‹æ–‡çš„requestå¯¹è±¡ä¸­è·å–</li>
</ul>
<p>çœ‹ğŸŒ°: <a href="https://github.com/yangkunxiao/koa2/blob/master/demo03.js" target="_blank" rel="noopener">æºç </a></p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//ä½¿ç”¨ä¸­é—´ä»¶koa-bodyparser</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">;</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token keyword">const</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> request<span class="token punctuation">.</span>query<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿”å›çš„æ˜¯æ ¼å¼åŒ–å¥½çš„å‚æ•°å¯¹è±¡ã€‚</span>
    <span class="token keyword">const</span> querystring <span class="token operator">=</span> request<span class="token punctuation">.</span>querystring<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿”å›çš„æ˜¯è¯·æ±‚å­—ç¬¦ä¸²ã€‚</span>
    <span class="token comment" spellcheck="true">//ç›´æ¥ä»ctxä¸­è·å–query</span>
    <span class="token keyword">const</span> ctx_query <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ctx_querystring <span class="token operator">=</span> ctx<span class="token punctuation">.</span>querystring<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'GET'</span> <span class="token operator">&amp;&amp;</span> url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
        &lt;h1>Koa2 request post demo&lt;/h1>
        &lt;form method="POST"  action="/">
            &lt;p>userName&lt;/p>
            &lt;input name="userName" /> &lt;br/>
            &lt;p>age&lt;/p>
            &lt;input name="age" /> &lt;br/>
            &lt;p>webSite&lt;/p>
            &lt;input name='webSite' />&lt;br/>
            &lt;button type="submit">submit&lt;/button>
        &lt;/form>
        `</span></span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// const postDate = await handlePostData(ctx);</span>
        <span class="token keyword">const</span> postDate <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> postDate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//å…¶å®ƒè¯·æ±‚æ˜¾ç¤º404é¡µé¢</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1>404!&lt;/h1>'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        url<span class="token punctuation">,</span>
        methods<span class="token punctuation">,</span>
        query<span class="token punctuation">,</span>
        querystring<span class="token punctuation">,</span>
        ctx_query<span class="token punctuation">,</span>
        ctx_querystring
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre>
<p><a name="8dDci"></a></p>
<h3 id="Postè¯·æ±‚"><a href="#Postè¯·æ±‚" class="headerlink" title="Postè¯·æ±‚"></a>Postè¯·æ±‚</h3><p>å¯¹äºPOSTè¯·æ±‚çš„å¤„ç†ï¼Œkoa2æ²¡æœ‰å°è£…è·å–å‚æ•°çš„æ–¹æ³•ï¼Œéœ€è¦é€šè¿‡è§£æä¸Šä¸‹æ–‡contextä¸­çš„åŸç”Ÿnode.jsè¯·æ±‚å¯¹è±¡reqï¼Œå°†POSTè¡¨å•æ•°æ®è§£ææˆquery stringï¼Œå†å°†query string è§£ææˆJSONæ ¼å¼ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//ä½¿ç”¨nodeä¸­çš„æ–¹å¼å¤„ç†postè¯·æ±‚æ•°æ®</span>
<span class="token keyword">function</span> <span class="token function">handlePostData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> querystring <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                querystring <span class="token operator">+</span><span class="token operator">=</span> data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> bodyParse <span class="token operator">=</span> <span class="token function">parseStringData</span><span class="token punctuation">(</span>querystring<span class="token punctuation">)</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>bodyParse<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseStringData</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> stringList <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> stringList<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">[</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> item<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><a name="aKKyJ"></a></p>
<h3 id="ä½¿ç”¨koa-parserä¸­é—´ä»¶"><a href="#ä½¿ç”¨koa-parserä¸­é—´ä»¶" class="headerlink" title="ä½¿ç”¨koa-parserä¸­é—´ä»¶"></a>ä½¿ç”¨koa-parserä¸­é—´ä»¶</h3><p>å¯¹äºPOSTè¯·æ±‚çš„å¤„ç†ï¼Œkoa-bodyparserä¸­é—´ä»¶å¯ä»¥æŠŠkoa2ä¸Šä¸‹æ–‡çš„formDataæ•°æ®è§£æåˆ°ctx.request.bodyä¸­<br />å®‰è£…ï¼š<code>npm install koa-parser</code>ã€‚<br />ä½¿ç”¨ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> bodyParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//ä½¿ç”¨ä¸­é—´ä»¶koa-bodyparser</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a name="f0a8J"></a></p>
<h2 id="é™æ€èµ„æºå¤„ç†"><a href="#é™æ€èµ„æºå¤„ç†" class="headerlink" title="é™æ€èµ„æºå¤„ç†"></a>é™æ€èµ„æºå¤„ç†</h2><p><a name="QGNys"></a></p>
<h3 id="koa-staticä¸­é—´ä»¶"><a href="#koa-staticä¸­é—´ä»¶" class="headerlink" title="koa-staticä¸­é—´ä»¶"></a>koa-staticä¸­é—´ä»¶</h3><p>å®‰è£…ï¼š<code>npm install koa-static</code></p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./static'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token keyword">async</span> <span class="token punctuation">(</span> ctx <span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello world'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'static-use-middleware is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><a name="ZkFRd"></a></p>
<h2 id="cookie-session"><a href="#cookie-session" class="headerlink" title="cookie/session"></a>cookie/session</h2><p><a name="VybS8"></a></p>
<h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>koaæä¾›äº†ç›´æ¥æ“ä½œcookieçš„æ–¹æ³•ï¼š</p>
<ul>
<li>ctx.cookies.get(name, [options]) è¯»å–ä¸Šä¸‹æ–‡è¯·æ±‚ä¸­çš„cookie</li>
<li>ctx.cookies.set(name, value, [options]) åœ¨ä¸Šä¸‹æ–‡ä¸­å†™å…¥cookie</li>
</ul>
<p>ä½¿ç”¨ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * domainï¼šå†™å…¥cookieæ‰€åœ¨çš„åŸŸå
     * pathï¼šå†™å…¥cookieæ‰€åœ¨çš„è·¯å¾„
     * maxAgeï¼šCookieæœ€å¤§æœ‰æ•ˆæ—¶é•¿
     * expiresï¼šcookieå¤±æ•ˆæ—¶é—´
     * httpOnly:æ˜¯å¦åªç”¨httpè¯·æ±‚ä¸­è·å¾—
     * overwirteï¼šæ˜¯å¦å…è®¸é‡å†™
    */</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>
            <span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"ykx"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                domain<span class="token punctuation">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
                maxAge<span class="token punctuation">:</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">,</span>
                expires<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-12-30'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                httpOnly<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
                overwrite<span class="token punctuation">:</span><span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'cookie is ready'</span>
   <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> str <span class="token operator">=</span> ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> str<span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'cookies is none'</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

   <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a name="OvJpf"></a></p>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>koaåŸç”Ÿåªæä¾›äº†æ“ä½œcookieçš„æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰sessionæ“ä½œã€‚æ‰€ä»¥å¯¹sessinoçš„æ“ä½œéœ€è¦è‡ªå·±å®ç°æˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚<br />å°†sessionå­˜å‚¨åˆ°æ•°æ®åº“ï¼Œéœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ï¼š</p>
<ul>
<li>koa-session-minimal é€‚ç”¨äºkoa2 çš„sessionä¸­é—´ä»¶ï¼Œæä¾›å­˜å‚¨ä»‹è´¨çš„è¯»å†™æ¥å£ ã€‚</li>
<li>koa-mysql-session ä¸ºkoa-session-minimalä¸­é—´ä»¶æä¾›MySQLæ•°æ®åº“çš„sessionæ•°æ®è¯»å†™æ“ä½œã€‚</li>
</ul>
<p>å®‰è£…ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">npm install koa<span class="token operator">-</span>session<span class="token operator">-</span>minimal koa<span class="token operator">-</span>mysql<span class="token operator">-</span>session <span class="token operator">--</span>save</code></pre>
<p>è¿‡ç¨‹ï¼š</p>
<ul>
<li>ç”Ÿæˆsessionï¼Œå¹¶å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</li>
<li>ä½¿ç”¨æ’ä»¶æ“ä½œæ•°æ®åº“ï¼Œå¹¶å°†sessionIdå’Œå¯¹åº”çš„æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</li>
<li>å°†æ•°æ®åº“çš„sessionIdå†™å…¥åˆ°é¡µé¢çš„cookieä¸­ã€‚</li>
<li>æ ¹æ®é¡µé¢cookieæºå¸¦çš„sessionIdå–å‡ºæ•°æ®åº“ä¸­å¯¹åº”çš„æ•°æ®ã€‚</li>
</ul>
<p>çœ‹ä»£ç ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-session-minimal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MysqlSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-mysql-session"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// é…ç½®å­˜å‚¨sessionä¿¡æ¯çš„mysql</span>
<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MysqlSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ•°æ®åº“ç”¨æˆ·</span>
    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//å¯†ç </span>
    database<span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ•°æ®åº“åç§°</span>
    host<span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ•°æ®åº“åœ°å€</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// å­˜æ”¾sessionIdçš„cookieé…ç½®</span>
<span class="token keyword">let</span> cookie <span class="token operator">=</span> <span class="token punctuation">{</span>
    maxAge<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// cookieæœ‰æ•ˆæ—¶é•¿</span>
    expires<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// cookieå¤±æ•ˆæ—¶é—´</span>
    path<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å†™cookieæ‰€åœ¨çš„è·¯å¾„</span>
    domain<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å†™cookieæ‰€åœ¨çš„åŸŸå</span>
    httpOnly<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ˜¯å¦åªç”¨äºhttpè¯·æ±‚ä¸­è·å–</span>
    overwrite<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ˜¯å¦å…è®¸é‡å†™</span>
    secure<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    sameSite<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    signed<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    key<span class="token punctuation">:</span> <span class="token string">'SESSION_ID'</span><span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    cookie
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// è®¾ç½®session</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/set'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token punctuation">{</span>
            user_id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            count<span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// è¯»å–sessionä¿¡æ¯</span>
        ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>count <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] session is starting at port 3000'</span><span class="token punctuation">)</span></code></pre>
<p><a name="QgQlX"></a></p>
<h2 id="æ¨¡ç‰ˆå¼•æ“ejs"><a href="#æ¨¡ç‰ˆå¼•æ“ejs" class="headerlink" title="æ¨¡ç‰ˆå¼•æ“ejs"></a>æ¨¡ç‰ˆå¼•æ“ejs</h2><p><a name="KPvdu"></a></p>
<h3 id="ejs"><a href="#ejs" class="headerlink" title="ejs"></a>ejs</h3><p>å…·ä½“ä½¿ç”¨è¯·æŸ¥çœ‹<a href="https://ejs.bootcss.com/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a><br><a name="3zFI3"></a></p>
<h3 id="koa2ä½¿ç”¨ejs"><a href="#koa2ä½¿ç”¨ejs" class="headerlink" title="koa2ä½¿ç”¨ejs"></a>koa2ä½¿ç”¨ejs</h3><p>å®‰è£…ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">#å®‰è£…koaæ¨¡ç‰ˆä½¿ç”¨ä¸­é—´ä»¶
npm install koa<span class="token operator">-</span>views <span class="token operator">--</span>save
#å®‰è£…ejsæ¨¡ç‰ˆå¼•æ“
npm install ejs <span class="token operator">--</span>save</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> views <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-views'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//åŠ è½½ejsæ¨¡ç‰ˆ è®¾ç½®æ¨¡ç‰ˆæ–‡ä»¶å¤¹</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./views'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    extension<span class="token punctuation">:</span><span class="token string">'ejs'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token string">'hello ejs'</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//æ¸²æŸ“æ¨¡ç‰ˆ</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        title
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is starting at 127.0.0.1:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>viewsä¸‹çš„æ¨¡ç‰ˆï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>EJS Welcome to <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre>
<p><a name="M5CLj"></a></p>
<h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p><a name="b2vUY"></a></p>
<h4 id="busboy"><a href="#busboy" class="headerlink" title="busboy"></a>busboy</h4><p>busboyç”¨æ¥è§£æPostè¯·æ±‚ï¼Œè¯»å–åŸç”Ÿnodeçš„reqä¸­çš„æ–‡ä»¶æµã€‚å…·ä½“ä½¿ç”¨è¯·<a href="https://www.npmjs.com/package/busboy" target="_blank" rel="noopener">ç§»æ­¥</a>ã€‚<br />å®‰è£…ï¼š<br /><code>npm install busboy --save</code><br />ä½¿ç”¨ï¼š<a href="https://github.com/yangkunxiao/koa2/blob/master/demo12.js" target="_blank" rel="noopener">æºç </a><br />app.js</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//æ–‡ä»¶ä¸Šä¼ </span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Views <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-views'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./util/syncUpload.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">Views</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/views'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    extension<span class="token punctuation">:</span> <span class="token string">'ejs'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'static'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">upload</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'static'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;img src="'</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'" style="max-width: 100%">'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre>
<p>ejsä¸Šä¼ æ¨¡ç‰ˆï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>

<span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"ie=edge"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span>æ–‡ä»¶ä¸Šä¼ <span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>

<span class="token operator">&lt;</span>body<span class="token operator">></span>
    <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">"/upload"</span> method<span class="token operator">=</span><span class="token string">"post"</span> enctype<span class="token operator">=</span><span class="token string">"multipart/form-data"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"file"</span><span class="token operator">></span>æ–‡ä»¶<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> name<span class="token operator">=</span><span class="token string">"file"</span> id<span class="token operator">=</span><span class="token string">"file"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre>
<p>nodeä¸Šä¼ å¤„ç†æ–‡ä»¶</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> BusBoy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'busboy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€å
 * @param  {string} fileName è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€å
 * @return {string}          æ–‡ä»¶åç¼€å
 */</span>
<span class="token keyword">function</span> <span class="token function">getFileSuffixName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nameList <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> nameList<span class="token punctuation">[</span>nameList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">/**
 * åŒæ­¥åˆ›å»ºæ–‡ä»¶ç›®å½•
 * @param { string } filePath æ–‡ä»¶ä¸Šä¼ è·¯å¾„
 * @return { boolean }         è¿”å›ç»“æœ
 */</span>
<span class="token keyword">function</span> <span class="token function">mkdirPath</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * åŒæ­¥ä¸Šä¼ æ–‡ä»¶
 * @param { ctx } Object ä¸Šä¸‹æ–‡å¯¹è±¡
 * @param { options } Object é…ç½®å‚æ•°
 * @return { promise }   è¿”å›ä¸Šä¼ ç»“æœçš„promise
 */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> req <span class="token operator">=</span> ctx<span class="token punctuation">.</span>req<span class="token punctuation">;</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">;</span>
        <span class="token keyword">let</span> busboy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BusBoy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> headers<span class="token punctuation">:</span> req<span class="token punctuation">.</span>headers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>
            success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            path<span class="token punctuation">:</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>

        busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>fieldname<span class="token punctuation">,</span> file<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> mimetype<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'File ['</span> <span class="token operator">+</span> fieldname <span class="token operator">+</span> <span class="token string">']: filename: '</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">'encoding: '</span> <span class="token operator">+</span> encoding <span class="token operator">+</span> <span class="token string">'mimetype: '</span> <span class="token operator">+</span> mimetype<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> fileName <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> <span class="token function">getFileSuffixName</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// let filePath = mkdirPath(options.path) &amp;&amp; (options.path + '/' + filename);</span>
            <span class="token keyword">let</span> filePath <span class="token operator">=</span> filename<span class="token punctuation">;</span>
            file<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'File ['</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">'] got '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">' bytes'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            file<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'File ['</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">'] finished '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                result<span class="token punctuation">.</span>success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                result<span class="token punctuation">.</span>path <span class="token operator">=</span> filePath<span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            file<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// è§£æè¡¨å•ä¸­å…¶ä»–å­—æ®µä¿¡æ¯</span>
            busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'field'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fieldname<span class="token punctuation">,</span> val<span class="token punctuation">,</span> fieldnameTruncated<span class="token punctuation">,</span> valTruncated<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> mimetype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// console.log('è¡¨å•å­—æ®µæ•°æ® [' + fieldname + ']: value: ' + inspect(val));</span>
                <span class="token comment" spellcheck="true">// result.formData[fieldname] = inspect(val);</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// è§£æç»“æŸäº‹ä»¶</span>
            busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶ä¸Šä¼ ç»“æŸ'</span><span class="token punctuation">)</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// è§£æé”™è¯¯äº‹ä»¶</span>
            busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶ä¸Šä¼ å‡ºé”™'</span><span class="token punctuation">)</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            file<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        req<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>busboy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Koa2/" rel="tag">Koa2</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Optimize/img" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/13/Optimize/img/"
    >å›¾ç‰‡ä¼˜åŒ–</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/13/Optimize/img/" class="article-date">
  <time datetime="2020-01-12T16:47:00.000Z" itemprop="datePublished">2020-01-13</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Optimize/">Optimize</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="å›¾ç‰‡ä¼˜åŒ–"><a href="#å›¾ç‰‡ä¼˜åŒ–" class="headerlink" title="å›¾ç‰‡ä¼˜åŒ–"></a>å›¾ç‰‡ä¼˜åŒ–</h1><h3 id="ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ</h3><p>Googleå®˜æ–¹çš„æœ€ä½³å®è·µä¸­å…³äºå›¾ç‰‡ä¼˜åŒ–æœ‰ä¸‹é¢è¿™æ ·ä¸€æ®µæè¿°ï¼š</p>
<blockquote>
<p>å¯¹äºç½‘é¡µæ¥è¯´ï¼Œåœ¨æ‰€ä¸‹è½½çš„å­—èŠ‚æ•°ä¸­ï¼Œå›¾ç‰‡å¾€å¾€ä¼šå å¾ˆå¤§æ¯”ä¾‹ã€‚å› æ­¤ï¼Œä¼˜åŒ–å›¾ç‰‡é€šå¸¸å¯ä»¥å“æœ‰æˆæ•ˆåœ°å‡å°‘å­—èŠ‚æ•°å’Œæ”¹è¿›æ€§èƒ½ï¼šæµè§ˆå™¨éœ€è¦ä¸‹è½½çš„å­—èŠ‚æ•°è¶Šå°‘ï¼Œå¯¹å®¢æˆ·ç«¯å¸¦å®½çš„äº‰ç”¨å°±è¶Šå°‘ï¼Œæµè§ˆå™¨ä¸‹è½½å†…å®¹å¹¶åœ¨å±å¹•ä¸Šå‘ˆç°å†…å®¹çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›ç¬¬ä¸‰æ–¹æ–¹æ³•æ¥çœ‹ä¸€ä¸‹åœ¨ä¸€ä¸ªç½‘ç«™ä¸­ï¼Œå›¾ç‰‡æ‰€å æ¯”ä¾‹çš„å¤§å°ï¼šä½¿ç”¨<a href="https://webpagetest.org/" target="_blank" rel="noopener">webTest</a>ç½‘ç«™ï¼Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ä¸€ä¸ªç½‘ç«™é¦–å±åŠ è½½æ—¶ï¼Œå›¾ç‰‡æ‰€å æ¯”ä¾‹çš„å¤§å°ã€‚è€Œä¸”ç”µå•†ç½‘ç«™ä¸­ï¼Œå›¾ç‰‡æ‰€å æ¯”ä¾‹å æ¯”æ˜¯æœ€å¤§çš„ã€‚</p>
<p>é€šè¿‡ä¼˜åŒ–å›¾ç‰‡å¯ä»¥å‡å°‘å®¢æˆ·ç«¯ä¸‹è½½çš„å­—èŠ‚æ•°ï¼Œæ”¹è¿›ç½‘é¡µæ€§èƒ½ã€‚</p>
<h3 id="å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯"><a href="#å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯" class="headerlink" title="å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯"></a>å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯</h3><p>ä¸€èˆ¬å¸¸ç”¨çš„å›¾ç‰‡æ ¼å¼æœ‰é‚£ä¹ˆå‡ ç§ï¼šJPEG/JPGã€PNGã€WebPã€Base64ã€SVGã€‚</p>
<blockquote>
<p>JPEGå’ŒJPGæ ¼å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
</blockquote>
<p>æ²¡æœ‰åŒºåˆ«ï¼Œå…¨åã€æ­£å¼æ‰©å±•åæ˜¯JPEGã€‚ä½†å› DOSã€Windows 95ç­‰æ—©æœŸç³»ç»Ÿé‡‡ç”¨çš„8.3å‘½åè§„åˆ™åªæ”¯æŒæœ€é•¿3å­—ç¬¦çš„æ‰©å±•åï¼Œä¸ºäº†å…¼å®¹é‡‡ç”¨äº†.jpgã€‚ä¹Ÿå› å†å²ä¹ æƒ¯å’Œå…¼å®¹æ€§è€ƒè™‘ï¼Œ.jpgç›®å‰æ›´æµè¡Œã€‚</p>
<h4 id="JPEG-JPG"><a href="#JPEG-JPG" class="headerlink" title="JPEG/JPG"></a>JPEG/JPG</h4><p>ç‰¹ç‚¹ï¼šæœ‰æŸå‹ç¼©ï¼Œä½“ç§¯å°ï¼ŒåŠ è½½å¿«ï¼Œä¸æ”¯æŒé€æ˜ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºå‘ˆç°è‰²å½©ä¸°å¯Œçš„å›¾ç‰‡ï¼Œåœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼ŒJPG å›¾ç‰‡ç»å¸¸ä½œä¸ºå¤§çš„èƒŒæ™¯å›¾ã€è½®æ’­å›¾æˆ– Banner å›¾å‡ºç°ã€‚</p>
<h4 id="PNG"><a href="#PNG" class="headerlink" title="PNG"></a>PNG</h4><p>ç‰¹ç‚¹ï¼šæ— æŸå‹ç¼©ï¼Œä½“ç§¯å¤§ï¼Œè´¨é‡é«˜ï¼Œæ”¯æŒé€æ˜ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šPNG åœ¨å¤„ç†çº¿æ¡å’Œé¢œè‰²å¯¹æ¯”åº¦æ–¹é¢æœ‰ä¼˜åŠ¿ï¼Œä¸»è¦ç”¨å®ƒæ¥å‘ˆç°å°çš„ Logoã€é¢œè‰²ç®€å•ä¸”å¯¹æ¯”å¼ºçƒˆçš„å›¾ç‰‡æˆ–èƒŒæ™¯ç­‰</p>
<h4 id="SVG"><a href="#SVG" class="headerlink" title="SVG"></a>SVG</h4><p>ç‰¹ç‚¹ï¼šæ–‡æœ¬æ–‡ä»¶ï¼Œä½“ç§¯çº¿ï¼Œä¸å¤±çœŸï¼Œå…¼å®¹æ€§å¥½ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šå°† SVG å†™å…¥ç‹¬ç«‹æ–‡ä»¶åå¼•å…¥ HTML</p>
<p>â€‹    <code>&lt;img src=&quot;æ–‡ä»¶å.svg&quot; alt=&quot;&quot;&gt;</code></p>
<h4 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h4><p>ç‰¹ç‚¹ï¼šæ–‡æœ¬æ–‡ä»¶ã€ä¾èµ–ç¼–ç ã€å°å›¾æ ‡è§£å†³æ–¹æ¡ˆã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šå°å›¾æ ‡ï¼Œæ›´æ–°é¢‘ç‡éå¸¸ä½ï¼Œä½œä¸ºé›ªç¢§å›¾çš„è¡¥å……ã€‚</p>
<h4 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h4><blockquote>
<p>WebP æ˜¯ Google ä¸“ä¸º Web å¼€å‘çš„ä¸€ç§æ—¨åœ¨åŠ å¿«å›¾ç‰‡åŠ è½½é€Ÿåº¦çš„å›¾ç‰‡æ ¼å¼ï¼Œå®ƒæ”¯æŒæœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©ã€‚</p>
</blockquote>
<p>ç‰¹ç‚¹ï¼šå…¨èƒ½ï¼Œä½†æ˜¯æœ‰å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šé™åˆ¶æˆ‘ä»¬ä½¿ç”¨ WebP çš„æœ€å¤§é—®é¢˜ä¸æ˜¯â€œè¿™ä¸ªå›¾ç‰‡æ˜¯å¦é€‚åˆç”¨ WebP å‘ˆç°â€ï¼Œè€Œæ˜¯â€œæµè§ˆå™¨æ˜¯å¦å…è®¸ WebPâ€ã€‚</p>
<h3 id="å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ"></a>å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ</h3><h4 id="å‡å°‘å›¾ç‰‡ä½“ç§¯"><a href="#å‡å°‘å›¾ç‰‡ä½“ç§¯" class="headerlink" title="å‡å°‘å›¾ç‰‡ä½“ç§¯"></a>å‡å°‘å›¾ç‰‡ä½“ç§¯</h4><p>ä½¿ç”¨WebPçš„æ–¹å¼ï¼Œéƒ½å¯ä»¥åœ¨ä¸é™ä½å›¾ç‰‡è´¨é‡çš„æ¡ä»¶ä¸‹ï¼Œå‡å°‘å›¾ç‰‡ä½“ç§¯çš„ã€‚</p>
<blockquote>
<p>WebP çš„ä¼˜åŠ¿æ˜¯å®ƒå…·æœ‰æ›´ä¼˜çš„å›¾åƒæ•°æ®å‹ç¼©ç®—æ³•ï¼Œèƒ½å¸¦æ¥æ›´å°çš„å›¾ç‰‡ä½“ç§¯ï¼Œè€Œä¸”æ‹¥æœ‰è‚‰çœ¼è¯†åˆ«æ— å·®å¼‚çš„å›¾åƒè´¨é‡ï¼›åŒæ—¶å…·å¤‡äº†æ— æŸå’Œæœ‰æŸçš„å‹ç¼©æ¨¡å¼ã€Alpha é€æ˜ä»¥åŠåŠ¨ç”»çš„ç‰¹æ€§ï¼Œåœ¨ JPEG å’Œ PNG ä¸Šçš„è½¬åŒ–æ•ˆæœéƒ½ç›¸å½“ä¼˜ç§€ã€ç¨³å®šå’Œç»Ÿä¸€ã€‚</p>
</blockquote>
<p><a href="https://cloudconvert.com/" target="_blank" rel="noopener">cloudconvert</a>å¯ä»¥åœ¨çº¿è½¬æ¢WebPå›¾ç‰‡ã€‚</p>
<p>åœ¨æ·˜å®é¦–é¡µï¼Œå°±æœ‰ä¸€äº›å›¾ç‰‡å°±æ˜¯WebPç±»å‹çš„ã€‚æ·˜å®æ˜¯æ ¹æ®æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebPæ¥åŠ¨æ€çš„è®¾ç½®å›¾ç‰‡urlçš„ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebPå‘¢ï¼Ÿ</p>
<p>Googleå®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·å¤„ç†çš„ï¼ˆå…ˆåŠ è½½ä¸€ä¸ªWebPå›¾ç‰‡ï¼Œå¦‚æœèƒ½è·å–åˆ°å›¾ç‰‡çš„å®½åº¦å’Œé«˜åº¦ï¼Œå°±è¯´æ˜æ˜¯æ”¯æŒWebPçš„ï¼Œåä¹‹åˆ™ä¸æ”¯æŒï¼‰ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">check_webp_feature</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> kTestImages <span class="token operator">=</span> <span class="token punctuation">{</span>
        lossy<span class="token punctuation">:</span> <span class="token string">"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"</span><span class="token punctuation">,</span>
        lossless<span class="token punctuation">:</span> <span class="token string">"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=="</span><span class="token punctuation">,</span>
        alpha<span class="token punctuation">:</span> <span class="token string">"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="</span><span class="token punctuation">,</span>
        animation<span class="token punctuation">:</span> <span class="token string">"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>width <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>height <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"data:image/webp;base64,"</span> <span class="token operator">+</span> kTestImages<span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>åŸç†ï¼šå¯¹æ¯ä¸€ç§æ ¼å¼çš„webp(æœ‰æŸï¼Œæ— æŸï¼Œalphaé€šé“ï¼ŒåŠ¨æ€)ç”Ÿæˆä¸€ä¸ªå¾ˆå°åƒç´ çš„å›¾ç‰‡ï¼Œåœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå°±ä»£è¡¨æ”¯æŒwebpã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯è®©æœåŠ¡å™¨æ¥åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebPæ ¼å¼ï¼šæœåŠ¡å™¨é€šè¿‡HTTPè¯·æ±‚å¤´çš„Acceptå­—æ®µï¼Œæ¥åˆ¤æ–­è¿”å›ä»€ä¹ˆæ ¼å¼çš„å›¾ç‰‡ã€‚å½“ Accept å­—æ®µåŒ…å« image/webp æ—¶ï¼Œå°±è¿”å› WebP æ ¼å¼çš„å›¾ç‰‡ï¼Œå¦åˆ™è¿”å›åŸå›¾ã€‚</p>
<p>åˆ©ç”¨SVGOå‹ç¼©svgæ–‡ä»¶çš„å¤§å°ã€‚</p>
<h4 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h4><h4 id="å›¾ç‰‡æ‡’åŠ è½½"><a href="#å›¾ç‰‡æ‡’åŠ è½½" class="headerlink" title="å›¾ç‰‡æ‡’åŠ è½½"></a>å›¾ç‰‡æ‡’åŠ è½½</h4><p>æ‡’åŠ è½½çš„åŸç†æ˜¯ï¼šå°†å›¾ç‰‡çš„urlèµ‹å€¼ç»™imgçš„data-urlï¼ˆå¯è‡ªå®šä¹‰ï¼‰å±æ€§ï¼Œç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œå½“å›¾ç‰‡è¿›å…¥å¯è§†åŒºåŸŸæ—¶ï¼Œå°†data-urlçš„å€¼èµ‹å€¼ç»™imgçš„urlå±æ€§ï¼Œè¿™æ—¶æ‰çœŸæ­£å‘å‡ºå›¾ç‰‡çš„httpè¯·æ±‚ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ç®€å•çš„èŠ‚æµå‡½æ•°</span>
<span class="token comment" spellcheck="true">//fun è¦æ‰§è¡Œçš„å‡½æ•°</span>
<span class="token comment" spellcheck="true">//delay å»¶è¿Ÿ</span>
<span class="token comment" spellcheck="true">//time  åœ¨timeæ—¶é—´å†…å¿…é¡»æ‰§è¡Œä¸€æ¬¡</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span>fun<span class="token punctuation">,</span> delay<span class="token punctuation">,</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> timeout<span class="token punctuation">,</span>
        startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
            args <span class="token operator">=</span> arguments<span class="token punctuation">,</span>
            curTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å¦‚æœè¾¾åˆ°äº†è§„å®šçš„è§¦å‘æ—¶é—´é—´éš”ï¼Œè§¦å‘ handler</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>curTime <span class="token operator">-</span> startTime <span class="token operator">>=</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fun<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            startTime <span class="token operator">=</span> curTime<span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// æ²¡è¾¾åˆ°è§¦å‘é—´éš”ï¼Œé‡æ–°è®¾å®šå®šæ—¶å™¨</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>fun<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// å®é™…æƒ³ç»‘å®šåœ¨ scroll äº‹ä»¶ä¸Šçš„ handler</span>
<span class="token keyword">function</span> <span class="token function">lazyload</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> imgNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">&lt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"default.jpg"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> src <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"data-src"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>

                n <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// é‡‡ç”¨äº†èŠ‚æµå‡½æ•°</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>lazyload<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="å“åº”å¼å›¾ç‰‡"><a href="#å“åº”å¼å›¾ç‰‡" class="headerlink" title="å“åº”å¼å›¾ç‰‡"></a>å“åº”å¼å›¾ç‰‡</h4><blockquote>
<p>ä¸€ç§å¯ä»¥åœ¨ä¸åŒçš„å±å¹•å°ºå¯¸å’Œåˆ†è¾¨ç‡çš„è®¾å¤‡ä¸Šéƒ½èƒ½è‰¯å¥½å·¥ä½œä»¥åŠå…¶ä»–ç‰¹æ€§çš„å›¾ç‰‡.</p>
</blockquote>
<h4 id="è‰ºæœ¯æ–¹å‘"><a href="#è‰ºæœ¯æ–¹å‘" class="headerlink" title="è‰ºæœ¯æ–¹å‘"></a>è‰ºæœ¯æ–¹å‘</h4><p>å½“ä½ æƒ³ä¸ºä¸åŒå¸ƒå±€æä¾›ä¸åŒå‰ªè£çš„å›¾ç‰‡â€”â€”æ¯”å¦‚åœ¨æ¡Œé¢å¸ƒå±€ä¸Šæ˜¾ç¤ºå®Œæ•´çš„ã€æ¨ªå‘å›¾ç‰‡ï¼Œè€Œåœ¨æ‰‹æœºå¸ƒå±€ä¸Šæ˜¾ç¤ºä¸€å¼ å‰ªè£è¿‡çš„ã€çªå‡ºé‡ç‚¹çš„çºµå‘å›¾ç‰‡ï¼Œå¯ä»¥ç”¨  å…ƒç´ æ¥å®ç°ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>picture<span class="token operator">></span>
  <span class="token operator">&lt;</span>source media<span class="token operator">=</span><span class="token string">"(max-width: 799px)"</span> srcset<span class="token operator">=</span><span class="token string">"elva-480w-close-portrait.jpg"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>source media<span class="token operator">=</span><span class="token string">"(min-width: 800px)"</span> srcset<span class="token operator">=</span><span class="token string">"elva-800w.jpg"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"elva-800w.jpg"</span> alt<span class="token operator">=</span><span class="token string">"Chris standing up holding his daughter Elva"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>picture<span class="token operator">></span></code></pre>
<h4 id="åˆ†è¾¨ç‡åˆ‡æ¢"><a href="#åˆ†è¾¨ç‡åˆ‡æ¢" class="headerlink" title="åˆ†è¾¨ç‡åˆ‡æ¢"></a>åˆ†è¾¨ç‡åˆ‡æ¢</h4><p>å½“ä½ æƒ³è¦ä¸ºçª„å±æä¾›æ›´å°çš„å›¾ç‰‡æ—¶ï¼Œå› ä¸ºå°å±å¹•ä¸éœ€è¦åƒæ¡Œé¢ç«¯æ˜¾ç¤ºé‚£ä¹ˆå¤§çš„å›¾ç‰‡ï¼›ä»¥åŠä½ æƒ³ä¸ºé«˜/ä½åˆ†è¾¨ç‡å±å¹•æä¾›ä¸åŒåˆ†è¾¨ç‡çš„å›¾ç‰‡æ—¶ï¼Œéƒ½å¯ä»¥é€šè¿‡ vector graphics (SVG images)ã€ srcset ä»¥åŠ sizes å±æ€§æ¥å®ç°ã€‚</p>
<p>åˆ†è¾¨ç‡åˆ‡æ¢ï¼šä¸åŒçš„å°ºå¯¸</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>img srcset<span class="token operator">=</span>"elva<span class="token operator">-</span>fairy<span class="token operator">-</span>320w<span class="token punctuation">.</span>jpg 320w<span class="token punctuation">,</span>
             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>480w<span class="token punctuation">.</span>jpg 480w<span class="token punctuation">,</span>
             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>800w<span class="token punctuation">.</span>jpg 800w"
     sizes<span class="token operator">=</span>"<span class="token punctuation">(</span>max<span class="token operator">-</span>width<span class="token punctuation">:</span> 320px<span class="token punctuation">)</span> 280px<span class="token punctuation">,</span>
            <span class="token punctuation">(</span>max<span class="token operator">-</span>width<span class="token punctuation">:</span> 480px<span class="token punctuation">)</span> 440px<span class="token punctuation">,</span>
            800px"
     src<span class="token operator">=</span><span class="token string">"elva-fairy-800w.jpg"</span> alt<span class="token operator">=</span><span class="token string">"Elva dressed as a fairy"</span><span class="token operator">></span></code></pre>
<p>åˆ†è¾¨ç‡åˆ‡æ¢: ç›¸åŒçš„å°ºå¯¸, ä¸åŒçš„åˆ†è¾¨ç‡</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>img srcset<span class="token operator">=</span>"elva<span class="token operator">-</span>fairy<span class="token operator">-</span>320w<span class="token punctuation">.</span>jpg<span class="token punctuation">,</span>
             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>480w<span class="token punctuation">.</span>jpg <span class="token number">1</span><span class="token punctuation">.</span>5x<span class="token punctuation">,</span>
             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>640w<span class="token punctuation">.</span>jpg 2x"
     src<span class="token operator">=</span><span class="token string">"elva-fairy-640w.jpg"</span> alt<span class="token operator">=</span><span class="token string">"Elva dressed as a fairy"</span><span class="token operator">></span></code></pre>
<p>ä¸€èˆ¬æƒ…å†µä¸‹å½“æˆ‘ä»¬ç»™<code>img</code>è®¾ç½®å›ºå®šçš„å®½çš„æ—¶å€™,ä¸ºäº†åœ¨ä¸åŒçš„<code>dpr</code>è®¾å¤‡ä¸Šæ˜¾ç¤ºç›¸åŒçš„å¤§å°ï¼Œå¯ä»¥é…åˆ<code>x</code>æ¥ï¼Œä¾‹å¦‚<code>1.5x</code>ä»£è¡¨dprä¸º1.5çš„è®¾å¤‡</p>
<h4 id="srcset-sizes-æ–°ç‰¹æ€§"><a href="#srcset-sizes-æ–°ç‰¹æ€§" class="headerlink" title="srcset/sizes/ æ–°ç‰¹æ€§"></a>srcset/sizes/<picture> æ–°ç‰¹æ€§</h4><blockquote>
<p>å·²ç»è¢«æ–°ç‰ˆæœ¬çš„ç°ä»£æµè§ˆå™¨å’Œç§»åŠ¨æµè§ˆå™¨æ‰€æ”¯ æŒï¼ˆåŒ…æ‹¬Edgeï¼Œè€Œä¸æ˜¯IEï¼‰ã€‚</p>
</blockquote>
<ul>
<li><code>srcset</code>è¯­æ³•: â€œå›¾ç‰‡è·¯å¾„ ç‰©ç†åƒç´ , å›¾ç‰‡è·¯å¾„ ç‰©ç†åƒç´ , â€¦..â€ã€‚</li>
<li><code>size</code>: â€œåª’ä½“æŸ¥è¯¢ cssåƒç´ â€ã€‚</li>
<li><code>src</code>: å½“æµè§ˆå™¨ä¸æ”¯æŒä¸Šé¢çš„å±æ€§çš„æ—¶å€™ï¼Œé»˜è®¤åŠ è½½è¿™é‡Œã€‚</li>
</ul>
<p>åŠ è½½çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æŸ¥çœ‹è®¾å¤‡å®½åº¦</li>
<li>æŸ¥çœ‹sizesä¸­å“ªä¸€ä¸ªåª’ä½“æŸ¥è¯¢æ¡ä»¶ä¸ºçœŸã€‚</li>
<li>æŸ¥çœ‹ç»™äºˆè¯¥åª’ä½“æŸ¥è¯¢çš„æ§½å¤§å°ã€‚</li>
<li>åŠ è½½srcsetåˆ—è¡¨ä¸­å¼•ç”¨çš„<strong>æœ€æ¥è¿‘</strong>æ‰€é€‰çš„æ§½å¤§å°çš„å›¾åƒ</li>
</ul>
<p>ä¸€èˆ¬ <code>1px = 1w</code>ã€‚</p>
<h3 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a>å…¶ä»–æ–¹æ¡ˆ</h3><h4 id="é›ªç¢§å›¾"><a href="#é›ªç¢§å›¾" class="headerlink" title="é›ªç¢§å›¾"></a>é›ªç¢§å›¾</h4><h4 id="base64ç¼–ç å†…è”å°å›¾ç‰‡"><a href="#base64ç¼–ç å†…è”å°å›¾ç‰‡" class="headerlink" title="base64ç¼–ç å†…è”å°å›¾ç‰‡"></a>base64ç¼–ç å†…è”å°å›¾ç‰‡</h4><h4 id="cdnåŠ é€Ÿ"><a href="#cdnåŠ é€Ÿ" class="headerlink" title="cdnåŠ é€Ÿ"></a>cdnåŠ é€Ÿ</h4>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Optimize/" rel="tag">Optimize</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Interview/02" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/10/Interview/02/"
    >HTTPç¼“å­˜</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/10/Interview/02/" class="article-date">
  <time datetime="2020-01-10T14:20:00.000Z" itemprop="datePublished">2020-01-10</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="HTTPç¼“å­˜"><a href="#HTTPç¼“å­˜" class="headerlink" title="HTTPç¼“å­˜"></a>HTTPç¼“å­˜</h1><h3 id="HTTPæŠ¥æ–‡"><a href="#HTTPæŠ¥æ–‡" class="headerlink" title="HTTPæŠ¥æ–‡"></a>HTTPæŠ¥æ–‡</h3><p>HTTPæŠ¥æ–‡ï¼šä½œä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šè®¯æ—¶å‘é€å’Œå“åº”çš„æ•°æ®å—ã€‚æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ä¼šå‘é€è¯·æ±‚æŠ¥æ–‡ï¼ˆRequestï¼‰ï¼ŒæœåŠ¡å™¨å“åº”æµè§ˆå™¨çš„è¯·æ±‚æ—¶ï¼Œä¼šå‘é€å“åº”æŠ¥æ–‡ï¼ˆResponseï¼‰ã€‚</p>
<p>è¯·æ±‚æŠ¥æ–‡ï¼šåŒ…å«è¯·æ±‚æ–¹æ³•ã€ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰ã€åè®®ç‰ˆæœ¬å·ã€MIMEä¿¡æ¯ç­‰ã€‚</p>
<p>å“åº”æŠ¥æ–‡ï¼šåŒ…å«åè®®ç‰ˆæœ¬å·ã€å“åº”çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚</p>
<h3 id="ç¼“å­˜è§„åˆ™è§£æ"><a href="#ç¼“å­˜è§„åˆ™è§£æ" class="headerlink" title="ç¼“å­˜è§„åˆ™è§£æ"></a>ç¼“å­˜è§„åˆ™è§£æ</h3><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œæµè§ˆå™¨çš„ç¼“å­˜æ•°æ®åº“æ˜¯æ²¡æœ‰ç¼“å­˜çš„ï¼Œéœ€è¦å‘æœåŠ¡å™¨ç›´æ¥è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨å°†ä¼šæŠŠèµ„æºå’Œç¼“å­˜è§„åˆ™è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨å°†æŠŠèµ„æºå’Œç¼“å­˜è§„åˆ™è¿›è¡Œç¼“å­˜ã€‚å…·ä½“å¦‚å›¾æ‰€ç¤º:</p>
<p><img src="http://cdn.yangkunxiao.cn/HttpCache2.png#alt=http-cache1" alt=""></p>
<h4 id="å¼ºç¼“å­˜-from-disk-cache-200"><a href="#å¼ºç¼“å­˜-from-disk-cache-200" class="headerlink" title="å¼ºç¼“å­˜(from disk cache 200)"></a>å¼ºç¼“å­˜(from disk cache 200)</h4><p>å·²å­˜åœ¨ç¼“å­˜æ—¶ï¼Œè¯·æ±‚èµ„æºæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="http://cdn.yangkunxiao.cn/http-strong-cache.png#alt=http-strong-cache" alt=""></p>
<p>ä»ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¼ºç¼“å­˜å¦‚æœç¼“å­˜æ•°æ®åº“ä¸­å·²å­˜åœ¨æ•°æ®ä¸”æœªå¤±æ•ˆï¼Œé‚£ä¹ˆå°†ä¸ä¼šå’ŒæœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œç›´æ¥ä»èµ„æºæ•°æ®åº“ä¸­å–ã€‚</p>
<p>å¯¹äºå¼ºç¼“å­˜æ¥è¯´ï¼Œå“åº”å¤´å°†ä¼šæœ‰ä¸¤ä¸ªå­—ç«¯æ¥æ ‡è¯†å¤±æ•ˆè§„åˆ™ï¼š<code>Expires/Cache-Control</code>ã€‚</p>
<p>Expiresï¼šHttp1.0ã€‚å®ƒçš„å€¼ä¸ºæœåŠ¡ç«¯è¿”å›çš„åˆ°æœŸæ—¶é—´ã€‚å³ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶çš„æ—¶é—´å°äºè¯¥æ—¶é—´çš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚</p>
<p>Cache-Controlï¼šHttp1.1 ã€‚Cache-Control æ˜¯æœ€é‡è¦çš„è§„åˆ™ã€‚å¸¸è§çš„å–å€¼æœ‰privateã€publicã€no-cacheã€max-ageï¼Œno-storeï¼Œé»˜è®¤ä¸ºprivateã€‚</p>
<p><code>private</code>ï¼šå®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜ã€‚</p>
<p><code>public</code>ï¼š å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ç¼“å­˜ã€‚</p>
<p><code>max-age=xxx</code>ï¼šç¼“å­˜çš„å†…å®¹å°†åœ¨ xxx ç§’åå¤±æ•ˆã€‚</p>
<p><code>no-cache</code>ï¼šéœ€è¦ä½¿ç”¨å¯¹æ¯”ç¼“å­˜æ¥éªŒè¯ç¼“å­˜æ•°æ®ã€‚</p>
<p><code>no-store</code>ï¼šæ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šç¼“å­˜ï¼Œå¼ºåˆ¶ç¼“å­˜ï¼Œå¯¹æ¯”ç¼“å­˜éƒ½ä¸ä¼šè§¦å‘ã€‚</p>
<h4 id="å¯¹æ¯”ç¼“å­˜-304"><a href="#å¯¹æ¯”ç¼“å­˜-304" class="headerlink" title="å¯¹æ¯”ç¼“å­˜(304)"></a>å¯¹æ¯”ç¼“å­˜(304)</h4><p>å·²å­˜åœ¨ç¼“å­˜æ•°æ®æ—¶ï¼Œè¯·æ±‚èµ„æºçš„æµç¨‹ï¼š</p>
<p><img src="http://cdn.yangkunxiao.cn/http-negotiate-cache.png#alt=http--cache" alt=""></p>
<p>å¯¹æ¯”ç¼“å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œéœ€è¦è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚</p>
<p>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†ç¼“å­˜æ ‡è¯†ä¸æ•°æ®ä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†äºŒè€…å¤‡ä»½è‡³ç¼“å­˜æ•°æ®åº“ä¸­ã€‚</p>
<p>å†æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯å°†å¤‡ä»½çš„ç¼“å­˜æ ‡è¯†å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†è¿›è¡Œåˆ¤æ–­ï¼Œåˆ¤æ–­æˆåŠŸåï¼Œè¿”å›304çŠ¶æ€ç ï¼Œé€šçŸ¥å®¢æˆ·ç«¯æ¯”è¾ƒæˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚</p>
<p>åœ¨å¯¹æ¯”ç¼“å­˜ç”Ÿæ•ˆæ—¶ï¼ŒçŠ¶æ€ç ä¸º304ï¼Œå¹¶ä¸”æŠ¥æ–‡å¤§å°å’Œè¯·æ±‚æ—¶é—´å¤§å¤§å‡å°‘ã€‚</p>
<p>åŸå› æ˜¯ï¼ŒæœåŠ¡ç«¯åœ¨è¿›è¡Œæ ‡è¯†æ¯”è¾ƒåï¼Œåªè¿”å›headeréƒ¨åˆ†ï¼Œé€šè¿‡çŠ¶æ€ç é€šçŸ¥å®¢æˆ·ç«¯ä½¿ç”¨ç¼“å­˜ï¼Œä¸å†éœ€è¦å°†æŠ¥æ–‡ä¸»ä½“éƒ¨åˆ†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><code>If-Modified-Since/Last-Modified</code>:Http1.0 ã€‚æµè§ˆå™¨åœ¨è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥å¤´ä¸­ä¼šæºå¸¦<code>Last-Modified</code>å­—ç«¯ï¼Œå‘Šè¯‰æµè§ˆå™¨æ–‡ä»¶æœ€åä¿®æ”¹çš„æ—¶é—´ã€‚å½“æµè§ˆå™¨åœ¨æ­¤è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¼šæºå¸¦<code>If-Modified-Since</code>ï¼Œå‘Šè¯‰æœåŠ¡å™¨ä¸Šæ¬¡æ–‡ä»¶ä¿®æ”¹çš„æ—¶é—´ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯¥å­—æ®µä¹‹åï¼Œå’ŒæœåŠ¡å™¨æ–‡ä»¶èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´åšå¯¹æ¯”ï¼Œåˆ¤æ–­èµ„æºæ˜¯å¦æœ‰æ”¹åŠ¨ã€‚è‹¥æ”¹åŠ¨è¿‡ï¼Œåˆ™è¿”å›200ï¼Œå¹¶å°†æ•´ä¸ªèµ„æºè¿”å›ã€‚è‹¥èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´å°äºæˆ–ç­‰äºIf-Modified-Sinceï¼Œè¯´æ˜èµ„æºæ— æ–°ä¿®æ”¹ï¼Œåˆ™å“åº”HTTP 304ï¼Œå‘ŠçŸ¥æµè§ˆå™¨ç»§ç»­ä½¿ç”¨æ‰€ä¿å­˜çš„cacheã€‚<code>Last-Modified</code>ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯æ–‡ä»¶æœ€åçš„ä¿®æ”¹æ—¶é—´ï¼Œè€Œä¸”åªèƒ½ç²¾ç¡®åˆ°<code>1s</code>ä»¥å†…</p>
<p><code>If-None-Match/E-tag</code>ï¼šHttp1.1 ã€‚æœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨å†³å®šï¼‰ã€‚å’ŒLast-Modifiedä¸åŒï¼ŒE-tagæ›´ç²¾ç¡®ï¼Œå®ƒæ˜¯ç±»ä¼¼äºæŒ‡çº¹ä¸€æ ·çš„ä¸œè¥¿ï¼ŒåŸºäº<code>FileEtag INode Mtime Size</code>ç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ–‡ä»¶å˜ï¼ŒæŒ‡çº¹å°±ä¼šå˜ï¼Œè€Œä¸”æ²¡æœ‰1sç²¾ç¡®åº¦çš„é™åˆ¶ã€‚</p>
<p><img src="http://cdn.yangkunxiao.cn/HttpCache3.png#alt=http-cache" alt=""></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-JavaScript/block-scope" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/04/JavaScript/block-scope/"
    >å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜å’Œå‡½æ•°å£°æ˜</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/04/JavaScript/block-scope/" class="article-date">
  <time datetime="2020-01-04T12:00:00.000Z" itemprop="datePublished">2020-01-04</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜</h1><p>æœ€è¿‘åœ¨ä¸€ä¸ªè®¨è®ºç¾¤çœ‹åˆ°ä¸€ä¸ªé¢è¯•é¢˜ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre>
<p>whatï¼Ÿä¸åº”è¯¥æ˜¯ï¼šfunction a(){} ã€function a(){} å—ï¼Ÿ</p>
<p>æœ€åä¸€ä½ç‰›äººç»™å‡ºäº†ä»–çš„ç†è§£ï¼Œè¿™é‡Œæœ¬äººåªæ˜¯ä½œå‡ºéªŒè¯ï¼ŒåŠ æ·±ç†è§£ã€‚</p>
<blockquote>
<p>æ¥ä¸‹æ¥çš„ç¯å¢ƒé»˜è®¤éƒ½æ˜¯chromeç¯å¢ƒï¼Œæ”¯æŒES6ã€‚<br>ä¸‹æ–‡æå‡ºçš„é»˜è®¤å˜é‡æŒ‡çš„æ˜¯æ²¡æœ‰ä½¿ç”¨ varã€letã€constå®šä¹‰çš„å˜é‡ã€‚</p>
</blockquote>
<h3 id="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"><a href="#å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"></a>å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡</h3><p>æˆ‘ä»¬å…ˆçœ‹è¿™æ ·ä¸€ä¸ªğŸŒ°ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ReferenceError: a is not defined</span>
<span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre>
<p>å¯èƒ½æœ‰äº›äººä¼šåƒæˆ‘ä¸€æ ·æ„Ÿåˆ°è¯§å¼‚ï¼šä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªaæ‰“å°å‡ºæ¥çš„ä¸æ˜¯undefinedï¼Ÿ<code>a = 10</code>é»˜è®¤ä¸æ˜¯ <code>var a = 10</code>å—ï¼Ÿåº”è¯¥ä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸçš„é¡¶ç«¯çš„å•Šã€‚</p>
<p>é‚£å¥½ï¼Œè®©æˆ‘ä»¬æŠŠ<code>window.a</code>æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>
<span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€a is not defined</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre>
<p>ç»“è®ºï¼šæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰æ‰§è¡Œäº†å£°æ˜ä»£ç ï¼Œå˜é‡æ‰ä¼šè¢«æŒ‚è½½åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šã€‚</p>
<p>è®©æˆ‘ä»¬åœ¨çœ‹çœ‹ä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡çš„æƒ…å†µï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  undefined</span>
<span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€undefined</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre>
<p>ç»“è®ºï¼šå¯¹æ¯”ä¸Šä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šï¼Œä¸è¿‡å®ƒåªæ˜¯å°†å£°æ˜æå‡ï¼Œèµ‹å€¼æ“ä½œå¹¶æœªæå‡ä¸Šå»ã€‚</p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>åœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰ä»£ç æ‰§è¡Œåˆ°å£°æ˜è¯­å¥ä¹‹åï¼Œæ‰å¯ä»¥è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>
<li>å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li>
</ul>
<h3 id="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜</h3><p>åœ¨å—çº§ä½œç”¨åŸŸä¸­çš„å‡½æ•°å£°æ˜å’Œå˜é‡æ˜¯ä¸åŒçš„ã€‚ä¸å¤šè¯´ï¼Œç›´æ¥æ’¸ä»£ç ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>å›åˆ°ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœå—çº§ä½œç”¨åŸŸé‡Œé¢æ˜¯ä¸€ä¸ªé»˜è®¤å˜é‡ï¼Œåˆ™ç¬¬ä¸€è¡Œä»£ç ä¼šç›´æ¥æŠ¥é”™ï¼Œè€Œå‡½æ•°å£°æ˜åˆ™ä¼šæ‰“å°<code>undefined</code>ã€‚</p>
<p>å…¶å®åœ¨é˜®ä¸€å³°è€å¸ˆçš„<a href="">ECMAScript6å…¥é—¨</a>ä¸­å…³äºè¿™ä¸€ç‚¹å°±åšäº†æ˜ç¡®è¯´æ˜ï¼š</p>
<p><img src="http://cdn.yangkunxiao.cn/qw7bBH.png#align=left&display=inline&height=528&originHeight=528&originWidth=1192&status=done&style=none&width=1192" alt=""></p>
<p>å—çº§ä½œç”¨åŸŸå‡½æ•°ï¼Œå°±åƒé¢„å…ˆåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä½¿ç”¨<code>var</code>å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œä¸”é»˜è®¤å€¼ä¸º<code>undefined</code>ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span>
<span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>
  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span></code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€è¡Œè¾“å‡ºå¤§æ¦‚æ˜¯æ¯”è¾ƒç¬¦åˆé¢„æœŸçš„ã€‚è‡³äºç¬¬äºŒè¡Œ<code>window.a=undefoned</code>ï¼Œè€Œ<code>a=function a(){}</code> ï¼Œä¸Šé¢åœ¨é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ä¸­è¯´è¿‡ï¼Œå£°æ˜å‡½æ•°aä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¸”åœ¨å…¶å—çº§ä½œç”¨åŸŸä¸­ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°é¡¶å±‚ã€‚è€Œ<code>window.a</code>ä¸ºä»€ä¹ˆä¼šä¸º<code>undefined</code>å‘¢ï¼Ÿå› ä¸ºåªæœ‰<code>window.a</code>åªæœ‰ç­‰å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜çš„å®šä¹‰çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡ä¹‹åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</p>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>å—çº§ä½œç”¨åŸŸå‡½æ•°åœ¨ç¼–è¯‘é˜¶æ®µå°†å‡½æ•°å£°æ˜æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œå¹¶ä¸”ä¼šåœ¨å…¨å±€å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå€¼ä¸ºundefinedã€‚åŒæ—¶ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°å¯¹åº”çš„å—çº§ä½œç”¨åŸŸé¡¶å±‚ã€‚</li>
<li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰å®šä¹‰å£°æ˜å‡½æ•°çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li>
</ul>
<h3 id="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜</h3><p>çœ‹ğŸŒ°ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  10</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  function a(){}</span></code></pre>
<p>åœ¨è¿™é‡Œï¼Œé¦–å…ˆï¼Œå—çº§ä½œç”¨åŸŸå‡½æ•°açš„å£°æ˜ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œç¬¬ä¸€è¡Œæ‰“å°æ¯”è¾ƒç¬¦åˆé¢„æœŸã€‚ç„¶ååœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œç”±äºå£°æ˜å‡½æ•°aæå‡åˆ°å—çº§ä½œç”¨åŸŸé¡¶ç«¯ï¼Œæ‰€ä»¥æ‰“å°<code>a = function a(){}</code>ï¼Œè€Œ<code>window.a</code>ç”±äºå¹¶æ²¡æœ‰æ‰§è¡Œå‡½æ•°å®šä¹‰çš„é‚£ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥ä»ç„¶ä¸º<code>undefined</code>ã€‚å½“æ‰§è¡Œåˆ°å£°æ˜å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå‡½æ•°aæ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸä¸­ã€‚å½“æ‰§è¡Œ<code>a = 10</code>çš„æ—¶å€™ï¼ŒJSå¼•æ“ä¼šè¿›è¡ŒLHSæŸ¥æ‰¾ï¼Œæ­¤æ—¶ï¼Œå£°æ˜å‡½æ•°å·²ç»è¢«åŒæ—¶æå‡åˆ°å…¨å±€ä½œç”¨åŸŸå’Œå—çº§ä½œç”¨åŸŸé¡¶ç«¯äº†ï¼Œç”±äº<code>é®è”½æ•ˆæœ</code>ï¼Œæ­¤æ—¶æŸ¥æ‰¾aåªä¼šæ‰¾åˆ°å—çº§ä½œç”¨åŸŸå†…çš„aï¼Œå¹¶ä¸ä¼šæ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸçš„aï¼Œè¿™æ—¶ï¼Œaå·²ç»è¢«å®šä¹‰ï¼Œ<code>a = 10</code>åªä¼šæ‰§è¡Œèµ‹å€¼æ“ä½œï¼Œå¹¶ä¸ä¼šè¿›è¡Œæå‡ã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ğŸŒ°2ã€‚å®ƒä¼šæ›´åŠ æŠ½è±¡ï¼Œå‡†å¤‡å¥½äº†æ²¡ï¼Ÿ</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>
       a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10  10</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10 10</span></code></pre>
<p>æœ‰äº†ä¸Šé¢ä¾‹å­çš„é“ºå«ï¼Œç›¸ä¿¡å¤§å®¶å¯¹å‰ä¸¤è¡Œçš„æ‰“å°ç»“æœä¸ä¼šæœ‰ä»»ä½•ç–‘é—®äº†å§ï¼Ÿ</p>
<p>é‚£å¥½ï¼Œæˆ‘ä»¬ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæ‰§è¡Œ<code>a = 10</code>ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ­¤æ—¶ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜å·²ç»è¢«æå‡åˆ°é¡¶å±‚ï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰§è¡Œaï¼Œå°±æ˜¯ç›¸å½“äºèµ‹å€¼ï¼Œå°†å‡½æ•°å£°æ˜aèµ‹å€¼ä¸ºæ•°å­—aï¼Œå¯ä»¥ç†è§£å—ï¼Ÿå¦‚æœæœ‰ç–‘é—®ï¼Œå¯ä»¥çœ‹ğŸŒ°1ã€‚ç„¶åï¼Œæ‰§è¡Œåˆ°å‡½æ•°å£°æ˜è¯­å¥ï¼Œæ­¤æ—¶ï¼Œè™½ç„¶è¿™ä¸€è¡Œä»£ç æ˜¯å‡½æ•°å£°æ˜è¯­å¥ï¼Œä½†æ˜¯aï¼Œå·²ç»ä¸ºæ•°å­—10äº†ï¼Œæ‰€ä»¥ï¼Œæ‰§è¡Œ<code>function a(){}</code>ä¹‹åï¼Œaçš„å€¼10å°±ä¼šè¢«èµ‹å€¼ç»™å…¨å±€ä½œç”¨åŸŸä¸Šçš„aï¼Œæ‰€ä»¥ä¸‹é¢æ‰“å°çš„<code>window.a,a</code>éƒ½ä¸º10ï¼ï¼ï¼</p>
<h4 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰æ‰§è¡Œå‡½æ•°å£°æ˜è¯­å¥çš„æ—¶å€™ï¼Œæ‰ä¼šé‡å†™å¯¹åº”çš„å…¨å±€ä½œç”¨åŸŸä¸Šçš„åŒåå˜é‡ã€‚</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-JavaScript/async" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/03/JavaScript/async/"
    >å¼‚æ­¥ç¼–ç¨‹</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/03/JavaScript/async/" class="article-date">
  <time datetime="2020-01-03T09:00:00.000Z" itemprop="datePublished">2020-01-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="JavaScriptå¼‚æ­¥ç¼–ç¨‹"><a href="#JavaScriptå¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="JavaScriptå¼‚æ­¥ç¼–ç¨‹"></a>JavaScriptå¼‚æ­¥ç¼–ç¨‹</h1><p>JavaScriptå¼‚æ­¥ç¼–ç¨‹</p>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p>Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå®ƒæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæ›´åŠ åˆé€‚ã€å¼ºå¤§ã€‚æ‰€è°“Promiseï¼Œå°±æ˜¯ä¸€ç§å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢ä¿å­˜ç€æœªæ¥æ‰ä¼šå‘ç”Ÿçš„äº‹æƒ…ï¼ˆä¸€èˆ¬æ˜¯å¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚</p>
<p>Promiseæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›ä¸€ç³»åˆ—çš„APIå¯ä»¥å°†å¼‚æ­¥æ“ä½œçš„äº‹æƒ…ä»¥åŒæ­¥çš„å½¢å¼è¡¨ç°å‡ºæ¥ï¼Œæ¯”èµ·â€å›è°ƒåœ°ç‹±â€ï¼Œå®ƒçœ‹èµ·æ¥æ›´åŠ åˆé€‚ã€å¼ºå¤§ã€‚å®ƒå…·æœ‰ä»¥ä¸‹å‡ å¤§ç‰¹ç‚¹ï¼š</p>
<ul>
<li><code>Promise</code>çš„çŠ¶æ€ä¸å—ä»»ä½•å¤–ç•Œçš„å½±å“ã€‚Promiseçš„å¼‚æ­¥æ“ä½œæœ‰ä¸‰ç§çŠ¶æ€ï¼š    <code>pending</code>(æ‰§è¡Œä¸­)ã€<code>fulfilled</code>(å·²æˆåŠŸ)ã€<code>rejected</code>(å·²å¤±è´¥)ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœæ‰èƒ½å¤Ÿå†³å®š<code>Promise</code>çŠ¶æ€çš„èµ°å‘ã€‚</li>
<li><code>Promise</code>çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå˜ä¸å¯å†æ¬¡å˜åŠ¨ã€‚å®ƒçš„çŠ¶æ€å˜åŒ–åªæœ‰ä¸¤ç§æƒ…å†µï¼š<code>pending</code> =&gt; <code>fulfilled</code>ã€<code>pengding</code> =&gt; <code>rejected</code>ã€‚çŠ¶æ€ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸å†æ”¹å˜ï¼Œç§°ä¹‹ä¸º <code>resolved</code>(å·²å®šå‹)ã€‚</li>
</ul>
<p>Promiseä¸€æ—¦æ–°å»ºä¹‹åï¼Œå°±ä¼šç«‹å³æ‰§è¡Œã€‚è€ŒthenæŒ‡å®šçš„å›è°ƒå‡½æ•°åªæœ‰åŒæ­¥æ“ä½œæ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//æˆåŠŸå›è°ƒ</span>
  <span class="token comment" spellcheck="true">//todo</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//å¤±è´¥å›è°ƒ</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//todo</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><code>Promise</code>æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>resolve</code>å’Œ<code>reject</code>ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚</p>
<p><code>resolve</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» <code>pending</code> å˜ä¸º <code>resolved</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›<code>reject</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» <code>pending</code> å˜ä¸º <code>rejected</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p>
<p><code>Promise</code>å®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨<code>then</code>æ–¹æ³•åˆ†åˆ«æŒ‡å®š<code>resolved</code>çŠ¶æ€å’Œ<code>rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚ä½†æ˜¯ä¸€èˆ¬é»˜è®¤ä¸æŒ‡å®š<code>rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨<code>catch</code>ã€‚</p>
<p><code>finally</code>ä¸ç®¡<code>promise</code>æœ€ç»ˆçš„æ‰§è¡Œç»“æœå¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œã€‚</p>
<p><code>all</code>ï¼šæ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p>
<p><code>Promise.all()</code>æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨<code>Promise.resolve</code>æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚å¦å¤–ï¼Œ<code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        msg<span class="token punctuation">:</span> <span class="token string">'p1'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        msg<span class="token punctuation">:</span> <span class="token string">'p2'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        msg<span class="token punctuation">:</span> <span class="token string">'p3'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">,</span>res3<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//æ‰§è¡Œç»“æœï¼šp1 p2 p3</span></code></pre>
<p><code>p</code>çš„çŠ¶æ€ç”±p1,p2,p3å†³å®šï¼š</p>
<ul>
<li><p>åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p>
</li>
<li><p>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p>
</li>
</ul>
<p><code>race</code>ï¼šè¯¥æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>åªè¦åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p>
<p><code>allSettled</code>ï¼šè¯¥æ–¹æ³•ç”±<code>ES2020</code>å¼•å…¥ã€‚<code>Promise.allSettled()</code>æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªæœ‰ç­‰åˆ°æ‰€æœ‰è¿™äº›å‚æ•°å®ä¾‹éƒ½è¿”å›ç»“æœï¼Œä¸ç®¡æ˜¯<code>fulfilled</code>è¿˜æ˜¯<code>rejected</code>ï¼ŒåŒ…è£…å®ä¾‹æ‰ä¼šç»“æŸã€‚</p>
<p><code>any</code>ï¼š<code>Promise.any()</code>æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆ<code>rejected</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>rejected</code>çŠ¶æ€ã€‚è¯¥æ–¹æ³•ç›®å‰æ˜¯ä¸€ä¸ªç¬¬ä¸‰é˜¶æ®µçš„<a href="https://github.com/tc39/proposal-promise-any" target="_blank" rel="noopener">ææ¡ˆ</a> ã€‚</p>
<p><code>resolve</code>ï¼š<code>Promise.resolve()</code>å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ã€‚</p>
<ul>
<li><p>å‚æ•°æ˜¯ä¸€ä¸ª<code>Promise</code>å®ä¾‹ï¼šé‚£ä¹ˆ<code>Promise.resolve</code>å°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</p>
</li>
<li><p>å‚æ•°æ˜¯ä¸€ä¸ª <code>thenable</code> å®ä¾‹ï¼š<code>thenable</code>å¯¹è±¡æŒ‡çš„æ˜¯å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¯¹è±¡ã€‚ï¼š</p>
</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> thenable <span class="token operator">=</span> <span class="token punctuation">{</span>
  then<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p><code>Promise.resolve</code>æ–¹æ³•ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ<code>thenable</code>å¯¹è±¡çš„<code>then</code>æ–¹æ³•ã€‚</p>
<ul>
<li>å‚æ•°ä¸æ˜¯å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–æ ¹æœ¬å°±ä¸æ˜¯å¯¹è±¡ï¼šå¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™<code>Promise.resolve</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º<code>resolved</code>ã€‚</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Hello</span></code></pre>
<p><code>reject</code>ï¼š<code>Promise.reject(reason)</code>æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸º<code>rejected</code>ã€‚</p>
<h4 id="Generator-yield"><a href="#Generator-yield" class="headerlink" title="Generator/yield"></a>Generator/yield</h4><p>Generator å‡½æ•°æ˜¯ ES6 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚</p>
<p>Generator å‡½æ•°æœ‰å¤šç§ç†è§£è§’åº¦ã€‚è¯­æ³•ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚</p>
<p>æ‰§è¡Œ Generator å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGenerator å‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ª<code>éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°</code>ã€‚è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå† Generator å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>å½¢å¼ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾:</p>
<p>1ã€<code>function</code>å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›</p>
<p>2ã€å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨<code>yield</code>è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€</p>
<blockquote>
<p>Generator å‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„ï¼Œ<code>yield</code>è¡¨è¾¾å¼æ˜¯æš‚åœæ‰§è¡Œçš„æ ‡è®°ï¼Œè€Œ<code>next</code>æ–¹æ³•å¯ä»¥æ¢å¤æ‰§è¡Œã€‚</p>
</blockquote>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'world'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'ending'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> hwg <span class="token operator">=</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:hello,done:false }</span>
hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:world,done:false }</span>
hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:ending,done:true }</span>
hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:undefined,done:true }</span></code></pre>
<p>æ€»ç»“ï¼šè°ƒç”¨Generatorå‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå®ƒæ˜¯å‡½æ•°å†…éƒ¨çš„æŒ‡é’ˆï¼Œä»¥åæ¯è°ƒç”¨ä¸€æ¬¡nextå‡½æ•°ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªå¸¦æœ‰valueå’Œdoneå±æ€§çš„å¯¹è±¡ã€‚<code>next</code>æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ª<code>yield</code>è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚<code>value</code>å±æ€§è¡¨ç¤ºå½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å€¼ï¼Œæ˜¯<code>yield</code>è¡¨è¾¾å¼åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›<code>done</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éå†ç»“æŸã€‚</p>
<p>Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>return</code>æ–¹æ³•ï¼Œå¯ä»¥è¿”å›ç»™å®šçš„å€¼ï¼Œå¹¶ä¸”ç»ˆç»“éå† Generator å‡½æ•°ã€‚</p>
<h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><p>ES2017 æ ‡å‡†å¼•å…¥äº† async å‡½æ•°ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚å®ƒæ˜¯Generatorçš„è¯­æ³•ç³–ã€‚<code>async</code>å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰æ›¿æ¢æˆ<code>async</code>ï¼Œå°†<code>yield</code>æ›¿æ¢æˆ<code>await</code>ã€‚</p>
<p><code>async</code>å‡½æ•°å¯¹ Generator å‡½æ•°çš„æ”¹è¿›ï¼Œä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ã€‚</p>
<ul>
<li>å†…ç½®æ‰§è¡Œå™¨ã€‚</li>
</ul>
<p>Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ã€‚è€Œ<code>async</code>å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>async</code>å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚</p>
<ul>
<li>è¿”å›å€¼æ˜¯ Promise</li>
</ul>
<p><code>async</code>å‡½æ•°çš„è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iterator å¯¹è±¡æ–¹ä¾¿å¤šäº†ã€‚ä½ å¯ä»¥ç”¨<code>then</code>æ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p>
<p>è¿›ä¸€æ­¥è¯´ï¼Œ<code>async</code>å‡½æ•°å®Œå…¨å¯ä»¥çœ‹ä½œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼ŒåŒ…è£…æˆçš„ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œ<code>await</code>å‘½ä»¤å°±æ˜¯å†…éƒ¨<code>then</code>å‘½ä»¤çš„è¯­æ³•ç³–ã€‚</p>
<p><code>async</code>å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚<code>async</code>å‡½æ•°å†…éƒ¨<code>return</code>è¯­å¥è¿”å›çš„å€¼ï¼Œä¼šæˆä¸º<code>then</code>æ–¹æ³•å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚</p>
<p><code>async</code>å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡ï¼Œå¿…é¡»ç­‰åˆ°å†…éƒ¨æ‰€æœ‰<code>await</code>å‘½ä»¤åé¢çš„ Promise å¯¹è±¡æ‰§è¡Œå®Œï¼Œæ‰ä¼šå‘ç”ŸçŠ¶æ€æ”¹å˜ï¼Œé™¤éé‡åˆ°<code>return</code>è¯­å¥æˆ–è€…æŠ›å‡ºé”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰<code>async</code>å‡½æ•°å†…éƒ¨çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œï¼Œæ‰ä¼šæ‰§è¡Œ<code>then</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">timeFn</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//Promise æ–°å»ºåå°±ä¼šç«‹å³æ‰§è¡Œã€‚</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        msg<span class="token punctuation">:</span><span class="token string">'hello'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//Promiseçš„å†™æ³•</span>
  <span class="token comment" spellcheck="true">// timeFn(time).then(res => {</span>
  <span class="token comment" spellcheck="true">//     console.log(res);</span>
  <span class="token comment" spellcheck="true">// })</span>

  <span class="token comment" spellcheck="true">//async awaitçš„å†™æ³•</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">timeFn</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre>
<p>ç¨‹åºä¼šåœ¨3sä¹‹åæ‰“å°{msg:â€™helloâ€™}</p>
<p><code>await</code>ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>await</code>å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚å¦‚æœä¸æ˜¯ Promise å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œ<code>await</code>å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼ˆå³å®šä¹‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆ<code>await</code>ä¼šå°†å…¶ç­‰åŒäº Promise å¯¹è±¡ã€‚</p>
<p>å¦‚æœ<code>await</code>åé¢çš„å¼‚æ­¥æ“ä½œå‡ºé”™ï¼Œé‚£ä¹ˆç­‰åŒäº<code>async</code>å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡è¢«<code>reject</code>ã€‚</p>
<p><code>await</code>å‘½ä»¤åªèƒ½ç”¨åœ¨<code>async</code>å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<p>async å‡½æ•°çš„å®ç°åŸç†ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// ç­‰åŒäº</span>

<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//spawn è‡ªåŠ¨æ‰§è¡Œå™¨</span></code></pre>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-JavaScript/block-scope-function" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/03/JavaScript/block-scope-function/"
    >JavaScriptå—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡å’Œå£°æ˜å‡½æ•°
  <i class="article-topping">ç½®é¡¶</i>
</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/03/JavaScript/block-scope-function/" class="article-date">
  <time datetime="2020-01-03T06:27:00.000Z" itemprop="datePublished">2020-01-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜</h1><p>æœ€è¿‘åœ¨ä¸€ä¸ªè®¨è®ºç¾¤çœ‹åˆ°ä¸€ä¸ªé¢è¯•é¢˜ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre>
<p>whatï¼Ÿä¸åº”è¯¥æ˜¯ï¼šfunction a(){} ã€function a(){} å—ï¼Ÿ</p>
<p>æœ€åä¸€ä½ç‰›äººç»™å‡ºäº†ä»–çš„ç†è§£ï¼Œè¿™é‡Œæœ¬äººåªæ˜¯ä½œå‡ºéªŒè¯ï¼ŒåŠ æ·±ç†è§£ã€‚</p>
<blockquote>
<p>æ¥ä¸‹æ¥çš„ç¯å¢ƒé»˜è®¤éƒ½æ˜¯chromeç¯å¢ƒï¼Œæ”¯æŒES6ã€‚</p>
<p>ä¸‹æ–‡æå‡ºçš„é»˜è®¤å˜é‡æŒ‡çš„æ˜¯æ²¡æœ‰ä½¿ç”¨ varã€letã€constå®šä¹‰çš„å˜é‡ã€‚</p>
</blockquote>
<h3 id="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"><a href="#å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"></a>å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡</h3><p>æˆ‘ä»¬å…ˆçœ‹è¿™æ ·ä¸€ä¸ªğŸŒ°ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ReferenceError: a is not defined</span>
<span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre>
<p>å¯èƒ½æœ‰äº›äººä¼šåƒæˆ‘ä¸€æ ·æ„Ÿåˆ°è¯§å¼‚ï¼šä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªaæ‰“å°å‡ºæ¥çš„ä¸æ˜¯undefinedï¼Ÿ<code>a = 10</code>é»˜è®¤ä¸æ˜¯ <code>var a = 10</code>å—ï¼Ÿåº”è¯¥ä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸçš„é¡¶ç«¯çš„å•Šã€‚</p>
<p>é‚£å¥½ï¼Œè®©æˆ‘ä»¬æŠŠ<code>window.a</code>æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>
<span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€a is not defined</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre>
<p>ç»“è®ºï¼šæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰æ‰§è¡Œäº†å£°æ˜ä»£ç ï¼Œå˜é‡æ‰ä¼šè¢«æŒ‚è½½åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šã€‚</p>
<p>è®©æˆ‘ä»¬åœ¨çœ‹çœ‹ä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡çš„æƒ…å†µï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  undefined</span>
<span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€undefined</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre>
<p>ç»“è®ºï¼šå¯¹æ¯”ä¸Šä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šï¼Œä¸è¿‡å®ƒåªæ˜¯å°†å£°æ˜æå‡ï¼Œèµ‹å€¼æ“ä½œå¹¶æœªæå‡ä¸Šå»ã€‚</p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>åœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰ä»£ç æ‰§è¡Œåˆ°å£°æ˜è¯­å¥ä¹‹åï¼Œæ‰å¯ä»¥è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>
<li>å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li>
</ul>
<h3 id="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜</h3><p>åœ¨å—çº§ä½œç”¨åŸŸä¸­çš„å‡½æ•°å£°æ˜å’Œå˜é‡æ˜¯ä¸åŒçš„ã€‚ä¸å¤šè¯´ï¼Œç›´æ¥æ’¸ä»£ç ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>
<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>å›åˆ°ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœå—çº§ä½œç”¨åŸŸé‡Œé¢æ˜¯ä¸€ä¸ªé»˜è®¤å˜é‡ï¼Œåˆ™ç¬¬ä¸€è¡Œä»£ç ä¼šç›´æ¥æŠ¥é”™ï¼Œè€Œå‡½æ•°å£°æ˜åˆ™ä¼šæ‰“å°<code>undefined</code>ã€‚</p>
<p>å…¶å®åœ¨é˜®ä¸€å³°è€å¸ˆçš„<a href="[http://es6.ruanyifeng.com/#docs/let#%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F](http://es6.ruanyifeng.com/#docs/let#å—çº§ä½œç”¨åŸŸ)">ECMAScript6å…¥é—¨</a>ä¸­å…³äºè¿™ä¸€ç‚¹å°±åšäº†æ˜ç¡®è¯´æ˜ï¼š</p>
<p><img src="http://cdn.yangkunxiao.cn/qw7bBH.png" alt=""></p>
<p>å—çº§ä½œç”¨åŸŸå‡½æ•°ï¼Œå°±åƒé¢„å…ˆåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä½¿ç”¨<code>var</code>å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œä¸”é»˜è®¤å€¼ä¸º<code>undefined</code>ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span>
<span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>
  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span></code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€è¡Œè¾“å‡ºå¤§æ¦‚æ˜¯æ¯”è¾ƒç¬¦åˆé¢„æœŸçš„ã€‚è‡³äºç¬¬äºŒè¡Œ<code>window.a=undefoned</code>ï¼Œè€Œ<code>a=function a(){}</code> ï¼Œä¸Šé¢åœ¨é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ä¸­è¯´è¿‡ï¼Œå£°æ˜å‡½æ•°aä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¸”åœ¨å…¶å—çº§ä½œç”¨åŸŸä¸­ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°é¡¶å±‚ã€‚è€Œ<code>window.a</code>ä¸ºä»€ä¹ˆä¼šä¸º<code>undefined</code>å‘¢ï¼Ÿå› ä¸ºåªæœ‰<code>window.a</code>åªæœ‰ç­‰å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜çš„å®šä¹‰çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡ä¹‹åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</p>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>å—çº§ä½œç”¨åŸŸå‡½æ•°åœ¨ç¼–è¯‘é˜¶æ®µå°†å‡½æ•°å£°æ˜æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œå¹¶ä¸”ä¼šåœ¨å…¨å±€å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå€¼ä¸ºundefinedã€‚åŒæ—¶ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°å¯¹åº”çš„å—çº§ä½œç”¨åŸŸé¡¶å±‚ã€‚</li>
<li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰å®šä¹‰å£°æ˜å‡½æ•°çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li>
</ul>
<h3 id="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜</h3><p>çœ‹ğŸŒ°ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  10</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  function a(){}</span></code></pre>
<p>åœ¨è¿™é‡Œï¼Œé¦–å…ˆï¼Œå—çº§ä½œç”¨åŸŸå‡½æ•°açš„å£°æ˜ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œç¬¬ä¸€è¡Œæ‰“å°æ¯”è¾ƒç¬¦åˆé¢„æœŸã€‚ç„¶ååœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œç”±äºå£°æ˜å‡½æ•°aæå‡åˆ°å—çº§ä½œç”¨åŸŸé¡¶ç«¯ï¼Œæ‰€ä»¥æ‰“å°<code>a = function a(){}</code>ï¼Œè€Œ<code>window.a</code>ç”±äºå¹¶æ²¡æœ‰æ‰§è¡Œå‡½æ•°å®šä¹‰çš„é‚£ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥ä»ç„¶ä¸º<code>undefined</code>ã€‚å½“æ‰§è¡Œåˆ°å£°æ˜å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå‡½æ•°aæ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸä¸­ã€‚å½“æ‰§è¡Œ<code>a = 10</code>çš„æ—¶å€™ï¼ŒJSå¼•æ“ä¼šè¿›è¡ŒLHSæŸ¥æ‰¾ï¼Œæ­¤æ—¶ï¼Œå£°æ˜å‡½æ•°å·²ç»è¢«åŒæ—¶æå‡åˆ°å…¨å±€ä½œç”¨åŸŸå’Œå—çº§ä½œç”¨åŸŸé¡¶ç«¯äº†ï¼Œç”±äº<code>é®è”½æ•ˆæœ</code>ï¼Œæ­¤æ—¶æŸ¥æ‰¾aåªä¼šæ‰¾åˆ°å—çº§ä½œç”¨åŸŸå†…çš„aï¼Œå¹¶ä¸ä¼šæ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸçš„aï¼Œè¿™æ—¶ï¼Œaå·²ç»è¢«å®šä¹‰ï¼Œ<code>a = 10</code>åªä¼šæ‰§è¡Œèµ‹å€¼æ“ä½œï¼Œå¹¶ä¸ä¼šè¿›è¡Œæå‡ã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ğŸŒ°2ã€‚å®ƒä¼šæ›´åŠ æŠ½è±¡ï¼Œå‡†å¤‡å¥½äº†æ²¡ï¼Ÿ</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>
       a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10  10</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10 10</span></code></pre>
<p>æœ‰äº†ä¸Šé¢ä¾‹å­çš„é“ºå«ï¼Œç›¸ä¿¡å¤§å®¶å¯¹å‰ä¸¤è¡Œçš„æ‰“å°ç»“æœä¸ä¼šæœ‰ä»»ä½•ç–‘é—®äº†å§ï¼Ÿ</p>
<p>é‚£å¥½ï¼Œæˆ‘ä»¬ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæ‰§è¡Œ<code>a = 10</code>ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ­¤æ—¶ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜å·²ç»è¢«æå‡åˆ°é¡¶å±‚ï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰§è¡Œaï¼Œå°±æ˜¯ç›¸å½“äºèµ‹å€¼ï¼Œå°†å‡½æ•°å£°æ˜aèµ‹å€¼ä¸ºæ•°å­—aï¼Œå¯ä»¥ç†è§£å—ï¼Ÿå¦‚æœæœ‰ç–‘é—®ï¼Œå¯ä»¥çœ‹ğŸŒ°1ã€‚ç„¶åï¼Œæ‰§è¡Œåˆ°å‡½æ•°å£°æ˜è¯­å¥ï¼Œæ­¤æ—¶ï¼Œè™½ç„¶è¿™ä¸€è¡Œä»£ç æ˜¯å‡½æ•°å£°æ˜è¯­å¥ï¼Œä½†æ˜¯aï¼Œå·²ç»ä¸ºæ•°å­—10äº†ï¼Œæ‰€ä»¥ï¼Œæ‰§è¡Œ<code>function a(){}</code>ä¹‹åï¼Œaçš„å€¼10å°±ä¼šè¢«èµ‹å€¼ç»™å…¨å±€ä½œç”¨åŸŸä¸Šçš„aï¼Œæ‰€ä»¥ä¸‹é¢æ‰“å°çš„<code>window.a,a</code>éƒ½ä¸º10ï¼ï¼ï¼</p>
<h4 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰æ‰§è¡Œå‡½æ•°å£°æ˜è¯­å¥çš„æ—¶å€™ï¼Œæ‰ä¼šé‡å†™å¯¹åº”çš„å…¨å±€ä½œç”¨åŸŸä¸Šçš„åŒåå˜é‡ã€‚</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-JavaScript/variableHoisting" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/01/JavaScript/variableHoisting/"
    >JSå˜é‡æå‡</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/01/JavaScript/variableHoisting/" class="article-date">
  <time datetime="2020-01-01T09:00:00.000Z" itemprop="datePublished">2020-01-01</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰"><a href="#æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰" class="headerlink" title="æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰"></a>æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰</h1><p>é¦–å…ˆï¼Œå…ˆä¸¢å‡ºæ¥ä¸€é“é¢˜ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>å¦‚æœæˆ‘ä»¬ä¸äº†è§£JavaScriptä¸­çš„å˜é‡æå‡å’Œå‡½æ•°å£°æ˜æå‡ï¼Œé‚£æˆ‘ä»¬çš„ç­”æ¡ˆå¯èƒ½å°±æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">undefined

ReferenceError<span class="token punctuation">:</span> b is not defined

<span class="token operator">...</span>
</code></pre>
<p>é‚£ä¹ˆæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬é¦–å…ˆæŠŠè¿™æ®µä»£ç è¿˜åŸï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>



console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>å¥½äº†ï¼Œè¿™ä¸‹çœ‹ä¸€çœ‹æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token string">"function"</span>

<span class="token string">"function"</span>

<span class="token string">"number"</span>

<span class="token string">"a is not a function"</span></code></pre>
<h2 id="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ç‚¹ç¼–è¯‘åŸç†çš„çŸ¥è¯†ã€‚JavaScriptçš„æºä»£ç åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šç»è¿‡ä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œæ‰§è¡Œã€‚è€Œä¸”ï¼Œç¼–è¯‘é˜¶æ®µå¾€å¾€å°±åœ¨æ‰§è¡Œé˜¶æ®µçš„å‰å‡ å¾®ç§’ç”šè‡³æ›´çŸ­çš„æ—¶é—´å†…ã€‚</p>
<h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><h4 id="è¯æ³•è§£æ"><a href="#è¯æ³•è§£æ" class="headerlink" title="è¯æ³•è§£æ"></a>è¯æ³•è§£æ</h4><p>è¿™ä¸ªé˜¶æ®µä¼šå…ˆæŠŠå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªä¸ªæœ‰æ„ä¹‰çš„ä»£ç å—ï¼Œè¿™äº›ä»£ç å—ä¹Ÿè¢«ç§°ä¸ºè¯æ³•å•å…ƒã€‚å¦‚ <code>var a = 1;</code> ä¼šè¢«è§£ææˆï¼š <code>var ã€aã€=ã€1ã€;</code> ï¼Œç©ºæ ¼æ˜¯å¦ä¼šè¢«è§£ææˆè¯æ³•å•å…ƒï¼Œå°±è¦çœ‹ç©ºæ ¼åœ¨è¿™ä¸ªè¯­è¨€ä¸­æœ‰æ„ä¹‰ã€‚</p>
<h4 id="è¯­æ³•è§£æ"><a href="#è¯­æ³•è§£æ" class="headerlink" title="è¯­æ³•è§£æ"></a>è¯­æ³•è§£æ</h4><p>è¿™ä¸ªé˜¶æ®µä¼šæŠŠè¯æ³•è§£æç”Ÿæˆçš„è¯æ³•å•å…ƒæµè§£ææˆæœ‰å…ƒç´ é€çº§åµŒå¥—æ‰€ç»„æˆçš„ç¨‹åºè¯­æ³•æ ‘ï¼ŒASTã€‚è‡³äºASTçš„ç»“æ„æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªç½‘ç«™ï¼Œå¤§å®¶å¯ä»¥å»è¯•è¯•: <a href="https://esprima.org/demo/parse.html#" target="_blank" rel="noopener">ç½‘ç«™1</a>ã€<a href="https://resources.jointjs.com/demos/javascript-ast" target="_blank" rel="noopener">ç½‘ç«™2</a>ã€‚</p>
<h4 id="ä»£ç ç”Ÿæˆ"><a href="#ä»£ç ç”Ÿæˆ" class="headerlink" title="ä»£ç ç”Ÿæˆ"></a>ä»£ç ç”Ÿæˆ</h4><p>è¿™ä¸ªé˜¶æ®µå°±æ˜¯å°†è¯­æ³•è§£æé˜¶æ®µç”Ÿæˆçš„ASTè½¬è¯‘æˆå¯æ‰§è¡Œçš„ä»£ç ã€‚</p>
<h3 id="å˜é‡æå‡"><a href="#å˜é‡æå‡" class="headerlink" title="å˜é‡æå‡"></a>å˜é‡æå‡</h3><h4 id="LHSæŸ¥è¯¢"><a href="#LHSæŸ¥è¯¢" class="headerlink" title="LHSæŸ¥è¯¢"></a>LHSæŸ¥è¯¢</h4><p>åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆå°†æ ‡è¯†ç¬¦å’Œå‡½æ•°å£°æ˜ç»™æå‡åˆ°å…¶å¯¹åº”çš„ä½œç”¨åŸŸçš„é¡¶ç«¯ã€‚æ ‡è¯†ç¬¦è§£æçš„æ—¶å€™ï¼Œä¼šè¿›è¡ŒLHSæŸ¥è¯¢ï¼Œåœ¨LHSæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœæ ‡è¯†ç¬¦ä¸€ç›´æ‰¾ä¸åˆ°å£°æ˜çš„ä½ç½®ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šåœ¨å…¨å±€ç¯å¢ƒç”Ÿæˆä¸€ä¸ªå…¨å±€å˜é‡ã€‚</p>
<blockquote>
<p>LHS ï¼š æŒ‡çš„æ˜¯èµ‹å€¼æ“ä½œçš„å·¦ç«¯ã€‚<br>æ ‡è¯†ç¬¦è§£æï¼šè¯·æŸ¥çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ã€‚</p>
</blockquote>
<h4 id="RHSæŸ¥è¯¢"><a href="#RHSæŸ¥è¯¢" class="headerlink" title="RHSæŸ¥è¯¢"></a>RHSæŸ¥è¯¢</h4><p>è¯´åˆ°LHSæŸ¥è¯¢ï¼Œå°±ä¸å¾—ä¸æå¯¹åº”çš„RHSæŸ¥è¯¢ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»çœ‹å‡ºRHSçš„æ„æ€äº†æŠŠï¼Œå®ƒæŒ‡çš„æ˜¯èµ‹å€¼æ“ä½œçš„æºå¤´ã€‚RHSæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„æ ‡è¯†ç¬¦ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼šReferenceErrorã€‚</p>
<h3 id="å‡½æ•°æå‡"><a href="#å‡½æ•°æå‡" class="headerlink" title="å‡½æ•°æå‡"></a>å‡½æ•°æå‡</h3><p>å‡½æ•°æå‡å’Œå˜é‡æå‡è¿˜æœ‰ç‚¹ä¸ä¸€æ ·ã€‚å‡½æ•°æå‡ï¼Œåªä¼šæå‡å‡½æ•°å£°æ˜ï¼Œè€Œä¸ä¼šæå‡å‡½æ•°è¡¨è¾¾å¼ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//fn is not a function </span>

<span class="token comment" spellcheck="true">//å‡½æ•°è¡¨è¾¾å¼</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//å‡½æ•°å£°æ˜</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>è¿™é‡Œæˆ‘æŠŠä»£ç è¿˜åŸï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//å‡½æ•°å£°æ˜</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> fn<span class="token punctuation">;</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>è¿™ä¸‹æ˜ç™½ä¸ºä»€ä¹ˆæ‰§è¡Œå‡½æ•°fnçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™äº†å§ã€‚</p>
<h3 id="å—çº§ä½œç”¨åŸŸ"><a href="#å—çº§ä½œç”¨åŸŸ" class="headerlink" title="å—çº§ä½œç”¨åŸŸ"></a>å—çº§ä½œç”¨åŸŸ</h3><p>å—çº§ä½œç”¨åŸŸæ˜¯åœ¨ES6ä¸­æå‡ºçš„ä¸€ä¸ªæ¦‚å¿µï¼ŒES5ä¸­æ˜¯æ²¡æœ‰å—çº§ä½œç”¨åŸŸçš„ï¼Œåªæœ‰å…¨å±€ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸã€‚<br>æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸ªæ¡ˆä¾‹ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>
<span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        yideng <span class="token operator">=</span> a<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"yideng1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//function</span></code></pre>
<p>è¿˜æ˜¯æŠŠè¿™æ®µä»£ç è¿˜åŸä¸€ä¸‹ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a<span class="token punctuation">,</span>flag<span class="token punctuation">,</span>fn<span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token operator">...</span></code></pre>
<p>æˆ–è®¸æœ‰äººä¼šé—®ï¼šä¸ºä»€ä¹ˆaå’Œå‡½æ•°fnä¼šè¢«æåˆ°æœ€é¡¶ç«¯ï¼Ÿå˜é‡aå’Œå‡½æ•°fnéƒ½æ˜¯åœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œå…¶ä¸­aæ˜¯é€šè¿‡varè¿›è¡Œå£°æ˜çš„ï¼Œå‡½æ•°fnæ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜ã€‚è€Œéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå—çº§ä½œç”¨åŸŸæ˜¯é˜»æŒ¡ä¸äº†varå£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜çš„æå‡çš„ã€‚ä½†æ˜¯ï¼Œå£°æ˜å‡½æ•°ã€‚<br>æ›´è¿›ä¸€æ­¥</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//5 5</span>

    a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//5 0</span>

<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//5 5</span></code></pre>
<p>å¤§å®¶çœ‹åˆ°è¿™ä¸ªç­”æ¡ˆæ˜¯ä¸æ˜¯å¾ˆç–‘æƒ‘ï¼Ÿå½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªç­”æ¡ˆçš„æ—¶å€™ï¼Œå†…å¿ƒä¹Ÿæ˜¯ä¸€ä¸‡ä¸ªğŸ¦™å¥”è…¾è€Œè¿‡ã€‚<br>æˆ‘ä»¬ä¸Šé¢è¯´è¿‡ï¼Œå—çº§ä½œç”¨åŸŸä¸­ï¼Œåªæœ‰varå£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜å¯ä»¥ç›´æ¥æåˆ°å…¨å±€ä½œç”¨åŸŸã€‚å—çº§ä½œç”¨åŸŸä¸­çš„ä¸å®ç”¨varå£°æ˜çš„å˜é‡ï¼Œä¹Ÿä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä½†æ˜¯åªæœ‰åœ¨å—çº§ä½œç”¨åŸŸä¸­è¿è¡Œä¹‹åï¼Œæ‰ä¼šåå°„åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šã€‚<br>è€Œä¸”å—çº§ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸå®Œå…¨ä¸åŒï¼šå‡½æ•°ä½œç”¨åŸŸä¼šåœ¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œé‡å†™windowã€‚è€Œå—çº§ä½œç”¨åŸŸä¹‹åè¿›è¡Œä¸€æ¬¡æœ‰æ„ä¹‰çš„é‡å†™ã€‚æ‰€è°“æœ‰æ„ä¹‰çš„é‡å†™ï¼Œå°±æ˜¯åœ¨å¤–å±‚ä½œç”¨åŸŸæ²¡æœ‰å£°æ˜å’Œèµ‹å€¼ã€‚<br>åœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œå‡½æ•°å£°æ˜ä¼šæå‡åˆ°å½“å‰ä½œç”¨åŸŸé¡¶å±‚ï¼Œè‡³äºä¼šä¸ä¼šé‡å†™å¤–å±‚å˜é‡ï¼Œé‚£å°±è¦çœ‹æ˜¯å¦æœ‰å®é™…æ„ä¹‰ã€‚</p>
<h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>ç°åœ¨ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯å¯¹å˜é‡å’Œå‡½æ•°çš„æå‡æœºåˆ¶å·²ç»æœ‰ä¸€å®šçš„äº†è§£äº†ï¼Ÿé‚£ä¹ˆè®©æˆ‘ä»¬åœ¨æ·±åº¦å®æˆ˜ä¸€ä¸‹ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//'use strict'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        f <span class="token operator">=</span> a<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"yideng1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>åœ¨ES6éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä»£ç å—ä¸­ï¼Œåªæœ‰ä½¿ç”¨ <code>var</code> å£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜æ˜¯å¯ä»¥æå‡çš„ï¼Œä½†æ˜¯å‡½æ•°å£°æ˜åªèƒ½å°†å‡½æ•°çš„åå­—æå‡å‡ºå»ã€‚<br>ES5éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå„ä¸ªæµè§ˆå™¨è¡¨ç°ä¸ä¸€æ ·ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token string">"undefined"</span>

<span class="token string">"undefined"</span>

<span class="token string">"function"</span></code></pre>
<p>åœ¨ES6ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼šä»£ç å—ä¸­ï¼Œåªæœ‰ä½¿ç”¨ <code>var</code> å£°æ˜çš„å˜é‡å¯ä»¥æå‡å‡ºå»ã€‚<br>ES5ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œç›´æ¥æŠ¥é”™ã€‚å› ä¸ºES5å‡½æ•°ä¸å…è®¸åœ¨å—çº§ä½œç”¨åŸŸä¸­å£°æ˜å‡½æ•°ã€‚å‡½æ•°çš„å£°æ˜åªèƒ½åœ¨å‡½æ•°ä½œç”¨åŸŸæˆ–è€…é¡¶çº§ä½œç”¨åŸŸä¸­ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token string">"undefined"</span>

<span class="token string">"ReferenceError:f is not defined "</span><span class="token comment" spellcheck="true">//æŠ¥é”™</span></code></pre>
<p>å†æ¥çœ‹ä¸€ä¸ªé¢˜ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function</span>
    <span class="token comment" spellcheck="true">// var f = 3;</span>
    f <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//number</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function</span>
    <span class="token comment" spellcheck="true">// var s = 3;</span>
    s <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">s</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå‡½æ•°fæ˜¯å…·åå‡½æ•°ï¼Œå‡½æ•°sæ˜¯å‡½æ•°è¡¨è¾¾å¼ã€‚å…·åå‡½æ•°ä¸­ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨æ”¹å˜å‡½æ•°åï¼Œè€Œå‡½æ•°è¡¨è¾¾å¼ï¼Œå¦‚æœæœ‰å‡½æ•°åï¼Œåˆ™å®ƒçš„å‡½æ•°ååªèƒ½ä½œç”¨åœ¨å…¶è‡ªèº«ä½œç”¨åŸŸä¸­ï¼Œä¸”ä¸å¯æ”¹å˜æ”¹å˜å‡½æ•°åã€‚</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-JavaScript/webWorker" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/31/JavaScript/webWorker/"
    >web Worker(2019æœ€åä¸€æ›´)</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/31/JavaScript/webWorker/" class="article-date">
  <time datetime="2019-12-31T09:00:00.000Z" itemprop="datePublished">2019-12-31</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="web-Workerçš„ä½¿ç”¨"><a href="#web-Workerçš„ä½¿ç”¨" class="headerlink" title="web Workerçš„ä½¿ç”¨"></a>web Workerçš„ä½¿ç”¨</h1><h2 id="web-Worker"><a href="#web-Worker" class="headerlink" title="web Worker"></a>web Worker</h2><h3 id="ä»€ä¹ˆæ˜¯web-Worker"><a href="#ä»€ä¹ˆæ˜¯web-Worker" class="headerlink" title="ä»€ä¹ˆæ˜¯web Worker"></a>ä»€ä¹ˆæ˜¯web Worker</h3><p>JavaScriptæ˜¯å•çº¿ç¨‹çš„ã€‚æ‰€æœ‰çš„ä»»åŠ¡åªèƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œï¼Œä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œåé¢çš„åªèƒ½ç­‰å¾…ã€‚è€Œä¸”ç°åœ¨è®¡ç®—æœºå¤§å¤šéƒ½æ˜¯å¤šæ ¸çš„ï¼Œå•çº¿ç¨‹ä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨è®¡ç®—æœºçš„èµ„æºã€‚<br />web Workeræ˜¯HTML5 æå‡ºçš„JavaScriptå¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å¤§è®¡ç®—é‡çš„æ“ä½œäº¤ç»™web workerå»è¿ç®—ï¼Œè€Œä¸å¿…â€œå†»ç»“â€é¡µé¢ã€‚</p>
<h3 id="web-Workerçš„ä½œç”¨"><a href="#web-Workerçš„ä½œç”¨" class="headerlink" title="web Workerçš„ä½œç”¨"></a>web Workerçš„ä½œç”¨</h3><p>ä¸ºJavaScriptåˆ›å»ºå¤šçº¿ç¨‹ã€‚å…è®¸ä¸»çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹ï¼Œå°†ä¸»çº¿ç¨‹çš„å¤æ‚çš„ä»»åŠ¡åˆ†é…ç»™å­çº¿ç¨‹å»æ‰§è¡Œã€‚åœ¨ä¸»çº¿ç¨‹è¿è¡Œçš„åŒæ—¶ï¼Œå­çº¿ç¨‹ä¹Ÿåœ¨åå°æ‰§è¡Œï¼ŒäºŒè€…äº’ä¸å½±å“ã€‚ç­‰å­çº¿ç¨‹å¤„ç†å®Œæˆä¹‹åï¼Œå†å°†ç»“æœä¼ é€’ç»™ä¸»çº¿ç¨‹ã€‚è¿™æ ·ï¼Œå­çº¿ç¨‹åˆ†æ‹…äº†ä¸»çº¿ç¨‹çš„è´Ÿè½½ï¼Œè®©ä¸»çº¿ç¨‹çš„è¿è¡Œâ€œé¡ºç•…â€èµ·æ¥ï¼Œä¸ä¼šè¢«é˜»å¡ã€‚</p>
<h3 id="web-Workerçš„ä½¿ç”¨é™åˆ¶"><a href="#web-Workerçš„ä½¿ç”¨é™åˆ¶" class="headerlink" title="web Workerçš„ä½¿ç”¨é™åˆ¶"></a>web Workerçš„ä½¿ç”¨é™åˆ¶</h3><ul>
<li>åŒæºé™åˆ¶ã€‚åˆ†é…çš„workerçº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶ï¼Œå¿…é¡»å’Œä¸»çº¿ç¨‹åŒæºã€‚</li>
<li>DOMé™åˆ¶ã€‚workerçº¿ç¨‹æ‰€åœ¨çš„è„šæœ¬æ–‡ä»¶ï¼Œæ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨çš„ç½‘é¡µçš„DOMå¯¹è±¡ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>location</code> å’Œ <code>navigator</code> å¯¹è±¡ã€‚</li>
<li>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯ã€‚ä¸»çº¿ç¨‹å’Œworkerçº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨æ¶ˆæ¯è¿›è¡Œé€šè®¯ã€‚</li>
<li>è„šæœ¬é™åˆ¶ã€‚workerçº¿ç¨‹ä¸­ä¸å…è®¸ä½¿ç”¨ <code>alert</code> å’Œ <code>confirm</code> ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>XMLHttpRequest</code> å¯¹è±¡ã€‚</li>
<li>æ–‡ä»¶é™åˆ¶ã€‚workerçº¿ç¨‹ä¸èƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå®ƒæ‰€åŠ è½½çš„è„šæœ¬æ–‡ä»¶ï¼Œå¿…é¡»æ¥æºäºç½‘ç»œã€‚</li>
</ul>
<h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><h3 id="ä¸»çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹" class="headerlink" title="ä¸»çº¿ç¨‹"></a>ä¸»çº¿ç¨‹</h3><p>ä¸»çº¿ç¨‹æ–°å»ºworkerçº¿ç¨‹ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//new Worker(jsUrl, options);</span>
<span class="token keyword">let</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'child.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>Worker</code> æ„é€ å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œè¯¥è„šæœ¬æ–‡ä»¶å°±æ˜¯è¦Workerçº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¿…é¡»æ¥è‡ªç½‘ç»œï¼Œå¦åˆ™åˆ™ä¼šå¤±è´¥ã€‚Workeræ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯å¯¹è±¡å½¢å¼ï¼Œå®ƒçš„ä¸€ä¸ªä½œç”¨å°±æ˜¯æŒ‡å®šWorkerçš„åç§°ã€‚</p>
<h4 id="ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯"><a href="#ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯" class="headerlink" title="ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯"></a>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯</h4><p>ä¸»çº¿ç¨‹è°ƒç”¨ <code>worker.postMessage()</code> æ–¹æ³•ï¼Œå‘å­çº¿ç¨‹ä¼ é€’æ•°æ®ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹é€šä¿¡!'</span><span class="token punctuation">)</span>ï¼›
<span class="token comment" spellcheck="true">//or</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'common'</span><span class="token punctuation">,</span>
  message<span class="token punctuation">:</span> <span class="token string">"å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹é€šä¿¡!"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶"><a href="#ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶" class="headerlink" title="ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶"></a>ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶</h4><p>ä¸»çº¿ç¨‹ä½¿ç”¨ <code>worker.onmessage()</code> æ–¹æ³•ï¼Œç›‘å¬ä»å­çº¿ç¨‹å‘é€çš„æ•°æ®ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ä¸»çº¿ç¨‹æ”¶åˆ°å­çº¿ç¨‹å‘çš„æ¶ˆæ¯ï¼ï¼ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h4><p>ä¸»çº¿ç¨‹ä¸­å¯ä»¥ç›‘å¬workeræ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œworkerå°±ä¼šè§¦å‘ä¸»çº¿ç¨‹çš„ <code>onerror</code> æ–¹æ³•ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//e.lineno ï¼šé”™è¯¯ä»£ç çš„è¡Œæ•°</span>
  <span class="token comment" spellcheck="true">//e.filename ï¼šå‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶</span>
  <span class="token comment" spellcheck="true">//e.message ï¼šé”™è¯¯è¯¦ç»†ä¿¡æ¯</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="ç»ˆæ­¢æ‰§è¡Œ"><a href="#ç»ˆæ­¢æ‰§è¡Œ" class="headerlink" title="ç»ˆæ­¢æ‰§è¡Œ"></a>ç»ˆæ­¢æ‰§è¡Œ</h4><p>å½“ä»»åŠ¡å®Œæˆä»¥åï¼Œä¸»çº¿ç¨‹å¯ä»¥é€šè¿‡ <code>worker.terminate()</code> æ–¹æ³•ï¼Œç»ˆæ­¢workerçš„æ‰§è¡Œã€‚</p>
<pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="workerçº¿ç¨‹"><a href="#workerçº¿ç¨‹" class="headerlink" title="workerçº¿ç¨‹"></a>workerçº¿ç¨‹</h3><h4 id="workerç›‘å¬å‡½æ•°"><a href="#workerç›‘å¬å‡½æ•°" class="headerlink" title="workerç›‘å¬å‡½æ•°"></a>workerç›‘å¬å‡½æ•°</h4><p>åœ¨workerä¸­ï¼Œä½¿ç”¨ç›‘å¬å‡½æ•°ï¼Œæ¥è·å–ä¸»çº¿ç¨‹å‘é€çš„æ•°æ®ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`å­çº¿ç¨‹æ¥æ”¶æ¶ˆæ¯ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`æˆ‘æ”¶åˆ°ä½ å‘çš„æ¶ˆæ¯äº†! ä½ å‘çš„æ¶ˆæ¯æ˜¯ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ <code>self</code> ä»£è¡¨å­çº¿ç¨‹è‡ªèº«ï¼Œå³å­çº¿ç¨‹çš„å…¨å±€å¯¹è±¡ã€‚</p>
<h4 id="workerçº¿ç¨‹åŠ è½½è„šæœ¬"><a href="#workerçº¿ç¨‹åŠ è½½è„šæœ¬" class="headerlink" title="workerçº¿ç¨‹åŠ è½½è„šæœ¬"></a>workerçº¿ç¨‹åŠ è½½è„šæœ¬</h4><p>å¦‚æœæˆ‘ä»¬åœ¨workerä¸­éœ€è¦å¼•å…¥å…¶ä»–è„šæœ¬æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ <code>importScripts()</code>  æ–¹æ³•å¯¼å…¥ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'underscore.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>å¯¼å…¥ä¹‹åï¼Œå°±å¯ä»¥åœ¨workerçº¿ç¨‹ä¸­ä½¿ç”¨äº†ã€‚</p>
<h4 id="å…³é—­worker"><a href="#å…³é—­worker" class="headerlink" title="å…³é—­worker"></a>å…³é—­worker</h4><p>å½“workeræ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¯ä»¥å°†å…¶å…³é—­ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Webpack/01" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/24/Webpack/01/"
    >åŸºç¡€</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/24/Webpack/01/" class="article-date">
  <time datetime="2019-12-23T16:47:00.000Z" itemprop="datePublished">2019-12-24</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/webpack/">webpack</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="webpack4-0-ä¸€-ï¼šåŸºç¡€"><a href="#webpack4-0-ä¸€-ï¼šåŸºç¡€" class="headerlink" title="webpack4.0(ä¸€)ï¼šåŸºç¡€"></a>webpack4.0(ä¸€)ï¼šåŸºç¡€</h1><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h4 id="context"><a href="#context" class="headerlink" title="context"></a>context</h4><p>åŸºç¡€ç›®å½•ï¼Œç»å¯¹è·¯å¾„ï¼Œç”¨æˆ·è®¾ç½®ä»é…ç½®æ–‡ä»¶ä¸­è§£æå…¥å£æ–‡ä»¶å’ŒåŠ è½½å™¨ã€‚<br>å¦‚ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span>'js<span class="token punctuation">)</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span><span class="token string">'./main.js'</span>
<span class="token punctuation">}</span></code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span>'<span class="token punctuation">.</span><span class="token operator">/</span>js<span class="token operator">/</span>main<span class="token punctuation">.</span>js
<span class="token punctuation">}</span></code></pre>
<p>contexté…ç½®å¯ä»¥ä¸è¦ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾ã€‚ä½†æ˜¯å¦‚æœè¦ä½¿ç”¨çš„è¯ï¼Œå»ºè®®æ·»åŠ ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºå‘Šè¯‰webpackæ˜¯ä»å½“å‰ç›®å½•ä¸‹å“ªä¸ªæ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾ã€‚</p>
<h4 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h4><p>webpackä¸­æœ‰å¤šç§å®šä¹‰å…¥å£çš„å½¢å¼ã€‚</p>
<h5 id="å•å…¥å£å†™æ³•"><a href="#å•å…¥å£å†™æ³•" class="headerlink" title="å•å…¥å£å†™æ³•"></a>å•å…¥å£å†™æ³•</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span><span class="token string">'./src/main.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre>
<h5 id="å¯¹è±¡è¯­æ³•"><a href="#å¯¹è±¡è¯­æ³•" class="headerlink" title="å¯¹è±¡è¯­æ³•"></a>å¯¹è±¡è¯­æ³•</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span><span class="token punctuation">{</span>
    main<span class="token punctuation">:</span><span class="token string">'./src/main.js'</span><span class="token punctuation">,</span>
    venders<span class="token punctuation">:</span><span class="token string">'./src/venders.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre>
<h4 id="output"><a href="#output" class="headerlink" title="output"></a>output</h4><p>é…ç½®<code>output</code>å¯ä»¥æŒ‡å®šwebpackå¦‚ä½•å‘ç¡¬ç›˜ä¸­å†™å…¥ï¼Œæ³¨æ„çš„æ˜¯ï¼šwebpackå¯ä»¥é…ç½®å¤šä¸ªå…¥å£æ–‡ä»¶ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªè¾“å‡ºé…ç½®ã€‚</p>
<p>åœ¨webpackä¸­ï¼Œoutputæœ€ä½çš„é…ç½®è¦æ±‚å°±æ˜¯ï¼š</p>
<ul>
<li>filenameï¼šç”¨äºæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶å</li>
<li>pathï¼šç”¨äºæŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„è·¯å¾„</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre>
<h4 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h4><p><code>mode</code>æ¨¡å—ç”¨äºå‘Šè¯‰webpackä½¿ç”¨ç›¸åº”çš„æ¨¡å¼è¿›è¡Œä¼˜åŒ–ã€‚</p>
<ul>
<li>developmentï¼šå¼€å‘ç¯å¢ƒã€‚ä¼šå°† <code>process.env.NODE_ENV</code> çš„å€¼è®¾ä¸º <code>development</code>ã€‚å¯ç”¨ <code>NamedChunksPlugin</code> å’Œ <code>NamedModulesPlugin</code>ã€‚</li>
<li>productionï¼šç”Ÿäº§ç¯å¢ƒã€‚ä¼šå°† <code>process.env.NODE_ENV</code> çš„å€¼è®¾ä¸º <code>production</code>ã€‚å¯ç”¨ <code>FlagDependencyUsagePlugin</code>, <code>FlagIncludedChunksPlugin</code>, <code>ModuleConcatenationPlugin</code>, <code>NoEmitOnErrorsPlugin</code>, <code>OccurrenceOrderPlugin</code>, <code>SideEffectsFlagPlugin</code> å’Œ <code>UglifyJsPlugin</code>ã€‚</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h4 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“webpackå¯ä»¥å¯¹èµ„æºè¿›è¡Œæ‰“åŒ…çš„ã€‚ä½†æ˜¯webpackåªèƒ½å¤„ç†jsæ¨¡å—ï¼Œå¯¹äºå…¶ä»–æ¨¡å—çš„å¤„ç†ï¼Œå°±éœ€è¦ç”¨loaderå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ã€‚loaderå¯ä»¥ä½¿ä½ åœ¨importæˆ–è€…â€œåŠ è½½â€æ¨¡å—çš„æ—¶å€™ï¼Œè¿›è¡Œé¢„ç¼–è¯‘ã€‚loader å¯ä»¥å°†æ–‡ä»¶ä»ä¸åŒçš„è¯­è¨€ï¼ˆå¦‚ TypeScriptï¼‰è½¬æ¢ä¸º JavaScriptï¼Œæˆ–å°†å†…è”å›¾åƒè½¬æ¢ä¸º data URLã€‚loader ç”šè‡³å…è®¸ä½ ç›´æ¥åœ¨ JavaScript æ¨¡å—ä¸­ <code>import</code> CSSæ–‡ä»¶ï¼</p>
<pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">:</span><span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h5 id="ç¼–å†™ä¸€ä¸ªloader"><a href="#ç¼–å†™ä¸€ä¸ªloader" class="headerlink" title="ç¼–å†™ä¸€ä¸ªloader"></a>ç¼–å†™ä¸€ä¸ªloader</h5><p>loaderå·¥å…·åº“ï¼š<code>loader-utils</code>ã€é…åˆ<code>schema-utils</code>ï¼Œ</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'loader-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> validateOptions <span class="token keyword">from</span> <span class="token string">'schema-utils'</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//loaderçš„APIè¯·å‚è€ƒï¼šhttps://webpack.docschina.org/api/loaders/</span></code></pre>
<p>æ‰€è°“ loader åªæ˜¯ä¸€ä¸ªå¯¼å‡ºä¸ºå‡½æ•°çš„ JavaScript æ¨¡å—ã€‚</p>
<ul>
<li>æ–°å»ºä¸€ä¸ªjsæ–‡ä»¶ï¼š</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//loader-utils å®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„å·¥å…·ï¼Œä½†æœ€å¸¸ç”¨çš„ä¸€ç§å·¥å…·æ˜¯è·å–ä¼ é€’ç»™ loader çš„é€‰é¡¹</span>
<span class="token keyword">const</span> loadersUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªloader</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//contentæ˜¯æ–‡ä»¶å†…å®¹</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> loadersUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'--------content'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">'--------options'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//åŒæ­¥loader</span>
    <span class="token comment" spellcheck="true">// return '{};' + content</span>
    <span class="token comment" spellcheck="true">/**
     * this.callback() å‚æ•°ï¼š
     * error:Error | nullï¼Œå½“loaderå‡ºé”™æ—¶å‘å¤–è·‘å‡ºä¸€ä¸ªError
     * content:ç»è¿‡loaderå¤„ç†è¿‡çš„å†…å®¹
     * sourceMapï¼šä¸ºæ–¹ä¾¿è°ƒè¯•ç”Ÿæˆçš„ç¼–è¯‘åå†…å®¹çš„source map
     * astï¼šæœ¬æ¬¡ç¼–è¯‘ç”Ÿæˆçš„ASTé™æ€è¯­æ³•æ ‘ï¼Œä¹‹åæ‰§è¡Œçš„loaderå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªASTï¼Œå¯ä»¥çœå»é‡å¤ç”ŸæˆASTçš„è¿‡ç¨‹
     * 
     */</span>
    <span class="token comment" spellcheck="true">// this.callback(null, '{};' + content)</span>
   <span class="token comment" spellcheck="true">//å¼‚æ­¥ ä½¿ç”¨promise</span>
    <span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token comment" spellcheck="true">// let data = await timeout(1000);</span>
    <span class="token comment" spellcheck="true">// return data</span>
    <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>åœ¨<code>webpack.config.js</code>ä¸­ä½¿ç”¨è¯¥loaderï¼š</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript">rules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
  exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./loaders/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre>
<ul>
<li>å¦‚æœæœ‰å¤šä¸ªloaderï¼Œå¯ä»¥åœ¨<code>webpack.config.js</code>ä¸­è¿™æ ·é…ç½®ï¼š</li>
</ul>
<pre><code>resolveLoader:{
    modules:[
        &#39;node_modules&#39;,
        path.resolve(__dirname,&#39;loaders&#39;)//loadersä»£è¡¨ä½ å­˜æ”¾loadersçš„æ–‡ä»¶å¤¹
    ]
}</code></pre><h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><p><img src="http://cdn.yangkunxiao.cn/sZosgl.jpg#align=left&display=inline&height=1610&originHeight=1610&originWidth=1150&status=done&style=none&width=1150" alt=""></p>
<p>webpackäº‹ä»¶æµï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œ<code>webpack</code>ä¼šè¯»å–ä½ åœ¨å‘½ä»¤è¡Œå’Œ<code>webpack.config.js</code>çš„é…ç½®ï¼Œåˆå§‹åŒ–æœ¬æ¬¡æ„å»ºçš„å‚æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œé…ç½®ä¸­çš„æ’ä»¶å®ä¾‹åŒ–ï¼Œç”Ÿäº§<code>compiler</code>ä¼ å…¥<code>apply</code>æ–¹æ³•ä¸­ï¼Œä¸º<code>webpackäº‹ä»¶æµ</code>æŒ‚ä¸Šè‡ªå®šä¹‰é’©å­ã€‚</li>
<li>æ¥ä¸‹æ¥åˆ°äº†è§£æå…¥å£æ–‡ä»¶é˜¶æ®µï¼Œ<code>webpack</code>ä¼šæ ¹æ®<code>entry</code>ä¾æ¬¡è¯»å–å…¥å£æ–‡ä»¶ã€‚</li>
<li><code>webpack</code>å¼€å§‹ç¼–è¯‘(<code>conpilation</code>)ï¼Œå¯¹äºæ¯ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œéƒ½ä¼šå…ˆæ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰çš„<code>loader</code>å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œç¼–è¯‘(<code>buildModule</code>)ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¼ å…¥äº‹ä»¶å›è°ƒçš„<code>compliation</code>ä¸Šæ‹¿åˆ°<code>module</code>çš„<code>resource</code>ã€<code>loader</code>ç­‰ä¿¡æ¯ã€‚ä¹‹åï¼Œå†å°†ç¼–è¯‘å¥½çš„æ–‡ä»¶å†…å®¹ä½¿ç”¨<code>acorn</code>è§£æç”ŸæˆAST(é™æ€è¯­æ³•æ ‘ï¼Œ<code>normalModuleLoader</code>)ã€‚åˆ†ææ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä¾æ¬¡æ‹‰å–ä¾èµ–æ¨¡å—ï¼Œå¹¶é‡å¤ä»¥ä¸Šè¿‡ç¨‹ã€‚æœ€åå°†requireè¯­æ³•æ›¿æ¢ä¸º<code>__webpack_require__</code>æ¥æ¨¡æ‹Ÿæ¨¡å—åŒ–æ“ä½œã€‚</li>
<li>emité˜¶æ®µï¼Œæ‰€æœ‰æ–‡ä»¶çš„ç¼–è¯‘åŠè½¬åŒ–éƒ½å·²ç»å®Œæˆï¼ŒåŒ…å«äº†æœ€ç»ˆè¾“å‡ºçš„èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼ å…¥äº‹ä»¶å›è°ƒçš„<code>compilation.assets</code> ä¸Šæ‹¿åˆ°æ‰€éœ€æ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬å³å°†è¾“å‡ºçš„èµ„æºã€ä»£ç å—<code>Chunk</code>ç­‰ç­‰ä¿¡æ¯ã€‚</li>
</ul>
<p>æˆ‘ä»¬å°†webpackäº‹ä»¶æµç†è§£ä¸ºwebpackæ„å»ºè¿‡ç¨‹ä¸­çš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œä»–ä»¬åˆ†åˆ«è¡¨ç¤ºç€ä¸åŒçš„æ„å»ºå‘¨æœŸå’ŒçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥åƒåœ¨æµè§ˆå™¨ä¸Šç›‘å¬clickäº‹ä»¶ä¸€æ ·ç›‘å¬äº‹ä»¶æµä¸Šçš„äº‹ä»¶ï¼Œå¹¶ä¸”ä¸ºå®ƒä»¬æŒ‚è½½äº‹ä»¶å›è°ƒã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰äº‹ä»¶å¹¶åœ¨åˆé€‚æ—¶æœºè¿›è¡Œå¹¿æ’­ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨äº†webpackè‡ªå¸¦çš„æ¨¡å— <code>Tapable</code> è¿›è¡Œç®¡ç†çš„ã€‚æˆ‘ä»¬ä¸éœ€è¦è‡ªè¡Œå®‰è£… <code>Tapable</code> ï¼Œåœ¨webpackè¢«å®‰è£…çš„åŒæ—¶å®ƒä¹Ÿä¼šä¸€å¹¶è¢«å®‰è£…ï¼Œå¦‚éœ€ä½¿ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ä»¶é‡Œç›´æ¥ <code>require</code> å³å¯ã€‚</p>
<p>Tapableçš„åŸç†å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨å‰ç«¯è¿›é˜¶è¿‡ç¨‹ä¸­éƒ½ä¼šç»å†çš„EventEmitï¼Œé€šè¿‡å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼å®ç°ï¼Œå®ƒçš„éƒ¨åˆ†æ ¸å¿ƒä»£ç å¯ä»¥æ¦‚æ‹¬æˆä¸‹é¢è¿™æ ·ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">SyncHook</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// è®¢é˜…äº‹ä»¶</span>
    <span class="token function">tap</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// å‘å¸ƒ</span>
    <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>hook <span class="token operator">=</span><span class="token operator">></span> <span class="token function">hook</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>å…·ä½“è¯·å‚è€ƒï¼š<a href="https://juejin.im/post/5abf33f16fb9a028e46ec352" target="_blank" rel="noopener">https://juejin.im/post/5abf33f16fb9a028e46ec352</a></p>
<h4 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h4><p>resolve.alias æ˜¯é€šè¿‡åˆ«åæ¥å°†åŸå¯¼å…¥è·¯å¾„æ˜ å°„æˆä¸€ä¸ªæ–°çš„å¯¼å…¥è·¯å¾„ã€‚æ¯”å¦‚å¦‚ä¸‹é…ç½®ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./js/main.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// å°†è¾“å‡ºçš„æ–‡ä»¶éƒ½æ”¾åœ¨distç›®å½•ä¸‹</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      components<span class="token punctuation">:</span> <span class="token string">'./src/components'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>å¦‚ä¸Šä»£ç é…ç½®ï¼Œå½“æˆ‘é€šè¿‡ import xxx from â€˜components/xxxâ€™ å¯¼å…¥æ—¶ï¼Œå®é™…ä¸Šè¢«aliasæ›¿æ¢æˆäº†<br>import xxx from â€˜./src/components/xxxâ€™;</p>
<h4 id="extensions"><a href="#extensions" class="headerlink" title="extensions"></a>extensions</h4><p>åœ¨ä½¿ç”¨ import å¯¼å…¥æ–‡ä»¶æ—¶ï¼Œæœ‰æ—¶å€™æ²¡æœ‰å¸¦å…¥æ–‡ä»¶çš„åç¼€åï¼Œwebpackä¼šè‡ªåŠ¨å¸¦ä¸Šåç¼€å»è®¿é—®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œé‚£ä¹ˆé»˜è®¤çš„åç¼€åä¸º<br>[â€˜.jsâ€™, â€˜.jsonâ€™]; å³ï¼š<br>extensions: [â€˜.jsâ€™, â€˜.jsonâ€™]; å¦‚æœæˆ‘ä»¬æƒ³è‡ªå·±é…ç½®.vueåç¼€åï¼Œé˜²æ­¢åœ¨å¯¼å…¥æ–‡ä»¶æ—¶å€™ä¸éœ€è¦åŠ ä¸Šåç¼€ï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨webpackåšå¦‚ä¸‹é…ç½®:</p>
<pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./js/main.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// å°†è¾“å‡ºçš„æ–‡ä»¶éƒ½æ”¾åœ¨distç›®å½•ä¸‹</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      components<span class="token punctuation">:</span> <span class="token string">'./src/components'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="Externals"><a href="#Externals" class="headerlink" title="Externals"></a>Externals</h4><p>Externals ç”¨æ¥å‘Šè¯‰webpackåœ¨æ„å»ºä»£ç æ—¶ä½¿ç”¨äº†ä¸å¤„ç†åº”ç”¨çš„æŸäº›ä¾èµ–åº“ï¼Œä¾ç„¶å¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡AMDï¼ŒCMDæˆ–windowå…¨å±€æ–¹å¼è®¿é—®ã€‚<br>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨htmlé¡µé¢ä¸­å¼•å…¥äº†jqueryæºæ–‡ä»¶åï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>title<span class="token operator">></span>Title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"http://code.jquery.com/jquery-1.12.0.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
  <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">"dist/main.css"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> type<span class="token operator">=</span><span class="token string">"text/css"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"dist/bundle.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre>
<p>ä½†æ˜¯æˆ‘ä»¬æƒ³åœ¨æ¨¡å—åŒ–çš„æºä»£ç é‡Œå¯¼å…¥å’Œä½¿ç”¨jqueryï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šéœ€è¦å®‰è£…ä¸‹ jqueryä¾èµ–åŒ…ï¼Œnpm install â€“save jquery, ç„¶åæˆ‘ä»¬ç¼–å†™å¦‚ä¸‹ä»£ç è¿›è¡Œä½¿ç”¨ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>æ„å»ºæ‰“åŒ…åæˆ‘ä»¬ä¼šå‘ç°è¾“å‡ºçš„æ–‡ä»¶é‡Œé¢åŒ…å«jqueryçš„å†…å®¹ï¼Œè¿™å¯¼è‡´äº†jqueryåº“å¼•å…¥äº†ä¸¤æ¬¡ï¼Œå¹¶ä¸”å¯¼è‡´äº†bundle.jsæ–‡ä»¶å˜å¾—æ›´å¤§ï¼Œæµªè´¹åŠ è½½æµé‡ã€‚å› æ­¤ Externals é…ç½®é¡¹å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚<br>é€šè¿‡externals å¯ä»¥å‘Šè¯‰webpackåœ¨javascriptè¿è¡Œç¯å¢ƒä¸­å·²ç»å†…ç½®äº†å“ªäº›å…¨å±€å˜é‡ï¼Œä¸ç”¨å°†è¿™äº›ä»£ç æ‰“åŒ…åˆ°ä»£ç é‡Œé¢å»ã€‚<br>å› æ­¤æˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹é…ç½®ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token keyword">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  externals<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    jquery<span class="token punctuation">:</span> <span class="token string">'jQuery'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h4 id="ä»€ä¹ˆæ˜¯ASTï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ASTï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ASTï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ASTï¼Ÿ</h4><p>è¯·å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000016231512#comment-area" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016231512#comment-area</a></p>
<p>è½¬æ¢æˆASTçš„ç›®çš„å°±æ˜¯å°†æˆ‘ä»¬ä¹¦å†™çš„å­—ç¬¦ä¸²æ–‡ä»¶è½¬æ¢æˆè®¡ç®—æœºæ›´å®¹æ˜“è¯†åˆ«çš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·æ›´å®¹æ˜“æå–å…¶ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œè€Œè¿™æ£µæ ‘åœ¨è®¡ç®—æœºä¸Šçš„è¡¨ç°å½¢å¼ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå•çº¯çš„Objectã€‚</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-JavaScript/ç±»å‹è½¬æ¢" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/20/JavaScript/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/"
    >JavaScriptå¼ºåˆ¶ç±»å‹è½¬æ¢
  <i class="article-topping">ç½®é¡¶</i>
</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/20/JavaScript/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" class="article-date">
  <time datetime="2019-12-20T15:40:00.000Z" itemprop="datePublished">2019-12-20</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><p>åœ¨è¯´JavaScriptçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹JavaScriptä¸­çš„æ•°æ®ç±»å‹æœ‰å“ªäº›ã€‚JavaScriptä¸­ç±»å‹åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p>
<ul>
<li>åŸå§‹æ•°æ®ç±»å‹ï¼šnullã€undefinedã€boolã€stringã€numberã€booleanä»¥åŠsymbolï¼ˆes6æå‡ºï¼‰</li>
<li>å¯¹è±¡æ•°æ®ç±»å‹ï¼šObjectï¼ˆfunctionã€date ç­‰å±äºObjectçš„å­ç±»å‹ï¼‰</li>
</ul>
<p>é‚£ä¹ˆè¿™ä¸¤ç§æ•°æ®ç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>åŸå§‹æ•°æ®ç±»å‹åœ¨å†…å­˜ä¸­çš„å­˜æ”¾åœ°ç‚¹æ˜¯å­˜æ”¾åœ¨æ ˆä¸­ï¼Œæ‰€ä»¥åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å€¼ä¼ é€’ã€‚</p>
<p>è€Œå¯¹è±¡æ•°æ®ç±»å‹çš„å­˜æ”¾æ–¹å¼æ˜¯ï¼šçœŸå®æ•°æ®å­˜æ”¾åœ¨å †ä¸­ï¼Œè€Œåœ¨æ ˆä¸­å­˜æ”¾çš„æ˜¯æŒ‡å‘å®é™…æ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œå³å †çš„æŒ‡é’ˆã€‚</p>
<p>è¿™ä¹Ÿå°±æ˜¯å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’ã€‚</p>
<h3 id="å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢"><a href="#å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢"></a>å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢</h3><h4 id="ToString"><a href="#ToString" class="headerlink" title="ToString"></a>ToString</h4><p>å®ƒè´Ÿè´£å¤„ç†éå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²çš„è½¬æ¢ã€‚</p>
<p>åŸºæœ¬ç±»å‹å€¼çš„è½¬æ¢è§„åˆ™æ˜¯ï¼šnullè½¬æ¢ä¸ºâ€nullâ€ï¼Œundefinedè½¬æ¢ä¸ºâ€undefinedâ€,å¸ƒå°”è½¬æ¢æˆå¯¹åº”çš„æ•°å­—ï¼štrueè½¬æ¢ä¸º1ï¼Œfalseè½¬æ¢ä¸º0ã€‚æ•°å­—ç›´æ¥è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å¯¹åº”å¯¹è±¡ï¼Œé™¤éå¯¹è±¡å†…éƒ¨å®šä¹‰äº†tostringæ–¹æ³•ï¼Œå¦åˆ™toString()ï¼ˆObject.prototype.toString()ï¼‰è¿”å›å…¶å†…éƒ¨å±æ€§[[class]]çš„å€¼ã€‚å¦‚æœå†…éƒ¨è‡ªå®šä¹‰äº†toStringæ–¹æ³•ï¼Œåˆ™è°ƒç”¨è¯¥å†…éƒ¨æ–¹æ³•å¹¶ä½¿ç”¨å…¶è¿”å›å€¼ã€‚</p>
<p>å¯¹è±¡çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºstringæ˜¯é€šè¿‡<code>Toprimitive</code>æŠ½è±¡æ“ä½œæ¥å®Œæˆçš„ã€‚</p>
<blockquote>
<p>ToPrimitive(input,PreferredType?)ï¼šå…¶ä¸­PreferredTypeä¸ºnumberæˆ–è€…stringã€‚</p>
<p>å¦‚æœinputæ˜¯åŸå§‹å€¼ï¼Œåˆ™è¿”å›è¯¥åŸå§‹å€¼å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å¦‚æœinputä¸æ˜¯åŸå§‹å€¼ï¼Œåˆ™è°ƒç”¨valueOf()æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›åŸå§‹å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›å€¼ã€‚</p>
<p>å¦‚æœvalueOf()è¿”å›çš„ä¸æ˜¯åŸå§‹å€¼ï¼Œåˆ™è°ƒç”¨toString()æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›åŸå§‹å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›çš„åŸå§‹å€¼ã€‚</p>
<p>å¦åˆ™ï¼ŒæŠ¥é”™TypeError</p>
</blockquote>
<p>JSONå­—ç¬¦ä¸²åŒ–</p>
<p>å·¥å…·å‡½æ•°JSON.stringifyå¯ä»¥å°†JSONå¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå†…éƒ¨ä¹Ÿæ˜¯è°ƒç”¨äº†ToStringã€‚</p>
<p>JSON.stringifyä½¿ç”¨è§„åˆ™ï¼šå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œä½¿ç”¨JSON.stringifyå’Œä½¿ç”¨toStringè¿”å›ç»“æœä¸€æ ·ã€‚å¯¹äºæ‰€æœ‰å®‰å…¨çš„JSONå€¼ï¼Œéƒ½å¯ä»¥ä½¿ç”¨JSON.stringifyæ–¹æ³•ï¼Œæ‰€è°“çš„JSONå®‰å…¨å€¼æ˜¯æŒ‡ï¼šé™¤äº†undefinedã€symbolã€functionä»¥åŠåŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ã€‚</p>
<p>JSON.stringifyæ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼šå¯ä»¥ä¸ºå­—ç¬¦ä¸²æ•°ç»„æˆ–è€…å‡½æ•°ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œåˆ™æ ¹æ®æ•°ç»„å†…çš„å…ƒç´ ï¼Œè¿”å›æŒ‡å®šçš„å¯¹è±¡å±æ€§å’Œå±æ€§å€¼ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œåˆ™ä¸ºè¿‡æ»¤å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œkeyã€valueï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è‡ªè¡Œè®¾å®šè¿”å›å€¼ã€‚å¦‚æœä¸éœ€è¦æŸä¸ªå±æ€§ï¼Œè¿”å›undefinedå³å¯è¿‡æ»¤ã€‚</p>
<p>JSON.stringifyæ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šç”¨äºæŒ‡å®šè¾“å‡ºå­—ç¬¦ä¸²çš„è¾“å‡ºæ ¼å¼ã€‚</p>
<p>å¦‚æœå¯¹è±¡å†…éƒ¨æœ‰è‡ªå®šä¹‰çš„toJSONæ–¹æ³•ï¼Œåˆ™ä½¿ç”¨è¯¥æ–¹æ³•ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// toJSON:function(){</span>
  <span class="token comment" spellcheck="true">//     return 0</span>
  <span class="token comment" spellcheck="true">// }</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿‡æ»¤å‡½æ•°</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿˜åŸå‡½æ•°</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="ToNumber"><a href="#ToNumber" class="headerlink" title="ToNumber"></a>ToNumber</h4><p>ç”¨æ¥å°†éæ•°å­—å¤„ç†æˆæ•°å­—ã€‚è½¬æ¢æ–¹å¼éµå¾ªToPrimitiveï¼Œ</p>
<h4 id="ToBoolean"><a href="#ToBoolean" class="headerlink" title="ToBoolean"></a>ToBoolean</h4><p>JavaScriptä¸­çš„å€¼å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>å¯ä»¥è¢«å¼ºåˆ¶è½¬æ¢ä¸ºfalseçš„å€¼ï¼Œå¦‚ï¼šundefinedã€nullã€falseã€+0ã€-0ã€NaNå’Œâ€â€</li>
<li>å…¶ä»–å¯ä»¥è¢«è½¬æ¢ä¸ºtrueçš„å€¼</li>
</ul>
<p>å‡å€¼å¯¹è±¡ï¼šå°è£…äº†å‡å€¼çš„å¯¹è±¡ã€‚</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span></code></pre>
<p>å®ƒä»¬çš„å€¼ä¸ºtrueï¼Œä½†æ˜¯å¦‚æœå¯¹å…¶è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œåˆ™ç»“æœä¸ºfalseã€‚</p>
<h3 id="å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><h4 id="éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢</h4><h5 id="å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢"><a href="#å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢"></a>å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢</h5><p>è¿ç®—ç¬¦ï¼š</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "420"</span>
c <span class="token operator">+</span> d<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 42</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "1,23,4"</span></code></pre>
<blockquote>
<p>æ ¹æ® ES5 è§„èŒƒ 11.6.1 èŠ‚ï¼Œå¦‚æœæŸä¸ªæ“ä½œæ•°æ˜¯å­—ç¬¦ä¸²æˆ–è€…èƒ½å¤Ÿé€šè¿‡ä»¥ä¸‹æ­¥éª¤è½¬æ¢ä¸ºå­—ç¬¦ä¸² çš„è¯ï¼Œ+ å°†è¿›è¡Œæ‹¼æ¥æ“ä½œã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°æ˜¯å¯¹è±¡(åŒ…æ‹¬æ•°ç»„)ï¼Œåˆ™é¦–å…ˆå¯¹å…¶è°ƒç”¨ ToPrimitive æŠ½è±¡æ“ä½œ(è§„èŒƒ 9.1 èŠ‚)ï¼Œè¯¥æŠ½è±¡æ“ä½œå†è°ƒç”¨ [[DefaultValue]](è§„èŒƒ 8.12.8 èŠ‚)ï¼Œä»¥æ•°å­—ä½œä¸ºä¸Šä¸‹æ–‡ã€‚ </p>
</blockquote>
<h5 id="å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰"><a href="#å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰" class="headerlink" title="å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰"></a>å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰</h5><p>å®½æ¾ç›¸ç­‰(loose equals)== å’Œä¸¥æ ¼ç›¸ç­‰(strict equals)=== éƒ½ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦â€œç›¸ç­‰â€ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ¤æ–­æ¡ä»¶ä¸Šã€‚</p>
<ul>
<li>== åœ¨ç›¸ç­‰æ¯”è¾ƒä¸­ï¼Œå…è®¸è¿›è¡Œç±»å‹è½¬æ¢</li>
<li>=== ä¸å…è®¸ç±»å‹è½¬æ¢</li>
</ul>
<h5 id="æŠ½è±¡ç›¸ç­‰"><a href="#æŠ½è±¡ç›¸ç­‰" class="headerlink" title="æŠ½è±¡ç›¸ç­‰"></a>æŠ½è±¡ç›¸ç­‰</h5><ul>
<li>å¦‚æœè¡¨è¾¾å¼ä¸¤ç«¯éƒ½æ˜¯nullã€undefinedï¼Œåˆ™ä¸ºtrueã€‚</li>
<li>å¦‚æœNaNåœ¨å…¶ä¸­ä¸€ç«¯ï¼Œåˆ™è¿”å›falseã€‚</li>
<li>å¦‚æœæ˜¯stringã€numberã€booleanå¹¶ä¸”ç±»å‹ä¸ä¸€è‡´ï¼Œåˆ™å…ˆä½¿ç”¨ToNumberè½¬æ¢ä¸ºnumberåœ¨æ¯”è¾ƒã€‚</li>
<li>å¦‚æœæ˜¯å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨ToPrimitiveï¼Œè·å–åŸå§‹å€¼å†æ¯”è¾ƒã€‚</li>
</ul>
<h4 id="æ˜¾ç¤ºç±»å‹è½¬æ¢"><a href="#æ˜¾ç¤ºç±»å‹è½¬æ¢" class="headerlink" title="æ˜¾ç¤ºç±»å‹è½¬æ¢"></a>æ˜¾ç¤ºç±»å‹è½¬æ¢</h4><h5 id="å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢"><a href="#å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢"></a>å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token string">"3.14"</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span> c <span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "42"</span>
d<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 3.14</span></code></pre>
<p>String(..) éµå¾ªå‰é¢è®²è¿‡çš„ ToString è§„åˆ™ï¼Œå°†å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²åŸºæœ¬ç±»å‹ã€‚Number(..) éµå¾ª å‰é¢è®²è¿‡çš„ ToNumber è§„åˆ™ï¼Œå°†å€¼è½¬æ¢ä¸ºæ•°å­—åŸºæœ¬ç±»å‹ã€‚ </p>
<h5 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h5><p>å­—ä½è¿ç®—ç¬¦åªé€‚ç”¨äº 32 ä½æ•´æ•°ï¼Œè¿ç®—ç¬¦ä¼šå¼ºåˆ¶æ“ä½œæ•°ä½¿ç”¨ 32 ä½ æ ¼å¼ã€‚è¿™æ˜¯é€šè¿‡æŠ½è±¡æ“ä½œ ToInt32 æ¥å®ç°çš„ </p>
<blockquote>
<p>ToInt32:å…ˆè¯•ç”¨ToNumberè½¬æ¢ä¸ºæ•°å­—ï¼Œå†æ‰§è¡ŒToInt32ã€‚</p>
</blockquote>
<p>ï½ï½ï¼š~~ ä¸­çš„ç¬¬ä¸€ä¸ª ~ æ‰§è¡Œ ToInt32 å¹¶åè½¬å­—ä½ã€‚ç„¶åç¬¬äºŒä¸ª ~ å†è¿›è¡Œä¸€æ¬¡å­—ä½åè½¬ï¼Œå³å°†æ‰€æœ‰ å­—ä½åè½¬å›åŸå€¼</p>
<p>parseIntï¼šåªæ”¯æŒå­—ç¬¦ä¸²è§£ææˆæ•°å­—ã€‚</p>
<blockquote>
<p>~~å’ŒparseIntçš„åŒºåˆ«ï¼š</p>
<p>1ã€è§£ææˆæ•°å­—å…è®¸å­—ç¬¦ä¸²ä¸­æœ‰éæ•°å­—å­—ç¬¦ï¼Œä»å·¦åˆ°å³ä¾æ¬¡è§£æï¼Œé‡åˆ°éæ•°å­—å­—ç¬¦åœæ­¢è§£æ</p>
<p>2ã€å¼ºåˆ¶è½¬æ¢æˆæ•°å­—ï¼Œä¸å…è®¸å­˜åœ¨éæ•°å­—å­—ç¬¦ï¼Œå¦åˆ™è½¬æ¢å¤±è´¥NaN</p>
</blockquote>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">ä¸‹ä¸€é¡µ</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2019-2020
        Walter
      </li>
      <li>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
      </li>
      
      <li>
        <a href="http://www.beian.miit.gov.cn/" target="_black">è±«ICPå¤‡17047806å·</a>
      </li>
      
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/logo.png" alt="Walter"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="æœç´¢">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i></p>
  <div class="reward-box">
    
    
  </div>
</div>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>





<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>
<script src="/dist/main.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>





<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>


    
  </div>
</body>

</html>