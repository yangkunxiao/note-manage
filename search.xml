<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ·±æ‹·è´ VS æµ…æ‹·è´</title>
      <link href="/2020/03/12/Interview/03/"/>
      <url>/2020/03/12/Interview/03/</url>
      
        <content type="html"><![CDATA[<h1 id="æ·±æ‹·è´-VS-æµ…æ‹·è´"><a href="#æ·±æ‹·è´-VS-æµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´ VS æµ…æ‹·è´"></a>æ·±æ‹·è´ VS æµ…æ‹·è´</h1><blockquote><p>æ·±æ‹·è´ï¼šæ‹·è´å®ä¾‹ã€‚æµ…æ‹·è´ï¼šæ‹·è´å¼•ç”¨ã€‚</p></blockquote><p>ä¸çŸ¥é“å¤§å®¶è¿˜è®°ä¸è®°å¾—é«˜ç¨‹ä¸Šå¯¹æ•°æ®ç±»å‹çš„å®šä¹‰ï¼š<br><strong>åŸºæœ¬æ•°æ®ç±»å‹ï¼š</strong><br>å¸ƒå°”ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€æ•°å­—ç±»å‹ã€‚è¿™äº›ç±»å‹å±äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå®ƒä»¬çš„å€¼é€šå¸¸éƒ½æ˜¯ç›´æ¥å­˜æ”¾åœ¨æ ˆä¸­ï¼Œæ‰€ä»¥å¹³æ—¶æˆ‘ä»¬åœ¨ç»™ç»™å˜é‡èµ‹å€¼çš„æ—¶å€™ï¼Œå°±æ˜¯ç›´æ¥å°†å€¼ç›´æ¥å¤åˆ¶ç»™å˜é‡ï¼Œæ–°å˜é‡çš„æ›´æ”¹ä¸ä¼šå½±å“åŸå˜é‡ã€‚<br><strong>å¼•ç”¨ç±»å‹ï¼š</strong><br>å¯¹äºå¯¹è±¡ï¼ˆåŒ…å«objectã€arrayã€dateã€functionç­‰ç­‰ï¼‰ï¼Œè¿™äº›å¯¹è±¡çš„å€¼éƒ½å­˜æ”¾åœ¨å †ä¸­ï¼Œå€¼çš„å¼•ç”¨å­˜æ”¾åœ¨æ ˆä¸­ã€‚</p><p>ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10,20</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token number">20</span> <span class="token punctuation">}</span><span class="token keyword">let</span> obj2 <span class="token operator">=</span> obj1<span class="token punctuation">;</span>obj2<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//100</span></code></pre><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1583893141137-90d3b97f-a36d-4bfb-a26d-88387fbfad4a.png#align=left&display=inline&height=438&name=image.png&originHeight=1074&originWidth=1468&size=133037&status=done&style=none&width=599" alt="image.png"><br>å¦‚å›¾ï¼Œæ·±æ‹·è´å°±æ˜¯åœ¨å†…å­˜ä¸­é‡æ–°å¼€è¾Ÿä¸€ä¸ªæ–°çš„å†…å­˜ï¼Œå°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­å®Œæ•´çš„è¯»å‡ºæ¥ï¼Œå­˜æ”¾åˆ°æ–°çš„å†…å­˜ä¸­ï¼Œä¸¤è€…äº’ä¸å½±å“ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œå…ˆæ’¸ä¸ºæ•¬ã€‚</p><h3 id="ä¹ä¸ç‰ˆ"><a href="#ä¹ä¸ç‰ˆ" class="headerlink" title="ä¹ä¸ç‰ˆ"></a>ä¹ä¸ç‰ˆ</h3><p>åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æœ€å¤šçš„å°±æ˜¯ä¸‹é¢çš„æ–¹å¼ï¼Œä½†æ˜¯è¿™æ ·çš„æ–¹å¼å­˜åœ¨ç€æ½œåœ¨çš„é£é™©ï¼Œå¯¹äºä¸€ä¸‹å¾ªç¯åµŒå¥—çš„å¯¹è±¡ã€æ•°ç»„ç­‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆçš„å¤åˆ¶ã€‚å…·ä½“è¯·çœ‹<a href="https://www.yuque.com/walter-glskq/zf7grn/uva3mi" target="_blank" rel="noopener">è¿™ä¸€ç¯‡æ–‡ç« </a></p><pre class=" language-javascript"><code class="language-javascript">JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸€ï¼‰"><a href="#åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸€ï¼‰" class="headerlink" title="åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸€ï¼‰"></a>åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸€ï¼‰</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">deeClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> element <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>      res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> element    <span class="token punctuation">}</span>    <span class="token keyword">return</span> res<span class="token punctuation">}</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">{</span> c<span class="token punctuation">:</span><span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    d<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">deeClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ a: 10, b: [ 1, 3, 4, { c: 20 } ], d: true }</span></code></pre><h3 id="åŸºç¡€ç‰ˆæœ¬ï¼ˆäºŒï¼‰"><a href="#åŸºç¡€ç‰ˆæœ¬ï¼ˆäºŒï¼‰" class="headerlink" title="åŸºç¡€ç‰ˆæœ¬ï¼ˆäºŒï¼‰"></a>åŸºç¡€ç‰ˆæœ¬ï¼ˆäºŒï¼‰</h3><p>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œéå†ç›®æ ‡å¯¹è±¡ï¼Œå°†åŸå¯¹è±¡ä¸Šçš„å±æ€§å’Œå±æ€§å€¼ä¸€æ¬¡æŒ‚è½½åˆ°æ–°å¯¹è±¡ä¸Šã€‚<br>æ·±æ‹·è´ï¼Œç”±äºæˆ‘ä»¬ä¸çŸ¥é“åŸå¯¹è±¡ä¼šåµŒå¥—å¤šå°‘å±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨é€’å½’æ¥è§£å†³ã€‚<br>å¦‚æœå±æ€§å€¼ä¸ºåŸºæœ¬ç±»å‹ï¼Œç›´æ¥å°†å±æ€§å’Œå±æ€§å€¼æŒ‚è½½åˆ°æ–°å¯¹è±¡ä¸Šã€‚<br>å¦‚æœå±æ€§å€¼ä¸ºå¯¹è±¡ç±»å‹ï¼Œåˆ™é€’å½’éå†è¯¥å±æ€§çš„å±æ€§å€¼ï¼Œç„¶åæŒ‚è½½åˆ°æ–°å¯¹è±¡ä¸Šã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">let</span> res <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">const</span> element <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> element <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>          <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>            res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> target    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span> <span class="token punctuation">{</span>        c<span class="token punctuation">:</span> <span class="token punctuation">{</span>            d<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    f<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">{</span> g<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>obj1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span></code></pre><h3 id="åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸‰ï¼‰"><a href="#åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸‰ï¼‰" class="headerlink" title="åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸‰ï¼‰"></a>åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸‰ï¼‰</h3><p>å…¼å®¹å¾ªç¯å¼•ç”¨ã€‚</p><p>æˆ‘ä»¬å€Ÿç”¨ä¸Šé¢çš„å‡½æ•°ï¼Œå»å¯¹ä¸€ä¸ªæœ‰å¾ªç¯å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œæ·±æ‹·è´ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span> <span class="token punctuation">{</span>        c<span class="token punctuation">:</span> <span class="token punctuation">{</span>            d<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    f<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">{</span> g<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>obj<span class="token punctuation">.</span>obj <span class="token operator">=</span> obj<span class="token punctuation">;</span><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>obj1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span></code></pre><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1583897125036-ba767d71-84e0-4793-828f-badefde0ecf1.png#align=left&display=inline&height=71&name=image.png&originHeight=108&originWidth=822&size=13051&status=done&style=none&width=537" alt="image.png"></p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå¦‚æœå­˜åœ¨å¯¹è±¡ç›´æ¥æˆ–è€…é—´æ¥å¼•ç”¨è‡ªèº«çš„æƒ…å†µï¼Œå°±ä¼šå‡ºç°å†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚</p><p>ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çš„ç©ºé—´ï¼Œæ¥å­˜å‚¨å½“å‰å¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„å…³ç³»ï¼Œå½“æ‹·è´å½“å‰å¯¹è±¡çš„æ—¶å€™ï¼Œç°åœ¨å­˜å‚¨ç©ºé—´ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å­˜å‚¨ä¸­çš„å€¼ï¼Œå¦åˆ™ï¼Œç»§ç»­æ‹·è´ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">deepClone3</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> res <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        map<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">const</span> element <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>          res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone3</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> target    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span> <span class="token punctuation">{</span>        c<span class="token punctuation">:</span> <span class="token punctuation">{</span>            b<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span>            d<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    f<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">{</span> g<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>obj<span class="token punctuation">.</span>obj <span class="token operator">=</span> obj<span class="token punctuation">;</span><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token function">deepClone3</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span></code></pre><p>å†æ¬¡æ‰§è¡Œæ‹·è´ï¼šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°obj.objå€¼ä¸º <code>Circular</code>ï¼Œå³å¾ªç¯å¼•ç”¨çš„æ„æ€ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1583938079008-5972dee1-63ac-4ef4-8cc9-ca65b4978571.png#align=left&display=inline&height=90&name=image.png&originHeight=148&originWidth=670&size=15716&status=done&style=none&width=408" alt="image.png"></p><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><p>JavaScriptçš„å¯¹è±¡æœ¬è´¨ä¸Šåªèƒ½æ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œä¸”é”®åªèƒ½ä¸ºå­—ç¬¦ä¸²ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ES6ä¸­æå‡ºäº†ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼šMapã€‚å®ƒç±»ä¼¼äºå¯¹è±¡ï¼Œä¹Ÿæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œä½†æ˜¯â€œé”®â€çš„èŒƒå›´ä¸é™äºå­—ç¬¦ä¸²ï¼Œå„ç§ç±»å‹çš„å€¼ï¼ˆåŒ…æ‹¬å¯¹è±¡ï¼‰éƒ½å¯ä»¥å½“ä½œé”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒObject ç»“æ„æä¾›äº†â€œå­—ç¬¦ä¸²â€”å€¼â€çš„å¯¹åº”ï¼ŒMap ç»“æ„æä¾›äº†â€œå€¼â€”å€¼â€çš„å¯¹åº”ï¼Œæ˜¯ä¸€ç§æ›´å®Œå–„çš„ Hash ç»“æ„å®ç°ã€‚<br>Mapçš„APIï¼š</p><ol><li>size()</li><li>set(key,value)</li><li>get(key)</li><li>has(key)</li><li>delete(key)</li><li>clear()</li></ol><p>Mapçš„éå†æ–¹æ³•ï¼š</p><ul><li><code>Map.prototype.keys()</code>ï¼šè¿”å›é”®åçš„éå†å™¨ã€‚</li><li><code>Map.prototype.values()</code>ï¼šè¿”å›é”®å€¼çš„éå†å™¨ã€‚</li><li><code>Map.prototype.entries()</code>ï¼šè¿”å›æ‰€æœ‰æˆå‘˜çš„éå†å™¨ã€‚</li><li><code>Map.prototype.forEach()</code>ï¼šéå† Map çš„æ‰€æœ‰æˆå‘˜ã€‚</li></ul><h4 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h4><p>WeakMapæ˜¯Mapçš„ä¸€ç§å˜å½¢ã€‚ä½†æ˜¯WeakMapåªæ¥å—å¯¹è±¡ä½œä¸ºé”®ï¼ˆé™¤nullå¤–ï¼‰ï¼Œä¸”WeakMapçš„é”®å¯¹åº”çš„å¯¹è±¡ï¼Œä¸ä¼šè¢«è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚<br>ä½¿ç”¨WeakMapçš„ä¼˜åŠ¿ï¼šå®ƒçš„é”®åæ‰€å¼•ç”¨çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸å°†è¯¥å¼•ç”¨è€ƒè™‘åœ¨å†…ã€‚å› æ­¤ï¼Œåªè¦æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å…¶ä»–å¼•ç”¨éƒ½è¢«æ¸…é™¤ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä¸å†éœ€è¦ï¼ŒWeakMap é‡Œé¢çš„é”®åå¯¹è±¡å’Œæ‰€å¯¹åº”çš„é”®å€¼å¯¹ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ é™¤å¼•ç”¨ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>WeakMap</code>çš„ä¸“ç”¨åœºåˆå°±æ˜¯ï¼Œå®ƒçš„é”®æ‰€å¯¹åº”çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ¶ˆå¤±ã€‚<code>WeakMap</code>ç»“æ„æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚<br>WeakMapçš„APIï¼š</p><ol><li>get(key)</li><li>set(key,value)</li><li>has(key)</li><li>delete(key)</li></ol><h3 id="å…¼å®¹å…¶ä»–ç±»å‹"><a href="#å…¼å®¹å…¶ä»–ç±»å‹" class="headerlink" title="å…¼å®¹å…¶ä»–ç±»å‹"></a>å…¼å®¹å…¶ä»–ç±»å‹</h3><p>æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰å¯¹åº”çš„<code>toString()</code>æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•æœªè¢«é‡å†™ï¼Œåˆ™è°ƒç”¨çš„å°±æ˜¯<code>Object.prototype</code>ä¸Šçš„toString()ï¼Œè¿”å›çš„å°±æ˜¯â€™[object type]â€™ï¼Œtypeå°±æ˜¯è¯¥å¯¹è±¡å¯¹åº”çš„æ•°æ®ç±»å‹ã€‚<br>æ‰€ä»¥ï¼Œä¸ºäº†é˜²æ­¢toString()æ–¹æ³•è¢«é‡å†™ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨<code>Object.prototype</code>ä¸Šçš„æ–¹æ³•ï¼Œè·å–æ•°æ®ç±»å‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//åˆ¤æ–­ç±»å‹</span><span class="token keyword">function</span> <span class="token function">getType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å‰é¢æåˆ°è¿‡ï¼Œå¯¹åº”å¯å¼•ç”¨çš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬è¦é€’å½’éå†ï¼›å¯¹åº”ä¸å¯å¼•ç”¨çš„æ•°æ®ç±»å‹ï¼Œç›´æ¥å¤åˆ¶å³å¯ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//åˆ¤æ–­æ˜¯å¦æ˜¯å¯å¼•ç”¨çš„æ•°æ®ç±»å‹ </span><span class="token keyword">function</span> <span class="token function">isRefrenceType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> target<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>target <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>è¿™é‡Œå¤§è‡´å¯¹ä¸€äº›æ•°æ®ç±»å‹è¿›è¡Œåˆ’åˆ†ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//å¼•ç”¨ç±»å‹</span><span class="token keyword">const</span> mapTag <span class="token operator">=</span> <span class="token string">'Map'</span><span class="token punctuation">;</span><span class="token keyword">const</span> setTag <span class="token operator">=</span> <span class="token string">'Set'</span><span class="token punctuation">;</span><span class="token keyword">const</span> arrayTag <span class="token operator">=</span> <span class="token string">'Array'</span><span class="token punctuation">;</span><span class="token keyword">const</span> objectTag <span class="token operator">=</span> <span class="token string">'Object'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¸å¯å¼•ç”¨ç±»å‹</span><span class="token keyword">const</span> boolTag <span class="token operator">=</span> <span class="token string">'Boolean'</span><span class="token punctuation">;</span><span class="token keyword">const</span> dateTag <span class="token operator">=</span> <span class="token string">'Date'</span><span class="token punctuation">;</span><span class="token keyword">const</span> errorTag <span class="token operator">=</span> <span class="token string">'Error'</span><span class="token punctuation">;</span><span class="token keyword">const</span> numberTag <span class="token operator">=</span> <span class="token string">'Number'</span><span class="token punctuation">;</span><span class="token keyword">const</span> regexpTag <span class="token operator">=</span> <span class="token string">'RegExp'</span><span class="token punctuation">;</span><span class="token keyword">const</span> stringTag <span class="token operator">=</span> <span class="token string">'String'</span><span class="token punctuation">;</span><span class="token keyword">const</span> symbolTag <span class="token operator">=</span> <span class="token string">'Symbol'</span><span class="token punctuation">;</span><span class="token keyword">const</span> bufferTag <span class="token operator">=</span> <span class="token string">'Uint8Array'</span><span class="token punctuation">;</span></code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//åˆ¤æ–­ç±»å‹</span><span class="token keyword">function</span> <span class="token function">getType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//åˆ¤æ–­æ˜¯å¦æ˜¯åŸå§‹ç±»å‹ç±»å‹ </span><span class="token keyword">function</span> <span class="token function">isRefrenceType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> target<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>target <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//è·å–åŸå‹ä¸Šçš„æ–¹æ³•</span><span class="token keyword">function</span> <span class="token function">getInit</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> ClassNames <span class="token operator">=</span> target<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClassNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//å¼•ç”¨ç±»å‹</span><span class="token keyword">const</span> mapTag <span class="token operator">=</span> <span class="token string">'Map'</span><span class="token punctuation">;</span><span class="token keyword">const</span> setTag <span class="token operator">=</span> <span class="token string">'Set'</span><span class="token punctuation">;</span><span class="token keyword">const</span> arrayTag <span class="token operator">=</span> <span class="token string">'Array'</span><span class="token punctuation">;</span><span class="token keyword">const</span> objectTag <span class="token operator">=</span> <span class="token string">'Object'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¸å¯å¼•ç”¨ç±»å‹</span><span class="token keyword">const</span> boolTag <span class="token operator">=</span> <span class="token string">'Boolean'</span><span class="token punctuation">;</span><span class="token keyword">const</span> dateTag <span class="token operator">=</span> <span class="token string">'Date'</span><span class="token punctuation">;</span><span class="token keyword">const</span> errorTag <span class="token operator">=</span> <span class="token string">'Error'</span><span class="token punctuation">;</span><span class="token keyword">const</span> numberTag <span class="token operator">=</span> <span class="token string">'Number'</span><span class="token punctuation">;</span><span class="token keyword">const</span> regexpTag <span class="token operator">=</span> <span class="token string">'RegExp'</span><span class="token punctuation">;</span><span class="token keyword">const</span> stringTag <span class="token operator">=</span> <span class="token string">'String'</span><span class="token punctuation">;</span><span class="token keyword">const</span> symbolTag <span class="token operator">=</span> <span class="token string">'Symbol'</span><span class="token punctuation">;</span><span class="token keyword">const</span> bufferTag <span class="token operator">=</span> <span class="token string">'Uint8Array'</span><span class="token punctuation">;</span><span class="token keyword">let</span> deepTag <span class="token operator">=</span> <span class="token punctuation">[</span>mapTag<span class="token punctuation">,</span> setTag<span class="token punctuation">,</span> arrayTag<span class="token punctuation">,</span> objectTag<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">deepClone4</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> isOriginType <span class="token operator">=</span> <span class="token function">isRefrenceType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOriginType<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> target    <span class="token punctuation">}</span>    <span class="token keyword">let</span> cloneTarget<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>deepTag<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cloneTarget <span class="token operator">=</span> <span class="token function">getInit</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//é˜²æ­¢å¾ªç¯å¼•ç”¨</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    map<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> cloneTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å¦‚æœæ˜¯mapTag ç±»å‹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> mapTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> cloneTarget<span class="token punctuation">,</span> <span class="token string">'target'</span><span class="token punctuation">)</span>        target<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            cloneTarget<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">deepClone4</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//å¦‚æœæ˜¯setTag ç±»å‹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> setTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        target<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            cloneTarget<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">deepClone4</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//å¦‚æœæ˜¯arrayTag ç±»å‹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> arrayTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        target<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            cloneTarget<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone4</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> map<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//objectTag ç±»å‹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> objectTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> array <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>        array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            cloneTarget<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone4</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'kaka'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>    field1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    field2<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>    field3<span class="token punctuation">:</span> <span class="token punctuation">{</span>        child<span class="token punctuation">:</span> <span class="token string">'child'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    field4<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    empty<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    map<span class="token punctuation">,</span>    <span class="token keyword">set</span><span class="token punctuation">}</span><span class="token punctuation">;</span>target<span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span><span class="token keyword">const</span> target1 <span class="token operator">=</span> <span class="token function">deepClone4</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>target1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">"a"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ğŸ'</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ğŸŒ'</span><span class="token punctuation">,</span> target1<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webå¸¸è§çš„æ”»å‡»æ‰‹æ®µ</title>
      <link href="/2020/03/12/Interview/04/"/>
      <url>/2020/03/12/Interview/04/</url>
      
        <content type="html"><![CDATA[<h1 id="å¸¸è§çš„æ”»å‡»æ‰‹æ®µ"><a href="#å¸¸è§çš„æ”»å‡»æ‰‹æ®µ" class="headerlink" title="å¸¸è§çš„æ”»å‡»æ‰‹æ®µ"></a>å¸¸è§çš„æ”»å‡»æ‰‹æ®µ</h1><h3 id="DOS"><a href="#DOS" class="headerlink" title="DOS"></a>DOS</h3><p>DOS(Denial Service)æ‹’ç»æœåŠ¡å¼æ”»å‡»ï¼Œå®ƒæ˜¯ä¸€ç§å®ç°å³ç®€å•å¾ˆæœ‰æ•ˆçš„é’ˆå¯¹æœåŠ¡å™¨è¿›è¡Œçš„æ”» å‡»æ–¹å¼ï¼Œå®ƒçš„æ”»å‡»ç›®çš„å°±æ˜¯è®©è¢«æ”»å‡»çš„ä¸»æœºå’ŒæœåŠ¡å™¨æ‹’ç»ç”¨æˆ·æ­£å¸¸è®¿é—®ï¼Œç ´åç³»ç»Ÿæ­£å¸¸è¿è¡Œ ï¼Œä»è€Œè¾¾åˆ°äº’è”ç½‘ç”¨æˆ·æ— æ³•è¿æ¥è¢«æ”»å‡»çš„æœåŠ¡å™¨å’Œä¸»æœºï¼Œé€ æˆæœåŠ¡å™¨ç˜«ç—ªã€‚å®ƒçš„æ”»å‡»è¿‡ç¨‹ï¼Œé¦–å…ˆæ”»å‡»è€…å‘è¢«æ”»å‡»çš„æœåŠ¡å™¨å‘ç”Ÿå¤§é‡å¸¦æœ‰è™šå‡IPåœ°å€çš„æœåŠ¡è¯·æ±‚ï¼Œè¢«æ”»å‡»è€…åœ¨æ¥æ”¶åˆ°è¯·æ±‚ åè¿”å›ç¡®è®¤ä¿¡æ¯ï¼Œç­‰å¾…æ”»å‡»è€…ç¡®è®¤ï¼Œæ­¤è¿‡ç¨‹éœ€è¦TCPçš„ä¸‰æ¬¡äº¤æ¢ã€‚ç”±äºæ”»å‡»è€…å‘é€çš„è¯·æ±‚ä¿¡ æ¯æ˜¯è™šå‡çš„ï¼Œæ‰€ä»¥è¢«æ”»å‡»æœåŠ¡å™¨æ— æ³•æ¥å—åˆ°ä¿¡æ¯ç¡®è®¤ï¼Œä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè€Œåˆ†é…ç»™è¿™æ¬¡è¯· æ±‚çš„èµ„æºå´å§‹ç»ˆæ²¡æœ‰è¢«é‡Šæ”¾ã€‚å½“è¢«æ”»å‡»è€…ç­‰å¾…ä¸€å®šçš„æ—¶é—´åï¼Œè¿æ¥ä¼šå› è¶…æ—¶è€Œè¢«æ–­å¼€ï¼Œè¿™æ˜¯ æ”»å‡»è€…å†æ¬¡å‘é€æ–°çš„è™šå‡ä¿¡æ¯è¯·æ±‚ï¼Œå°±è¿™æ ·æœ€ç»ˆæœåŠ¡å™¨èµ„æºè¢«è€—å°½ï¼Œç›´åˆ°ç˜«ç—ªã€‚</p><h3 id="DDOS"><a href="#DDOS" class="headerlink" title="DDOS"></a>DDOS</h3><p>DDOS(Distributed Denial Service)åˆ†å¸ƒæ‹’ç»å¼æ”»å‡»ï¼Œå®ƒæ˜¯åœ¨DOSåŸºç¡€ä¸Šè¿›è¡Œçš„å¤§è§„æ¨¡ï¼Œå¤§ èŒƒå›´çš„æ”»å‡»æ¨¡å¼ï¼ŒDOSåªæ˜¯å•æœºå’Œå•æœºä¹‹é—´çš„æ”»å‡»æ¨¡å¼ï¼Œè€ŒDDOSæ˜¯åˆ©ç”¨ä¸€æ‰¹å—æ§åˆ¶çš„åƒµå°¸ä¸» æœºå‘ä¸€å°æœåŠ¡å™¨ä¸»æœºå‘èµ·çš„æ”»å‡»ï¼Œå…¶æ”»å‡»çš„å¼ºåº¦å’Œé€ æˆçš„å¨èƒè¦æ¯”DOSä¸¥é‡å¾ˆå¤šï¼Œæ›´å…·ç ´å æ€§ã€‚é¦–å…ˆDDOSæ”»å‡»è€…è¦å¯»æ‰¾åƒµå°¸ä¸»æœºï¼Œåœ¨äº’è”ç½‘ä¸Šå¯»æ‰¾ä¸€äº›æœ‰åé—¨æ¼æ´çš„ä¸»æœºï¼Œç„¶åå…¥ä¾µç³» ç»Ÿå®‰è£…æ§åˆ¶ç¨‹åºï¼Œå…¥ä¾µçš„è¶Šå¤šï¼Œæ§åˆ¶çš„åƒµå°¸ä¸»æœºå°±è¶Šå¤šï¼Œæ”»å‡»æºå°±æ›´å¤šï¼Œç„¶åæŠŠå…¥ä¾µçš„ä¸»æœº åˆ†é…ï¼Œä¸€éƒ¨åˆ†å……å½“æ”»å‡»çš„ä¸»è¦æ§åˆ¶ç«¯ï¼Œä¸€éƒ¨åˆ†å……å½“æ”»å‡»æºï¼Œå„è´Ÿå…¶è´£ï¼Œåœ¨æ”»å‡»è€…ç»Ÿä¸€æŒ‡æŒ¥ä¸‹ å¯¹è¢«æ”»å‡»çš„æœåŠ¡å™¨å‘èµ·æ”»å‡»ï¼Œç”±äºè¿™ä¸ªæ”»å‡»æ¨¡å¼æ˜¯åœ¨å¹•åæ“ä½œï¼Œæ‰€ä»¥å¾ˆéš¾è¢«ç›‘æ§ç³»ç»Ÿè·Ÿè¸ªï¼Œ èº«ä»½ä¸å®¹æ˜“è¢«å‘ç°ã€‚</p><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>XSS(Cross Site Scripting)ï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ã€‚æŒ‡çš„æ˜¯é€šè¿‡ç½‘é¡µå¼€å‘è¿‡ç¨‹ä¸­ç•™ä¸‹çš„æ¼æ´ï¼Œé€šè¿‡ä¸€äº›æ–¹æ³•å°†æ¶æ„æŒ‡ä»¤ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä½¿ç”¨æˆ·åŠ è½½å¹¶æ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ç¨‹åºæŒ‡ä»¤ã€‚è¿™äº›æ¶æ„ç½‘é¡µç¨‹åºé€šå¸¸æ˜¯JavaScriptï¼Œä½†å®é™…ä¸Šä¹Ÿå¯ä»¥åŒ…æ‹¬Javaã€ VBScriptã€ActiveXã€ Flash æˆ–è€…ç”šè‡³æ˜¯æ™®é€šçš„HTMLã€‚æ”»å‡»æˆåŠŸåï¼Œæ”»å‡»è€…å¯èƒ½å¾—åˆ°åŒ…æ‹¬ä½†ä¸é™äºæ›´é«˜çš„æƒé™ï¼ˆå¦‚æ‰§è¡Œä¸€äº›æ“ä½œï¼‰ã€ç§å¯†ç½‘é¡µå†…å®¹ã€ä¼šè¯å’Œcookieç­‰å„ç§å†…å®¹ã€‚</p><h4 id="åå°„å‹XSS"><a href="#åå°„å‹XSS" class="headerlink" title="åå°„å‹XSS"></a>åå°„å‹XSS</h4><p>æ”»å‡»è€…çš„æ¶æ„ä»£ç å¹¶æ²¡æœ‰æ³¨å…¥åˆ°ç½‘ç«™ä¸­ï¼Œè€Œæ˜¯è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ç›®æ ‡ç½‘ç«™çš„é“¾æ¥æ¥å®æ–½æ”»å‡»ã€‚<br>åå°„å‹ XSS è·Ÿå­˜å‚¨å‹ XSS çš„åŒºåˆ«æ˜¯ï¼šå­˜å‚¨å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨æ•°æ®åº“é‡Œï¼Œåå°„å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨ URL é‡Œã€‚<br>åå°„å‹ XSS æ¼æ´å¸¸è§äºé€šè¿‡ URL ä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œå¦‚ç½‘ç«™æœç´¢ã€è·³è½¬ç­‰ã€‚</p><h4 id="å­˜å‚¨å‹XSS"><a href="#å­˜å‚¨å‹XSS" class="headerlink" title="å­˜å‚¨å‹XSS"></a>å­˜å‚¨å‹XSS</h4><p>æ”»å‡»è€…çš„æ¶æ„ä»£ç è¢«ä¿å­˜åˆ°ç›®æ ‡ç½‘ç«™çš„æœåŠ¡å™¨ä¸­ï¼Œè¿™ç§æ”»å‡»çš„æŒä¹…æ€§å’Œç¨³å®šæ€§è¾ƒå¼ºã€‚</p><h4 id="DOMå‹XSS"><a href="#DOMå‹XSS" class="headerlink" title="DOMå‹XSS"></a>DOMå‹XSS</h4><p>DOMå‹æŒ‡çš„å°±æ˜¯æ”»å‡»è€…è¾“å…¥æ¶æ„çš„ä»£ç å‰ç«¯æ²¡æœ‰åšä»»ä½•è¿‡æ»¤è¢«æ‰§è¡Œäº†ï¼Œç„¶åæ¶æ„ä»£ç å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæ¨¡æ‹Ÿç”¨æˆ·çš„è¡Œä¸ºã€‚</p><ol><li>æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚</li><li>ç”¨æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URLã€‚</li><li>ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œå‰ç«¯ JavaScript å–å‡º URL ä¸­çš„æ¶æ„ä»£ç å¹¶æ‰§è¡Œã€‚</li><li>æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œ</li></ol><h4 id="åå°„å‹XSSå’Œå­˜å‚¨å‹XSSé˜²èŒƒ"><a href="#åå°„å‹XSSå’Œå­˜å‚¨å‹XSSé˜²èŒƒ" class="headerlink" title="åå°„å‹XSSå’Œå­˜å‚¨å‹XSSé˜²èŒƒ"></a>åå°„å‹XSSå’Œå­˜å‚¨å‹XSSé˜²èŒƒ</h4><p>å­˜å‚¨å‹å’Œåå°„å‹ XSS éƒ½æ˜¯åœ¨æœåŠ¡ç«¯å–å‡ºæ¶æ„ä»£ç åï¼Œæ’å…¥åˆ°å“åº” HTML é‡Œçš„ï¼Œæ”»å‡»è€…åˆ»æ„ç¼–å†™çš„â€œæ•°æ®â€è¢«å†…åµŒåˆ°â€œä»£ç â€ä¸­ï¼Œè¢«æµè§ˆå™¨æ‰€æ‰§è¡Œã€‚<br>é¢„é˜²è¿™ä¸¤ç§æ¼æ´ï¼Œæœ‰ä¸¤ç§å¸¸è§åšæ³•ï¼š</p><ul><li>æ”¹æˆçº¯å‰ç«¯æ¸²æŸ“ï¼ŒæŠŠä»£ç å’Œæ•°æ®åˆ†éš”å¼€ã€‚</li><li>å¯¹ HTML åšå……åˆ†è½¬ä¹‰ã€‚</li></ul><h4 id="DOMå‹XSSé˜²èŒƒ"><a href="#DOMå‹XSSé˜²èŒƒ" class="headerlink" title="DOMå‹XSSé˜²èŒƒ"></a>DOMå‹XSSé˜²èŒƒ</h4><p>DOM å‹ XSS æ”»å‡»ï¼Œå®é™…ä¸Šå°±æ˜¯ç½‘ç«™å‰ç«¯ JavaScript ä»£ç æœ¬èº«ä¸å¤Ÿä¸¥è°¨ï¼ŒæŠŠä¸å¯ä¿¡çš„æ•°æ®å½“ä½œä»£ç æ‰§è¡Œäº†ã€‚<br>åœ¨ä½¿ç”¨ <code>.innerHTML</code>ã€<code>.outerHTML</code>ã€<code>document.write()</code> æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œä¸è¦æŠŠä¸å¯ä¿¡çš„æ•°æ®ä½œä¸º HTML æ’åˆ°é¡µé¢ä¸Šï¼Œè€Œåº”å°½é‡ä½¿ç”¨ <code>.textContent</code>ã€<code>.setAttribute()</code> ç­‰ã€‚<br>å¦‚æœç”¨ Vue/React æŠ€æœ¯æ ˆï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ <code>v-html</code>/<code>dangerouslySetInnerHTML</code> åŠŸèƒ½ï¼Œå°±åœ¨å‰ç«¯ render é˜¶æ®µé¿å… <code>innerHTML</code>ã€<code>outerHTML</code> çš„ XSS éšæ‚£ã€‚<br>DOM ä¸­çš„å†…è”äº‹ä»¶ç›‘å¬å™¨ï¼Œå¦‚ <code>location</code>ã€<code>onclick</code>ã€<code>onerror</code>ã€<code>onload</code>ã€<code>onmouseover</code> ç­‰ï¼Œ<code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>href</code> å±æ€§ï¼ŒJavaScript çš„ <code>eval()</code>ã€<code>setTimeout()</code>ã€<code>setInterval()</code> ç­‰ï¼Œéƒ½èƒ½æŠŠå­—ç¬¦ä¸²ä½œä¸ºä»£ç è¿è¡Œã€‚å¦‚æœä¸å¯ä¿¡çš„æ•°æ®æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸­ä¼ é€’ç»™è¿™äº› APIï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿå®‰å…¨éšæ‚£ï¼Œè¯·åŠ¡å¿…é¿å…ã€‚</p><h4 id="å¸¸è§çš„XSSæ³¨å…¥æ–¹æ³•"><a href="#å¸¸è§çš„XSSæ³¨å…¥æ–¹æ³•" class="headerlink" title="å¸¸è§çš„XSSæ³¨å…¥æ–¹æ³•"></a>å¸¸è§çš„XSSæ³¨å…¥æ–¹æ³•</h4><ul><li>åœ¨ HTML ä¸­å†…åµŒçš„æ–‡æœ¬ä¸­ï¼Œæ¶æ„å†…å®¹ä»¥ script æ ‡ç­¾å½¢æˆæ³¨å…¥ã€‚</li><li>åœ¨å†…è”çš„ JavaScript ä¸­ï¼Œæ‹¼æ¥çš„æ•°æ®çªç ´äº†åŸæœ¬çš„é™åˆ¶ï¼ˆå­—ç¬¦ä¸²ï¼Œå˜é‡ï¼Œæ–¹æ³•åç­‰ï¼‰ã€‚</li><li>åœ¨æ ‡ç­¾å±æ€§ä¸­ï¼Œæ¶æ„å†…å®¹åŒ…å«å¼•å·ï¼Œä»è€Œçªç ´å±æ€§å€¼çš„é™åˆ¶ï¼Œæ³¨å…¥å…¶ä»–å±æ€§æˆ–è€…æ ‡ç­¾ã€‚</li><li>åœ¨æ ‡ç­¾çš„ hrefã€src ç­‰å±æ€§ä¸­ï¼ŒåŒ…å« <code>javascript:</code> ç­‰å¯æ‰§è¡Œä»£ç ã€‚</li><li>åœ¨ onloadã€onerrorã€onclick ç­‰äº‹ä»¶ä¸­ï¼Œæ³¨å…¥ä¸å—æ§åˆ¶ä»£ç ã€‚</li><li>åœ¨ style å±æ€§å’Œæ ‡ç­¾ä¸­ï¼ŒåŒ…å«ç±»ä¼¼ <code>background-image:url(&quot;javascript:...&quot;);</code> çš„ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰ã€‚</li><li>åœ¨ style å±æ€§å’Œæ ‡ç­¾ä¸­ï¼ŒåŒ…å«ç±»ä¼¼ <code>expression(...)</code> çš„ CSS è¡¨è¾¾å¼ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vueå¸¸è§é¢è¯•é¢˜</title>
      <link href="/2020/03/11/Interview/05/"/>
      <url>/2020/03/11/Interview/05/</url>
      
        <content type="html"><![CDATA[<h1 id="vueå¸¸è§é¢è¯•é¢˜"><a href="#vueå¸¸è§é¢è¯•é¢˜" class="headerlink" title="vueå¸¸è§é¢è¯•é¢˜"></a>vueå¸¸è§é¢è¯•é¢˜</h1><h3 id="1ã€ä½ çŸ¥é“vueçš„æ¨¡æ¿è¯­æ³•ç”¨çš„æ˜¯å“ªä¸ªwebæ¨¡æ¿å¼•æ“çš„å—ï¼Ÿè¯´è¯´ä½ å¯¹è¿™æ¨¡æ¿å¼•æ“çš„ç†è§£ã€‚"><a href="#1ã€ä½ çŸ¥é“vueçš„æ¨¡æ¿è¯­æ³•ç”¨çš„æ˜¯å“ªä¸ªwebæ¨¡æ¿å¼•æ“çš„å—ï¼Ÿè¯´è¯´ä½ å¯¹è¿™æ¨¡æ¿å¼•æ“çš„ç†è§£ã€‚" class="headerlink" title="1ã€ä½ çŸ¥é“vueçš„æ¨¡æ¿è¯­æ³•ç”¨çš„æ˜¯å“ªä¸ªwebæ¨¡æ¿å¼•æ“çš„å—ï¼Ÿè¯´è¯´ä½ å¯¹è¿™æ¨¡æ¿å¼•æ“çš„ç†è§£ã€‚"></a>1ã€ä½ çŸ¥é“vueçš„æ¨¡æ¿è¯­æ³•ç”¨çš„æ˜¯å“ªä¸ªwebæ¨¡æ¿å¼•æ“çš„å—ï¼Ÿè¯´è¯´ä½ å¯¹è¿™æ¨¡æ¿å¼•æ“çš„ç†è§£ã€‚</h3><p>ä½¿ç”¨çš„Mustacheæ¨¡ç‰ˆã€‚<br>æ¨¡æ¿å¼•æ“ï¼š<br>è´Ÿè´£ç»„è£…æ•°æ®ï¼Œä»¥å¦å¤–ä¸€ç§å½¢å¼æˆ–å¤–è§‚å±•ç°æ•°æ®ã€‚<br>ä¼˜ç‚¹ï¼š</p><ol><li>å¯ç»´æŠ¤æ€§ï¼ˆåæœŸæ”¹èµ·æ¥æ–¹ä¾¿ï¼‰ï¼›</li><li>å¯æ‰©å±•æ€§ï¼ˆæƒ³è¦å¢åŠ åŠŸèƒ½ï¼Œå¢åŠ éœ€æ±‚æ–¹ä¾¿ï¼‰ï¼›</li><li>å¼€å‘æ•ˆç‡æé«˜ï¼ˆç¨‹åºé€»è¾‘ç»„ç»‡æ›´å¥½ï¼Œè°ƒè¯•æ–¹ä¾¿ï¼‰ï¼›</li><li>çœ‹èµ·æ¥èˆ’æœï¼ˆä¸å®¹æ˜“å†™é”™ï¼‰</li></ol><h3 id="2ã€ä½ çŸ¥é“v-modelçš„åŸç†å—ï¼Ÿ"><a href="#2ã€ä½ çŸ¥é“v-modelçš„åŸç†å—ï¼Ÿ" class="headerlink" title="2ã€ä½ çŸ¥é“v-modelçš„åŸç†å—ï¼Ÿ"></a>2ã€ä½ çŸ¥é“v-modelçš„åŸç†å—ï¼Ÿ</h3><p>v-modelåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå…¶å†…éƒ¨å®ç°åŸç†å°±æ˜¯ä½¿ç”¨<code>v-bind</code>å’Œ<code>input</code>äº‹ä»¶ç›‘å¬å€¼çš„æ”¹å˜ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">changeValue</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>    value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span></code></pre><h3 id="3ã€ä½¿ç”¨è¿‡vueå¼€å‘è¿‡å¤šè¯­è¨€é¡¹ç›®å—ï¼Ÿè¯´è¯´ä½ çš„åšæ³•"><a href="#3ã€ä½¿ç”¨è¿‡vueå¼€å‘è¿‡å¤šè¯­è¨€é¡¹ç›®å—ï¼Ÿè¯´è¯´ä½ çš„åšæ³•" class="headerlink" title="3ã€ä½¿ç”¨è¿‡vueå¼€å‘è¿‡å¤šè¯­è¨€é¡¹ç›®å—ï¼Ÿè¯´è¯´ä½ çš„åšæ³•"></a>3ã€ä½¿ç”¨è¿‡vueå¼€å‘è¿‡å¤šè¯­è¨€é¡¹ç›®å—ï¼Ÿè¯´è¯´ä½ çš„åšæ³•</h3><p>ä½¿ç”¨vue-i18nã€‚å…·ä½“ä½¿ç”¨è¯·å‚è€ƒ<a href="https://kazupon.github.io/vue-i18n/zh/started.html#html" target="_blank" rel="noopener">vue-i18n</a>ã€‚</p><ol><li>å®‰è£…ï¼šnpm install vue-i18n â€“save-dev</li><li>åˆ›å»ºè¯­è¨€æ–‡ä»¶ï¼šlanguage-zh.jså’Œlanguage-en.js   åˆ†åˆ«å¯¹åº”ä¸­æ–‡å’Œè‹±æ–‡ã€‚</li><li>åœ¨main.jsä¸­å¼•å…¥ã€‚</li><li>åˆ‡æ¢è¯­è¨€ã€‚</li></ol><p>language-zh.js:</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> lang <span class="token operator">=</span> <span class="token punctuation">{</span>    home<span class="token punctuation">:</span>'é¦–é¡µâ€˜<span class="token punctuation">,</span>  name<span class="token punctuation">:</span><span class="token string">'å§“å'</span><span class="token punctuation">}</span></code></pre><p>language-en.js:</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> lang <span class="token operator">=</span> <span class="token punctuation">{</span>    home<span class="token punctuation">:</span>'homeâ€˜<span class="token punctuation">,</span>  name<span class="token punctuation">:</span><span class="token string">'name'</span><span class="token punctuation">}</span></code></pre><p>main.jsï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> VueI18n <span class="token keyword">from</span> <span class="token string">'vue-i18n'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueI18n<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é€šè¿‡æ’ä»¶çš„å½¢å¼æŒ‚è½½ï¼Œé€šè¿‡å…¨å±€æ–¹æ³• Vue.use() ä½¿ç”¨æ’ä»¶const i18n = new VueI18n({</span>  locale<span class="token punctuation">:</span> <span class="token string">'zh'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// è¯­è¨€æ ‡è¯† //this.$i18n.locale // é€šè¿‡åˆ‡æ¢localeçš„å€¼æ¥å®ç°è¯­è¨€åˆ‡æ¢</span>  messages<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">'zh'</span><span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./VueI18n/language-zh'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//</span>    <span class="token string">'en'</span><span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./VueI18n/language-en'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  router<span class="token punctuation">,</span>  i18n<span class="token punctuation">,</span>  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span><span class="token punctuation">,</span>  template<span class="token punctuation">:</span> <span class="token string">'&lt;App/>'</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>åˆ‡æ¢è¯­è¨€ï¼š</p><pre class=" language-javascript"><code class="language-javascript">changeLaguages <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span>locale<span class="token punctuation">)</span>  <span class="token keyword">let</span> lang <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span>locale <span class="token operator">===</span> <span class="token string">'zh'</span> <span class="token operator">?</span> <span class="token string">'en'</span> <span class="token punctuation">:</span> <span class="token string">'zh'</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span>locale <span class="token operator">=</span> lang<span class="token punctuation">}</span></code></pre><h3 id="4ã€åœ¨ä½¿ç”¨è®¡ç®—å±æ€§æ—¶ï¼Œå‡½æ•°åå¯ä»¥å’Œdataæ•°æ®æºä¸­çš„å±æ€§åŒåå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#4ã€åœ¨ä½¿ç”¨è®¡ç®—å±æ€§æ—¶ï¼Œå‡½æ•°åå¯ä»¥å’Œdataæ•°æ®æºä¸­çš„å±æ€§åŒåå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="4ã€åœ¨ä½¿ç”¨è®¡ç®—å±æ€§æ—¶ï¼Œå‡½æ•°åå¯ä»¥å’Œdataæ•°æ®æºä¸­çš„å±æ€§åŒåå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>4ã€åœ¨ä½¿ç”¨è®¡ç®—å±æ€§æ—¶ï¼Œå‡½æ•°åå¯ä»¥å’Œdataæ•°æ®æºä¸­çš„å±æ€§åŒåå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3><p>ä¸å¯ä»¥ã€‚å› ä¸ºæ— è®ºæ˜¯è®¡ç®—å±æ€§ã€dataã€è¿˜æ˜¯propsï¼Œæœ€ç»ˆéƒ½ä¼šæŒ‚è½½åˆ°vmå®ä¾‹ä¸Šï¼Œå› æ­¤ä¸‰è€…ä¸å¯ä»¥åŒåã€‚<br>åœ¨<code>src/core/instance/state.js#L202</code>è¿™é‡Œï¼Œä¼šåšä¸€ä¸ªæ£€æŸ¥ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1583571758515-80345c94-4499-402d-b250-a3c760844e70.png#align=left&display=inline&height=210&name=image.png&originHeight=420&originWidth=1316&size=75093&status=done&style=none&width=658" alt="image.png"><br>è€Œä¸”åœ¨åˆå§‹åŒ–vmçš„æ—¶å€™ï¼Œä¼šä¾æ¬¡åˆå§‹åŒ–propsã€mehtodsã€dataï¼Œcomputedç­‰ã€‚è¿™æ˜¯åˆå§‹åŒ–çš„æºç ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> initState <span class="token punctuation">(</span>vm<span class="token punctuation">:</span> Component<span class="token punctuation">)</span> <span class="token punctuation">{</span>  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token function">initMethods</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment" spellcheck="true">/* asRootData */</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>watch <span class="token operator">!==</span> nativeWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="5ã€vueä¸­dataæ•°æ®æºä¸­çš„å±æ€§å¯ä»¥å’Œmethodsä¸­çš„æ–¹æ³•åé‡åå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#5ã€vueä¸­dataæ•°æ®æºä¸­çš„å±æ€§å¯ä»¥å’Œmethodsä¸­çš„æ–¹æ³•åé‡åå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="5ã€vueä¸­dataæ•°æ®æºä¸­çš„å±æ€§å¯ä»¥å’Œmethodsä¸­çš„æ–¹æ³•åé‡åå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>5ã€vueä¸­dataæ•°æ®æºä¸­çš„å±æ€§å¯ä»¥å’Œmethodsä¸­çš„æ–¹æ³•åé‡åå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3><p>ä¸å¯ä»¥ã€‚<br>åœ¨åˆå§‹åŒ–dataçš„æ—¶å€™ï¼Œç¨‹åºä¼šè¿›è¡Œæ£€æŸ¥ï¼Œ<code>src/core/instance/state.js#L113</code>ï¼Œåœ¨<code>initState</code>å‡½æ•°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> initData <span class="token punctuation">(</span>vm<span class="token punctuation">:</span> Component<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data  data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span>    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>    <span class="token punctuation">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>      <span class="token string">'data functions should return an object:\n'</span> <span class="token operator">+</span>      <span class="token string">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span><span class="token punctuation">,</span>      vm    <span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// proxy data on instance</span>  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props  <span class="token keyword">const</span> methods <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>methods  <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>methods<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿™é‡Œä¼šå¯¹åŒåå±æ€§å’Œæ–¹æ³•è¿›è¡Œè­¦å‘Š</span>        <span class="token function">warn</span><span class="token punctuation">(</span>          <span class="token template-string"><span class="token string">`Method "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" has already been defined as a data property.`</span></span><span class="token punctuation">,</span>          vm        <span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿™é‡Œä¼šå¯¹åŒåçš„propså’Œå±æ€§è¿›è¡Œè­¦å‘Š</span>      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>        <span class="token template-string"><span class="token string">`The data property "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is already declared as a prop. `</span></span> <span class="token operator">+</span>        <span class="token template-string"><span class="token string">`Use prop default value instead.`</span></span><span class="token punctuation">,</span>        vm      <span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isReserved</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`_data`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// observe data</span>  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment" spellcheck="true">/* asRootData */</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="5ã€æ€ä¹ˆç»™vueå®šä¹‰å…¨å±€æ–¹æ³•ï¼Ÿ"><a href="#5ã€æ€ä¹ˆç»™vueå®šä¹‰å…¨å±€æ–¹æ³•ï¼Ÿ" class="headerlink" title="5ã€æ€ä¹ˆç»™vueå®šä¹‰å…¨å±€æ–¹æ³•ï¼Ÿ"></a>5ã€æ€ä¹ˆç»™vueå®šä¹‰å…¨å±€æ–¹æ³•ï¼Ÿ</h3><ol><li>æŒ‚è½½åˆ°Vueçš„åŸå‹ä¸Šï¼Œå³ï¼šVue.prototype.methodsName = function(){}ã€‚</li><li>ä½¿ç”¨mixinï¼Œå³Vue.use(mixins)ã€‚</li></ol><h3 id="6ã€vue2-0ä¸­ä¸å†æ”¯æŒåœ¨v-htmlä¸­ä½¿ç”¨è¿‡æ»¤å™¨äº†æ€ä¹ˆåŠï¼Ÿ"><a href="#6ã€vue2-0ä¸­ä¸å†æ”¯æŒåœ¨v-htmlä¸­ä½¿ç”¨è¿‡æ»¤å™¨äº†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="6ã€vue2.0ä¸­ä¸å†æ”¯æŒåœ¨v-htmlä¸­ä½¿ç”¨è¿‡æ»¤å™¨äº†æ€ä¹ˆåŠï¼Ÿ"></a>6ã€vue2.0ä¸­ä¸å†æ”¯æŒåœ¨v-htmlä¸­ä½¿ç”¨è¿‡æ»¤å™¨äº†æ€ä¹ˆåŠï¼Ÿ</h3><ol><li>ä½¿ç”¨å…¨å±€æ–¹æ³•ã€‚æ¨è</li><li>ä½¿ç”¨filtersè¿‡æ»¤å™¨ã€‚</li><li>ä½¿ç”¨computedã€‚</li><li>ä½¿ç”¨methodsã€‚</li></ol><p>å…¨å±€æ–¹æ³•ï¼š</p><pre class=" language-javascript"><code class="language-javascript">Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token keyword">function</span>ï¼ˆmsgï¼‰<span class="token punctuation">{</span> ã€€<span class="token keyword">return</span> msg<span class="token punctuation">.</span>replaceï¼ˆ<span class="token string">"\n"</span>ï¼Œ<span class="token string">"&lt;br>"</span>ï¼‰<span class="token punctuation">}</span>ï¼›</code></pre><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg(content)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>filtersè¿‡æ»¤å™¨ï¼š</p><pre class=" language-javascript"><code class="language-javascript">filtersï¼š<span class="token punctuation">{</span>  msgï¼š<span class="token keyword">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\n<span class="token operator">/</span>gï¼Œ<span class="token string">"&lt;br>"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>computedï¼š</p><pre class=" language-javascript"><code class="language-javascript">computed<span class="token punctuation">:</span><span class="token punctuation">{</span>  msgï¼š<span class="token keyword">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\n<span class="token operator">/</span>gï¼Œ<span class="token string">"&lt;br>"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>mehtodsï¼š</p><pre class=" language-javascript"><code class="language-javascript">methods<span class="token punctuation">:</span><span class="token punctuation">{</span>  msgï¼š<span class="token keyword">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\n<span class="token operator">/</span>gï¼Œ<span class="token string">"&lt;br>"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="7ã€ä½¿ç”¨vueåæ€ä¹ˆé’ˆå¯¹æœç´¢å¼•æ“åšSEOä¼˜åŒ–"><a href="#7ã€ä½¿ç”¨vueåæ€ä¹ˆé’ˆå¯¹æœç´¢å¼•æ“åšSEOä¼˜åŒ–" class="headerlink" title="7ã€ä½¿ç”¨vueåæ€ä¹ˆé’ˆå¯¹æœç´¢å¼•æ“åšSEOä¼˜åŒ–?"></a>7ã€ä½¿ç”¨vueåæ€ä¹ˆé’ˆå¯¹æœç´¢å¼•æ“åšSEOä¼˜åŒ–?</h3><ol><li>SSRæœåŠ¡ç«¯æ¸²æŸ“</li><li>NUXTåŒæ„</li><li>prerender-spa-plugin é¢„æ¸²æŸ“</li></ol><h3 id="8ã€å’Œkeep-aliveç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼Ÿæè¿°ä¸‹è¿™äº›ç”Ÿå‘½å‘¨æœŸ"><a href="#8ã€å’Œkeep-aliveç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼Ÿæè¿°ä¸‹è¿™äº›ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="8ã€å’Œkeep-aliveç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼Ÿæè¿°ä¸‹è¿™äº›ç”Ÿå‘½å‘¨æœŸ"></a>8ã€å’Œkeep-aliveç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼Ÿæè¿°ä¸‹è¿™äº›ç”Ÿå‘½å‘¨æœŸ</h3><p>activated å’Œ deactivatedã€‚</p><ol><li>activatedï¼šå½“é¡µé¢è¿›å…¥çš„æ—¶å€™ï¼Œä¾æ¬¡è§¦å‘ï¼šcreated â€“&gt; mounted â€“&gt; activatedã€‚</li><li>deactivatedï¼šå½“é€€å‡ºé¡µé¢çš„æ—¶å€™è§¦å‘deactivatedï¼Œå½“åœ¨æ­¤å‰è¿›æˆ–è€…åé€€çš„æ—¶å€™ä¹‹åè§¦å‘activatedã€‚</li></ol><h3 id="9ã€ä½ çŸ¥é“vueä¸­keyçš„åŸç†å—ï¼Ÿ"><a href="#9ã€ä½ çŸ¥é“vueä¸­keyçš„åŸç†å—ï¼Ÿ" class="headerlink" title="9ã€ä½ çŸ¥é“vueä¸­keyçš„åŸç†å—ï¼Ÿ"></a>9ã€ä½ çŸ¥é“vueä¸­keyçš„åŸç†å—ï¼Ÿ</h3><p>keyçš„ä½œç”¨ä¸»è¦å°±æ˜¯ä¸ºäº†é«˜æ•ˆçš„æ›´æ–°è™šæ‹Ÿdomï¼ŒåŒæ—¶ï¼Œåœ¨vueä¸­ä½¿ç”¨ç›¸åŒæ ‡ç­¾åçš„å…ƒç´ è¿‡æ¸¡çš„æ—¶å€™éœ€è¦ä½¿ç”¨keyè¿›è¡ŒåŒºåˆ†ï¼Œå¦åˆ™vueä¹‹åæ›´æ–°å…¶å†…éƒ¨å±æ€§è€Œä¸ä¼šè§¦å‘è¿‡æ¸¡æ•ˆæœã€‚</p><h3 id="10ã€-vueå¦‚ä½•é‡ç½®dataï¼Ÿ"><a href="#10ã€-vueå¦‚ä½•é‡ç½®dataï¼Ÿ" class="headerlink" title="10ã€ vueå¦‚ä½•é‡ç½®dataï¼Ÿ"></a>10ã€ vueå¦‚ä½•é‡ç½®dataï¼Ÿ</h3><p>this.$data: è·å–å½“å‰çŠ¶æ€ä¸‹çš„dataã€‚<br>this.$options.data()ï¼šè·å–å½“å‰ç»„ä»¶åˆå§‹åŒ–çŠ¶æ€ä¸‹çš„dataã€‚<br>soï¼šObject.assgin( this.$data,this.$options.data() )</p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜²æŠ–èŠ‚æµ</title>
      <link href="/2020/03/05/Code/05/"/>
      <url>/2020/03/05/Code/05/</url>
      
        <content type="html"><![CDATA[<h1 id="é˜²æŠ–èŠ‚æµ"><a href="#é˜²æŠ–èŠ‚æµ" class="headerlink" title="é˜²æŠ–èŠ‚æµ"></a>é˜²æŠ–èŠ‚æµ</h1><p>åœ¨å‰ç«¯å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦ç»‘å®šä¸€äº›æŒç»­è§¦å‘çš„äº‹ä»¶ï¼Œå¦‚ resizeã€scrollã€mousemove ç­‰ç­‰ï¼Œä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨äº‹ä»¶æŒç»­è§¦å‘çš„è¿‡ç¨‹ä¸­é‚£ä¹ˆé¢‘ç¹åœ°å»æ‰§è¡Œå‡½æ•°ã€‚<br>é€šå¸¸è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ€ä¹ˆå»è§£å†³çš„å‘¢ï¼Ÿä¸€èˆ¬æ¥è®²ï¼Œé˜²æŠ–å’ŒèŠ‚æµæ˜¯æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="é˜²æŠ–-debounce"><a href="#é˜²æŠ–-debounce" class="headerlink" title="é˜²æŠ–(debounce)"></a>é˜²æŠ–(debounce)</h3><p>é˜²æŠ–å°±æ˜¯åœ¨è§„å®šæ—¶é—´å†…å‡½æ•°åªä¼šè§¦å‘ä¸€æ¬¡ï¼Œå¦‚æœå†æ¬¡è§¦å‘ï¼Œä¼šé‡æ–°è®¡ç®—æ—¶é—´ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/***  * @description é˜²æŠ–å‡½æ•° * @param func å‡½æ•° * @param wait å»¶è¿Ÿæ‰§è¡Œæ¯«ç§’æ•° * @param immediate æ˜¯å¦ç«‹å³æ‰§è¡Œ * */</span><span class="token keyword">function</span> <span class="token function">debouncing</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> wait <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> immediate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//ç¬¬ä¸€ç§ï¼šnç§’ä¹‹åæ‰§è¡Œï¼Œnç§’å†…å†æ¬¡è§¦å‘ä¼šé‡æ–°è®¡ç®—æ—¶é—´</span>            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//ç¡®ä¿thisæŒ‡å‘ä¸ä¼šæ”¹å˜</span>                func<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//ç¬¬äºŒç§ï¼šç«‹å³æ‰§è¡Œï¼Œnç§’å†…ä¸å¯å†æ¬¡è§¦å‘</span>            <span class="token keyword">let</span> callnew <span class="token operator">=</span> <span class="token operator">!</span>timer<span class="token punctuation">;</span>            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'kaka'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>callnew<span class="token punctuation">)</span> func<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debluncing'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token function">debouncing</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="èŠ‚æµ-throttle"><a href="#èŠ‚æµ-throttle" class="headerlink" title="èŠ‚æµ(throttle)"></a>èŠ‚æµ(throttle)</h3><p>èŠ‚æµæŒ‡çš„æ˜¯å‡½æ•°ä¸€å®šæ—¶é—´å†…ä¸ä¼šå†æ¬¡æ‰§è¡Œï¼Œç”¨ä½œç¨€é‡Šå‡½æ•°çš„æ‰§è¡Œé¢‘ç‡ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @description èŠ‚æµå‡½æ•° * @param func å‡½æ•° * @param wait å»¶è¿Ÿæ‰§è¡Œæ¯«ç§’æ•° * @param type 1ï¼šæ—¶é—´æˆ³ç‰ˆæœ¬ 2: å®šæ—¶å™¨ç‰ˆæœ¬ *  */</span><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> wait <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>            <span class="token keyword">const</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>                timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                    timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    func<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>            <span class="token keyword">const</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>            <span class="token keyword">let</span> newDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>newDate <span class="token operator">-</span> previous <span class="token operator">></span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>                func<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                previous <span class="token operator">=</span> newDate<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'throttle'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> f1 <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŸ¯é‡ŒåŒ–</title>
      <link href="/2020/03/05/Code/06/"/>
      <url>/2020/03/05/Code/06/</url>
      
        <content type="html"><![CDATA[<h1 id="æŸ¯é‡ŒåŒ–"><a href="#æŸ¯é‡ŒåŒ–" class="headerlink" title="æŸ¯é‡ŒåŒ–"></a>æŸ¯é‡ŒåŒ–</h1><h3 id="æŸ¯é‡ŒåŒ–-1"><a href="#æŸ¯é‡ŒåŒ–-1" class="headerlink" title="æŸ¯é‡ŒåŒ–"></a>æŸ¯é‡ŒåŒ–</h3><h4 id="ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Ÿ</h4><p>å‡½æ•°æŸ¯é‡ŒåŒ–å°±æ˜¯ä½¿å‡½æ•°å…ˆæ¥å—ä¸€éƒ¨åˆ†å‚æ•°ï¼Œä½¿ç”¨é—­åŒ…ç¼“å­˜å·²æ¥å—çš„å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨æ–°çš„å‡½æ•°ä¸­æ¥å—å‰©ä½™å‚æ•°ã€‚å¸¸å¸¸ç”¨ä½œå®ç°å‚æ•°å¤ç”¨ã€å°½é‡ä½¿ä»£ç å‡½æ•°åŒ–ï¼Œå¢åŠ å¯è¯»æ€§ã€‚</p><h4 id="å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–"><a href="#å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–" class="headerlink" title="å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–"></a>å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–</h4><p>å…ˆç»™ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//1</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//3</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//6</span></code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @description curry å‡½æ•°æŸ¯é‡ŒåŒ– * @param func å‡½æ•° * @return å‡½æ•° */</span><span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> outerargs <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">const</span> innerargs <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    outerargs <span class="token operator">=</span> outerargs<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>innerargs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> inner<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  inner<span class="token punctuation">.</span>toString <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>outerargs<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> inner<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="åæŸ¯é‡ŒåŒ–"><a href="#åæŸ¯é‡ŒåŒ–" class="headerlink" title="åæŸ¯é‡ŒåŒ–"></a>åæŸ¯é‡ŒåŒ–</h3>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°callã€applyå’Œbind</title>
      <link href="/2020/03/01/Code/04/"/>
      <url>/2020/03/01/Code/04/</url>
      
        <content type="html"><![CDATA[<h1 id="å®ç°callã€applyå’Œbind"><a href="#å®ç°callã€applyå’Œbind" class="headerlink" title="å®ç°callã€applyå’Œbind"></a>å®ç°callã€applyå’Œbind</h1><h3 id="ä¸‰è€…çš„å¼‚åŒ"><a href="#ä¸‰è€…çš„å¼‚åŒ" class="headerlink" title="ä¸‰è€…çš„å¼‚åŒ"></a>ä¸‰è€…çš„å¼‚åŒ</h3><ol><li>éƒ½å¯ä»¥æ”¹å˜thisæŒ‡å‘ã€‚</li><li>æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ”¹å˜åçš„thisæŒ‡å‘ã€‚</li><li>callã€bindæ¥å—çš„å‚æ•°ï¼Œä»¥é˜Ÿåˆ—çš„å½¢å¼ã€‚applyæ¥å—æ•°ç»„å½¢å¼çš„ä¼ å‚ã€‚</li><li>callå’Œapplyå¯ä»¥å¤šæ¬¡æ”¹å˜thisæŒ‡å‘ã€‚è€Œbindåªå¯ä½¿ç”¨ä¸€æ¬¡ï¼Œå†æ¬¡ä½¿ç”¨æ— æ•ˆï¼Œç»‘å®šçš„ä»ç„¶æ˜¯ç¬¬ä¸€æ¬¡çš„å¯¹è±¡ã€‚</li><li>callå’Œapplyè°ƒç”¨æ—¶ï¼Œä¼šç›´æ¥æ‰§è¡Œfunctionï¼Œè€Œbindä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œä¸”å‡½æ•°åä¸ºâ€bound xxxâ€ ã€‚</li></ol><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>åœ¨JavaScriptä¸­thisçš„æŒ‡å‘é—®é¢˜ä¸­æåˆ°ï¼Œä½œä¸ºå¯¹è±¡æ–¹æ³•çš„è°ƒç”¨ã€‚å‡½æ•°è¿˜å¯ä»¥ä½œä¸ºæŸä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿™æ—¶thiså°±æŒ‡è¿™ä¸ªä¸Šçº§å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„ï¼Œè°è°ƒç”¨ï¼Œthiså°±æŒ‡å‘è°ã€‚</p><p>å®ç°æ–¹æ³•ï¼šåœ¨ä¼ å…¥çš„å‚æ•°ä¸­ä¼ å…¥ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œæœ€ååˆ é™¤è¯¥æ–¹æ³•ï¼ˆä¸ºäº†ä¿æŒå¯¹è±¡çš„å‰åä¸€è‡´æ€§ï¼‰ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><pre class=" language-javascript"><code class="language-javascript">Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>newCall <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span><span class="token operator">...</span>rest<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//è·å–æ„é€ å‡½æ•° å³this</span>    <span class="token keyword">const</span> constructor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//è·å–å¯¹è±¡ å³æ–°çš„thisæŒ‡å‘</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">{</span>      context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>      context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">cerate</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//ä½¿ç”¨Symbol()ç¡®ä¿ä¸ä¼šè¦†ç›–å¯¹è±¡objçš„åŸæœ‰çš„å±æ€§</span>  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span> <span class="token operator">=</span> constructor<span class="token punctuation">;</span>  context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>rest<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//åˆ é™¤æ·»åŠ çš„å±æ€§</span>  <span class="token keyword">delete</span> context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span>    <span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>fn<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre><h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><pre class=" language-javascript"><code class="language-javascript">Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>newApply <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>rest<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//è·å–æ„é€ å‡½æ•° å³this</span>    <span class="token keyword">const</span> constructor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//è·å–å¯¹è±¡ å³æ–°çš„thisæŒ‡å‘</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">{</span>      context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>      context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">cerate</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//ä½¿ç”¨Symbol()ç¡®ä¿ä¸ä¼šè¦†ç›–å¯¹è±¡objçš„åŸæœ‰çš„å±æ€§</span>  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span> <span class="token operator">=</span> constructor<span class="token punctuation">;</span>  context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//åˆ é™¤æ·»åŠ çš„å±æ€§</span>  <span class="token keyword">delete</span> context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span>    <span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>fn<span class="token punctuation">.</span><span class="token function">newApply</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre><h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><pre class=" language-javascript"><code class="language-javascript">Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>newBind <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span><span class="token operator">...</span>params<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>    <span class="token keyword">const</span> Constructor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token operator">...</span>rest<span class="token punctuation">)</span><span class="token punctuation">{</span>        Constructor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">...</span>params<span class="token punctuation">,</span><span class="token operator">...</span>rest<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> f1 <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">newBind</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼</title>
      <link href="/2020/02/27/Code/03/"/>
      <url>/2020/02/27/Code/03/</url>
      
        <content type="html"><![CDATA[<h1 id="è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼</h1><h3 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡è§ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰€ä»¥ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½å°†æ¥æ”¶åˆ°é€šçŸ¥ï¼Œå¹¶ä½œå‡ºæ›´æ–°ã€‚</p><h3 id="å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><p>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä¸ªäººç†è§£ä¸ºæ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§ç‰¹ä¾‹ã€‚æœ€åˆçš„æ—¶å€™ï¼Œè®¢é˜…ç›®æ ‡å’Œè®¢é˜…å¯¹è±¡æ˜¯è”ç³»åœ¨ä¸€èµ·çš„ï¼Œå½“è®¢é˜…ç›®æ ‡å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä¼šé€ä¸ªé€šçŸ¥è®¢é˜…è€…ã€‚<br>åœ¨ç°åœ¨çš„å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…ä¸åœ¨ç›´æ¥å°†æ¶ˆæ¯å‘é€ç»™è®¢é˜…è€…ï¼Œè€Œæ˜¯æ˜¯é€šè¿‡ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯ä¸­å¿ƒæˆ–è€…è°ƒåº¦ä¸­å¿ƒï¼Œç”±å®ƒæ¥ç»´æŒç€å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´çš„é€šè®¯ï¼Œå‘å¸ƒæ–¹å’Œè®¢é˜…æ–¹äº’ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚</p><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1580894616701-bd4dca45-dd7c-450c-a2d5-d7c139c053fc.png#align=left&display=inline&height=348&name=image.png&originHeight=372&originWidth=554&size=149810&status=done&style=none&width=519" alt="image.png"></p><h4 id="è§‚å¯Ÿè€…æ¨¡å¼-1"><a href="#è§‚å¯Ÿè€…æ¨¡å¼-1" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h4><p>è®¢é˜…è€…ç›´æ¥è®¢é˜…å‘å¸ƒè€…çš„äº‹ä»¶ï¼Œå½“å‘å¸ƒè€…çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œä¼šç›´æ¥è§¦å‘è®¢é˜…è€…çš„å›è°ƒäº‹ä»¶ã€‚</p><h4 id="å‘å¸ƒè®¢é˜…æ¨¡å¼-1"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼-1" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼</h4><p>è®¢é˜…è€…é¦–å…ˆå°†å³å°†è®¢é˜…çš„äº‹ä»¶æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒï¼Œå½“å‘å¸ƒè€…å‘å¸ƒè¯¥äº‹ä»¶åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒåº¦è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚</p><h3 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h3><h4 id="è§‚å¯Ÿè€…æ¨¡å¼-2"><a href="#è§‚å¯Ÿè€…æ¨¡å¼-2" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Hunter</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å‘å¸ƒ</span>Hunter<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>publish <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">+</span> <span class="token string">'çŒäºº,'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'å¯»æ±‚å¸®åŠ©!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">item</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è®¢é˜…</span>Hunter<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>subscribe <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'è®¢é˜…äº†'</span> <span class="token operator">+</span> target<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    target<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> kaka <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hunter</span><span class="token punctuation">(</span><span class="token string">'é»„é‡‘'</span><span class="token punctuation">,</span><span class="token string">'kaka'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> hudie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hunter</span><span class="token punctuation">(</span><span class="token string">'é’»çŸ³'</span><span class="token punctuation">,</span><span class="token string">'hudie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> dida <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hunter</span><span class="token punctuation">(</span><span class="token string">'ç‹è€…'</span><span class="token punctuation">,</span><span class="token string">'dida'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hudie<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>kaka<span class="token punctuation">,</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è§‚å¯Ÿåˆ°kakaçš„åŠ¨æ€,å‘æ‚¨æ±‡æŠ¥!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>kaka<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></code></pre><p>è¿™ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰æ¥ä¸€ä¸ªå‡½æ•°Hunterï¼Œåœ¨å…¶åŸå‹ä¸Šæ³¨å†Œäº†å‘å¸ƒå’Œè®¢é˜…çš„å‡½æ•°ã€‚åœ¨è®¢é˜…å‡½æ•°ä¸­ï¼Œè®¾ç½®äº†ä¸¤ä¸ªå‚æ•°ï¼Œtargetå¯¹è±¡å’Œå›è°ƒå‡½æ•°fnï¼Œç„¶ååœ¨å‘å¸ƒè€…çš„æ‰§è¡Œé˜Ÿåˆ—ä¸­å°†å›è°ƒå‡½æ•°æ³¨å…¥è¿›å»ã€‚åœ¨å‘å¸ƒå‡½æ•°ä¸­ï¼Œä¸€æ—¦å‘å¸ƒè€…æ”¹å˜äº†çŠ¶æ€ï¼Œåˆ™ä¼šè§¦å‘å…¶æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°ã€‚</p><h4 id="å‘å¸ƒè®¢é˜…æ¨¡å¼-2"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼-2" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> HunterUnion <span class="token operator">=</span> <span class="token punctuation">{</span>    type<span class="token punctuation">:</span><span class="token string">'hunter'</span><span class="token punctuation">,</span>    topics<span class="token punctuation">:</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    publish<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>topics<span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span>         <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>topics<span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token function">item</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    subscribe<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>topics<span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>topics<span class="token punctuation">[</span>topic<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>topics<span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Hunter</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å‘å¸ƒ</span>Hunter<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>publish <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">+</span> <span class="token string">'çŒäºº,'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'å‘å¸ƒtigerä»»åŠ¡!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    HunterUnion<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è®¢é˜…</span>Hunter<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>subscribe <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'è®¢é˜…äº†'</span> <span class="token operator">+</span> topic<span class="token punctuation">)</span><span class="token punctuation">;</span>    HunterUnion<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>fn<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// target.list.push(fn);</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> kaka <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hunter</span><span class="token punctuation">(</span><span class="token string">'é»„é‡‘'</span><span class="token punctuation">,</span><span class="token string">'kaka'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> hudie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hunter</span><span class="token punctuation">(</span><span class="token string">'é’»çŸ³'</span><span class="token punctuation">,</span><span class="token string">'hudie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> dida <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hunter</span><span class="token punctuation">(</span><span class="token string">'ç‹è€…'</span><span class="token punctuation">,</span><span class="token string">'dida'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hudie<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'tiger'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hudie,'</span> <span class="token operator">+</span> <span class="token string">'è§‚å¯Ÿåˆ°tigerçš„åŠ¨æ€,å‘æ‚¨æ±‡æŠ¥!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dida<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'tiger'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dida,'</span> <span class="token operator">+</span> <span class="token string">'è§‚å¯Ÿåˆ°tigerçš„åŠ¨æ€,å‘æ‚¨æ±‡æŠ¥!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>kaka<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'tiger'</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span></code></pre><p>åœ¨ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒHunterUnionï¼Œæ‰€æœ‰çš„å‘å¸ƒè®¢é˜…çš„åŠ¨ä½œï¼Œéƒ½åœ¨å…¶å†…éƒ¨å®Œæˆã€‚å…¶ä»–å¤§è‡´å’Œä¸Šé¢çš„è§‚å¯Ÿè€…å·®ä¸å¤šã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼æœ‰ä¸ªäº‹ä»¶è°ƒåº¦ä¸­å¿ƒã€‚<br>è§‚å¯Ÿè€…æ¨¡å¼ç”±å…·ä½“ç›®æ ‡è°ƒåº¦ï¼Œæ¯ä¸ªè¢«è®¢é˜…çš„ç›®æ ‡é‡Œé¢éƒ½éœ€è¦æœ‰å¯¹è§‚å¯Ÿè€…çš„å¤„ç†ï¼Œè¿™ç§å¤„ç†æ–¹å¼æ¯”è¾ƒç›´æ¥ç²—æš´ï¼Œä½†æ˜¯ä¼šé€ æˆä»£ç çš„å†—ä½™ã€‚<br>è€Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ç»Ÿä¸€ç”±è°ƒåº¦ä¸­å¿ƒè¿›è¡Œå¤„ç†ï¼Œè®¢é˜…è€…å’Œå‘å¸ƒè€…äº’ä¸å¹²æ‰°ï¼Œæ¶ˆé™¤äº†å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´çš„ä¾èµ–ã€‚è¿™æ ·ä¸€æ–¹é¢å®ç°äº†è§£è€¦ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„ä¸€äº›æ§åˆ¶ã€‚æ¯”å¦‚å‘å¸ƒè€…å‘å¸ƒäº†å¾ˆå¤šæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸æƒ³æ‰€æœ‰çš„è®¢é˜…è€…éƒ½æ¥æ”¶åˆ°ï¼Œå°±å¯ä»¥åœ¨è°ƒåº¦ä¸­å¿ƒåšä¸€äº›å¤„ç†ï¼Œç±»ä¼¼äºæƒé™æ§åˆ¶ä¹‹ç±»çš„ã€‚è¿˜å¯ä»¥åšä¸€äº›èŠ‚æµæ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™JSON.stringify</title>
      <link href="/2020/02/25/Code/02/"/>
      <url>/2020/02/25/Code/02/</url>
      
        <content type="html"><![CDATA[<h1 id="æ‰‹å†™JSON-stringify"><a href="#æ‰‹å†™JSON-stringify" class="headerlink" title="æ‰‹å†™JSON.stringify"></a>æ‰‹å†™JSON.stringify</h1><p>æ ¹æ®<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" target="_blank" rel="noopener">JSON.stringify()</a>çš„å®šä¹‰ï¼Œå¯å¾—çŸ¥è¯¥æ–¹æ³•çš„å®ç°è¿‡ç¨‹ï¼š</p><ol><li>å¦‚æœå¯¹è±¡æœ‰è‡ªå®šä¹‰çš„toJSON()æ–¹æ³•ï¼Œåˆ™ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ï¼›</li><li>å¸ƒå°”ã€æ•°å­—ã€å­—ç¬¦ä¸²è¢«è½¬æ¢ä¸ºå¯¹åº”çš„åŸå§‹å€¼ï¼›</li><li>undefined function symbolè½¬æ¢æ—¶è¢«å¿½ç•¥ï¼Œå¦‚æœå‡ºç°åœ¨æ•°ç»„ä¸­ï¼Œåˆ™è¿”å›nullã€‚</li></ol><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">JSONString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è·å–ä¼ å…¥çš„å€¼çš„æ•°æ®ç±»å‹</span>    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex">/(function|undefined|symbol)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">'"'</span> <span class="token operator">+</span> obj <span class="token operator">+</span> <span class="token string">'"'</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ˜¯å¦æ˜¯æ•°ç»„</span>        <span class="token keyword">let</span> isArray <span class="token operator">=</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array<span class="token punctuation">;</span>        loop<span class="token punctuation">:</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> value <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> typeValue <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>typeValue <span class="token operator">===</span> <span class="token string">'[object Symbol]'</span> <span class="token operator">||</span> typeValue <span class="token operator">===</span> <span class="token string">'[object Undefined]'</span> <span class="token operator">||</span> typeValue <span class="token operator">===</span> <span class="token string">'[object Function]'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//symbol ç±»å‹ </span>                <span class="token keyword">continue</span> loop<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>typeValue <span class="token operator">===</span> <span class="token string">'[object Object]'</span> <span class="token operator">||</span> typeValue <span class="token operator">===</span> <span class="token string">'[object Array]'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                value <span class="token operator">=</span> <span class="token function">JSONString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">let</span> v <span class="token operator">=</span> isArray <span class="token operator">?</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">String</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">":</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">String</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>            arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> str <span class="token operator">=</span> isArray <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token string">`"[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">String</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]"`</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token string">`{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">String</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> str<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    c<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    d<span class="token punctuation">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    e<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    f<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    g<span class="token punctuation">:</span> undefined<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">JSONString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™newæ“ä½œç¬¦</title>
      <link href="/2020/02/25/Code/01/"/>
      <url>/2020/02/25/Code/01/</url>
      
        <content type="html"><![CDATA[<h1 id="æ‰‹å†™newæ“ä½œç¬¦"><a href="#æ‰‹å†™newæ“ä½œç¬¦" class="headerlink" title="æ‰‹å†™newæ“ä½œç¬¦"></a>æ‰‹å†™newæ“ä½œç¬¦</h1><h4 id="newæ“ä½œç¬¦åšäº†ä»€ä¹ˆï¼Ÿ"><a href="#newæ“ä½œç¬¦åšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="newæ“ä½œç¬¦åšäº†ä»€ä¹ˆï¼Ÿ"></a>newæ“ä½œç¬¦åšäº†ä»€ä¹ˆï¼Ÿ</h4><ol><li>æ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼›</li><li>å°†ç»§æ‰¿æ„é€ å‡½æ•°çš„åŸå‹ï¼›</li><li>æ”¹å˜æ„é€ å‡½æ•°çš„thisæŒ‡å‘ï¼›</li><li>è¿”å›å¯¹è±¡ï¼ˆå¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ç±»å‹ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼‰ã€‚</li></ol><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//æ‰‹å†™newæ“ä½œç¬¦</span>Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è·å–å‚æ•°</span>    <span class="token keyword">const</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è·å–æ„é€ å‡½æ•° å³this</span>    <span class="token keyword">let</span> Controuctor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ–°å»ºå¯¹è±¡</span>    <span class="token keyword">let</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> Controuctor<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ”¹å˜æ„é€ å‡½æ•°thisæŒ‡å‘</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> Controuctor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> res <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> res <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> obj<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>getName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> f <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>f<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆ</title>
      <link href="/2020/02/20/Interview/01/"/>
      <url>/2020/02/20/Interview/01/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹"><a href="#ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹" class="headerlink" title="ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹"></a>ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹</h1><h2 id="ä¸»å¹²æµç¨‹"><a href="#ä¸»å¹²æµç¨‹" class="headerlink" title="ä¸»å¹²æµç¨‹"></a>ä¸»å¹²æµç¨‹</h2><ol><li><strong>æµè§ˆå™¨æ¥æ”¶urlï¼Œå¼€å¯ä¸€ä¸ªæ–°çš„ç½‘ç»œè¯·æ±‚çº¿ç¨‹ï¼ˆè¿™éƒ¨åˆ†æ¶‰åŠåˆ°æµè§ˆå™¨è¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„å…³ç³»ï¼‰ã€‚</strong></li><li><strong>ä»å¼€å¯ç½‘ç»œè¯·æ±‚çº¿ç¨‹åˆ°å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼ˆè¿™éƒ¨åˆ†æ¶‰åŠåˆ°dnsè§£æã€äº”å±‚å› ç‰¹ç½‘åè®®æ ˆã€tcp/ipåè®®ç­‰ï¼‰ã€‚</strong></li><li><strong>ä»æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚åˆ°åå°æ”¶åˆ°è¯·æ±‚ï¼ˆè¿™éƒ¨åˆ†æ¶‰åŠåˆ°è´Ÿè½½å‡è¡¡ã€å®‰å…¨æ‹¦æˆªã€åå°ç¨‹åºå†…éƒ¨å¤„ç†ç­‰çŸ¥è¯†ï¼‰ã€‚</strong></li><li><strong>æœåŠ¡ç«¯å’Œæµè§ˆå™¨ä¹‹é—´çš„äº¤äº’ï¼ˆå¦‚httpè¯·æ±‚å¤´ã€çŠ¶æ€ç ã€è¯·æ±‚æŠ¥æ–‡ã€cookieã€sessionç­‰ï¼‰ã€‚</strong></li><li><strong>httpç¼“å­˜ï¼ˆåŒ…æ‹¬å¼ºç¼“å­˜ã€åå•†ç¼“å­˜ç­‰ï¼‰ã€‚</strong></li><li><strong>CSSçš„å¯è§†åŒ–æ¨¡å‹è§£æï¼ˆå…ƒç´ çš„æ¸²æŸ“è§„åˆ™ã€åŒ…å«å—ã€æ§åˆ¶å—ã€BFCã€IFCç­‰ï¼‰ã€‚</strong></li><li><strong>JSçš„è§£æè¿‡ç¨‹ï¼ˆJSçš„è§£é‡Šè¿‡ç¨‹ã€é¢„å¤„ç†è¿‡ç¨‹ã€æ‰§è¡Œé˜¶æ®µçš„GOã€VOã€AOã€ä½œç”¨åŸŸå’Œä½œç”¨åŸŸè¿ç­‰ï¼‰ã€‚</strong></li><li><strong>å…¶å®ƒï¼ˆå¦‚å®‰å…¨ç­–ç•¥ã€è·¨åŸŸç­‰ï¼‰</strong></li></ol><h2 id="ä»æµè§ˆå™¨æ¥æ”¶urlåˆ°å¼€å¯ç½‘ç»œè¯·æ±‚çº¿ç¨‹"><a href="#ä»æµè§ˆå™¨æ¥æ”¶urlåˆ°å¼€å¯ç½‘ç»œè¯·æ±‚çº¿ç¨‹" class="headerlink" title="ä»æµè§ˆå™¨æ¥æ”¶urlåˆ°å¼€å¯ç½‘ç»œè¯·æ±‚çº¿ç¨‹"></a>ä»æµè§ˆå™¨æ¥æ”¶urlåˆ°å¼€å¯ç½‘ç»œè¯·æ±‚çº¿ç¨‹</h2><h3 id="å¤šè¿›ç¨‹çš„æµè§ˆå™¨"><a href="#å¤šè¿›ç¨‹çš„æµè§ˆå™¨" class="headerlink" title="å¤šè¿›ç¨‹çš„æµè§ˆå™¨"></a>å¤šè¿›ç¨‹çš„æµè§ˆå™¨</h3><p>æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ï¼Œæœ‰ä¸€ä¸ªä¸»æ§è¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªtabé¡µéƒ½ä¼šæ–°å¼€ä¸€ä¸ªè¿›ç¨‹ã€‚<br>è¿™äº›è¿›ç¨‹å¯èƒ½åŒ…æ‹¬ï¼šä¸»æ§è¿›ç¨‹ã€æ’ä»¶è¿›ç¨‹ã€GPUã€tabé¡µç­‰ã€‚</p><ul><li>Browserè¿›ç¨‹ï¼šæµè§ˆå™¨çš„ä¸»è¿›ç¨‹ï¼Œè´Ÿè´£è°ƒæ§ï¼Œåªæœ‰ä¸€ä¸ªã€‚</li><li>GPUè¿›ç¨‹ï¼šè´Ÿè´£3Dæ¸²æŸ“ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªã€‚</li><li>ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹ï¼šè´Ÿè´£ç®¡ç†ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ¯ä¸€ä¸ªæ’ä»¶éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„è¿›ç¨‹ï¼Œä»…å½“è¯¥æ’ä»¶åˆ›å»ºæ—¶åˆ›å»ºã€‚</li><li>æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹ï¼ˆæµè§ˆå™¨å†…æ ¸ï¼‰ï¼šé»˜è®¤æ¯ä¸ªtabé¡µä¸€ä¸ªè¿›ç¨‹ï¼Œäº’ä¸å¹²æ‰°ï¼Œè´Ÿè´£æ§åˆ¶é¡µé¢æ¸²æŸ“ã€è„šæœ¬æ‰§è¡Œã€äº‹ä»¶å¤„ç†ç­‰ã€‚</li></ul><h3 id="æµè§ˆå™¨å†…æ ¸çš„äº”å¤§çº¿ç¨‹"><a href="#æµè§ˆå™¨å†…æ ¸çš„äº”å¤§çº¿ç¨‹" class="headerlink" title="æµè§ˆå™¨å†…æ ¸çš„äº”å¤§çº¿ç¨‹"></a>æµè§ˆå™¨å†…æ ¸çš„äº”å¤§çº¿ç¨‹</h3><p>æ¯ä¸€ä¸ªtabé¡µéƒ½å¯ä»¥çœ‹ä½œä¸€ä¸ªæµè§ˆå™¨å†…æ ¸è¿›ç¨‹ï¼Œè€Œè¯¥è¿›ç¨‹åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼š</p><ul><li>GUIçº¿ç¨‹ï¼šè´Ÿè´£é¡µé¢æ¸²æŸ“ã€é‡ç»˜ã€CSSè§£æç­‰ã€‚</li><li>JSå¼•æ“çº¿ç¨‹ï¼šè´Ÿè´£ç¨‹åºè„šæœ¬çš„è§£æå’Œæ‰§è¡Œã€‚</li><li>äº‹ä»¶è§¦å‘çº¿ç¨‹ï¼šè´Ÿè´£ç®¡ç†äº‹ä»¶å¾ªç¯ï¼Œç®¡ç†äº‹ä»¶ä»»åŠ¡é˜Ÿåˆ—ã€‚</li><li>å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ï¼šsetTImeout å’Œ setInterval æ‰€åœ¨çš„çº¿ç¨‹ã€‚å®šæ—¶å™¨çš„è®¡æ—¶ä¸æ˜¯æœ‰JSå¼•æ“æ§åˆ¶ï¼Œè€Œæ˜¯ç”±è¯¥çº¿ç¨‹æ§åˆ¶ã€‚</li><li>httpè¯·æ±‚çº¿ç¨‹ï¼šè´Ÿè´£httpè¯·æ±‚ã€‚</li></ul><h4 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h4><p>Qï¼šä¸ºä»€ä¹ˆJSå¼•æ“çº¿ç¨‹å’ŒGUIçº¿ç¨‹äº’æ–¥ï¼Ÿ<br>Aï¼šå› ä¸ºJSæ˜¯å¯ä»¥æ“ä½œDOMçš„ï¼Œå¦‚æœåœ¨JSæ“ä½œDOMçš„åŒæ—¶ï¼ŒGUIçº¿ç¨‹ä¹Ÿåœ¨æ¸²æŸ“é¡µé¢ï¼Œé‚£ä¹ˆå…ƒç´ æœ€ç»ˆçš„å‘ˆç°å¯èƒ½å°±ä¸ä¼šå’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€è‡´äº†ã€‚<br>Qï¼šä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹ï¼Ÿ<br>Aï¼š1ã€åˆ›å»ºJavaScriptè¯­è¨€çš„æ—¶å€™ï¼Œå¤šè¿›ç¨‹å¤šçº¿ç¨‹å¹¶ä¸æµè¡Œï¼Œç¡¬ä»¶æ”¯æŒåº¦ä¸é«˜ã€‚<br>    2ã€å¤šè¿›ç¨‹å¤šçº¿ç¨‹ä½¿ç”¨æ—¶éœ€è¦åŠ é”ï¼Œå®æ–½æˆæœ¬é«˜ã€‚<br>    3ã€å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªDOMå…ƒç´ ï¼Œå¯èƒ½å…ƒç´ çš„æœ€ç»ˆå‘ˆç°ä¸ä¼šå¦‚é¢„æœŸä¸€æ ·ã€‚<br>    4ã€çº¿ç¨‹ä¹‹é—´èµ„æºå…±äº«ã€‚<br>å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://www.yuque.com/walter-glskq/zf7grn/guyw1x" target="_blank" rel="noopener">æ–‡ç« </a>ã€‚</p><h3 id="è§£æURL"><a href="#è§£æURL" class="headerlink" title="è§£æURL"></a>è§£æURL</h3><p>å½“ç”¨æˆ·è¾“å…¥URLä¹‹åï¼Œä¼šè¿›è¡Œè§£æï¼ˆURLçš„æœ¬è´¨æ˜¯ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ã€‚<br>URLä¸€èˆ¬åŒ…å«è¿™å‡ éƒ¨åˆ†ï¼š</p><ul><li>protocolï¼šåè®®å¤´ï¼Œå¦‚httpã€https ã€ftpç­‰ã€‚</li><li>hostï¼šæŒ‡å®šä¸»æœºåŸŸåæˆ–è€…IPåœ°å€ã€‚</li><li>portï¼šç«¯å£å·ã€‚</li><li>pathï¼šèµ„æºè·¯å¾„ã€‚</li><li>queryï¼šæŸ¥è¯¢å‚æ•°ã€‚</li><li>fragmentï¼šå³#ä¹‹åçš„hashå€¼ï¼Œä¸€èˆ¬ç”¨æ¥å®šä½åˆ°æŸä¸ªä½ç½®ã€‚</li></ul><h3 id="ç½‘ç»œè¯·æ±‚éƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹"><a href="#ç½‘ç»œè¯·æ±‚éƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹" class="headerlink" title="ç½‘ç»œè¯·æ±‚éƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹"></a>ç½‘ç»œè¯·æ±‚éƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹</h3><p>æ¯æ¬¡ç½‘ç»œè¯·æ±‚éƒ½ä¼šå¼€è¾Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œï¼Œè­¬å¦‚å¦‚æœURLè§£æåˆ°httpåè®®ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ªç½‘ç»œçº¿ç¨‹å»å¤„ç†èµ„æºä¸‹è½½ï¼Œ<br>å› æ­¤æµè§ˆå™¨ä¼šæ ¹æ®è§£æåˆ°çš„httpåè®®å»å•ç‹¬å¼€è¾Ÿå‡ºæ–°çš„ç½‘ç»œçº¿ç¨‹ï¼Œå‰å¾€è¯·æ±‚èµ„æºã€‚</p><h2 id="ä»å¼€å¯ç½‘ç»œçº¿ç¨‹åˆ°å‘èµ·httpè¯·æ±‚"><a href="#ä»å¼€å¯ç½‘ç»œçº¿ç¨‹åˆ°å‘èµ·httpè¯·æ±‚" class="headerlink" title="ä»å¼€å¯ç½‘ç»œçº¿ç¨‹åˆ°å‘èµ·httpè¯·æ±‚"></a>ä»å¼€å¯ç½‘ç»œçº¿ç¨‹åˆ°å‘èµ·httpè¯·æ±‚</h2><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦åŒ…å«dnsè§£æã€tcp/ipè¯·æ±‚æ„å»ºã€äº”å±‚å› ç‰¹ç½‘åè®®æ ˆç­‰ã€‚</p><h3 id="DNSè§£æ"><a href="#DNSè§£æ" class="headerlink" title="DNSè§£æ"></a>DNSè§£æ</h3><p>å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯åŸŸåï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œdnsè§£æè·å–å¯¹åº”çš„IPåœ°å€ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœæµè§ˆå™¨æœ‰ç¼“å­˜ï¼Œå°±ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ï¼›å¦åˆ™ä½¿ç”¨æœ¬æœºç¼“å­˜ï¼Œå†æ²¡æœ‰å°±ä½¿ç”¨hostã€‚</li><li>å¦‚æœæœ¬åœ°æ²¡æœ‰ç¼“å­˜ï¼Œå°±å‘dnsæœåŠ¡å™¨æŸ¥è¯¢ï¼Œï¼ˆæŸ¥è¯¢ä¸­å¯èƒ½ä¼šä½¿ç”¨è·¯ç”±ç­‰ï¼Œè·¯ç”±ä¹Ÿæ˜¯æœ‰ç¼“å­˜çš„ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä½¿ç”¨ï¼‰ï¼Œè·å–IPåœ°å€ã€‚</li></ol><p>æ³¨æ„ï¼šåŸŸåæŸ¥è¯¢å¯èƒ½ç»è¿‡dnsè°ƒåº¦å™¨çš„ã€‚è€Œä¸”dnsæŸ¥è¯¢æ˜¯å¾ˆè€—æ—¶ï¼Œå¦‚æœè§£æåŸŸåè¾ƒå¤šï¼Œé‚£ä¹ˆç½‘ç«™çš„é¦–å±åŠ è½½å°±ä¼šå˜å¾—å¾ˆæ…¢ï¼Œè¿™æ—¶å¯ä»¥è€ƒè¯•ä½¿ç”¨<code>dns-prefetch</code>ï¼Œè¿™ä¸€ç‚¹è¯·å‚è€ƒ<a href="https://www.cnblogs.com/goloving/p/9368965.html" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><h3 id="TCP-IPè¯·æ±‚"><a href="#TCP-IPè¯·æ±‚" class="headerlink" title="TCP/IPè¯·æ±‚"></a>TCP/IPè¯·æ±‚</h3><p>httpè¯·æ±‚æœ¬è´¨ä¸Šè¿˜æ˜¯tcp/ipè¯·æ±‚ã€‚<br>tcpå°†httpé•¿æŠ¥æ–‡åˆ’åˆ†ä¸ºçŸ­æŠ¥æ–‡ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œè¿›è¡Œå¯é ä¼ è¾“ã€‚</p><h4 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582018099404-452e08b5-fc6b-4686-9893-7d0b2eaa0183.png" alt="image.png"><br>TCPæŠ¥å¤´ä¸­çš„æºç«¯å£å·å’Œç›®çš„ç«¯å£å·åŒIPæ•°æ®æŠ¥ä¸­çš„æºIPä¸ç›®çš„IPå”¯ä¸€ç¡®å®šä¸€æ¡TCPè¿æ¥ã€‚TCPåœ¨å‘é€æ•°æ®å‰å¿…é¡»åœ¨å½¼æ­¤é—´å»ºç«‹è¿æ¥ï¼Œè¿™é‡Œè¿æ¥æ„æ€æ˜¯ï¼šåŒæ–¹éœ€è¦å†…ä¿å­˜å¯¹æ–¹ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šIPï¼ŒPortâ€¦ï¼‰ã€‚</p><p>æŠ¥æ–‡ä¸»è¦æ®µçš„æ„æ€ï¼š</p><ul><li>åºå·seqï¼šå‘é€çš„æ•°æ®å­—èŠ‚æµï¼Œç¡®ä¿TCPè¿æ¥ä¼ è¾“æœ‰åºï¼Œå¯¹æ¯ä¸ªå­—èŠ‚ç¼–å·ã€‚åºåˆ—å·seqå°±æ˜¯è¿™ä¸ªæŠ¥æ–‡æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ç¼–å·ã€‚</li><li>ç¡®è®¤åºå·ackï¼šå‘é€æ–¹æœŸå¾…æ¥æ”¶çš„ä¸‹ä¸€åºåˆ—å·ï¼Œæ¥æ”¶æˆåŠŸååºåˆ—å·åŠ 1ï¼Œåªæœ‰ACKä¸º1æ—¶ï¼Œæ‰æœ‰æ•ˆã€‚</li><li>ç¡®è®¤ACKï¼šä»…å½“ACKä¸º1æ—¶ç¡®è®¤å·æ‰æœ‰æ•ˆï¼Œä¸º0æ—¶æ— æ•ˆã€‚</li><li>åŒæ­¥SYNï¼šè¿æ¥å»ºç«‹æ—¶ç”¨äºåŒæ­¥åºå·ã€‚å½“SYN=1ï¼ŒACK=0æ—¶ï¼ŒæŒ‡çš„æ˜¯è¿™æ˜¯ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡æ®µï¼Œè‹¥ç»Ÿä¸€è¿æ¥ï¼Œåˆ™SYN=1ï¼ŒACK=1ã€‚å› æ­¤ï¼ŒSYN=1ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¯·æ±‚è¿æ¥ï¼Œæˆ–è€…è¿æ¥æ¥æ”¶æŠ¥æ–‡ã€‚SYNåªæœ‰åœ¨å»ºç«‹è¿æ¥æ—¶æ‰ä¼šè¢«ç½®ä¸º1ï¼Œæ¡æ‰‹ç»“æŸä¹‹åç½®ä¸º0.</li><li>ç»ˆæ­¢FINï¼šç”¨äºé‡Šæ”¾è¿æ¥ã€‚å½“FIN=1æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿æ¥ã€‚</li></ul><p>PSï¼šACKã€SYNå’ŒFINè¿™äº›å¤§å†™çš„å•è¯è¡¨ç¤ºæ ‡å¿—ä½ï¼Œå…¶å€¼è¦ä¹ˆæ˜¯1ï¼Œè¦ä¹ˆæ˜¯0ï¼›ackã€seqå°å†™çš„å•è¯è¡¨ç¤ºåºå·ã€‚</p><table><thead><tr><th align="center">å­—æ®µ</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">URG</td><td align="center">ç´§æ€¥æŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆã€‚ä¸º1ï¼Œè¡¨ç¤ºæŸä¸€ä½éœ€è¦è¢«ä¼˜å…ˆå¤„ç†</td></tr><tr><td align="center">ACK</td><td align="center">ç¡®è®¤å·æ˜¯å¦æœ‰æ•ˆï¼Œä¸€èˆ¬ç½®ä¸º1ã€‚</td></tr><tr><td align="center">PSH</td><td align="center">æç¤ºæ¥æ”¶ç«¯åº”ç”¨ç¨‹åºç«‹å³ä»TCPç¼“å†²åŒºæŠŠæ•°æ®è¯»èµ°ã€‚</td></tr><tr><td align="center">RST</td><td align="center">å¯¹æ–¹è¦æ±‚é‡æ–°å»ºç«‹è¿æ¥ï¼Œå¤ä½ã€‚</td></tr><tr><td align="center">SYN</td><td align="center">è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨å…¶åºåˆ—å·çš„å­—æ®µè¿›è¡Œåºåˆ—å·çš„åˆå§‹å€¼è®¾å®šã€‚å»ºç«‹è¿æ¥ï¼Œè®¾ç½®ä¸º1</td></tr><tr><td align="center">FIN</td><td align="center">å¸Œæœ›æ–­å¼€è¿æ¥ã€‚</td></tr></tbody></table><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582018876320-c8e1eeaa-ca19-4344-9744-f2044a9bd6e0.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_a2Fr,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="image.png"></p><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€åˆå§‹åºå·seq=xï¼ŒSYN=1è¯·æ±‚æ ‡å¿—ã€‚è®©æœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯å‘é€ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨å‘é€è¯·æ±‚æ ‡å¿—SYNï¼Œå‘é€ç¡®è®¤æ ‡å¿—ACKï¼ŒæœåŠ¡å™¨è‡ªå·±çš„åºå·seqï¼Œå‘é€å®¢æˆ·ç«¯çš„ç¡®è®¤æ ‡å¿—ackï¼šSYN=1ï¼ŒACK=1ï¼Œseq=yï¼Œack=x + 1ã€‚è®©å®¢æˆ·ç«¯çŸ¥é“è‡ªå·±æ¥æ”¶ã€å‘é€æ­£å¸¸ï¼ŒæœåŠ¡å™¨æ¥æ”¶ã€å‘é€æ­£å¸¸ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€ç¡®è®¤æ ‡å¿—ACKï¼Œè‡ªå·±çš„åºå·seqï¼Œå‘é€æœåŠ¡ç«¯çš„ç¡®è®¤åºå·ackï¼šACK=1ï¼Œseq=x+1ï¼Œack=y+1ã€‚è®©æœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯å‘é€ã€æ¥æ”¶ï¼Œè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ã€‚</li></ol><p>ä»ä¸Šé¢å¯çŸ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹æ˜¯è®©æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çŸ¥é“å½¼æ­¤åŒæ–¹å‘é€ã€æ¥æ”¶èƒ½åŠ›æ­£å¸¸çš„æœ€å°‘æ¡æ‰‹æ¬¡æ•°ã€‚</p><h4 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582019583668-d848c108-a4f3-4188-b8f3-c7fda16138e9.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_a2Fr,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="image.png"></p><p>å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹è§£æï¼š</p><ol><li>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯ä¸»åŠ¨è¯·æ±‚æ–­å¼€ï¼Œå‘æœåŠ¡ç«¯å‘é€FIN=1ï¼Œseq=uï¼Œè¿›å…¥FIN-WAIT-1çŠ¶æ€ã€‚</li><li>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯ï¼Œå‘é€ç¡®è®¤åºå·ACK=1ï¼Œå®¢æˆ·ç«¯çš„ç¡®è®¤å·ack=u+1ï¼Œè‡ªå·±çš„åºå·seq=vã€‚å¹¶ä¸”è¿›å…¥CLOSE-WAITçŠ¶æ€ã€‚</li><li>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„ä¿¡æ¯åï¼Œè¿›å…¥FIN-WAIT-2çŠ¶æ€ã€‚æ­¤æ—¶æœåŠ¡å™¨å‘é€é‡Šæ”¾FIN=1ä¿¡å·ï¼Œå‘é€ç¡®è®¤æ ‡å¿—ACK=1ï¼Œè‡ªå·±çš„åºå·seq=wï¼Œå®¢æˆ·ç«¯çš„ç¡®è®¤å·ack=u+1ã€‚å¹¶ä¸”è‡ªå·±è¿›å…¥LAST-ACTçŠ¶æ€ï¼ˆæœ€å¥½ç¡®è®¤çŠ¶æ€ï¼‰ã€‚</li><li>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯ä¿¡æ¯åï¼Œå‘é€ç¡®è®¤æ ‡å¿—ACK=1ï¼Œè‡ªå·±çš„åºå·seq=u+1ï¼ŒæœåŠ¡ç«¯çš„ç¡®è®¤å·ack=w+1ã€‚å®¢æˆ·ç«¯è¿›å…¥TIME-WAITçŠ¶æ€ã€‚ç­‰å¾…2MSLï¼ˆ2ä¸ªæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰ä¹‹åï¼Œè¿›å…¥CLOSEçŠ¶æ€ã€‚æœåŠ¡ç«¯æ”¶åˆ°ç¡®è®¤åï¼Œä¹Ÿè¿›å…¥CLOSEçŠ¶æ€ã€‚</li></ol><h4 id="QA-1"><a href="#QA-1" class="headerlink" title="QA"></a>QA</h4><p>Qï¼šä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿ<br>Aï¼šä¸‰æ¬¡æ¡æ‰‹æ—¶ï¼ŒæœåŠ¡å™¨åŒæ—¶æŠŠACKå’ŒSYNæ”¾åœ¨ä¸€èµ·å‘é€åˆ°äº†å®¢æˆ·ç«¯é‚£é‡Œã€‚å››æ¬¡æŒ¥æ‰‹æ—¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œå·±æ–¹æ˜¯å¦ç°åœ¨å…³é—­å‘é€æ•°æ®é€šé“ï¼Œéœ€è¦ä¸Šå±‚åº”ç”¨æ¥å†³å®šï¼Œå› æ­¤ï¼Œå·±æ–¹ ACK å’Œ FIN ä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ã€‚<br>Qï¼šä¸ºä»€ä¹ˆTIME_WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿ<br>Aï¼šè™½ç„¶æŒ‰é“ç†ï¼Œå››ä¸ªæŠ¥æ–‡éƒ½å‘é€å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›å…¥CLOSEçŠ¶æ€äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»å‡è±¡ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰å¯ä»¥æœ€åä¸€ä¸ªACKä¸¢å¤±ã€‚æ‰€ä»¥TIME_WAITçŠ¶æ€å°±æ˜¯ç”¨æ¥é‡å‘å¯èƒ½ä¸¢å¤±çš„ACKæŠ¥æ–‡ã€‚åœ¨Clientå‘é€å‡ºæœ€åçš„ACKå›å¤ï¼Œä½†è¯¥ACKå¯èƒ½ä¸¢å¤±ã€‚Serverå¦‚æœæ²¡æœ‰æ”¶åˆ°ACKï¼Œå°†ä¸æ–­é‡å¤å‘é€FINç‰‡æ®µã€‚æ‰€ä»¥Clientä¸èƒ½ç«‹å³å…³é—­ï¼Œå®ƒå¿…é¡»ç¡®è®¤Serveræ¥æ”¶åˆ°äº†è¯¥ACKã€‚Clientä¼šåœ¨å‘é€å‡ºACKä¹‹åè¿›å…¥åˆ°TIME_WAITçŠ¶æ€ã€‚Clientä¼šè®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œç­‰å¾…2MSLçš„æ—¶é—´ã€‚å¦‚æœåœ¨è¯¥æ—¶é—´å†…å†æ¬¡æ”¶åˆ°FINï¼Œé‚£ä¹ˆClientä¼šé‡å‘ACKå¹¶å†æ¬¡ç­‰å¾…2MSLã€‚æ‰€è°“çš„2MSLæ˜¯ä¸¤å€çš„MSL(Maximum Segment Lifetime)ã€‚MSLæŒ‡ä¸€ä¸ªç‰‡æ®µåœ¨ç½‘ç»œä¸­æœ€å¤§çš„å­˜æ´»æ—¶é—´ï¼Œ2MSLå°±æ˜¯ä¸€ä¸ªå‘é€å’Œä¸€ä¸ªå›å¤æ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœç›´åˆ°2MSLï¼ŒClientéƒ½æ²¡æœ‰å†æ¬¡æ”¶åˆ°FINï¼Œé‚£ä¹ˆClientæ¨æ–­ACKå·²ç»è¢«æˆåŠŸæ¥æ”¶ï¼Œåˆ™ç»“æŸTCPè¿æ¥ã€‚<br>Qï¼šå¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ<br>Aï¼šTCPè¿˜è®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚</p><h4 id="tcp-ipçš„å¹¶å‘é™åˆ¶"><a href="#tcp-ipçš„å¹¶å‘é™åˆ¶" class="headerlink" title="tcp/ipçš„å¹¶å‘é™åˆ¶"></a>tcp/ipçš„å¹¶å‘é™åˆ¶</h4><p>æµè§ˆå™¨é’ˆå¯¹åŒä¸€ä¸ªåŸŸåä¸‹çš„tcpè¿æ¥æ˜¯æœ‰é™åˆ¶çš„ï¼ˆä¸€èˆ¬æ˜¯5-20ä¸ªï¼‰ã€‚è€Œä¸”åœ¨http1.0ä¸­ï¼Œä¸€ä¸ªèµ„æºä¸‹è½½å°±å¯¹åº”ç€ä¸€ä¸ªtcp/ipè¿æ¥ã€‚</p><h4 id="getå’Œpostçš„åŒºåˆ«"><a href="#getå’Œpostçš„åŒºåˆ«" class="headerlink" title="getå’Œpostçš„åŒºåˆ«"></a>getå’Œpostçš„åŒºåˆ«</h4><p>getå’Œpostæœ¬è´¨ä¸Šéƒ½æ˜¯tcp/ipï¼Œä½†æ˜¯ä¸¤è€…é™¤äº†åœ¨httpå±‚é¢ä¸Šçš„ä¸åŒï¼Œåœ¨tcp/ipå±‚é¢ä¹Ÿæœ‰åŒºåˆ«ã€‚<br>getä¼šäº§ç”Ÿä¸€ä¸ªtcpåŒ…ï¼Œè€Œpostä¼šäº§ç”Ÿä¸¤ä¸ªï¼š</p><ul><li>getè¯·æ±‚æ—¶ä¼šæŠŠheaderså’Œdataä¸€èµ·å‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº”200ã€‚</li><li>postè¯·æ±‚ä¼šå…ˆæŠŠheaderså‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº”100 continueï¼Œç„¶åæµè§ˆå™¨åœ¨å‘é€dataï¼ŒæœåŠ¡å™¨å“åº”200ã€‚</li></ul><p>å…¶ä»–åŒºåˆ«ï¼š</p><table><thead><tr><th>åˆ†ç±»</th><th>GET</th><th>POST</th></tr></thead><tbody><tr><td>å¯å¦è¢«ç¼“å­˜</td><td>å¯ä»¥è¢«ç¼“å­˜</td><td>ä¸å¯ä»¥è¢«ç¼“å­˜</td></tr><tr><td>åé€€æˆ–åˆ·æ–°</td><td>æ— å®³</td><td>é‡æ–°æäº¤è¯·æ±‚</td></tr><tr><td>ç¼–ç ç±»å‹</td><td>application/x-www-form-urlencoded</td><td>application/x-www-form-urlencoded æˆ– multipart/form-dataã€‚ä¸ºäºŒè¿›åˆ¶æ•°æ®ä½¿ç”¨å¤šé‡ç¼–ç ã€‚</td></tr><tr><td>å†å²</td><td>ä¼šè¢«ä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­</td><td>ä¸ä¼šè¢«ä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­</td></tr><tr><td>å¯¹æ•°æ®ç±»å‹çš„é™åˆ¶</td><td>åªå…è®¸ASCIIå­—ç¬¦</td><td>æ— é™åˆ¶</td></tr><tr><td>å®‰å…¨æ€§</td><td>ä¸POSTæ¯”ï¼Œå®‰å…¨æ€§è¾ƒå·®ï¼Œå› ä¸ºå‘é€çš„æ•°æ®ä¼šæš´éœ²åœ¨åœ°å€æ ä¸­</td><td>POSTæ¯”GETè¾ƒå®‰å…¨</td></tr><tr><td>å¯è§æ€§</td><td>å¯è§</td><td>ä¸å¯è§</td></tr></tbody></table><h3 id="äº”å±‚å› ç‰¹ç½‘åè®®"><a href="#äº”å±‚å› ç‰¹ç½‘åè®®" class="headerlink" title="äº”å±‚å› ç‰¹ç½‘åè®®"></a>äº”å±‚å› ç‰¹ç½‘åè®®</h3><p>ä»å®¢æˆ·ç«¯å‘å‡ºhttpè¯·æ±‚åˆ°æœåŠ¡å™¨æ¥æ”¶ï¼Œè¿™ä¸­é—´ä¼šç»è¿‡ä¸€ç³»åˆ—çš„è¿‡ç¨‹ï¼š<br><strong>ä»åº”ç”¨å±‚å‘å‡ºhttpè¯·æ±‚ï¼Œåˆ°ä¼ è¾“å±‚ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹tcpè¿æ¥ï¼Œå†åˆ°ç½‘ç»œå±‚çš„IPå¯»å€ï¼Œå†åˆ°æ•°æ®é“¾è·¯å±‚å°è£…æˆå¸§ï¼Œæœ€åç»ç”±ç‰©ç†å±‚ä¼ è¾“ã€‚</strong><br>äº”å±‚å› ç‰¹ç½‘åè®®æ ˆå…¶å®å°±æ˜¯ï¼š</p><ol><li>åº”ç”¨å±‚ï¼ˆdns httpï¼‰DNSè§£æIPå¹¶å‘é€httpè¯·æ±‚ã€‚</li><li>ä¼ è¾“å±‚ï¼ˆtcp udpï¼‰ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹tcpè¿æ¥ã€‚</li><li>ç½‘ç»œå±‚ï¼ˆIP ARPï¼‰IPå¯»å€ã€‚</li><li>æ•°æ®é“¾è·¯å±‚ï¼ˆPPPï¼‰å°è£…æˆå¸§ã€‚</li><li>ç‰©ç†å±‚ï¼ˆåˆ©ç”¨æ— åŠ›ä»‹è´¨ä¼ è¾“æ¯”ç‰¹æµï¼‰ç‰©ç†ä¼ è¾“ï¼ˆç„¶åä¼ è¾“çš„æ—¶å€™é€šè¿‡åŒç»çº¿ï¼Œç”µç£æ³¢ç­‰ä»‹è´¨ï¼‰ã€‚</li></ol><p>ç›¸æ¯”äºå®Œæ•´çš„IOS/OSIä¸ƒå±‚æ¡†æ¶ï¼Œå°‘äº†è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ã€‚<br>OSIä¸ƒå±‚æ¡†æ¶ï¼š<code>ç‰©ç†å±‚</code>ã€<code>æ•°æ®é“¾è·¯å±‚</code>ã€<code>ç½‘ç»œå±‚</code>ã€<code>ä¼ è¾“å±‚</code>ã€<code>ä¼šè¯å±‚</code>ã€<code>è¡¨ç¤ºå±‚</code>ã€<code>åº”ç”¨å±‚</code></p><ol><li>è¡¨ç¤ºå±‚ï¼šä¸»è¦å¤„ç†ä¸¤ä¸ªé€šè®¯ç³»ç»Ÿä¹‹é—´çš„ä¿¡æ¯äº¤æ¢çš„è¡¨ç¤ºæ–¹å¼ï¼ŒåŒ…æ‹¬æ•°æ®æ ¼å¼äº¤æ¢ã€æ•°æ®åŠ å¯†è§£å¯†ç­‰ã€‚</li><li>ä¼šè¯å±‚ï¼šå®ƒç®¡ç†ä¸åŒç”¨æˆ·çš„è¿›ç¨‹ä¹‹é—´çš„å¯¹è¯ï¼Œå¦‚ç™»å½•ã€æ³¨é”€ç­‰ã€‚</li></ol><h2 id="ä»æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚åˆ°åå°æ¥æ”¶åˆ°è¯·æ±‚"><a href="#ä»æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚åˆ°åå°æ¥æ”¶åˆ°è¯·æ±‚" class="headerlink" title="ä»æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚åˆ°åå°æ¥æ”¶åˆ°è¯·æ±‚"></a>ä»æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚åˆ°åå°æ¥æ”¶åˆ°è¯·æ±‚</h2><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>å¯¹äºä¸€ä¸ªå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œå®ƒçš„å¹¶å‘è®¿é—®é‡å¯èƒ½ä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥å¦‚æœåªæœ‰ä¸€å°æœåŠ¡å™¨å¯èƒ½æ˜¯åƒä¸æ¶ˆçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šæœ‰è‹¥å¹²ä¸ªæœåŠ¡å™¨ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åé…åˆåå‘ä»£ç†æœåŠ¡å™¨å®ç°è´Ÿè½½å‡è¡¡ã€‚<br>ç®€å•æ¥è¯´ï¼š<strong>å°±æ˜¯ç”¨æˆ·çš„è¯·æ±‚éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¦‚nginxï¼Œç„¶åä»£ç†æœåŠ¡å™¨æŒ‰ç…§æŒ‡å®šçš„ç®—æ³•ï¼Œåˆ†é…ä¸åŒçš„è¯·æ±‚ç»™å¯¹åº”é›†ç¾¤ä¸­çš„æœåŠ¡å™¨æ‰§è¡Œï¼Œç„¶ååå“ä»£ç†æœåŠ¡å™¨ç­‰å¾…æœåŠ¡å™¨çš„httpå“åº”ï¼Œå¹¶å°†å…¶ååº”ç»™ç”¨æˆ·ã€‚</strong><br>**</p><h3 id="åå°å¤„ç†"><a href="#åå°å¤„ç†" class="headerlink" title="åå°å¤„ç†"></a>åå°å¤„ç†</h3><p>ä¸€èˆ¬åå°éƒ½æ˜¯éƒ¨ç½²åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œæ‰€ä»¥ï¼š</p><ul><li>å…ˆæ˜¯å®¹å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼ˆå¦‚tomcatï¼‰ï¼Œ</li><li>ç„¶åå¯¹åº”å®¹å™¨ä¸­çš„ç¨‹åºæ¥æ”¶åˆ°è¯·æ±‚ï¼ˆå¦‚javaã€phpç­‰ï¼‰ï¼Œ</li><li>ç„¶åå°±æ˜¯åå°ç¨‹åºä¸­çš„å†…éƒ¨å¤„ç†ï¼Œå¤„ç†å®Œæˆä¹‹åå“åº”ç»“æœã€‚</li></ul><p>ä¸€èˆ¬åå°éƒ½ä¼šæœ‰ç»Ÿä¸€çš„éªŒè¯ï¼šå®‰å…¨æ‹¦æˆªã€è·¨åŸŸå¤„ç†ç­‰ï¼Œå¦‚æœéªŒè¯ä¸é€šè¿‡ï¼Œåˆ™ç›´æ¥æ‹’ç»è¯·æ±‚ã€‚å¦‚æœéªŒè¯é€šè¿‡ï¼Œæ‰ä¼šè¿›å…¥åå°ç¨‹åºï¼Œåå°ç¨‹åºè¿›è¡Œå¯¹åº”çš„æ“ä½œï¼Œå¦‚æ•°æ®æŸ¥è¯¢ç­‰ã€‚ç­‰ç¨‹åºæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ªhttpåŒ…ï¼Œç„¶åå°†è¿™ä¸ªåŒ…å‘é€ç»™å‰ç«¯ï¼Œå®Œæˆäº¤äº’ã€‚</p><h3 id="åå°å’Œå‰å°çš„äº¤äº’"><a href="#åå°å’Œå‰å°çš„äº¤äº’" class="headerlink" title="åå°å’Œå‰å°çš„äº¤äº’"></a>åå°å’Œå‰å°çš„äº¤äº’</h3><p>å‰åç«¯äº¤äº’çš„æ—¶å€™ï¼ŒhttpæŠ¥æ–‡ä½œä¸ºæœ€é‡è¦çš„ä¿¡æ¯è½½ä½“ã€‚</p><h4 id="httpæŠ¥æ–‡ç»“æ„"><a href="#httpæŠ¥æ–‡ç»“æ„" class="headerlink" title="httpæŠ¥æ–‡ç»“æ„"></a>httpæŠ¥æ–‡ç»“æ„</h4><p>æŠ¥æ–‡ä¸€èˆ¬åŒ…æ‹¬äº†é€šç”¨å¤´éƒ¨ã€è¯·æ±‚/å“åº”å¤´éƒ¨ã€è¯·æ±‚/å“åº”ä½“</p><h5 id="é€šç”¨å¤´éƒ¨"><a href="#é€šç”¨å¤´éƒ¨" class="headerlink" title="é€šç”¨å¤´éƒ¨"></a>é€šç”¨å¤´éƒ¨</h5><ul><li>Request Urlï¼šè¯·æ±‚çš„webæœåŠ¡å™¨åœ°å€ã€‚</li><li>Request Methodï¼šè¯·æ±‚æ–¹å¼ï¼ˆGETã€POSTã€PUTã€DELETEã€HEADã€CONNECTã€TRACEï¼‰ã€‚</li><li>Status Codeï¼šè¯·æ±‚è¿”å›çš„çŠ¶æ€ç ã€‚</li><li>Remote Addressï¼šè¯·æ±‚çš„è¿œç¨‹æœåŠ¡å™¨åœ°å€ï¼ˆä¼šè¢«è½¬ä¸ºIPï¼‰ã€‚</li></ul><p>å…¶ä¸­methodsä¸€èˆ¬å¯ä»¥åˆ†ä¸ºä¸¤æ‰¹æ¬¡ï¼š</p><ul><li>HTTP1.0å®šä¹‰äº†ä¸‰ç§è¯·æ±‚æ–¹æ³•ï¼šGETã€POSTå’ŒHEADæ–¹æ³•ä»¥åŠå‡ ç§é¢å¤–çš„è¯·æ±‚æ–¹å¼ï¼ˆPUTã€DELETEã€LINKå’ŒUNLINKï¼‰ã€‚HTTP1.0å…·ä½“å®šä¹‰è¯·å‚è€ƒï¼š<a href="https://tools.ietf.org/html/rfc1945" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc1945</a>ã€‚</li><li>HTTP1.1å®šä¹‰äº†å…«ç§è¯·æ±‚æ–¹å¼ï¼šGETã€POSTã€PUTã€DELETEã€HEADã€CONNECTã€TRACEã€‚HTTP1.1å…·ä½“å®šä¹‰è¯·å‚è€ƒï¼š<a href="https://tools.ietf.org/html/rfc2616" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc2616</a>ã€‚</li></ul><h5 id="å¸¸ç”¨çŠ¶æ€ç "><a href="#å¸¸ç”¨çŠ¶æ€ç " class="headerlink" title="å¸¸ç”¨çŠ¶æ€ç "></a>å¸¸ç”¨çŠ¶æ€ç </h5><pre><code>200-è¯·æ±‚æˆåŠŸã€‚è¯·æ±‚çš„èµ„æºå·²è¿”å›å®¢æˆ·ç«¯ã€‚301-æ°¸ä¹…é‡å®šå‘ã€‚302-ä¸´æ—¶é‡å®šå‘ã€‚304-è¡¨æ˜è‡ªä¸Šæ¬¡è¯·æ±‚ä¹‹åï¼Œèµ„æºæœªåšå˜æ›´ï¼Œè¯·ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„èµ„æºã€‚400-å®¢æˆ·ç«¯è¯·æ±‚å‡ºé”™ã€‚401-è¯·æ±‚æœªç»æˆæƒã€‚403-ç¦æ­¢è®¿é—®ã€‚404-è¯·æ±‚èµ„æºä¸å­˜åœ¨ã€‚500-æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚503-æœåŠ¡å™¨ä¸å¯ç”¨ã€‚......</code></pre><p>æœ€ååˆ—ä¸¾ä¸‹å¤§è‡´ä¸åŒèŒƒå›´çš„çŠ¶æ€ç ï¼š</p><pre><code>1xxï¼šæŒ‡ç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºè¯·æ±‚å·²æ¥å—ï¼Œæ­£åœ¨å¤„ç†ã€‚2xxï¼šè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€‚3xxï¼šé‡å®šå‘ï¼Œè¦å®Œæˆè¯·æ±‚éœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œã€‚4xxï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚è¯­æ³•é”™è¯¯æˆ–è€…è¯·æ±‚æ— æ³•å®ç°ã€‚5xxï¼šæœåŠ¡ç«¯é”™è¯¯ï¼ŒæœåŠ¡å™¨å®ç°åˆæ³•çš„è¯·æ±‚ã€‚</code></pre><h4 id="è¯·æ±‚-å“åº”å¤´éƒ¨"><a href="#è¯·æ±‚-å“åº”å¤´éƒ¨" class="headerlink" title="è¯·æ±‚/å“åº”å¤´éƒ¨"></a>è¯·æ±‚/å“åº”å¤´éƒ¨</h4><p>å¸¸ç”¨çš„è¯·æ±‚å¤´éƒ¨ï¼š</p><pre><code>Acceptï¼šæ¥æ”¶ç±»å‹ã€‚è¡¨ç¤ºæµè§ˆå™¨å¯ä»¥æ”¯æŒçš„MIMEç±»å‹ï¼ˆå¯¹æ ‡æœåŠ¡å™¨è¿”å›çš„Content-Typeï¼‰ã€‚Accept-Encodeingï¼šæµè§ˆå™¨æ”¯æŒçš„å‹ç¼©ç±»å‹ï¼Œå¦‚GZipï¼Œè¶…å‡ºç±»å‹ä¸èƒ½æ¥æ”¶ã€‚ConContent-Typeï¼šå®¢æˆ·ç«¯å‘å‡ºå»çš„å®ä½“å†…å®¹çš„ç±»å‹ã€‚Cache-Controlï¼šæŒ‡å®šè¯·æ±‚å’Œå“åº”åº”éµå¾ªçš„ç¼“å­˜æœºåˆ¶ï¼Œå¦‚no-cacheç­‰ã€‚If-Modifiy-Sinceï¼šå¯¹åº”æœåŠ¡ç«¯çš„Last-Modifiedï¼Œç”¨äºæ¯”è¾ƒæœåŠ¡å™¨èµ„æºæ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŠ¨ï¼Œç²¾ç¡®åˆ°1sï¼Œhttp1.0ã€‚Expiresï¼šç¼“å­˜æ§åˆ¶ã€‚è®¾ç½®èµ„æºçš„æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæ—¶é—´å†…å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚ä½¿ç”¨çš„æ˜¯æœåŠ¡ç«¯æ—¶é—´ï¼Œhttp1.0ã€‚Max-ageï¼šä»£è¡¨èµ„æºåœ¨æœ¬åœ°çš„æœ‰æ•ˆæ—¶é—´ï¼Œæœ‰æ•ˆæ—¶é—´å†…ä¸ä¼šè¯·æ±‚ï¼Œhttp1.1ã€‚If-None-Matchï¼šå¯¹åº”æœåŠ¡ç«¯çš„ETagï¼Œç”¨äºåŒ¹é…æ–‡ä»¶å†…å®¹æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œæ¯”è¾ƒç²¾ç¡®ï¼Œhttp1.1ã€‚Cookieï¼šæœ‰cookieä¸”åŒåŸŸåè®¿é—®æ—¶ä¼šå¸¦ä¸Šã€‚Connectionï¼šå½“æµè§ˆå™¨ä¸æœåŠ¡å™¨é€šä¿¡æ—¶å¯¹äºé•¿è¿æ¥å¦‚ä½•è¿›è¡Œå¤„ç†ï¼Œå¦‚keep-aliveã€‚Hostï¼šè¯·æ±‚çš„æœåŠ¡å™¨åœ°å€ã€‚Originï¼šè¯·æ±‚æœ€åˆä»å“ªé‡Œå‘èµ·çš„ã€‚Originæ¯”Refereræ›´å°Šé‡éšç§ã€‚Refererï¼šè¯¥é¡µé¢çš„æ¥æºURLï¼ˆCSRFæ‹¦æˆªå¸¸ç”¨è¯¥å­—æ®µï¼‰ã€‚User-Agentï¼šç”¨æˆ·å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚</code></pre><p>å¸¸ç”¨çš„å“åº”å¤´éƒ¨ï¼š</p><pre><code>Access-Control-Allow-Headersï¼šæœåŠ¡å™¨å…è®¸çš„è¯·æ±‚headersã€‚Access-Control-Allow-Methodsï¼šæœåŠ¡å™¨å…è®¸çš„è¯·æ±‚æ–¹å¼ã€‚Access-Control-Allow-Methodsï¼šæœåŠ¡å™¨å…è®¸çš„è¯·æ±‚Originå¤´éƒ¨ï¼ˆå¦‚*ï¼‰ã€‚Content-Typeï¼šæœåŠ¡å™¨è¿”å›çš„å“åº”å†…å®¹å®ä½“çš„ç±»å‹ã€‚Dateï¼šæ•°æ®ä»æœåŠ¡å™¨è¿”å›çš„æ—¶é—´ã€‚Cache-Controlï¼šå‘Šè¯‰æµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ï¼Œä»€ä¹ˆç¯å¢ƒå¯ä»¥å®‰å…¨çš„ç¼“å­˜æ–‡æ¡£ã€‚Last-Modifiedï¼šè¯·æ±‚èµ„æºæœ€åçš„ä¿®æ”¹æ—¶é—´ã€‚Expiresï¼šå‘Šè¯‰æµè§ˆå™¨åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™æ”¾å¼ƒä½¿ç”¨èµ„æºï¼Œä»è€Œä¸åœ¨ç¼“å­˜å®ƒã€‚Max-ageï¼šå‘Šè¯‰æµè§ˆå™¨åº”è¯¥ç¼“å­˜å¤šé•¿æ—¶é—´ï¼Œå¼€å¯Cache-Controlæœ‰æ•ˆã€‚ETagï¼šè¯·æ±‚èµ„æºçš„æ–‡ä»¶æŒ‡çº¹ã€‚Set-cookieï¼šè®¾ç½®è¯¥é¡µé¢çš„cookieï¼ŒæœåŠ¡å™¨é€šè¿‡è¿™ä¸ªè®¾ç½®æµè§ˆå™¨é¡µé¢çš„cookieã€‚Keep-Aliveï¼šå¦‚æœæµè§ˆå™¨æœ‰keep-aliveï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¹Ÿæœ‰å¯¹åº”çš„keep-aliveã€‚Serverï¼šæœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯ã€‚</code></pre><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¯·æ±‚å¤´éƒ¨å’Œå“åº”å¤´éƒ¨éƒ½æ˜¯åŒ¹é…åˆ†æçš„<br>å¦‚ï¼šè¯·æ±‚å¤´éƒ¨çš„Acceptè¦å’Œå“åº”å¤´éƒ¨çš„Content-Typeæ˜¯è¦åŒ¹é…çš„ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚<br>å¦‚ï¼šè·¨åŸŸè¯·æ±‚æ—¶ï¼Œè¯·æ±‚å¤´éƒ¨çš„Originè¦å’Œå“åº”å¤´éƒ¨çš„Access-Control-Allow-OriginåŒ¹é…ï¼Œå¦åˆ™å›æŠ¥è·¨åŸŸé”™è¯¯ã€‚<br>å†æ¯”å¦‚ï¼šç¼“å­˜æ—¶ï¼Œè¯·æ±‚å¤´éƒ¨çš„If-Modified-Sinceå’ŒETagï¼Œè¦ä¸å“åº”å¤´éƒ¨çš„Last-Modifiedå’ŒIf-None-Matchç›¸åŒ¹é…ã€‚</p><h4 id="è¯·æ±‚å’Œå“åº”å®ä½“"><a href="#è¯·æ±‚å’Œå“åº”å®ä½“" class="headerlink" title="è¯·æ±‚å’Œå“åº”å®ä½“"></a>è¯·æ±‚å’Œå“åº”å®ä½“</h4><p>httpè¯·æ±‚æ—¶ï¼Œé™¤äº†å¤´éƒ¨ï¼Œè¿˜æœ‰æ¶ˆæ¯å®ä½“ï¼Œä¸€èˆ¬æ¥è¯´<br>è¯·æ±‚å®ä½“ä¸­ä¼šå°†ä¸€äº›éœ€è¦çš„å‚æ•°éƒ½æ”¾å…¥è¿›å…¥ï¼ˆç”¨äºpostè¯·æ±‚ï¼‰ã€‚<br>è­¬å¦‚å®ä½“ä¸­å¯ä»¥æ”¾å‚æ•°çš„åºåˆ—åŒ–å½¢å¼ï¼ˆ<code>a=1&amp;b=2</code>è¿™ç§ï¼‰ï¼Œæˆ–è€…ç›´æ¥æ”¾è¡¨å•å¯¹è±¡ï¼ˆ<code>Form Data</code>å¯¹è±¡ï¼Œä¸Šä¼ æ—¶å¯ä»¥å¤¹æ‚å‚æ•°ä»¥åŠæ–‡ä»¶ï¼‰ï¼Œç­‰ç­‰<br>è€Œä¸€èˆ¬å“åº”å®ä½“ä¸­ï¼Œå°±æ˜¯æ”¾æœåŠ¡ç«¯éœ€è¦ä¼ ç»™å®¢æˆ·ç«¯çš„å†…å®¹<br>ä¸€èˆ¬ç°åœ¨çš„æ¥å£è¯·æ±‚æ—¶ï¼Œå®ä½“ä¸­å°±æ˜¯å¯¹äºçš„ä¿¡æ¯çš„jsonæ ¼å¼ï¼Œè€Œåƒé¡µé¢è¯·æ±‚è¿™ç§ï¼Œé‡Œé¢å°±æ˜¯ç›´æ¥æ”¾äº†ä¸€ä¸ªhtmlå­—ç¬¦ä¸²ï¼Œç„¶åæµè§ˆå™¨è‡ªå·±è§£æå¹¶æ¸²æŸ“ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582102205845-08bbd0a9-cfb7-4e35-951c-3ede3cb2e7bd.png#align=left&display=inline&height=933&name=image.png&originHeight=800&originWidth=596&size=402292&status=done&style=none&width=695" alt="image.png"></p><h4 id="cookieåŠç›¸å…³ä¼˜åŒ–"><a href="#cookieåŠç›¸å…³ä¼˜åŒ–" class="headerlink" title="cookieåŠç›¸å…³ä¼˜åŒ–"></a>cookieåŠç›¸å…³ä¼˜åŒ–</h4><p>cookie æ˜¯ä¸€ç§æœ¬åœ°å­˜å‚¨æ–¹å¼ï¼Œä¸»è¦ç”¨äºæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šä¿¡ï¼Œå¸¸ç”¨äºéªŒè¯èº«ä»½ï¼Œå’ŒæœåŠ¡ç«¯çš„sessionæ­é…ä½¿ç”¨ã€‚<br>åœºæ™¯å¦‚ä¸‹ï¼ˆç®€è¿°ï¼‰ï¼š</p><pre><code>åœ¨ç™»é™†é¡µé¢ï¼Œç”¨æˆ·ç™»é™†äº†æ­¤æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªsessionï¼Œsessionä¸­æœ‰å¯¹äºç”¨æˆ·çš„ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·åã€å¯†ç ç­‰ï¼‰ç„¶åä¼šæœ‰ä¸€ä¸ªsessionidï¼ˆç›¸å½“äºæ˜¯æœåŠ¡ç«¯çš„è¿™ä¸ªsessionå¯¹åº”çš„keyï¼‰ç„¶åæœåŠ¡ç«¯åœ¨ç™»å½•é¡µé¢ä¸­å†™å…¥cookieï¼Œå€¼å°±æ˜¯:jsessionid=xxxç„¶åæµè§ˆå™¨æœ¬åœ°å°±æœ‰è¿™ä¸ªcookieäº†ï¼Œä»¥åè®¿é—®åŒåŸŸåä¸‹çš„é¡µé¢æ—¶ï¼Œè‡ªåŠ¨å¸¦ä¸Šcookieï¼Œè‡ªåŠ¨æ£€éªŒï¼Œåœ¨æœ‰æ•ˆæ—¶é—´å†…æ— éœ€äºŒæ¬¡ç™»é™†</code></pre><p>ä¸Šè¿°å°±æ˜¯cookieçš„å¸¸ç”¨åœºæ™¯ç®€è¿°ï¼ˆå½“ç„¶äº†ï¼Œå®é™…æƒ…å†µä¸‹å¾—è€ƒè™‘æ›´å¤šå› ç´ ï¼‰ã€‚<br>ä¸€èˆ¬æ¥è¯´ï¼Œcookieä¸­æ˜¯ä¸å…è®¸å­˜æ”¾æ•æ„Ÿä¿¡æ¯çš„ï¼Œå¦‚å¸å·ï¼Œå¯†ç ç­‰ã€‚å¦‚æœéè¦å­˜å‚¨ï¼Œä¸€å®šè¦åœ¨cookie ä¸­è¿™åªhttpOnlyï¼Œè¿™æ ·å°±æ— æ³•é€šè¿‡jsæ“ä½œè·å–cookieäº†ã€‚<br>å¦å¤–ï¼Œåœ¨åŒåŸŸåæ“ä½œæ—¶ï¼Œæ€»ä¼šé»˜è®¤å¸¦ä¸Šè¯¥åŸŸåä¸‹æ‰€æœ‰çš„cookieã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œåœ¨æŸäº›åœºæ™¯ä¸­æ˜¯éœ€è¦ä¼˜åŒ–çš„ï¼š</p><p>æ¯”å¦‚ä»¥ä¸‹åœºæ™¯ï¼š</p><pre><code>å®¢æˆ·ç«¯åœ¨åŸŸåAä¸‹æœ‰cookieï¼ˆè¿™ä¸ªå¯ä»¥æ˜¯ç™»é™†æ—¶ç”±æœåŠ¡ç«¯å†™å…¥çš„ï¼‰ç„¶ååœ¨åŸŸåAä¸‹æœ‰ä¸€ä¸ªé¡µé¢ï¼Œé¡µé¢ä¸­æœ‰å¾ˆå¤šä¾èµ–çš„é™æ€èµ„æºï¼ˆéƒ½æ˜¯åŸŸåAçš„ï¼Œè­¬å¦‚æœ‰20ä¸ªé™æ€èµ„æºï¼‰æ­¤æ—¶å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé¡µé¢åŠ è½½ï¼Œè¯·æ±‚è¿™äº›é™æ€èµ„æºæ—¶ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤å¸¦ä¸Šcookieä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™20ä¸ªé™æ€èµ„æºçš„httpè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªéƒ½å¾—å¸¦ä¸Šcookieï¼Œè€Œå®é™…ä¸Šé™æ€èµ„æºå¹¶ä¸éœ€è¦cookieéªŒè¯æ­¤æ—¶å°±é€ æˆäº†è¾ƒä¸ºä¸¥é‡çš„æµªè´¹ï¼Œè€Œä¸”ä¹Ÿé™ä½äº†è®¿é—®é€Ÿåº¦ï¼ˆå› ä¸ºå†…å®¹æ›´å¤šäº†ï¼‰</code></pre><p>é’ˆå¯¹è¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸŸåæ‹†åˆ†çš„æ–¹æ¡ˆï¼šå°†é™æ€èµ„æºåˆ†ç»„ï¼Œåˆ†åˆ«å­˜æ”¾åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸­ã€‚<br>è€Œåœ¨ç§»åŠ¨ç«¯ï¼Œå¦‚æœè¯·æ±‚çš„åŸŸåè¿‡å¤šæ—¶ï¼Œä¼šé™ä½è¯·æ±‚é€Ÿåº¦ï¼ˆå› ä¸ºåŸŸåè§£ææ˜¯å¾ˆè€—æ—¶çš„ï¼Œè€Œä¸”ç§»åŠ¨ç«¯çš„å¸¦å®½å¤§éƒ½ä¸å¦‚pcï¼‰ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨dns-prefetchï¼Œè®©æµè§ˆå™¨ç©ºé—²æ—¶æå‰è§£æåŸŸåã€‚<br>å…³äºcookie çš„æ“ä½œå¤§è‡´å¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582103208942-51d8603a-aef1-436c-968a-804cff71baa1.png#align=left&display=inline&height=350&name=image.png&originHeight=527&originWidth=800&size=96045&status=done&style=none&width=531" alt="image.png"></p><h4 id="gzipå‹ç¼©"><a href="#gzipå‹ç¼©" class="headerlink" title="gzipå‹ç¼©"></a>gzipå‹ç¼©</h4><p>é¦–å…ˆï¼Œæ˜ç¡®<code>gzip</code>æ˜¯ä¸€ç§å‹ç¼©æ ¼å¼ï¼Œéœ€è¦æµè§ˆå™¨æ”¯æŒæ‰æœ‰æ•ˆï¼ˆä¸è¿‡ä¸€èˆ¬ç°åœ¨æµè§ˆå™¨éƒ½æ”¯æŒï¼‰ï¼Œ<br>è€Œä¸”gzipå‹ç¼©æ•ˆç‡å¾ˆå¥½ï¼ˆé«˜è¾¾70%å·¦å³ï¼‰<br>ç„¶ågzipä¸€èˆ¬æ˜¯ç”±<code>apache</code>ã€<code>tomcat</code>ç­‰webæœåŠ¡å™¨å¼€å¯<br>å½“ç„¶æœåŠ¡å™¨é™¤äº†gzipå¤–ï¼Œä¹Ÿè¿˜ä¼šæœ‰å…¶å®ƒå‹ç¼©æ ¼å¼ï¼ˆå¦‚deflateï¼Œæ²¡æœ‰gzipé«˜æ•ˆï¼Œä¸”ä¸æµè¡Œï¼‰<br>æ‰€ä»¥ä¸€èˆ¬åªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå¼€å¯äº†gzipå‹ç¼©ï¼Œç„¶åä¹‹åçš„è¯·æ±‚å°±éƒ½æ˜¯åŸºäºgzipå‹ç¼©æ ¼å¼çš„ï¼Œ<br>éå¸¸æ–¹ä¾¿ã€‚</p><h4 id="é•¿è¿æ¥ä¸çŸ­è¿æ¥"><a href="#é•¿è¿æ¥ä¸çŸ­è¿æ¥" class="headerlink" title="é•¿è¿æ¥ä¸çŸ­è¿æ¥"></a>é•¿è¿æ¥ä¸çŸ­è¿æ¥</h4><p>é¦–å…ˆçœ‹<code>tcp/ip</code>å±‚é¢çš„å®šä¹‰ï¼š</p><ul><li>é•¿è¿æ¥ï¼šä¸€ä¸ªtcp/ipè¿æ¥ä¸Šå¯ä»¥è¿ç»­å‘é€å¤šä¸ªæ•°æ®åŒ…ï¼Œåœ¨tcpè¿æ¥ä¿æŒæœŸé—´ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®åŒ…å‘é€ï¼Œéœ€è¦åŒæ–¹å‘æ£€æµ‹åŒ…ä»¥ç»´æŒæ­¤è¿æ¥ï¼Œä¸€èˆ¬éœ€è¦è‡ªå·±åšåœ¨çº¿ç»´æŒï¼ˆç±»ä¼¼äºå¿ƒè·³åŒ…ï¼‰</li><li>çŸ­è¿æ¥ï¼šé€šä¿¡åŒæ–¹æœ‰æ•°æ®äº¤äº’æ—¶ï¼Œå°±å»ºç«‹ä¸€ä¸ªtcpè¿æ¥ï¼Œæ•°æ®å‘é€å®Œæˆåï¼Œåˆ™æ–­å¼€æ­¤tcpè¿æ¥</li></ul><p>ç„¶ååœ¨httpå±‚é¢ï¼š</p><ul><li><code>http1.0</code>ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨æ²¡è¿›è¡Œä¸€æ¬¡httpæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ï¼Œè­¬å¦‚æ¯ä¸€ä¸ªé™æ€èµ„æºè¯·æ±‚æ—¶éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿æ¥</li><li>http1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œä½¿ç”¨é•¿è¿æ¥ä¼šæœ‰è¿™ä¸€è¡Œ<code>Connection: keep-alive</code>ï¼Œåœ¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ç”¨äºä¼ è¾“httpçš„tcpè¿æ¥ä¸ä¼šå…³é—­ï¼Œå¦‚æœå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨çš„é¡µé¢ï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚</li></ul><p>æ³¨æ„ï¼š <strong>keep-aliveä¸ä¼šæ°¸è¿œä¿æŒï¼Œå®ƒæœ‰ä¸€ä¸ªæŒç»­æ—¶é—´ï¼Œä¸€èˆ¬åœ¨æœåŠ¡å™¨ä¸­é…ç½®ï¼ˆå¦‚apacheï¼‰ï¼Œå¦å¤–é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒæ—¶æ‰æœ‰æ•ˆã€‚</strong></p><h4 id="http2-0"><a href="#http2-0" class="headerlink" title="http2.0"></a>http2.0</h4><p>http2.0ä¸æ˜¯httpsï¼Œå®ƒæ˜¯httpçš„ä¸‹ä¸€ä»£è§„èŒƒã€‚<br>ç®€è¿°ä¸€ä¸‹http2.0å’Œhttp1.1çš„åŒºåˆ«ï¼š</p><ul><li>http1.1ä¸­ï¼Œæ¯è¯·æ±‚ä¸€ä¸ªèµ„æºï¼Œéƒ½éœ€è¦æ–°å¼€ä¸€ä¸ªtcp/ipè¿æ¥ï¼Œæ‰€ä»¥å¯¹åº”çš„ç»“æœå°±æ˜¯æ¯ä¸€ä¸ªèµ„æºéƒ½å ç”¨ä¸€ä¸ªtcp/ipè¯·æ±‚ï¼Œè€Œtcp/ipè¯·æ±‚å¹¶å‘æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œå½“è¯·æ±‚èµ„æºæ•°é‡ä¸€å¤šï¼Œè¯·æ±‚é€Ÿåº¦å°±ä¼šæ…¢ä¸‹æ¥ã€‚</li><li>http2.0ä¸­ï¼Œä¸€ä¸ªtcp/ipè¯·æ±‚å¯ä»¥è¯·æ±‚å¤šä¸ªèµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä¸€æ¬¡tcp/ipè¯·æ±‚ï¼Œå°±å¯ä»¥è¯·æ±‚è¯ºå¹²ä¸ªèµ„æºï¼Œåˆ†å‰²æˆæ›´å°çš„å¸§è¯·æ±‚ï¼Œé€Ÿåº¦ä¼šæœ‰æ˜¾è‘—æå‡ã€‚</li></ul><p>æ‰€ä»¥ï¼Œå¦‚æœhttp2.0å¾—åˆ°å…¨é¢çš„ä½¿ç”¨ï¼Œé‚£ä¹ˆhttp1.1ä¸­çš„å¾ˆå¤šä¼˜åŒ–æ‰‹æ®µå°±ä¸å¿…åœ¨ä½¿ç”¨äº†ï¼Œæ¯”å¦‚ï¼šä½¿ç”¨é›ªç¢§å›¾ï¼Œé™æ€èµ„æºå¤šåŸŸåæ‹†åˆ†ç­‰ã€‚<br>http2.0çš„ç‰¹æ€§ï¼š</p><ol><li>å¤šè·¯å¤ç”¨ï¼ˆå³ä¸€ä¸ªtcp/ipè¯·æ±‚å¯ä»¥è¯·æ±‚å¤šä¸ªèµ„æºï¼‰ã€‚</li><li>é¦–éƒ¨å‹ç¼©ï¼ˆhttpå¤´éƒ¨å‹ç¼©ï¼Œå‡å°‘ä½“ç§¯ï¼‰ã€‚</li><li>äºŒè¿›åˆ¶åˆ†å¸§ï¼ˆåœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä½¿ç”¨äºŒè¿›åˆ¶åˆ†å¸§ï¼Œæ”¹å–„ä¼ è¾“æ€§èƒ½ï¼Œå®ç°ä½å»¶è¿Ÿå’Œé«˜ååé‡ï¼‰ã€‚</li><li>æœåŠ¡å™¨æ¨é€ï¼ˆæœåŠ¡ç«¯å¯ä»¥å¯¹å®¢æˆ·ç«¯çš„ä¸€ä¸ªè¯·æ±‚å‘å‡ºå¤šä¸ªå“åº”ï¼Œå¯ä»¥ä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯ï¼‰ã€‚</li><li>è¯·æ±‚ä¼˜å…ˆçº§ï¼ˆå¦‚æœæµè¢«èµ‹äºˆäº†ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šåŸºäºè¿™ä¸ªä¼˜å…ˆçº§è¢«å¤„ç†ï¼Œä¸”ç”±æœåŠ¡å™¨å†³å®šä½¿ç”¨å¤šå°‘èµ„æºæ¥å¤„ç†è¿™ä¸ªæµï¼‰ã€‚</li></ol><h4 id="https"><a href="#https" class="headerlink" title="https"></a>https</h4><p>httpsæ˜¯å®‰å…¨ç‰ˆæœ¬çš„httpã€‚è­¬å¦‚ä¸€äº›æ”¯ä»˜ç­‰æ“ä½œéƒ½æ˜¯åŸºäºhttpsçš„ï¼Œhttpçš„å®‰å…¨æ€§å¤ªä½ã€‚<br>ç®€å•æ¥è¯´ï¼Œhttpså’Œhttpçš„åŒºåˆ«å°±æ˜¯åœ¨è¯·æ±‚å»ºç«‹è¿æ¥ä¹‹å‰ï¼Œå…ˆå»ºç«‹sslè¿æ¥ï¼Œç¡®ä¿ä¹‹åçš„é€šä¿¡éƒ½æ˜¯åŠ å¯†çš„ï¼Œæ— æ³•è¢«è½»æ˜“æˆªå–åˆ†æã€‚<br>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœè¦å°†ç½‘ç«™å‡çº§æˆhttpsï¼Œéœ€è¦åç«¯æ”¯æŒï¼ˆåç«¯éœ€è¦ç”³è¯·è¯ä¹¦ç­‰ï¼‰ï¼Œç„¶åhttpsçš„å¼€é”€ä¹Ÿæ¯”httpè¦å¤§ï¼ˆå› ä¸ºéœ€è¦é¢å¤–å»ºç«‹å®‰å…¨é“¾æ¥ä»¥åŠåŠ å¯†ç­‰ï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´http2.0é…åˆhttpsçš„ä½“éªŒæ›´ä½³ï¼ˆå› ä¸ºhttp2.0æ›´å¿«äº†ï¼‰ã€‚</p><pre><code>1ã€æµè§ˆå™¨è¯·æ±‚å»ºç«‹SSLé“¾æ¥ï¼Œå¹¶å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªéšæœºæ•°â€“Client randomå’Œå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹æ³•ï¼Œæ¯”å¦‚RSAåŠ å¯†ï¼Œæ­¤æ—¶æ˜¯æ˜æ–‡ä¼ è¾“ã€‚ 2. æœåŠ¡ç«¯ä»ä¸­é€‰å‡ºä¸€ç»„åŠ å¯†ç®—æ³•ä¸Hashç®—æ³•ï¼Œå›å¤ä¸€ä¸ªéšæœºæ•°â€“Server randomï¼Œå¹¶å°†è‡ªå·±çš„èº«ä»½ä¿¡æ¯ä»¥è¯ä¹¦çš„å½¢å¼å‘å›ç»™æµè§ˆå™¨ï¼ˆè¯ä¹¦é‡ŒåŒ…å«äº†ç½‘ç«™åœ°å€ï¼Œéå¯¹ç§°åŠ å¯†çš„å…¬é’¥ï¼Œä»¥åŠè¯ä¹¦é¢å‘æœºæ„ç­‰ä¿¡æ¯ï¼‰3. æµè§ˆå™¨æ”¶åˆ°æœåŠ¡ç«¯çš„è¯ä¹¦å    - éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼ˆé¢å‘æœºæ„æ˜¯å¦åˆæ³•ï¼Œè¯ä¹¦ä¸­åŒ…å«çš„ç½‘å€æ˜¯å¦å’Œæ­£åœ¨è®¿é—®çš„ä¸€æ ·ï¼‰ï¼Œå¦‚æœè¯ä¹¦ä¿¡ä»»ï¼Œåˆ™æµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸€ä¸ªå°é”å¤´ï¼Œå¦åˆ™ä¼šæœ‰æç¤º    - ç”¨æˆ·æ¥æ”¶è¯ä¹¦åï¼ˆä¸ç®¡ä¿¡ä¸ä¿¡ä»»ï¼‰ï¼Œæµè§ˆä¼šç”Ÿäº§æ–°çš„éšæœºæ•°â€“Premaster secretï¼Œç„¶åè¯ä¹¦ä¸­çš„å…¬é’¥ä»¥åŠæŒ‡å®šçš„åŠ å¯†æ–¹æ³•åŠ å¯†`Premaster secret`ï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚    - åˆ©ç”¨Client randomã€Server randomå’ŒPremaster secreté€šè¿‡ä¸€å®šçš„ç®—æ³•ç”ŸæˆHTTPé“¾æ¥æ•°æ®ä¼ è¾“çš„å¯¹ç§°åŠ å¯†key-`session key`    - ä½¿ç”¨çº¦å®šå¥½çš„HASHç®—æ³•è®¡ç®—æ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ç”Ÿæˆçš„`session key`å¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ï¼Œæœ€åå°†ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰ä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯ã€‚ 4. æœåŠ¡ç«¯æ”¶åˆ°æµè§ˆå™¨çš„å›å¤    - åˆ©ç”¨å·²çŸ¥çš„åŠ è§£å¯†æ–¹å¼ä¸è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè·å–`Premaster secret`    - å’Œæµè§ˆå™¨ç›¸åŒè§„åˆ™ç”Ÿæˆ`session key`    - ä½¿ç”¨`session key`è§£å¯†æµè§ˆå™¨å‘æ¥çš„æ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶éªŒè¯Hashæ˜¯å¦ä¸æµè§ˆå™¨å‘æ¥çš„ä¸€è‡´    - ä½¿ç”¨`session key`åŠ å¯†ä¸€æ®µæ¡æ‰‹æ¶ˆæ¯ï¼Œå‘é€ç»™æµè§ˆå™¨5. æµè§ˆå™¨è§£å¯†å¹¶è®¡ç®—æ¡æ‰‹æ¶ˆæ¯çš„HASHï¼Œå¦‚æœä¸æœåŠ¡ç«¯å‘æ¥çš„HASHä¸€è‡´ï¼Œæ­¤æ—¶æ¡æ‰‹è¿‡ç¨‹ç»“æŸã€‚</code></pre><p><strong>ä¹‹åæ‰€æœ‰çš„httpsé€šä¿¡æ•°æ®å°†ç”±ä¹‹å‰æµè§ˆå™¨ç”Ÿæˆçš„<code>session key</code>å¹¶åˆ©ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚</strong><br><strong><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582123727413-3e3bbc49-a819-4229-8174-4bdcc8ced04b.png#align=left&display=inline&height=712&name=image.png&originHeight=773&originWidth=760&size=172844&status=done&style=none&width=700" alt="image.png"></strong></p><p><strong>å›¾ç‰‡æ¥æºäºé˜®ä¸€å³°çš„<a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html" target="_blank" rel="noopener">å›¾è§£SSL/TSLåè®®</a></strong></p><h3 id="httpç¼“å­˜"><a href="#httpç¼“å­˜" class="headerlink" title="httpç¼“å­˜"></a>httpç¼“å­˜</h3><p>ç¼“å­˜å¯ä»¥è¢«ç®€å•çš„åˆ’åˆ†ä¸ºä¸¤ç±»ï¼šå¼ºç¼“å­˜ï¼ˆ200 from cacheï¼‰å’Œåå•†ç¼“å­˜ï¼ˆ304ï¼‰ã€‚<br>åŒºåˆ«ï¼š</p><ul><li>å¼ºç¼“å­˜ï¼šå¦‚æœæµè§ˆå™¨åˆ¤æ–­æœ¬åœ°ç¼“å­˜æœªè¿‡æœŸçš„æ—¶å€™ï¼Œå°†ä¼šç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œä¸ä¼šå‘èµ·è¯·æ±‚ã€‚</li><li>åå•†ç¼“å­˜ï¼šæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œåœ¨è¯·æ±‚å¤´éƒ¨æºå¸¦èµ„æºæ–‡ä»¶çš„ç¼“å­˜ä¿¡æ¯ï¼Œå¦‚If-Modified-Sinceã€ETagç­‰ï¼Œç”±æœåŠ¡å™¨ç«¯åˆ¤æ–­ï¼Œèµ„æºè‡ªä»ä¸Šæ¬¡è®¿é—®æ˜¯å¦å‘ç”Ÿè¿‡å˜æ›´ï¼Œå¦‚æœå‘ç”Ÿè¿‡å˜æ›´ï¼Œåˆ™è¿”å›çŠ¶æ€ç 200ï¼Œå¹¶å°†æ–°çš„èµ„æºæ–‡ä»¶å’Œç¼“å­˜è§„åˆ™è¿”å›ï¼›å¦‚æœæœªå˜æ›´ï¼Œè¿”å›304çŠ¶æ€ç ï¼Œå‘Šè¯‰æµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚</li></ul><h4 id="ç¼“å­˜å¤´éƒ¨æ¦‚è¿°"><a href="#ç¼“å­˜å¤´éƒ¨æ¦‚è¿°" class="headerlink" title="ç¼“å­˜å¤´éƒ¨æ¦‚è¿°"></a>ç¼“å­˜å¤´éƒ¨æ¦‚è¿°</h4><p>ä¸Šé¢æåˆ°çš„å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œé‚£ä¹ˆå®ƒä»¬æ˜¯å¦‚ä½•è¿›è¡ŒåŒºåˆ†çš„å‘¢ï¼Ÿ<br>ç­”æ¡ˆæ˜¯é€šè¿‡ä¸åŒçš„httpå¤´éƒ¨æ§åˆ¶ã€‚<br>è¿™é‡Œåˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„ç¼“å­˜å¤´éƒ¨ï¼š<br>ç”¨äºå¼ºç¼“å­˜æ§åˆ¶çš„ï¼š</p><ul><li>http1.0: Pragma/Expires</li><li>http1.1: Cache-Control/Max-Age</li></ul><p>æ³¨æ„ï¼š<strong><code>Max-Age</code>ä¸æ˜¯ä¸€ä¸ªå¤´éƒ¨ï¼Œå®ƒæ˜¯<code>Cache-Control</code>å¤´éƒ¨çš„å€¼ã€‚</strong></p><p>ç”¨äºåå•†ç¼“å­˜æ§åˆ¶çš„ï¼š</p><ul><li>http1.0: Last-Modified/If-Modified-Since</li><li>http1.1ï¼šE-tag/If-None-Match</li></ul><p>å†æä¸€ç‚¹ï¼Œå…¶å®HTMLé¡µé¢ä¸­ä¹Ÿæœ‰ä¸€ä¸ªmetaæ ‡ç­¾å¯ä»¥æ§åˆ¶ç¼“å­˜æ–¹æ¡ˆ-<code>Pragma</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>META</span> <span class="token attr-name">HTTP-EQUIV</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Pragma<span class="token punctuation">"</span></span> <span class="token attr-name">CONTENT</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>no-cache<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>ä¸è¿‡ï¼Œè¿™ç§æ–¹æ¡ˆè¿˜æ˜¯æ¯”è¾ƒå°‘ç”¨åˆ°ï¼Œå› ä¸ºæ”¯æŒæƒ…å†µä¸ä½³ï¼Œè­¬å¦‚ç¼“å­˜ä»£ç†æœåŠ¡å™¨è‚¯å®šä¸æ”¯æŒï¼Œæ‰€ä»¥ä¸æ¨èã€‚</p><h4 id="å¤´éƒ¨çš„åŒºåˆ«"><a href="#å¤´éƒ¨çš„åŒºåˆ«" class="headerlink" title="å¤´éƒ¨çš„åŒºåˆ«"></a>å¤´éƒ¨çš„åŒºåˆ«</h4><h5 id="http1-0çš„ç¼“å­˜æ§åˆ¶"><a href="#http1-0çš„ç¼“å­˜æ§åˆ¶" class="headerlink" title="http1.0çš„ç¼“å­˜æ§åˆ¶"></a>http1.0çš„ç¼“å­˜æ§åˆ¶</h5><ul><li>Pragmaï¼šä¸¥æ ¼æ¥è¯´ï¼Œå®ƒä¸å±äºä¸“é—¨çš„ç¼“å­˜æ§åˆ¶å¤´éƒ¨ï¼Œä½†æ˜¯å®ƒè®¾ç½®<code>no-cache</code>æ—¶å¯ä»¥è®©æœ¬åœ°å¼ºç¼“å­˜å¤±æ•ˆï¼ˆå±äºç¼–è¯‘æ§åˆ¶ï¼Œæ¥å®ç°ç‰¹å®šçš„æŒ‡ä»¤ï¼Œä¸»è¦æ˜¯å› ä¸ºå…¼å®¹http1.0ï¼Œæ‰€ä»¥ä»¥å‰åˆè¢«å¤§é‡åº”ç”¨ï¼‰ã€‚</li><li>Expiresï¼šæœåŠ¡ç«¯é…ç½®çš„ï¼Œå±äºå¼ºç¼“å­˜ï¼Œåœ¨è§„å®šçš„æ—¶é—´ä¹‹å‰ï¼Œæµè§ˆå™¨ç«¯ä¸ä¼šå‘èµ·è¯·æ±‚ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚æ³¨æ„ï¼ŒExpiresä¸€èˆ¬å¯¹åº”æœåŠ¡å™¨ç«¯æ—¶é—´ï¼Œå¦‚<code>Expiresï¼šFri, 30 Oct 1998 14:19:41</code>ã€‚</li><li>If-Modified-Since/Last-Modifiedï¼šè¿™ä¸¤ä¸ªæ˜¯æˆå †å‡ºç°çš„ï¼Œå±äºåå•†ç¼“å­˜çš„å†…å®¹ã€‚å…¶ä¸­å±äºæµè§ˆå™¨çš„å¤´éƒ¨å†…å®¹æ˜¯<code>If-Modified-Since</code>ï¼Œè€Œå±äºæœåŠ¡ç«¯çš„æ˜¯<code>Last-Modified</code>ã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼Œå½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¦‚æœäºŒè€…åŒ¹é…ï¼Œåˆ™è¯´æ˜æœåŠ¡ç«¯èµ„æºæœªæ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œåªè¿”å›å¤´éƒ¨ï¼ŒçŠ¶æ€ç 304ã€‚</li></ul><h5 id="http1-1çš„ç¼“å­˜æ§åˆ¶"><a href="#http1-1çš„ç¼“å­˜æ§åˆ¶" class="headerlink" title="http1.1çš„ç¼“å­˜æ§åˆ¶"></a>http1.1çš„ç¼“å­˜æ§åˆ¶</h5><ul><li>Cache-Controlï¼šç¼“å­˜æ§åˆ¶å¤´éƒ¨ï¼Œå±äºå¼ºç¼“å­˜ï¼Œæœ‰no-cacheã€max-ageç­‰å¤šä¸ªå€¼ã€‚</li><li>Max-Ageï¼šæœåŠ¡ç«¯é…ç½®çš„ï¼Œç”¨æ¥æ§åˆ¶å¼ºç¼“å­˜ï¼Œåœ¨è§„å®šçš„æ—¶é—´ä¹‹å†…ï¼Œæµè§ˆå™¨æ— éœ€å‘å‡ºè¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œæ³¨æ„ï¼ŒMax-Ageæ˜¯Cache-Controlå¤´éƒ¨çš„å€¼ï¼Œä¸æ˜¯ç‹¬ç«‹çš„å¤´éƒ¨ï¼Œè­¬å¦‚<code>Cache-Control: max-age=3600</code>ï¼Œè€Œä¸”å®ƒå€¼å¾—æ˜¯ç»å¯¹æ—¶é—´ï¼Œç”±æµè§ˆå™¨è‡ªå·±è®¡ç®—ã€‚</li><li>If-None-Match/E-tagï¼šè¿™ä¸¤ä¸ªæ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå±äºåå•†ç¼“å­˜çš„å†…å®¹ï¼Œå…¶ä¸­æµè§ˆå™¨çš„å¤´éƒ¨æ˜¯<code>If-None-Match</code>ï¼Œè€ŒæœåŠ¡ç«¯çš„æ˜¯<code>E-tag</code>ï¼ŒåŒæ ·ï¼Œå‘å‡ºè¯·æ±‚åï¼Œå¦‚æœ<code>If-None-Match</code>å’Œ<code>E-tag</code>åŒ¹é…ï¼Œåˆ™ä»£è¡¨å†…å®¹æœªå˜ï¼Œé€šçŸ¥æµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå’ŒLast-Modifiedä¸åŒï¼ŒE-tagæ›´ç²¾ç¡®ï¼Œå®ƒæ˜¯ç±»ä¼¼äºæŒ‡çº¹ä¸€æ ·çš„ä¸œè¥¿ï¼ŒåŸºäºFileEtag INode Mtime Sizeç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ–‡ä»¶å˜ï¼ŒæŒ‡çº¹å°±ä¼šå˜ï¼Œè€Œä¸”æ²¡æœ‰1sç²¾ç¡®åº¦çš„é™åˆ¶ã€‚</li></ul><h4 id="Max-Ageå’ŒExpires"><a href="#Max-Ageå’ŒExpires" class="headerlink" title="Max-Ageå’ŒExpires"></a>Max-Ageå’ŒExpires</h4><p>Expiresä½¿ç”¨çš„æ˜¯æœåŠ¡å™¨ç«¯çš„æ—¶é—´<br>ä½†æ˜¯æœ‰æ—¶å€™ä¼šæœ‰è¿™æ ·ä¸€ç§æƒ…å†µ-å®¢æˆ·ç«¯æ—¶é—´å’ŒæœåŠ¡ç«¯ä¸åŒæ­¥<br>é‚£è¿™æ ·ï¼Œå¯èƒ½å°±ä¼šå‡ºé—®é¢˜äº†ï¼Œé€ æˆäº†æµè§ˆå™¨æœ¬åœ°çš„ç¼“å­˜æ— ç”¨æˆ–è€…ä¸€ç›´æ— æ³•è¿‡æœŸ<br>æ‰€ä»¥ä¸€èˆ¬http1.1åä¸æ¨èä½¿ç”¨<code>Expires</code><br>è€Œ<code>Max-Age</code>ä½¿ç”¨çš„æ˜¯å®¢æˆ·ç«¯æœ¬åœ°æ—¶é—´çš„è®¡ç®—ï¼Œå› æ­¤ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜<br>å› æ­¤æ¨èä½¿ç”¨<code>Max-Age</code>ã€‚<br>æ³¨æ„ï¼Œå¦‚æœåŒæ—¶å¯ç”¨äº†<code>Cache-Control</code>ä¸<code>Expires</code>ï¼Œ<code>Cache-Control</code>ä¼˜å…ˆçº§é«˜ã€‚</p><h4 id="E-tagå’ŒLast-Modified"><a href="#E-tagå’ŒLast-Modified" class="headerlink" title="E-tagå’ŒLast-Modified"></a>E-tagå’ŒLast-Modified</h4><p><code>Last-Modified</code>ï¼š</p><ul><li>è¡¨æ˜æœåŠ¡ç«¯çš„æ–‡ä»¶æœ€åä½•æ—¶æ”¹å˜çš„</li><li>å®ƒæœ‰ä¸€ä¸ªç¼ºé™·å°±æ˜¯åªèƒ½ç²¾ç¡®åˆ°1sï¼Œ</li><li>ç„¶åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯æœ‰çš„æœåŠ¡ç«¯çš„æ–‡ä»¶ä¼šå‘¨æœŸæ€§çš„æ”¹å˜ï¼Œå¯¼è‡´ç¼“å­˜å¤±æ•ˆ</li></ul><p>è€Œ<code>E-tag</code>ï¼š</p><ul><li>æ˜¯ä¸€ç§æŒ‡çº¹æœºåˆ¶ï¼Œä»£è¡¨æ–‡ä»¶ç›¸å…³æŒ‡çº¹</li><li>åªæœ‰æ–‡ä»¶å˜æ‰ä¼šå˜ï¼Œä¹Ÿåªè¦æ–‡ä»¶å˜å°±ä¼šå˜ï¼Œ</li><li>ä¹Ÿæ²¡æœ‰ç²¾ç¡®æ—¶é—´çš„é™åˆ¶ï¼Œåªè¦æ–‡ä»¶ä¸€éï¼Œç«‹é©¬E-tagå°±ä¸ä¸€æ ·äº†</li></ul><p>å¦‚æœåŒæ—¶å¸¦æœ‰<code>E-tag</code>å’Œ<code>Last-Modified</code>ï¼ŒæœåŠ¡ç«¯ä¼šä¼˜å…ˆæ£€æŸ¥<code>E-tag</code>ã€‚<br>å„å¤§ç¼“å­˜å¤´éƒ¨çš„æ•´ä½“å…³ç³»å¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582125780799-6c37f8c2-f017-437c-b0a1-5883bc52f640.png#align=left&display=inline&height=361&name=image.png&originHeight=487&originWidth=800&size=56724&status=done&style=none&width=593" alt="image.png"></p><h2 id="è§£æé¡µé¢"><a href="#è§£æé¡µé¢" class="headerlink" title="è§£æé¡µé¢"></a>è§£æé¡µé¢</h2><p>å‰é¢æœ‰æåˆ°httpäº¤äº’ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æµè§ˆå™¨è·å–åˆ°htmlï¼Œç„¶åè§£æï¼Œæ¸²æŸ“ã€‚</p><h3 id="æµç¨‹ç®€è¿°"><a href="#æµç¨‹ç®€è¿°" class="headerlink" title="æµç¨‹ç®€è¿°"></a>æµç¨‹ç®€è¿°</h3><p>æµè§ˆå™¨å†…æ ¸æ‹¿åˆ°å†…å®¹åï¼Œæ¸²æŸ“æ­¥éª¤å¤§è‡´åˆ†ä¸ºä¸€ä¸‹å‡ æ­¥ï¼š</p><pre><code>1ã€è§£æHTMLï¼Œæ„å»ºDOM Tree2ã€è§£æCSSï¼Œæ„å»ºCSS Rules Tree3ã€åˆå¹¶DOM Tree å’Œ CSS Rules Treeï¼ˆå…¶å®æ˜¯å°†CSS Rules Treeé™„åœ¨DOM Treeä¹‹ä¸Šï¼‰ï¼Œç”Ÿæˆrender Treeã€‚4ã€å¸ƒå±€äººçš„äºº Treeï¼ˆLayout/reflowï¼‰ï¼Œè´Ÿè´£è®¡ç®—å„å…ƒç´ çš„å°ºå¯¸å’Œä½ç½®çš„è®¡ç®—ã€‚5ã€ç»˜åˆ¶render Treeï¼ˆpaintï¼‰ï¼Œç»˜åˆ¶é¡µé¢åƒç´ ä¿¡æ¯ã€‚6ã€æµè§ˆå™¨å°†å„å±‚çš„ä¿¡æ¯å‘é€ç»™GPUï¼Œç”±GPUå°†å„å±‚åˆå±‚ï¼ˆcompositeï¼‰ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</code></pre><p>å¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582126229278-a9a28d86-1240-46bc-b731-9159edea5de0.png#align=left&display=inline&height=290&name=image.png&originHeight=313&originWidth=800&size=59355&status=done&style=none&width=741" alt="image.png"></p><h3 id="HTMLè§£æ-æ„å»ºDOM"><a href="#HTMLè§£æ-æ„å»ºDOM" class="headerlink" title="HTMLè§£æ æ„å»ºDOM"></a>HTMLè§£æ æ„å»ºDOM</h3><p>æ•´ä¸ªæ¸²æŸ“æ­¥éª¤ä¸­ï¼ŒHTMLè§£ææ˜¯ç¬¬ä¸€æ­¥ã€‚<br>ç®€å•çš„ç†è§£ï¼Œè¿™ä¸€æ­¥çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š<strong>æµè§ˆå™¨è§£æHTMLï¼Œæ„å»ºDOMæ ‘ã€‚</strong><br>ä½†å®é™…ä¸Šï¼Œåœ¨åˆ†ææ•´ä½“æ„å»ºæ—¶ï¼Œå´ä¸èƒ½ä¸€ç¬”å¸¦è¿‡ï¼Œå¾—ç¨å¾®å±•å¼€ã€‚<br>è§£æHTMLåˆ°æ„å»ºå‡ºDOMå½“ç„¶è¿‡ç¨‹å¯ä»¥ç®€è¿°å¦‚ä¸‹ï¼š<br><code>Bytes â†’ characters â†’ tokens â†’ nodes â†’ DOM</code><br>è­¬å¦‚å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªHTMLé¡µé¢ï¼šï¼ˆä»¥ä¸‹éƒ¨åˆ†çš„å†…å®¹å‡ºè‡ªå‚è€ƒæ¥æºï¼Œä¿®æ”¹äº†ä¸‹æ ¼å¼ï¼‰</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width,initial-scale<span class="token punctuation">=</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>style.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Critical Path<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>web performance<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span> students!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>awesome-photo.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>æµè§ˆå™¨çš„å¤„ç†å¦‚ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582126699954-e7997952-47cc-42bd-a124-17b5228a4008.png#align=left&display=inline&height=393&name=image.png&originHeight=443&originWidth=800&size=156787&status=done&style=none&width=709" alt="image.png"><br>åˆ—ä¸¾å…¶ä¸­çš„ä¸€äº›é‡ç‚¹è¿‡ç¨‹ï¼š</p><ol><li>Conversionè½¬æ¢ï¼šæµè§ˆå™¨å°†è·å¾—çš„HTMLå†…å®¹ï¼ˆBytesï¼‰åŸºäºå®ƒçš„ç¼–ç æ ¼å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</li><li>Tokeizingåˆ†è¯ï¼šæµè§ˆå™¨æŒ‰ç…§HTMLè§„èŒƒå°†è¿™äº›å­—ç¬¦ä¸²è½¬æ¢æœªä¸åŒçš„æ ‡è®°tokenï¼Œæ¯ä¸€ä¸ªtokenéƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„å«ä¹‰å’Œè§„åˆ™ã€‚</li><li>Lexingè¯æ³•åˆ†æï¼šåˆ†è¯çš„ç»“æœå°±æ˜¯è·å¾—ä¸€å †tokenï¼Œæ­¤æ—¶å°†ä»–ä»¬è½¬æ¢ä¸ºå¯¹è±¡ï¼Œä¸ºä»–ä»¬å®šä¹‰å®ƒä»¬çš„å±æ€§å’Œè§„åˆ™ã€‚</li><li>DOMæ„å»ºï¼šå› ä¸ºHTMLæ ‡è®°çš„å°±æ˜¯ä¸åŒæ ‡ç­¾ä¹‹é—´çš„å…³ç³»ï¼Œè¿™ä¸ªå…³ç³»å°±åƒæ ‘å½¢ç»“æ„ä¸€æ ·ã€‚</li></ol><p>æœ€ç»ˆçš„DOMæ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582127390688-259012c7-ea28-4f28-979c-3038be4bbeae.png#align=left&display=inline&height=302&name=image.png&originHeight=284&originWidth=665&size=80041&status=done&style=none&width=707" alt="image.png"></p><h3 id="ç”ŸæˆCSSè§„åˆ™"><a href="#ç”ŸæˆCSSè§„åˆ™" class="headerlink" title="ç”ŸæˆCSSè§„åˆ™"></a>ç”ŸæˆCSSè§„åˆ™</h3><p>åŒç†ï¼ŒCSSè§„åˆ™æ ‘çš„ç”Ÿæˆä¹Ÿæ˜¯ç±»ä¼¼ã€‚ç®€è¿°ä¸ºï¼š<br><code>Bytes â†’ characters â†’ tokens â†’ nodes â†’ CSSOM</code>ã€‚</p><pre><code>body { font-size: 16px }p { font-weight: bold }span { color: red }p span { display: none }img { float: right }</code></pre><p>æœ€ç»ˆç”Ÿæˆçš„CSS Rules Treeï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582127478001-17abbd25-fe2f-4132-bdf9-512c64f7edd7.png#align=left&display=inline&height=345&name=image.png&originHeight=299&originWidth=582&size=78490&status=done&style=none&width=671" alt="image.png"></p><h3 id="æ„å»ºæ¸²æŸ“æ ‘"><a href="#æ„å»ºæ¸²æŸ“æ ‘" class="headerlink" title="æ„å»ºæ¸²æŸ“æ ‘"></a>æ„å»ºæ¸²æŸ“æ ‘</h3><p>å½“DOMæ ‘å’ŒCSSOMéƒ½æœ‰äº†åï¼Œå°±è¦å¼€å§‹æ„å»ºæ¸²æŸ“æ ‘äº†<br>ä¸€èˆ¬æ¥è¯´ï¼Œæ¸²æŸ“æ ‘å’ŒDOMæ ‘ç›¸å¯¹åº”çš„ï¼Œä½†ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ä¸€ä¸€å¯¹åº”<br>å› ä¸ºæœ‰ä¸€äº›ä¸å¯è§çš„DOMå…ƒç´ ä¸ä¼šæ’å…¥åˆ°æ¸²æŸ“æ ‘ä¸­ï¼Œå¦‚headè¿™ç§ä¸å¯è§çš„æ ‡ç­¾æˆ–è€…<code>display: none</code>ç­‰<br>æ•´ä½“æ¥è¯´å¯ä»¥çœ‹å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582127519945-fb1dc7a5-a137-4ce5-8051-37574d82a1eb.png#align=left&display=inline&height=326&name=image.png&originHeight=373&originWidth=800&size=163504&status=done&style=none&width=699" alt="image.png"></p><h3 id="æ¸²æŸ“"><a href="#æ¸²æŸ“" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h3><p>æœ‰äº†renderæ ‘ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¼€å§‹æ¸²æŸ“ï¼ŒåŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582127560548-6cd4e861-a923-4f9f-928e-8688ee6244e5.png#align=left&display=inline&height=194&name=image.png&originHeight=220&originWidth=800&size=171754&status=done&style=none&width=707" alt="image.png"></p><p>å›¾ä¸­é‡è¦çš„å››ä¸ªæ­¥éª¤å°±æ˜¯ï¼š</p><pre><code>1. è®¡ç®—CSSæ ·å¼2. æ„å»ºæ¸²æŸ“æ ‘3. å¸ƒå±€ï¼Œä¸»è¦å®šä½åæ ‡å’Œå¤§å°ï¼Œæ˜¯å¦æ¢è¡Œï¼Œå„ç§position overflow z-indexå±æ€§4. ç»˜åˆ¶ï¼Œå°†å›¾åƒç»˜åˆ¶å‡ºæ¥</code></pre><p>ç„¶åï¼Œå›¾ä¸­çš„çº¿ä¸ç®­å¤´ä»£è¡¨é€šè¿‡jsåŠ¨æ€ä¿®æ”¹äº†DOMæˆ–CSSï¼Œå¯¼è‡´äº†é‡æ–°å¸ƒå±€ï¼ˆLayoutï¼‰æˆ–æ¸²æŸ“ï¼ˆRepaintï¼‰ã€‚<br>è¿™é‡ŒLayoutå’ŒRepaintçš„æ¦‚å¿µæ˜¯æœ‰åŒºåˆ«çš„ï¼š</p><ul><li>Layoutï¼Œä¹Ÿç§°ä¸ºReflowï¼Œå³å›æµã€‚ä¸€èˆ¬æ„å‘³ç€å…ƒç´ çš„å†…å®¹ã€ç»“æ„ã€ä½ç½®æˆ–å°ºå¯¸å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦é‡æ–°è®¡ç®—æ ·å¼å’Œæ¸²æŸ“æ ‘</li><li>Repaintï¼Œå³é‡ç»˜ã€‚æ„å‘³ç€å…ƒç´ å‘ç”Ÿçš„æ”¹å˜åªæ˜¯å½±å“äº†å…ƒç´ çš„ä¸€äº›å¤–è§‚ä¹‹ç±»çš„æ—¶å€™ï¼ˆä¾‹å¦‚ï¼ŒèƒŒæ™¯è‰²ï¼Œè¾¹æ¡†é¢œè‰²ï¼Œæ–‡å­—é¢œè‰²ç­‰ï¼‰ï¼Œæ­¤æ—¶åªéœ€è¦åº”ç”¨æ–°æ ·å¼ç»˜åˆ¶è¿™ä¸ªå…ƒç´ å°±å¯ä»¥äº†</li></ul><p>æ³¨æ„ï¼šå›æµçš„æˆæœ¬è¦è¿œé«˜äºé‡ç»˜ï¼Œå› ä¸ºå›æµä¼šé€ æˆåŒçº§å…ƒç´ å’Œå­èŠ‚ç‚¹çš„å›æµã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦å°½å¯èƒ½çš„é¿å…å›æµã€‚</p><h3 id="ä»€ä¹ˆä¼šé€ æˆå›æµ"><a href="#ä»€ä¹ˆä¼šé€ æˆå›æµ" class="headerlink" title="ä»€ä¹ˆä¼šé€ æˆå›æµ"></a>ä»€ä¹ˆä¼šé€ æˆå›æµ</h3><ul><li>é¡µé¢æ¸²æŸ“åˆå§‹åŒ–</li><li>DOMç»“æ„æ”¹å˜ï¼Œå¦‚åˆ é™¤æŸä¸ªèŠ‚ç‚¹</li><li>render Treeå‘ç”Ÿå˜åŒ–ï¼Œå¦‚paddingæ”¹å˜</li><li>çª—å£resize</li><li>æœ€å¤æ‚çš„ä¸€ç§ï¼šè·å–å…ƒç´ çš„æŸä¸ªå±æ€§ï¼š<ul><li>offsetTop/Left/Width/Height</li><li>scrollTop/Left/Width/Height</li><li>clientTop/Left/Width/Height</li><li>width/height</li><li>è°ƒç”¨äº†getComputedStyle()æˆ–è€…IEçš„currentStyle</li></ul></li></ul><p>å›æµä¸€å®šä¼šä¼´éšç€é‡ç»˜ï¼Œé‡ç»˜å´ä¸ä¸€å®šé€ æˆå›æµï¼Œè¿™æ˜¯ä¸€ä¸ªå……åˆ†å¿…è¦æ¡ä»¶ã€‚</p><h5 id="ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h5><ol><li>å‡å°‘é€é¡¹æ›´æ”¹æ ·å¼ï¼Œæœ€å¥½ä¸€æ¬¡æ€§æ›´æ”¹ï¼Œæˆ–è€…ä½¿ç”¨å®šä¹‰æ ·å¼classä¸€æ¬¡æ€§æ›´æ”¹ã€‚</li><li>é¿å…å¾ªç¯æ“ä½œdomï¼Œåˆ›å»ºä¸€ä¸ªdocumentFragmentæˆ–divï¼Œåœ¨å®ƒä¸Šé¢åº”ç”¨æ‰€æœ‰DOMæ“ä½œï¼Œæœ€åå†æŠŠå®ƒæ·»åŠ åˆ°window.documentã€‚</li><li>é¿å…å¤šæ¬¡è°ƒç”¨è¯»å–offsetç­‰å±æ€§ï¼Œå¿…è¦çš„æ—¶å€™å¯ä»¥ç¼“å­˜åˆ°å˜é‡ä¸­ã€‚</li><li>å°†å¤æ‚çš„å…ƒç´ å†³å®šå®šä½æˆ–è€…å›ºå®šå®šä½ï¼Œä½¿å…¶è„±ç¦»æ–‡æ¡£æµï¼Œå¦åˆ™é€ æˆçš„å›æµä»£ä»·å¤ªå¤§ã€‚</li></ol><p><strong>æ³¨æ„ï¼šæ”¹å˜å­—ä½“å¤§å°ä¼šå¼•å‘å›æµ</strong></p><h3 id="å¤åˆå±‚ä¸ç®€å•å±‚"><a href="#å¤åˆå±‚ä¸ç®€å•å±‚" class="headerlink" title="å¤åˆå±‚ä¸ç®€å•å±‚"></a>å¤åˆå±‚ä¸ç®€å•å±‚</h3><p>æµè§ˆå™¨æ¸²æŸ“çš„å›¾å±‚ä¸€èˆ¬åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ™®é€šå›¾å±‚å’Œå¤åˆå›¾å±‚ã€‚</p><ul><li>DOMä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªæ™®é€šå›¾å±‚ã€‚</li><li>å¤åˆå›¾å±‚å°±æ˜¯æ™®é€šå›¾å±‚çš„åˆå¹¶ã€‚ä¸€ä¸ªé¡µé¢ä¸€èˆ¬æ¥è¯´åªè¦ä¸€ä¸ªå¤åˆå›¾å±‚ã€‚</li></ul><h4 id="æµè§ˆå™¨ä»€ä¹ˆæ—¶å€™ä¼šåˆ›å»ºå¤åˆå›¾å±‚"><a href="#æµè§ˆå™¨ä»€ä¹ˆæ—¶å€™ä¼šåˆ›å»ºå¤åˆå›¾å±‚" class="headerlink" title="æµè§ˆå™¨ä»€ä¹ˆæ—¶å€™ä¼šåˆ›å»ºå¤åˆå›¾å±‚"></a>æµè§ˆå™¨ä»€ä¹ˆæ—¶å€™ä¼šåˆ›å»ºå¤åˆå›¾å±‚</h4><ul><li><p>3D æˆ–è€… CSS transform</p></li><li><p><video> å’Œ <canvas> æ ‡ç­¾</p></li><li><p>CSS filters</p></li><li><p>å…ƒç´ è¦†ç›–æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨äº† z-index å±æ€§</p></li></ul><h4 id="å¦‚ä½•å˜æˆå¤åˆå›¾å±‚"><a href="#å¦‚ä½•å˜æˆå¤åˆå›¾å±‚" class="headerlink" title="å¦‚ä½•å˜æˆå¤åˆå›¾å±‚"></a>å¦‚ä½•å˜æˆå¤åˆå›¾å±‚</h4><p>å°†ä¸€ä¸ªå…ƒç´ å˜ä¸ºå¤åˆå›¾å±‚ï¼Œå°±æ˜¯ä½¿ç”¨ä¼ è¯´ä¸­çš„ç¡¬ä»¶åŠ é€Ÿã€‚</p><ul><li>transform:translate3d(0,0,0)ï¼Œæˆ–è€…translateZ(0)ã€‚</li><li>opacityå±æ€§/è¿‡åº¦åŠ¨ç”»ï¼ˆéœ€è¦åŠ¨ç”»æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ‰ä¼šåˆ›å»ºåˆæˆå±‚ï¼ŒåŠ¨ç”»æ²¡æœ‰å¼€å§‹æˆ–ç»“æŸåå…ƒç´ è¿˜ä¼šå›åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼‰</li><li>will-changå±æ€§ï¼ˆè¿™ä¸ªæ¯”è¾ƒååƒ»ï¼‰ï¼Œä¸€èˆ¬é…åˆopacityä¸translateä½¿ç”¨ï¼ˆè€Œä¸”ç»æµ‹è¯•ï¼Œé™¤äº†ä¸Šè¿°å¯ä»¥å¼•å‘ç¡¬ä»¶åŠ é€Ÿçš„å±æ€§å¤–ï¼Œå…¶å®ƒå±æ€§å¹¶ä¸ä¼šå˜æˆå¤åˆå±‚ï¼‰ï¼Œwill-changeçš„ä½œç”¨å°±æ˜¯å‘Šè¯‰æµè§ˆå™¨è¯¥å…ƒç´ ä¼šæœ‰é‚£äº›å‘ç”Ÿå˜åŒ–çš„æ–¹æ³•ï¼Œè®©æµè§ˆå™¨ä¸ºè¯¥å…ƒç´ çš„å˜åŒ–åšå¥½ä¼˜åŒ–å‡†å¤‡ï¼Œå…·ä½“è¯·<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/will-change" target="_blank" rel="noopener">ç§»æ­¥</a>ã€‚</li></ul><h4 id="å¤åˆå›¾å±‚çš„ä½œç”¨"><a href="#å¤åˆå›¾å±‚çš„ä½œç”¨" class="headerlink" title="å¤åˆå›¾å±‚çš„ä½œç”¨"></a>å¤åˆå›¾å±‚çš„ä½œç”¨</h4><p>ä¸€èˆ¬ä¸€ä¸ªå…ƒç´ å¼€å¯ç¡¬ä»¶åŠ é€Ÿåä¼šå˜æˆå¤åˆå›¾å±‚ï¼Œå¯ä»¥ç‹¬ç«‹äºæ™®é€šæ–‡æ¡£æµä¸­ï¼Œæ”¹åŠ¨åå¯ä»¥é¿å…æ•´ä¸ªé¡µé¢é‡ç»˜ï¼Œæå‡æ€§èƒ½<br>ä½†æ˜¯å°½é‡ä¸è¦å¤§é‡ä½¿ç”¨å¤åˆå›¾å±‚ï¼Œå¦åˆ™ç”±äºèµ„æºæ¶ˆè€—è¿‡åº¦ï¼Œé¡µé¢åè€Œä¼šå˜çš„æ›´å¡ã€‚</p><h4 id="ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„é—®é¢˜"><a href="#ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„é—®é¢˜" class="headerlink" title="ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„é—®é¢˜"></a>ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„é—®é¢˜</h4><ol><li>å†…å­˜ã€‚å¦‚æœGPUåŠ è½½äº†å¤§é‡çš„çº¹ç†ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å°±ä¼šå‘ç”Ÿå†…å®¹é—®é¢˜ï¼Œè¿™ä¸€ç‚¹åœ¨ç§»åŠ¨ç«¯æµè§ˆå™¨ä¸Šå°¤ä¸ºæ˜æ˜¾ï¼Œæ‰€ä»¥ï¼Œä¸€å®šè¦ç‰¢è®°ä¸è¦è®©é¡µé¢çš„æ¯ä¸ªå…ƒç´ éƒ½ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿã€‚</li><li>ä½¿ç”¨GPUæ¸²æŸ“ä¼šå½±å“å­—ä½“çš„æŠ—é”¯é½¿æ•ˆæœã€‚è¿™æ˜¯å› ä¸ºGPUå’ŒCPUå…·æœ‰ä¸åŒçš„æ¸²æŸ“æœºåˆ¶ã€‚å³ä½¿æœ€ç»ˆç¡¬ä»¶åŠ é€Ÿåœæ­¢äº†ï¼Œæ–‡æœ¬è¿˜æ˜¯ä¼šåœ¨åŠ¨ç”»æœŸé—´æ˜¾ç¤ºå¾—å¾ˆæ¨¡ç³Šã€‚</li></ol><p>æ³¨æ„ï¼šä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿæ—¶ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨indexï¼Œé˜²æ­¢æµè§ˆå™¨é»˜è®¤ç»™åç»­çš„å…ƒç´ åˆ›å»ºå¤åˆå±‚æ¸²æŸ“ã€‚<br>å…·ä½“çš„åŸç†æ—¶è¿™æ ·çš„ï¼š<br><strong>webkit CSS3ä¸­ï¼Œå¦‚æœè¿™ä¸ªå…ƒç´ æ·»åŠ äº†ç¡¬ä»¶åŠ é€Ÿï¼Œå¹¶ä¸”indexå±‚çº§æ¯”è¾ƒä½ï¼Œ<br>é‚£ä¹ˆåœ¨è¿™ä¸ªå…ƒç´ çš„åé¢å…¶å®ƒå…ƒç´ ï¼ˆå±‚çº§æ¯”è¿™ä¸ªå…ƒç´ é«˜çš„ï¼Œæˆ–è€…ç›¸åŒçš„ï¼Œå¹¶ä¸”releativeæˆ–absoluteå±æ€§ç›¸åŒçš„ï¼‰ï¼Œ<br>ä¼šé»˜è®¤å˜ä¸ºå¤åˆå±‚æ¸²æŸ“ï¼Œå¦‚æœå¤„ç†ä¸å½“ä¼šæå¤§çš„å½±å“æ€§èƒ½</strong><br>ç®€å•ç‚¹ç†è§£ï¼Œå…¶å®å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªéšå¼åˆæˆçš„æ¦‚å¿µï¼š<strong>å¦‚æœaæ˜¯ä¸€ä¸ªå¤åˆå›¾å±‚ï¼Œè€Œä¸”båœ¨aä¸Šé¢ï¼Œé‚£ä¹ˆbä¹Ÿä¼šè¢«éšå¼è½¬ä¸ºä¸€ä¸ªå¤åˆå›¾å±‚</strong>ï¼Œè¿™ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„</p><h4 id="QA-2"><a href="#QA-2" class="headerlink" title="QA"></a>QA</h4><p>Qï¼šä¸ºä»€ä¹ˆå¼€å¯transformçš„å…ƒç´ ä¸ä¼šå¼•èµ·å›æµå’Œé‡ç»˜ï¼Ÿ<br>Aï¼šå› ä¸ºtransformå±æ€§æ”¯æŒçš„ä½ç§»å‡½æ•°translate()ã€ç¼©æ”¾æ¯”ä¾‹å‡½æ•°scale()ã€æ–œåˆ‡å‡½æ•°skew()ã€æ—‹è½¬å‡½æ•°rotate()éƒ½æ”¯æŒçº¿æ€§æ˜ å°„çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯<code>matrix( )</code>è¡¨ç¤ºçš„æ–¹å¼ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ‰€æœ‰<code>transform</code>å®ç°çš„æ•ˆæœéƒ½å¯ä»¥å¯¹åŸåæ ‡ç³»ä¸­çš„ç‚¹<code>[x,y]</code>æŒ‰ç…§å¦‚ä¸‹çš„é½æ¬¡çŸ©é˜µè¿›è¡Œè®¡ç®—å¾—åˆ°å˜æ¢åçš„ç‚¹åæ ‡<code>[x&#39;,y&#39;]</code>ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582211853941-542e6ef7-9ecf-4ff9-85b8-95d867517878.png#align=left&display=inline&height=79&name=image.png&originHeight=104&originWidth=241&size=9375&status=done&style=none&width=184" alt="image.png"><br>é½æ¬¡çŸ©é˜µçš„ç³»æ•°æ˜¯è®¾å®š<code>transform</code>å˜æ¢æ—¶ä¼ å…¥çš„ï¼Œæ˜¯ä¸€ä¸ªå·²çŸ¥é¡¹ï¼Œè€Œä½¿ç”¨ä¸‰ç»´çš„é½æ¬¡çŸ©é˜µæ˜¯å› ä¸ºäºŒç»´åæ ‡çš„ç‚¹åœ¨å˜æ¢æ—¶ä¼šäº§ç”Ÿå¸¸æ•°é¡¹ï¼ˆä¸»è¦æ˜¯å¹³ç§»å˜æ¢ï¼‰ï¼Œè€Œå¦‚æœä»¥äºŒç»´çŸ©é˜µä½œä¸ºå‚æ•°æ¥è®¡ç®—æ—¶ï¼Œä»¥<code>x</code>åæ ‡å˜æ¢ä¸ºä¾‹ï¼Œç»“æœçš„å½¢å¼å°±æ˜¯<code>x&#39;=ax+by</code>ï¼Œå…¶ä¸­æ˜¯æ²¡æœ‰å¸¸é‡çš„ï¼Œæ‰€ä»¥åªèƒ½é‡‡ç”¨ä¸€ä¸ªä¸‰ç»´é½æ¬¡çŸ©é˜µæ¥è¡¨ç¤ºï¼Œä½†è®¡ç®—ä¸­çš„ç¬¬ä¸‰ä¸ªåæ ‡å®é™…ä¸Šå¹¶ä¸éœ€è¦ä½¿ç”¨ã€‚æ›´å¤šçš„å…³äºå˜æ¢çš„æ•°å­¦åŸç†ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥é˜…èµ„æ–™ã€‚<br>æ‰€ä»¥translformåœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­ä¸æ˜¯ä½¿ç”¨ç¼“å­˜ï¼Œè€Œæ˜¯åœ¨å›¾å±‚åˆæˆæ—¶éå†å½“å‰å±‚çš„ç‚¹ï¼Œç„¶ååˆ©ç”¨ä¸Šè¿°æ–¹æ³•è®¡ç®—å‡ºæ–°çš„åæ ‡ç‚¹å³å¯ã€‚å®ƒå¯ä»¥è§†ä¸ºä¸€ç§ä¸å›¾å±‚å†…å®¹æ— å…³çš„å˜æ¢ï¼Œå›¾å±‚ä¸­çš„å…ƒç´ é¦–æ¬¡ç”Ÿæˆçš„ä½å›¾ä¿¡æ¯ç¼“å­˜å¯ä»¥è¢«åå¤ä½¿ç”¨ã€‚æ¯”å¦‚ä¸€æ®µå¹³ç§»åŠ¨ç”»ï¼Œå¦‚æœä½¿ç”¨<code>ç»å¯¹å®šä½+æ”¹å˜leftå€¼</code>çš„æ–¹å¼æ¥å®ç°ï¼Œå°±éœ€è¦ä¸æ–­è®¡ç®—åŠ¨ç”»å…ƒç´ çš„å¸ƒå±€å¹¶æ›´æ–°å®ƒçš„åƒç´ ä¿¡æ¯ï¼Œä½†å¦‚æœä½¿ç”¨<code>translate</code>æ¥å®ç°ï¼ŒåŠ¨ç”»å…ƒç´ åœ¨æ–‡æ¡£æµä¸­çš„ä½ç½®å¹¶ä¸éœ€è¦æ”¹å˜ï¼Œæ— è®ºåç»­å¹³ç§»åˆ°å¤šè¿œï¼Œéƒ½å¯ä»¥ä½¿ç”¨ä½å›¾ç¼“å­˜ä¸­ä¿å­˜çš„åˆå§‹ä½ç½®ä¿¡æ¯ï¼Œå†åŠ ä¸Šå˜æ¢çŸ©é˜µçš„å½±å“åœ¨å±‚åˆå¹¶æ—¶è®¡ç®—å‡ºæ¥ï¼ŒåŒæ ·<strong>æ—¢ä¸å½±å“å¸ƒå±€ï¼Œä¹Ÿä¸éœ€è¦é‡ç»˜</strong>ï¼Œè¿™å°±æ˜¯å®ƒé«˜æ€§èƒ½çš„åŸå› ã€‚<br>Qï¼šä¸ºä»€ä¹ˆä½¿ç”¨opacityçš„å…ƒç´ ä¸ä¼šå¼•èµ·å›æµå’Œé‡ç»˜ï¼Ÿ<br>Aï¼š<code>opacity</code>å•è¯æ„æ€ä¸ºé€æ˜åº¦ï¼Œç›´è§‚è§†è§‰æ•ˆæœå°±æ˜¯é¢œè‰²å˜æ·¡äº†ï¼Œä½†æœ€ç»ˆæ˜¾ç¤ºçš„é¢œè‰²å…¶å®ä»ç„¶å¯ä»¥ç”¨<strong>RGB</strong>ä¸‰ä¸ªé€šé“æ¥è¡¨ç¤ºï¼Œä»æ•°å€¼è¿ç®—çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå®é™…ä¸Šè¡¨ç¤ºäº†<strong>å®ƒé‡‡ç”¨ä¸€èˆ¬æ··åˆç­–ç•¥å’Œå…¶ä»–é¢œè‰²è¿›è¡Œæ··åˆæ—¶çš„æ¯”ä¾‹</strong>ï¼Œä¹Ÿå°±æ˜¯ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582212158471-ce8e20ce-10bc-464d-adc1-a221180fb791.png#align=left&display=inline&height=50&originHeight=50&originWidth=544&size=0&status=done&style=none&width=544" alt=""><br>ä¾‹å¦‚åœ¨ç½‘é¡µé»˜è®¤çš„ç™½åº•è‰²ä¸Š<code>rgba(255,255,255)</code>æ˜¾ç¤ºä¸€ä¸ªåŒ…å«é€æ˜åº¦çš„<code>rgba(218,89,97,0.8)</code>é¢œè‰²ï¼Œ é‚£ä¹ˆé¢œè‰²çš„<strong>RGB</strong>åˆ†é‡éƒ½æŒ‰ç…§ä¸Šè¿°å…¬å¼è¿›è¡Œè®¡ç®—å°±å¾—åˆ°<code>rgb(225,122,128)</code>,ç”¨å–è‰²å™¨æ‹¾å–ä¸€ä¸‹æ¸²æŸ“å‡ºæ¥çš„ç‚¹ï¼Œç»“æœå’Œä¸Šè¿°ç†è®ºæ˜¯ä¸€è‡´çš„ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582212170227-051b23df-08a3-4c3e-8d39-78730254c405.png#align=left&display=inline&height=648&name=image.png&originHeight=666&originWidth=525&size=220613&status=done&style=none&width=511" alt="image.png"><br>æ‰€ä»¥<code>opacity</code>è¿™ä¸ªå±æ€§æœ¬èº«å°±æ˜¯ç”¨åœ¨é‡å éƒ¨åˆ†é¢œè‰²å¤„ç†çš„è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ï¼Œå¯¹äºåˆ†å±‚çš„å›¾åŸæ¥è¯´å°±å¯ä»¥çœ‹ä½œæ˜¯ä¸å›¾å±‚å†…å®¹æ— å…³çš„ç³»æ•°ï¼Œå› ä¸ºåˆæˆè¿‡ç¨‹ä¸­å½“å‰å±‚ä¸­æ‰€æœ‰åƒç´ éƒ½éœ€è¦ç»å†ä¸Šé¢çš„é¢œè‰²æ··åˆå…¬å¼ï¼Œæ‰€ä»¥<code>opacity</code>çš„åŠ¨ç”»è¿‡ç¨‹<strong>æ—¢ä¸ä¼šå½±å“å¸ƒå±€ï¼Œä¹Ÿä¸éœ€è¦é‡ç»˜ã€‚</strong>è¿™æ ·å›¾å±‚ä¸­ä¿å­˜çš„<strong>RGB</strong>åƒç´ æ•°æ®çš„ç¼“å­˜åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­ä¹Ÿå°±ä¸éœ€è¦æ›´æ–°äº†ï¼Œå¦‚æœä¸ä½¿ç”¨<code>opacity</code>å±æ€§çš„è¯ï¼Œæ¯ä¸€å¸§å¯¹äºå˜åŒ–éƒ¨åˆ†éƒ½éœ€è¦æ‰‹åŠ¨é‡è®¡ç®—<strong>RGB</strong>é¢œè‰²å€¼ï¼ˆè¿™ä¹Ÿå°±ç›¸å½“äºæ˜¯é‡ç»˜äº†ï¼‰ï¼Œå› ä¸ºè¿™äº›åŒºåŸŸçš„åƒç´ é¢œè‰²ä¸€ç›´éƒ½åœ¨å˜åŒ–ï¼Œç¼“å­˜ä¹Ÿå°±æ²¡æœ‰æ„ä¹‰ã€‚ç°åœ¨å†æ¥çœ‹çœ‹<code>opacity</code>çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œå°±ç›¸å¯¹å®¹æ˜“ç†è§£äº†ã€‚</p><h5 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h5><h5 id="opacityå’ŒtransformåŠ¨ç”»çš„é«˜æ€§èƒ½æ˜¯ç”±äºå…¶æ•°å­¦åŸç†å†³å®šäº†å¯ä»¥ä½¿ç”¨ç¼“å­˜ä¿¡æ¯ï¼Œè€Œå¹¶ä¸æ˜¯å› ä¸ºå®ƒè¢«ç¡¬ä»¶åŠ é€Ÿäº†ã€‚"><a href="#opacityå’ŒtransformåŠ¨ç”»çš„é«˜æ€§èƒ½æ˜¯ç”±äºå…¶æ•°å­¦åŸç†å†³å®šäº†å¯ä»¥ä½¿ç”¨ç¼“å­˜ä¿¡æ¯ï¼Œè€Œå¹¶ä¸æ˜¯å› ä¸ºå®ƒè¢«ç¡¬ä»¶åŠ é€Ÿäº†ã€‚" class="headerlink" title="opacityå’ŒtransformåŠ¨ç”»çš„é«˜æ€§èƒ½æ˜¯ç”±äºå…¶æ•°å­¦åŸç†å†³å®šäº†å¯ä»¥ä½¿ç”¨ç¼“å­˜ä¿¡æ¯ï¼Œè€Œå¹¶ä¸æ˜¯å› ä¸ºå®ƒè¢«ç¡¬ä»¶åŠ é€Ÿäº†ã€‚"></a><code>opacity</code>å’Œ<code>transform</code>åŠ¨ç”»çš„é«˜æ€§èƒ½æ˜¯ç”±äºå…¶æ•°å­¦åŸç†å†³å®šäº†å¯ä»¥ä½¿ç”¨ç¼“å­˜ä¿¡æ¯ï¼Œè€Œå¹¶ä¸æ˜¯å› ä¸ºå®ƒè¢«<strong>ç¡¬ä»¶åŠ é€Ÿ</strong>äº†ã€‚</h5><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/huaweicloud/p/11867409.html" target="_blank" rel="noopener">é«˜æ€§èƒ½çš„WebåŠ¨ç”»å’Œæ¸²æŸ“åŸç†</a><br>        <a href="https://www.cnblogs.com/ranyonsue/p/8296983.html" target="_blank" rel="noopener">ä½¿ç”¨CSSå¼€å¯ç¡¬ä»¶åŠ é€Ÿæé«˜æ€§èƒ½</a><br>        <a href="https://segmentfault.com/a/1190000012925872#item-6-11" target="_blank" rel="noopener">å¤åˆå›¾å±‚å’Œç®€å•å›¾å±‚</a></p><h3 id="Chromeä¸­çš„è°ƒè¯•"><a href="#Chromeä¸­çš„è°ƒè¯•" class="headerlink" title="Chromeä¸­çš„è°ƒè¯•"></a>Chromeä¸­çš„è°ƒè¯•</h3><p>Chromeçš„å¼€å‘è€…å·¥å…·ä¸­ï¼ŒPerformanceä¸­å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ¸²æŸ“è¿‡ç¨‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582212896980-635456b9-ed30-431c-993d-5b3e41864b67.png#align=left&display=inline&height=322&name=image.png&originHeight=384&originWidth=800&size=245579&status=done&style=none&width=670" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582213833661-5eaebd59-e5ec-4a25-aff7-2fa87e5dae04.png#align=left&display=inline&height=327&name=image.png&originHeight=388&originWidth=800&size=281621&status=done&style=none&width=675" alt="image.png"></p><h3 id="èµ„æºå¤–é“¾çš„ä¸‹è½½"><a href="#èµ„æºå¤–é“¾çš„ä¸‹è½½" class="headerlink" title="èµ„æºå¤–é“¾çš„ä¸‹è½½"></a>èµ„æºå¤–é“¾çš„ä¸‹è½½</h3><p>ä¸Šé¢ä»‹ç»äº†htmlè§£æï¼Œæ¸²æŸ“æµç¨‹ã€‚ä½†å®é™…ä¸Šï¼Œåœ¨è§£æhtmlæ—¶ï¼Œä¼šé‡åˆ°ä¸€äº›èµ„æºè¿æ¥ï¼Œæ­¤æ—¶å°±éœ€è¦è¿›è¡Œå•ç‹¬å¤„ç†äº†<br>ç®€å•èµ·è§ï¼Œè¿™é‡Œå°†é‡åˆ°çš„é™æ€èµ„æºåˆ†ä¸ºä¸€ä¸‹å‡ å¤§ç±»ï¼ˆæœªåˆ—ä¸¾æ‰€æœ‰ï¼‰ï¼š</p><ul><li>CSSæ ·å¼èµ„æº</li><li>JSè„šæœ¬èµ„æº</li><li>imgå›¾ç‰‡ç±»èµ„æº</li></ul><h4 id="å½“é‡åˆ°å¤–é“¾æ—¶çš„å¤„ç†"><a href="#å½“é‡åˆ°å¤–é“¾æ—¶çš„å¤„ç†" class="headerlink" title="å½“é‡åˆ°å¤–é“¾æ—¶çš„å¤„ç†"></a>å½“é‡åˆ°å¤–é“¾æ—¶çš„å¤„ç†</h4><p>å½“é‡åˆ°ä¸Šè¿°çš„å¤–é“¾æ—¶ï¼Œä¼šå•ç‹¬å¼€å¯ä¸€ä¸ªçº¿ç¨‹å»ä¸‹è½½èµ„æºï¼ˆhttp1.1ä¸­æ¯ä¸€ä¸ªèµ„æºçš„ä¸‹è½½éƒ½å¯¹åº”ä¸€ä¸ªtcp/ipè¿æ¥ï¼‰ã€‚</p><h4 id="é‡åˆ°CSSèµ„æºå¤–é“¾"><a href="#é‡åˆ°CSSèµ„æºå¤–é“¾" class="headerlink" title="é‡åˆ°CSSèµ„æºå¤–é“¾"></a>é‡åˆ°CSSèµ„æºå¤–é“¾</h4><p>CSSèµ„æºçš„å¤„ç†æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>CSSä¸‹è½½æ—¶å¼‚æ­¥ï¼Œä¸ä¼šé˜»å¡æµè§ˆå™¨æ„å»ºDOMæ ‘</li><li>ä½†æ˜¯ä¼šé˜»å¡æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯åœ¨æ„å»ºrenderæ—¶ï¼Œä¼šç­‰åˆ°cssä¸‹è½½è§£æå®Œæ¯•åæ‰è¿›è¡Œï¼ˆè¿™ç‚¹ä¸æµè§ˆå™¨ä¼˜åŒ–æœ‰å…³ï¼Œé˜²æ­¢cssè§„åˆ™ä¸æ–­æ”¹å˜ï¼Œé¿å…äº†é‡å¤çš„æ„å»ºï¼‰</li><li>æœ‰ä¾‹å¤–ï¼Œ<code>media query</code>å£°æ˜çš„CSSæ˜¯ä¸ä¼šé˜»å¡æ¸²æŸ“çš„</li></ul><h4 id="é‡åˆ°è„šæœ¬èµ„æº"><a href="#é‡åˆ°è„šæœ¬èµ„æº" class="headerlink" title="é‡åˆ°è„šæœ¬èµ„æº"></a>é‡åˆ°è„šæœ¬èµ„æº</h4><p>JSè„šæœ¬èµ„æºçš„å¤„ç†æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>é˜»å¡æµè§ˆå™¨çš„è§£æï¼Œä¹Ÿå°±æ˜¯è¯´å‘ç°ä¸€ä¸ªå¤–é“¾è„šæœ¬æ—¶ï¼Œéœ€ç­‰å¾…è„šæœ¬ä¸‹è½½å®Œæˆå¹¶æ‰§è¡Œåæ‰ä¼šç»§ç»­è§£æHTML</li><li>æµè§ˆå™¨çš„ä¼˜åŒ–ï¼Œä¸€èˆ¬ç°ä»£æµè§ˆå™¨æœ‰ä¼˜åŒ–ï¼Œåœ¨è„šæœ¬é˜»å¡æ—¶ï¼Œä¹Ÿä¼šç»§ç»­ä¸‹è½½å…¶å®ƒèµ„æºï¼ˆå½“ç„¶æœ‰å¹¶å‘ä¸Šé™ï¼‰ï¼Œä½†æ˜¯è™½ç„¶è„šæœ¬å¯ä»¥å¹¶è¡Œä¸‹è½½ï¼Œè§£æè¿‡ç¨‹ä»ç„¶æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»è¿™ä¸ªè„šæœ¬æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ¥ä¸‹æ¥çš„è§£æï¼Œå¹¶è¡Œä¸‹è½½åªæ˜¯ä¸€ç§ä¼˜åŒ–è€Œå·²</li><li>deferä¸asyncï¼Œæ™®é€šçš„è„šæœ¬æ˜¯ä¼šé˜»å¡æµè§ˆå™¨è§£æçš„ï¼Œä½†æ˜¯å¯ä»¥åŠ ä¸Šdeferæˆ–asyncå±æ€§ï¼Œè¿™æ ·è„šæœ¬å°±å˜æˆå¼‚æ­¥äº†ï¼Œå¯ä»¥ç­‰åˆ°è§£æå®Œæ¯•åå†æ‰§è¡Œ</li></ul><p>æ³¨æ„ï¼Œdeferå’Œasyncæ˜¯æœ‰åŒºåˆ«çš„ï¼š <strong>deferæ˜¯å»¶è¿Ÿæ‰§è¡Œï¼Œè€Œasyncæ˜¯å¼‚æ­¥æ‰§è¡Œã€‚</strong><br>ç®€å•çš„è¯´ï¼ˆä¸å±•å¼€ï¼‰ï¼š</p><ul><li><code>async</code>æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œå¼‚æ­¥ä¸‹è½½å®Œæ¯•åå°±ä¼šæ‰§è¡Œï¼Œä¸ç¡®ä¿æ‰§è¡Œé¡ºåºï¼Œä¸€å®šåœ¨<code>onload</code>å‰ï¼Œä½†ä¸ç¡®å®šåœ¨<code>DOMContentLoaded</code>äº‹ä»¶çš„å‰æˆ–å</li><li><code>defer</code>æ˜¯å»¶è¿Ÿæ‰§è¡Œï¼Œåœ¨æµè§ˆå™¨çœ‹èµ·æ¥çš„æ•ˆæœåƒæ˜¯å°†è„šæœ¬æ”¾åœ¨äº†<code>body</code>åé¢ä¸€æ ·ï¼ˆè™½ç„¶æŒ‰è§„èŒƒåº”è¯¥æ˜¯åœ¨<code>DOMContentLoaded</code>äº‹ä»¶å‰ï¼Œä½†å®é™…ä¸Šä¸åŒæµè§ˆå™¨çš„ä¼˜åŒ–æ•ˆæœä¸ä¸€æ ·ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨å®ƒåé¢ï¼‰</li></ul><h4 id="é‡åˆ°å›¾ç‰‡èµ„æº"><a href="#é‡åˆ°å›¾ç‰‡èµ„æº" class="headerlink" title="é‡åˆ°å›¾ç‰‡èµ„æº"></a>é‡åˆ°å›¾ç‰‡èµ„æº</h4><p>é‡åˆ°å›¾ç‰‡ç­‰èµ„æºæ—¶ï¼Œç›´æ¥å°±æ˜¯å¼‚æ­¥ä¸‹è½½ï¼Œä¸ä¼šé˜»å¡è§£æï¼Œä¸‹è½½å®Œæ¯•åç›´æ¥ç”¨å›¾ç‰‡æ›¿æ¢åŸæœ‰srcçš„åœ°æ–¹</p><h4 id="loadedå’Œdomcontentloaded"><a href="#loadedå’Œdomcontentloaded" class="headerlink" title="loadedå’Œdomcontentloaded"></a>loadedå’Œdomcontentloaded</h4><p>ç®€å•çš„å¯¹æ¯”ï¼š</p><ul><li>DOMContentLoaded äº‹ä»¶è§¦å‘æ—¶ï¼Œä»…å½“DOMåŠ è½½å®Œæˆï¼Œä¸åŒ…æ‹¬æ ·å¼è¡¨ï¼Œå›¾ç‰‡(è­¬å¦‚å¦‚æœæœ‰asyncåŠ è½½çš„è„šæœ¬å°±ä¸ä¸€å®šå®Œæˆ)ã€‚ç­‰åŒäº$(document).ready()</li><li>load äº‹ä»¶è§¦å‘æ—¶ï¼Œé¡µé¢ä¸Šæ‰€æœ‰çš„DOMï¼Œæ ·å¼è¡¨ï¼Œè„šæœ¬ï¼Œå›¾ç‰‡éƒ½å·²ç»åŠ è½½å®Œæˆäº†</li></ul><h3 id="CSSçš„å¯è§†åŒ–æ¨¡å‹"><a href="#CSSçš„å¯è§†åŒ–æ¨¡å‹" class="headerlink" title="CSSçš„å¯è§†åŒ–æ¨¡å‹"></a>CSSçš„å¯è§†åŒ–æ¨¡å‹</h3><p><strong>è¿™ä¸€éƒ¨åˆ†å†…å®¹å¾ˆå¤šå‚è€ƒã€Šç²¾é€šCSS-é«˜çº§Webæ ‡å‡†è§£å†³æ–¹æ¡ˆã€‹ä»¥åŠå‚è€ƒæ¥æº</strong><br>å‰é¢æåˆ°äº†æ•´ä½“çš„æ¸²æŸ“æ¦‚å¿µï¼Œä½†å®é™…ä¸Šæ–‡æ¡£æ ‘ä¸­çš„å…ƒç´ æ˜¯æŒ‰ä»€ä¹ˆæ¸²æŸ“è§„åˆ™æ¸²æŸ“çš„ï¼Œæ˜¯å¯ä»¥è¿›ä¸€æ­¥å±•å¼€çš„ï¼Œæ­¤éƒ¨åˆ†å†…å®¹å³ï¼š <strong>CSSçš„å¯è§†åŒ–æ ¼å¼æ¨¡å‹</strong><br>å…ˆäº†è§£ï¼š</p><ul><li>CSSä¸­è§„å®šæ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰è‡ªå·±çš„ç›’å­æ¨¡å‹ï¼ˆç›¸å½“äºè§„å®šäº†è¿™ä¸ªå…ƒç´ å¦‚ä½•æ˜¾ç¤ºï¼‰</li><li>ç„¶åå¯è§†åŒ–æ ¼å¼æ¨¡å‹åˆ™æ˜¯æŠŠè¿™äº›ç›’å­æŒ‰ç…§è§„åˆ™æ‘†æ”¾åˆ°é¡µé¢ä¸Šï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•å¸ƒå±€</li><li>æ¢å¥è¯è¯´ï¼Œç›’å­æ¨¡å‹è§„å®šäº†æ€ä¹ˆåœ¨é¡µé¢é‡Œæ‘†æ”¾ç›’å­ï¼Œç›’å­çš„ç›¸äº’ä½œç”¨ç­‰ç­‰</li></ul><p>è¯´åˆ°åº•ï¼š <strong>CSSçš„å¯è§†åŒ–æ ¼å¼æ¨¡å‹å°±æ˜¯è§„å®šäº†æµè§ˆå™¨åœ¨é¡µé¢ä¸­å¦‚ä½•å¤„ç†æ–‡æ¡£æ ‘</strong><br><strong>å…³é”®å­—ï¼š</strong></p><pre><code>åŒ…å«å—ï¼ˆContaining Blockï¼‰æ§åˆ¶æ¡†ï¼ˆControlling Boxï¼‰BFCï¼ˆBlock Formatting Contextï¼‰IFCï¼ˆInline Formatting Contextï¼‰å®šä½ä½“ç³»æµ®åŠ¨...</code></pre><p>å¦å¤–ï¼ŒCSSæœ‰ä¸‰ç§å®šä½æœºåˆ¶ï¼š<code>æ™®é€šæµ</code>ï¼Œ<code>æµ®åŠ¨</code>ï¼Œ<code>ç»å¯¹å®šä½</code>ï¼Œå¦‚æ— ç‰¹åˆ«æåŠï¼Œä¸‹æ–‡ä¸­éƒ½æ˜¯é’ˆå¯¹æ™®é€šæµä¸­çš„ã€‚</p><h4 id="åŒ…å«å—-Containing-Block"><a href="#åŒ…å«å—-Containing-Block" class="headerlink" title="åŒ…å«å—(Containing Block)"></a>åŒ…å«å—(Containing Block)</h4><p>ä¸€ä¸ªå…ƒç´ çš„boxçš„å®šä½å’Œå°ºå¯¸ï¼Œä¼šä¸æŸä¸€çŸ©å½¢æ¡†æœ‰å…³ï¼Œè¿™ä¸ªæ¡†å°±ç§°ä¹‹ä¸ºåŒ…å«å—ã€‚<br>å…ƒç´ ä¼šä¸ºå®ƒçš„å­å­™å…ƒç´ åˆ›å»ºåŒ…å«å—ï¼Œä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯è¯´å…ƒç´ çš„åŒ…å«å—å°±æ˜¯å®ƒçš„çˆ¶å…ƒç´ ï¼Œå…ƒç´ çš„åŒ…å«å—ä¸å®ƒçš„ç¥–å…ˆå…ƒç´ çš„æ ·å¼ç­‰æœ‰å…³ç³»<br>è­¬å¦‚ï¼š</p><ul><li>æ ¹å…ƒç´ æ˜¯æœ€é¡¶ç«¯çš„å…ƒç´ ï¼Œå®ƒæ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œå®ƒçš„åŒ…å«å—å°±æ˜¯åˆå§‹åŒ…å«å—</li><li>staticå’Œrelativeçš„åŒ…å«å—ç”±å®ƒæœ€è¿‘çš„å—çº§ã€å•å…ƒæ ¼æˆ–è€…è¡Œå†…å—ç¥–å…ˆå…ƒç´ çš„å†…å®¹æ¡†ï¼ˆcontentï¼‰åˆ›å»º</li><li>fixedçš„åŒ…å«å—æ˜¯å½“å‰å¯è§†çª—å£</li><li>absoluteçš„åŒ…å«å—ç”±å®ƒæœ€è¿‘çš„position å±æ€§ä¸º<code>absolute</code>ã€<code>relative</code>æˆ–è€…<code>fixed</code>çš„ç¥–å…ˆå…ƒç´ åˆ›å»º<ul><li>å¦‚æœå…¶ç¥–å…ˆå…ƒç´ æ˜¯è¡Œå†…å…ƒç´ ï¼Œåˆ™åŒ…å«å—å–å†³äºå…¶ç¥–å…ˆå…ƒç´ çš„<code>direction</code>ç‰¹æ€§</li><li>å¦‚æœç¥–å…ˆå…ƒç´ ä¸æ˜¯è¡Œå†…å…ƒç´ ï¼Œé‚£ä¹ˆåŒ…å«å—çš„åŒºåŸŸåº”è¯¥æ˜¯ç¥–å…ˆå…ƒç´ çš„å†…è¾¹è·è¾¹ç•Œ</li></ul></li></ul><h4 id="æ§åˆ¶æ¡†-Controlling-Box"><a href="#æ§åˆ¶æ¡†-Controlling-Box" class="headerlink" title="æ§åˆ¶æ¡†(Controlling Box)"></a>æ§åˆ¶æ¡†(Controlling Box)</h4><p>å—çº§å…ƒç´ å’Œå—æ¡†ä»¥åŠè¡Œå†…å…ƒç´ å’Œè¡Œæ¡†çš„ç›¸å…³æ¦‚å¿µ<br><strong>å—æ¡†:</strong></p><ul><li>å—çº§å…ƒç´ ä¼šç”Ÿæˆä¸€ä¸ªå—æ¡†ï¼ˆ<code>Block Box</code>ï¼‰ï¼Œå—æ¡†ä¼šå æ®ä¸€æ•´è¡Œï¼Œç”¨æ¥åŒ…å«å­boxå’Œç”Ÿæˆçš„å†…å®¹</li><li>å—æ¡†åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå—åŒ…å«æ¡†ï¼ˆ<code>Containing Box</code>ï¼‰ï¼Œé‡Œé¢è¦ä¹ˆåªåŒ…å«å—æ¡†ï¼Œè¦ä¹ˆåªåŒ…å«è¡Œå†…æ¡†ï¼ˆä¸èƒ½æ··æ‚ï¼‰ï¼Œå¦‚æœå—æ¡†å†…éƒ¨æœ‰å—çº§å…ƒç´ ä¹Ÿæœ‰è¡Œå†…å…ƒç´ ï¼Œé‚£ä¹ˆè¡Œå†…å…ƒç´ ä¼šè¢«åŒ¿åå—æ¡†åŒ…å›´</li></ul><p>å…³äº<strong>åŒ¿åå—æ¡†</strong>çš„ç”Ÿæˆï¼Œç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DIV</span><span class="token punctuation">></span></span>Some text  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>P</span><span class="token punctuation">></span></span>More text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>P</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DIV</span><span class="token punctuation">></span></span></code></pre><p><code>div</code>ç”Ÿæˆäº†ä¸€ä¸ªå—æ¡†ï¼ŒåŒ…å«äº†å¦ä¸€ä¸ªå—æ¡†<code>p</code>ä»¥åŠæ–‡æœ¬å†…å®¹<code>Some text</code>ï¼Œæ­¤æ—¶<code>Some text</code>æ–‡æœ¬ä¼šè¢«å¼ºåˆ¶åŠ åˆ°ä¸€ä¸ªåŒ¿åçš„å—æ¡†é‡Œé¢ï¼Œè¢«<code>div</code>ç”Ÿæˆçš„å—æ¡†åŒ…å«ï¼ˆå…¶å®è¿™ä¸ªå°±æ˜¯<code>IFC</code>ä¸­æåˆ°çš„è¡Œæ¡†ï¼ŒåŒ…å«è¿™äº›è¡Œå†…æ¡†çš„è¿™ä¸€è¡ŒåŒ¿åå—å½¢æˆçš„æ¡†ï¼Œè¡Œæ¡†å’Œè¡Œå†…æ¡†ä¸åŒï¼‰<br>æ¢å¥è¯è¯´:<br><strong>å¦‚æœä¸€ä¸ªå—æ¡†åœ¨å…¶ä¸­åŒ…å«å¦å¤–ä¸€ä¸ªå—æ¡†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¼ºè¿«å®ƒåªèƒ½åŒ…å«å—æ¡†ï¼Œå› æ­¤å…¶å®ƒæ–‡æœ¬å†…å®¹ç”Ÿæˆå‡ºæ¥çš„éƒ½æ˜¯åŒ¿åå—æ¡†ï¼ˆè€Œä¸æ˜¯åŒ¿åè¡Œå†…æ¡†ï¼‰</strong><br><strong>**è¡Œå†…æ¡†ï¼š</strong></p><ul><li>ä¸€ä¸ªè¡Œå†…å…ƒç´ ç”Ÿæˆä¸€ä¸ªè¡Œå†…æ¡†</li><li>è¡Œå†…å…ƒç´ èƒ½æ’åœ¨ä¸€è¡Œï¼Œå…è®¸å·¦å³æœ‰å…¶å®ƒå…ƒç´ </li></ul><p>å…³äº<strong>åŒ¿åè¡Œå†…æ¡†</strong>çš„ç”Ÿæˆï¼Œç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>P</span><span class="token punctuation">></span></span>Some <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EM</span><span class="token punctuation">></span></span>emphasized<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EM</span><span class="token punctuation">></span></span> text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>P</span><span class="token punctuation">></span></span></code></pre><p><code>P</code>å…ƒç´ ç”Ÿæˆä¸€ä¸ªå—æ¡†ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªè¡Œå†…æ¡†ï¼ˆå¦‚<code>EM</code>ï¼‰ï¼Œä»¥åŠæ–‡æœ¬<code>Some</code>ï¼Œ<code>text</code>ï¼Œæ­¤æ—¶ä¼šä¸“é—¨ä¸ºè¿™äº›æ–‡æœ¬ç”ŸæˆåŒ¿åè¡Œå†…æ¡†ã€‚<br><strong>displayå±æ€§çš„å½±å“</strong><br><code>display</code>çš„å‡ ä¸ªå±æ€§ä¹Ÿå¯ä»¥å½±å“ä¸åŒæ¡†çš„ç”Ÿæˆï¼š</p><ul><li><code>block</code>ï¼Œå…ƒç´ ç”Ÿæˆä¸€ä¸ªå—æ¡†</li><li><code>inline</code>ï¼Œå…ƒç´ äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªçš„è¡Œå†…æ¡†</li><li><code>inline-block</code>ï¼Œå…ƒç´ äº§ç”Ÿä¸€ä¸ªè¡Œå†…çº§å—æ¡†ï¼Œè¡Œå†…å—æ¡†çš„å†…éƒ¨ä¼šè¢«å½“ä½œå—å—æ¥æ ¼å¼åŒ–ï¼Œè€Œæ­¤å…ƒç´ æœ¬èº«ä¼šè¢«å½“ä½œè¡Œå†…çº§æ¡†æ¥æ ¼å¼åŒ–ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿ<code>BFC</code>ï¼‰</li><li><code>none</code>ï¼Œä¸ç”Ÿæˆæ¡†ï¼Œä¸å†æ ¼å¼åŒ–ç»“æ„ä¸­ï¼Œå½“ç„¶äº†ï¼Œå¦ä¸€ä¸ª<code>visibility: hidden</code>åˆ™ä¼šäº§ç”Ÿä¸€ä¸ªä¸å¯è§çš„æ¡†</li></ul><p>æ€»ç»“ï¼š</p><ul><li>å¦‚æœä¸€ä¸ªæ¡†é‡Œï¼Œæœ‰ä¸€ä¸ªå—çº§å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¡†é‡Œçš„å†…å®¹éƒ½ä¼šè¢«å½“ä½œå—æ¡†æ¥è¿›è¡Œæ ¼å¼åŒ–ï¼Œå› ä¸ºåªè¦å‡ºç°äº†å—çº§å…ƒç´ ï¼Œå°±ä¼šå°†é‡Œé¢çš„å†…å®¹åˆ†å—å‡ å—ï¼Œæ¯ä¸€å—ç‹¬å ä¸€è¡Œï¼ˆå‡ºç°è¡Œå†…å¯ä»¥ç”¨åŒ¿åå—æ¡†è§£å†³ï¼‰</li><li>å¦‚æœä¸€ä¸ªæ¡†é‡Œï¼Œæ²¡æœ‰ä»»ä½•å—çº§å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¡†é‡Œçš„å†…å®¹ä¼šè¢«å½“æˆè¡Œå†…æ¡†æ¥æ ¼å¼åŒ–ï¼Œå› ä¸ºé‡Œé¢çš„å†…å®¹æ˜¯æŒ‰ç…§é¡ºåºæˆè¡Œçš„æ’åˆ—ã€‚</li></ul><h4 id="BFC-Block-Formatting-Context"><a href="#BFC-Block-Formatting-Context" class="headerlink" title="BFC(Block Formatting Context)"></a>BFC(Block Formatting Context)</h4><p>å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚<br>FCå³æ ¼å¼ä¸Šä¸‹æ–‡ï¼Œå®ƒå®šä¹‰æ¡†å†…éƒ¨çš„å…ƒç´ æ¸²æŸ“è§„åˆ™ï¼Œæ¯”è¾ƒæŠ½è±¡ï¼Œè­¬å¦‚ï¼š</p><pre><code>FCåƒæ˜¯ä¸€ä¸ªå¤§ç®±å­ï¼Œé‡Œé¢è£…æœ‰å¾ˆå¤šå…ƒç´ ç®±å­å¯ä»¥éš”å¼€é‡Œé¢çš„å…ƒç´ å’Œå¤–é¢çš„å…ƒç´ ï¼ˆæ‰€ä»¥å¤–éƒ¨å¹¶ä¸ä¼šå½±å“FCå†…éƒ¨çš„æ¸²æŸ“ï¼‰å†…éƒ¨çš„è§„åˆ™å¯ä»¥æ˜¯ï¼šå¦‚ä½•å®šä½ï¼Œå®½é«˜è®¡ç®—ï¼ŒmarginæŠ˜å ç­‰ç­‰</code></pre><p>ä¸åŒç±»å‹çš„æ¡†å‚ä¸çš„FCç±»å‹ä¸åŒï¼Œè­¬å¦‚å—çº§æ¡†å¯¹åº”BFCï¼Œè¡Œå†…æ¡†å¯¹åº”IFC<br><strong>æ³¨æ„ï¼Œå¹¶ä¸æ˜¯è¯´æ‰€æœ‰çš„æ¡†éƒ½ä¼šäº§ç”ŸFCï¼Œè€Œæ˜¯ç¬¦åˆç‰¹å®šæ¡ä»¶æ‰ä¼šäº§ç”Ÿï¼Œåªæœ‰äº§ç”Ÿäº†å¯¹åº”çš„FCåæ‰ä¼šåº”ç”¨å¯¹åº”æ¸²æŸ“è§„åˆ™</strong><br><strong>BFCè§„åˆ™ï¼š</strong></p><pre><code>åœ¨å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­æ¯ä¸€ä¸ªå…ƒç´ å·¦å¤–è¾¹ä¸åŒ…å«å—çš„å·¦è¾¹ç›¸æ¥è§¦ï¼ˆå¯¹äºä»å³åˆ°å·¦çš„æ ¼å¼åŒ–ï¼Œå³å¤–è¾¹æ¥è§¦å³è¾¹ï¼‰å³ä½¿å­˜åœ¨æµ®åŠ¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼ˆæ‰€ä»¥æµ®åŠ¨å…ƒç´ æ­£å¸¸ä¼šç›´æ¥è´´è¿‘å®ƒçš„åŒ…å«å—çš„å·¦è¾¹ï¼Œä¸æ™®é€šå…ƒç´ é‡åˆï¼‰é™¤éè¿™ä¸ªå…ƒç´ ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„BFC</code></pre><p>æ€»ç»“å‡ ç‚¹BFCç‰¹ç‚¹ï¼š</p><ol><li>å†…éƒ¨<code>box</code>åœ¨å‚ç›´æ–¹å‘ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ”¾ç½®</li><li>boxçš„å‚ç›´æ–¹å‘ç”±<code>margin</code>å†³å®šï¼Œå±äºåŒä¸€ä¸ªBFCçš„ä¸¤ä¸ªboxé—´çš„marginä¼šé‡å </li><li>BFCåŒºåŸŸä¸ä¼šä¸<code>float box</code>é‡å ï¼ˆå¯ç”¨äºæ’ç‰ˆ)</li><li>BFCå°±æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å­å…ƒç´ ä¸ä¼šå½±å“åˆ°å¤–é¢çš„å…ƒç´ ã€‚åä¹‹ä¹Ÿå¦‚æ­¤</li><li>è®¡ç®—BFCçš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—ï¼ˆä¸ä¼šæµ®åŠ¨åå¡Œï¼‰</li></ol><p>å¦‚ä½•è§¦å‘BFCï¼Ÿ</p><ol><li>æ ¹å…ƒç´ </li><li><code>float</code>å±æ€§ä¸ä¸º<code>none</code></li><li><code>position</code>ä¸º<code>absolute</code>æˆ–<code>fixed</code></li><li><code>display</code>ä¸º<code>inline-block</code>, <code>flex</code>, <code>inline-flex</code>ï¼Œ<code>table</code>ï¼Œ<code>table-cell</code>ï¼Œ<code>table-caption</code></li><li><code>overflow</code>ä¸ä¸º<code>visible</code></li></ol><p>è¿™é‡Œæä¸‹ï¼Œ<code>display: table</code>ï¼Œå®ƒæœ¬èº«ä¸äº§ç”ŸBFCï¼Œä½†æ˜¯å®ƒä¼šäº§ç”ŸåŒ¿åæ¡†ï¼ˆåŒ…å«<code>display: table-cell</code>çš„æ¡†ï¼‰ï¼Œè€Œè¿™ä¸ªåŒ¿åæ¡†äº§ç”ŸBFCã€‚<br>æ›´å¤šè¯·è‡ªè¡Œåœ¨ç½‘ä¸Šæœç´¢ã€‚</p><h4 id="IFC-Inline-Formatting-Context"><a href="#IFC-Inline-Formatting-Context" class="headerlink" title="IFC(Inline Formatting Context)"></a>IFC(Inline Formatting Context)</h4><p>IFCå³è¡Œå†…æ¡†äº§ç”Ÿçš„æ ¼å¼ä¸Šä¸‹æ–‡<br><strong>IFCè§„åˆ™</strong></p><pre><code>åœ¨è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­æ¡†ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ°´å¹³æ’åˆ—ï¼Œèµ·ç‚¹æ˜¯åŒ…å«å—çš„é¡¶éƒ¨ã€‚æ°´å¹³æ–¹å‘ä¸Šçš„ marginï¼Œborder å’Œ padding åœ¨æ¡†ä¹‹é—´å¾—åˆ°ä¿ç•™æ¡†åœ¨å‚ç›´æ–¹å‘ä¸Šå¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å¯¹é½ï¼šå®ƒä»¬çš„é¡¶éƒ¨æˆ–åº•éƒ¨å¯¹é½ï¼Œæˆ–æ ¹æ®å…¶ä¸­æ–‡å­—çš„åŸºçº¿å¯¹é½</code></pre><p><strong>è¡Œæ¡†</strong><br><strong>åŒ…å«é‚£äº›æ¡†çš„é•¿æ–¹å½¢åŒºåŸŸï¼Œä¼šå½¢æˆä¸€è¡Œï¼Œå«åšè¡Œæ¡†</strong><br>è¡Œæ¡†çš„å®½åº¦ç”±å®ƒçš„åŒ…å«å—å’Œå…¶ä¸­çš„æµ®åŠ¨å…ƒç´ å†³å®šï¼Œé«˜åº¦çš„ç¡®å®šç”±è¡Œé«˜åº¦è®¡ç®—è§„åˆ™å†³å®š<br>è¡Œæ¡†çš„è§„åˆ™ï¼š</p><pre><code>å¦‚æœå‡ ä¸ªè¡Œå†…æ¡†åœ¨æ°´å¹³æ–¹å‘æ— æ³•æ”¾å…¥ä¸€ä¸ªè¡Œæ¡†å†…ï¼Œå®ƒä»¬å¯ä»¥åˆ†é…åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªå‚ç›´å †å çš„è¡Œæ¡†ä¸­ï¼ˆå³è¡Œå†…æ¡†çš„åˆ†å‰²ï¼‰è¡Œæ¡†åœ¨å †å æ—¶æ²¡æœ‰å‚ç›´æ–¹å‘ä¸Šçš„åˆ†å‰²ä¸”æ°¸ä¸é‡å è¡Œæ¡†çš„é«˜åº¦æ€»æ˜¯è¶³å¤Ÿå®¹çº³æ‰€åŒ…å«çš„æ‰€æœ‰æ¡†ã€‚ä¸è¿‡ï¼Œå®ƒå¯èƒ½é«˜äºå®ƒåŒ…å«çš„æœ€é«˜çš„æ¡†ï¼ˆä¾‹å¦‚ï¼Œæ¡†å¯¹é½ä¼šå¼•èµ·åŸºçº¿å¯¹é½ï¼‰è¡Œæ¡†çš„å·¦è¾¹æ¥è§¦åˆ°å…¶åŒ…å«å—çš„å·¦è¾¹ï¼Œå³è¾¹æ¥è§¦åˆ°å…¶åŒ…å«å—çš„å³è¾¹ã€‚</code></pre><p><strong>ç»“åˆè¡¥å……ä¸‹IFCè§„åˆ™ï¼š</strong></p><pre><code>æµ®åŠ¨å…ƒç´ å¯èƒ½ä¼šå¤„äºåŒ…å«å—è¾¹ç¼˜å’Œè¡Œæ¡†è¾¹ç¼˜ä¹‹é—´å°½ç®¡åœ¨ç›¸åŒçš„è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­çš„è¡Œæ¡†é€šå¸¸æ‹¥æœ‰ç›¸åŒçš„å®½åº¦ï¼ˆåŒ…å«å—çš„å®½åº¦ï¼‰ï¼Œå®ƒä»¬å¯èƒ½ä¼šå› æµ®åŠ¨å…ƒç´ ç¼©çŸ­äº†å¯ç”¨å®½åº¦ï¼Œè€Œåœ¨å®½åº¦ä¸Šå‘ç”Ÿå˜åŒ–åŒä¸€è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­çš„è¡Œæ¡†é€šå¸¸é«˜åº¦ä¸ä¸€æ ·ï¼ˆå¦‚ï¼Œä¸€è¡ŒåŒ…å«äº†ä¸€ä¸ªé«˜çš„å›¾å½¢ï¼Œè€Œå…¶å®ƒè¡ŒåªåŒ…å«æ–‡æœ¬ï¼‰å½“ä¸€è¡Œä¸­è¡Œå†…æ¡†å®½åº¦çš„æ€»å’Œå°äºåŒ…å«å®ƒä»¬çš„è¡Œæ¡†çš„å®½ï¼Œå®ƒä»¬åœ¨æ°´å¹³æ–¹å‘ä¸Šçš„å¯¹é½ï¼Œå–å†³äº `text-align` ç‰¹æ€§ç©ºçš„è¡Œå†…æ¡†åº”è¯¥è¢«å¿½ç•¥å³ä¸åŒ…å«æ–‡æœ¬ï¼Œä¿ç•™ç©ºç™½ç¬¦ï¼Œmargin/padding/borderé0çš„è¡Œå†…å…ƒç´ ï¼Œä»¥åŠå…¶ä»–å¸¸è§„æµä¸­çš„å†…å®¹(æ¯”å¦‚ï¼Œå›¾ç‰‡ï¼Œinline blocks å’Œ inline tables)ï¼Œå¹¶ä¸”ä¸æ˜¯ä»¥æ¢è¡Œç»“æŸçš„è¡Œæ¡†ï¼Œå¿…é¡»è¢«å½“ä½œé›¶é«˜åº¦è¡Œæ¡†å¯¹å¾…</code></pre><p>æ€»ç»“ï¼š</p><ul><li>è¡Œå†…å…ƒç´ æ€»æ˜¯ä¼šåº”ç”¨IFCæ¸²æŸ“è§„åˆ™</li><li>è¡Œå†…å…ƒç´ ä¼šåº”ç”¨IFCè§„åˆ™æ¸²æŸ“ï¼Œè­¬å¦‚<code>text-align</code>å¯ä»¥ç”¨æ¥å±…ä¸­ç­‰</li><li>å—æ¡†å†…éƒ¨ï¼Œå¯¹äºæ–‡æœ¬è¿™ç±»çš„åŒ¿åå…ƒç´ ï¼Œä¼šäº§ç”ŸåŒ¿åè¡Œæ¡†åŒ…å›´ï¼Œè€Œè¡Œæ¡†å†…éƒ¨å°±åº”ç”¨IFCæ¸²æŸ“è§„åˆ™</li><li>è¡Œå†…æ¡†å†…éƒ¨ï¼Œå¯¹äºé‚£äº›è¡Œå†…å…ƒç´ ï¼Œä¸€æ ·åº”ç”¨IFCæ¸²æŸ“è§„åˆ™</li><li>å¦å¤–ï¼Œ<code>inline-block</code>ï¼Œä¼šåœ¨å…ƒç´ å¤–å±‚äº§ç”ŸIFCï¼ˆæ‰€ä»¥è¿™ä¸ªå…ƒç´ æ˜¯å¯ä»¥é€šè¿‡<code>text-align</code>æ°´å¹³å±…ä¸­çš„ï¼‰ï¼Œå½“ç„¶ï¼Œå®ƒå†…éƒ¨åˆ™æŒ‰ç…§BFCè§„åˆ™æ¸²æŸ“</li></ul><p>ç›¸æ¯”BFCè§„åˆ™æ¥è¯´ï¼ŒIFCå¯èƒ½æ›´åŠ æŠ½è±¡ï¼ˆå› ä¸ºæ²¡æœ‰é‚£ä¹ˆæ¡ç†æ¸…æ™°çš„è§„åˆ™å’Œè§¦å‘æ¡ä»¶ï¼‰<br>ä½†æ€»çš„æ¥è¯´ï¼Œå®ƒå°±æ˜¯è¡Œå†…å…ƒç´ è‡ªèº«å¦‚ä½•æ˜¾ç¤ºä»¥åŠåœ¨æ¡†å†…å¦‚ä½•æ‘†æ”¾çš„æ¸²æŸ“è§„åˆ™ï¼Œè¿™æ ·æè¿°åº”è¯¥æ›´å®¹æ˜“ç†è§£ã€‚</p><h4 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h4><p>å½“ç„¶è¿˜æœ‰æœ‰ä¸€äº›å…¶å®ƒå†…å®¹ï¼š</p><ul><li>è­¬å¦‚å¸¸è§„æµï¼Œæµ®åŠ¨ï¼Œç»å¯¹å®šä½ç­‰åŒºåˆ«</li><li>è­¬å¦‚æµ®åŠ¨å…ƒç´ ä¸åŒ…å«åœ¨å¸¸è§„æµä¸­</li><li>è­¬å¦‚ç›¸å¯¹å®šä½ï¼Œç»å¯¹å®šä½ï¼Œ<code>Fixed</code>å®šä½ç­‰åŒºåˆ«</li><li>è­¬å¦‚<code>z-index</code>çš„åˆ†å±‚æ˜¾ç¤ºæœºåˆ¶ç­‰</li></ul><p>è¿™é‡Œä¸ä¸€ä¸€å±•å¼€ï¼Œæ›´å¤šè¯·å‚è€ƒï¼š<a href="https://bbs.csdn.net/topics/340204423" target="_blank" rel="noopener">https://bbs.csdn.net/topics/340204423</a></p><h3 id="JSå¼•æ“è§£æè¿‡ç¨‹"><a href="#JSå¼•æ“è§£æè¿‡ç¨‹" class="headerlink" title="JSå¼•æ“è§£æè¿‡ç¨‹"></a>JSå¼•æ“è§£æè¿‡ç¨‹</h3><p>å‰é¢æœ‰æåˆ°é‡åˆ°JSè„šæœ¬æ—¶ï¼Œä¼šç­‰åˆ°å®ƒçš„æ‰§è¡Œï¼Œå®é™…ä¸Šæ˜¯éœ€è¦å¼•æ“è§£æçš„ï¼Œè¿™é‡Œå±•å¼€æè¿°ï¼ˆä»‹ç»ä¸»å¹²æµç¨‹ï¼‰ã€‚</p><h4 id="JSçš„è§£é‡Šé˜¶æ®µ"><a href="#JSçš„è§£é‡Šé˜¶æ®µ" class="headerlink" title="JSçš„è§£é‡Šé˜¶æ®µ"></a>JSçš„è§£é‡Šé˜¶æ®µ</h4><p>é¦–å…ˆå¾—æ˜ç¡®ï¼š <strong>JSæ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œæ‰€ä»¥å®ƒæ— éœ€æå‰ç¼–è¯‘ï¼Œè€Œæ˜¯ç”±è§£é‡Šå™¨å®æ—¶è¿è¡Œ</strong><br>å¼•æ“å¯¹JSçš„å¤„ç†è¿‡ç¨‹å¯ä»¥ç®€è¿°å¦‚ä¸‹ï¼š</p><ol><li>è¯»å–ä»£ç ï¼Œè¿›è¡Œè¯æ³•åˆ†æ(Lexical analysis)ï¼Œç„¶åå°†ä»£ç åˆ†è§£ä¸ºè¯å…ƒtokenã€‚</li><li>å¯¹è¯å…ƒtokenè¿›è¡Œè¯­æ³•åˆ†æ(parsing)ï¼Œç„¶åå°†ä»£ç æ•´ç†å‡ºè¯­æ³•æ ‘(syntax tree)ã€‚</li><li>ä½¿ç”¨ç¿»è¯‘å™¨(translator)ï¼Œå°†ä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç (bytecode)</li><li>ä½¿ç”¨å­—èŠ‚ç è§£é‡Šå™¨(bytecode interpreter)ï¼Œå°†å­—èŠ‚ç è½¬ä¸ºæœºå™¨ç ã€‚</li></ol><p>æœ€ç»ˆè®¡ç®—æœºæ‰§è¡Œçš„å°±æ˜¯æœºå™¨ç ã€‚<br>ä¸ºäº†æé«˜è¿è¡Œé€Ÿåº¦ï¼Œç°ä»£æµè§ˆå™¨ä¸€èˆ¬é‡‡ç”¨å³æ—¶ç¼–è¯‘ï¼ˆ<code>JIT-Just In Time compiler</code>ï¼‰ã€‚<br>å³å­—èŠ‚ç åªåœ¨è¿è¡Œæ—¶ç¼–è¯‘ï¼Œç”¨åˆ°å“ªä¸€è¡Œå°±ç¼–è¯‘å“ªä¸€è¡Œï¼Œå¹¶ä¸”æŠŠç¼–è¯‘ç»“æœç¼“å­˜ï¼ˆ<code>inline cache</code>ï¼‰ã€‚<br>è¿™æ ·æ•´ä¸ªç¨‹åºçš„è¿è¡Œé€Ÿåº¦èƒ½å¾—åˆ°æ˜¾è‘—æå‡ã€‚<br>è€Œä¸”ï¼Œä¸åŒæµè§ˆå™¨ç­–ç•¥å¯èƒ½è¿˜ä¸åŒï¼Œæœ‰çš„æµè§ˆå™¨å°±çœç•¥äº†å­—èŠ‚ç çš„ç¿»è¯‘æ­¥éª¤ï¼Œç›´æ¥è½¬ä¸ºæœºå™¨ç ï¼ˆå¦‚chromeçš„v8ï¼‰<br>æ€»ç»“èµ·æ¥å¯ä»¥è®¤ä¸ºæ˜¯ï¼š <strong>æ ¸å¿ƒçš„<code>JIT</code>ç¼–è¯‘å™¨å°†æºç ç¼–è¯‘æˆæœºå™¨ç è¿è¡Œã€‚</strong></p><h4 id="JSçš„é¢„å¤„ç†é˜¶æ®µ"><a href="#JSçš„é¢„å¤„ç†é˜¶æ®µ" class="headerlink" title="JSçš„é¢„å¤„ç†é˜¶æ®µ"></a>JSçš„é¢„å¤„ç†é˜¶æ®µ</h4><p>ä¸Šè¿°å°†çš„æ˜¯è§£é‡Šå™¨çš„æ•´ä½“è¿‡ç¨‹ï¼Œè¿™é‡Œå†æä¸‹åœ¨æ­£å¼æ‰§è¡ŒJSå‰ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªé¢„å¤„ç†é˜¶æ®µ<br>ï¼ˆè­¬å¦‚å˜é‡æå‡ï¼Œåˆ†å·è¡¥å…¨ç­‰ï¼‰<br>é¢„å¤„ç†é˜¶æ®µä¼šåšä¸€äº›äº‹æƒ…ï¼Œç¡®ä¿JSå¯ä»¥æ­£ç¡®æ‰§è¡Œï¼Œè¿™é‡Œä»…æéƒ¨åˆ†ï¼š<br><strong>åˆ†å·è¡¥å…¨</strong><br>JSæ‰§è¡Œæ˜¯éœ€è¦åˆ†å·çš„ï¼Œä½†ä¸ºä»€ä¹ˆä»¥ä¸‹è¯­å¥å´å¯ä»¥æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿ</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span></code></pre><p>åŸå› å°±æ˜¯JSè§£é‡Šå™¨æœ‰ä¸€ä¸ª<a href="http://inimino.org/~inimino/blog/javascript_semicolons" target="_blank" rel="noopener">Semicolon Insertion</a>è§„åˆ™ï¼Œå®ƒä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™ï¼Œåœ¨é€‚å½“çš„ä½ç½®è¡¥å……åˆ†å·<br>è­¬å¦‚åˆ—ä¸¾å‡ æ¡è‡ªåŠ¨åŠ åˆ†å·çš„è§„åˆ™ï¼š</p><ul><li>å½“æœ‰æ¢è¡Œç¬¦ï¼ˆåŒ…æ‹¬å«æœ‰æ¢è¡Œç¬¦çš„å¤šè¡Œæ³¨é‡Šï¼‰ï¼Œå¹¶ä¸”ä¸‹ä¸€ä¸ª<code>token</code>æ²¡æ³•è·Ÿå‰é¢çš„è¯­æ³•åŒ¹é…æ—¶ï¼Œä¼šè‡ªåŠ¨è¡¥åˆ†å·ã€‚</li><li>å½“æœ‰<code>}</code>æ—¶ï¼Œå¦‚æœç¼ºå°‘åˆ†å·ï¼Œä¼šè¡¥åˆ†å·ã€‚</li><li>ç¨‹åºæºä»£ç ç»“æŸæ—¶ï¼Œå¦‚æœç¼ºå°‘åˆ†å·ï¼Œä¼šè¡¥åˆ†å·ã€‚</li></ul><p>äºæ˜¯ï¼Œä¸Šè¿°çš„ä»£ç å°±å˜æˆäº†</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ‰€ä»¥å¯ä»¥æ­£å¸¸è¿è¡Œ<br>å½“ç„¶äº†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç»å…¸çš„ä¾‹å­ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span>    <span class="token punctuation">{</span>        a<span class="token punctuation">:</span> <span class="token string">'a'</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç”±äºåˆ†å·è¡¥å…¨æœºåˆ¶ï¼Œæ‰€ä»¥å®ƒå˜æˆäº†ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">{</span>        a<span class="token punctuation">:</span> <span class="token string">'a'</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ‰€ä»¥è¿è¡Œåæ˜¯<code>undefined</code></p><h5 id="å˜é‡æå‡"><a href="#å˜é‡æå‡" class="headerlink" title="å˜é‡æå‡"></a>å˜é‡æå‡</h5><p>ä¸€èˆ¬åŒ…æ‹¬å‡½æ•°æå‡å’Œå˜é‡æå‡<br>è­¬å¦‚ï¼š</p><pre class=" language-javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> a<span class="token punctuation">;</span></code></pre><p>ç»è¿‡å˜é‡æå‡åï¼Œå°±å˜æˆï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> a<span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™é‡Œæ²¡æœ‰å±•å¼€ï¼Œå…¶å®å±•å¼€ä¹Ÿå¯ä»¥ç‰µæ¶‰åˆ°å¾ˆå¤šå†…å®¹çš„<br>è­¬å¦‚å¯ä»¥æä¸‹å˜é‡å£°æ˜ï¼Œå‡½æ•°å£°æ˜ï¼Œå½¢å‚ï¼Œå®å‚çš„ä¼˜å…ˆçº§é¡ºåºï¼Œä»¥åŠes6ä¸­letæœ‰å…³çš„ä¸´æ—¶æ­»åŒºç­‰ã€‚</p><h4 id="JSçš„æ‰§è¡Œé˜¶æ®µ"><a href="#JSçš„æ‰§è¡Œé˜¶æ®µ" class="headerlink" title="JSçš„æ‰§è¡Œé˜¶æ®µ"></a>JSçš„æ‰§è¡Œé˜¶æ®µ</h4><p>æ­¤é˜¶æ®µçš„å†…å®¹ä¸­çš„å›¾ç‰‡æ¥æºï¼š<a href="http://www.cnblogs.com/TomXu/archive/2012/01/12/2308594.html" target="_blank" rel="noopener">æ·±å…¥ç†è§£JavaScriptç³»åˆ—ï¼ˆ10ï¼‰ï¼šJavaScriptæ ¸å¿ƒï¼ˆæ™‹çº§é«˜æ‰‹å¿…è¯»ç¯‡ï¼‰</a><br>è¿™é‡Œè¿˜æœ‰ä¸€ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©å¤§å®¶ç†è§£ï¼š<a href="https://www.yuque.com/walter-glskq/zf7grn/xhnw6t" target="_blank" rel="noopener">ä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾</a><br>è§£é‡Šå™¨è§£é‡Šå®Œè¯­æ³•è§„åˆ™åï¼Œå°±å¼€å§‹æ‰§è¡Œï¼Œç„¶åæ•´ä¸ªæ‰§è¡Œæµç¨‹ä¸­å¤§è‡´åŒ…å«ä»¥ä¸‹æ¦‚å¿µï¼š</p><ul><li>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ‰§è¡Œå †æ ˆæ¦‚å¿µï¼ˆå¦‚å…¨å±€ä¸Šä¸‹æ–‡ï¼Œå½“å‰æ´»åŠ¨ä¸Šä¸‹æ–‡ï¼‰</li><li>VOï¼ˆå˜é‡å¯¹è±¡ï¼‰å’ŒAOï¼ˆæ´»åŠ¨å¯¹è±¡ï¼‰</li><li>ä½œç”¨åŸŸé“¾</li><li>thisæœºåˆ¶ç­‰</li></ul><p>è¿™äº›æ¦‚å¿µå¦‚æœæ·±å…¥è®²è§£çš„è¯å†…å®¹è¿‡å¤šï¼Œå› æ­¤è¿™é‡Œä»…æåŠéƒ¨åˆ†ç‰¹æ€§<br><strong>æ‰§è¡Œä¸Šä¸‹æ–‡ç®€å•è§£é‡Š</strong></p><ul><li>JSæœ‰<code>æ‰§è¡Œä¸Šä¸‹æ–‡</code>ï¼‰</li><li>æµè§ˆå™¨é¦–æ¬¡è½½å…¥è„šæœ¬ï¼Œå®ƒå°†åˆ›å»º<code>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</code>ï¼Œå¹¶å‹å…¥æ‰§è¡Œæ ˆæ ˆé¡¶ï¼ˆä¸å¯è¢«å¼¹å‡ºï¼‰</li><li>ç„¶åæ¯è¿›å…¥å…¶å®ƒä½œç”¨åŸŸå°±åˆ›å»ºå¯¹åº”çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶æŠŠå®ƒå‹å…¥æ‰§è¡Œæ ˆçš„é¡¶éƒ¨</li><li>ä¸€æ—¦å¯¹åº”çš„ä¸Šä¸‹æ–‡æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä»æ ˆé¡¶å¼¹å‡ºï¼Œå¹¶å°†ä¸Šä¸‹æ–‡æ§åˆ¶æƒäº¤ç»™å½“å‰çš„æ ˆã€‚</li><li>è¿™æ ·ä¾æ¬¡æ‰§è¡Œï¼ˆæœ€ç»ˆéƒ½ä¼šå›åˆ°å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰</li></ul><p>è­¬å¦‚ï¼Œå¦‚æœç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œè¢«å¼¹å‡ºæ‰§è¡Œæ ˆï¼Œç„¶åæœ‰æ²¡æœ‰è¢«å¼•ç”¨ï¼ˆæ²¡æœ‰å½¢æˆé—­åŒ…ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°ä¸­ç”¨åˆ°çš„å†…å­˜å°±ä¼šè¢«åƒåœ¾å¤„ç†å™¨è‡ªåŠ¨å›æ”¶ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582215760520-0c77076a-b9cb-4faf-bbd7-5ad55a280dab.png#align=left&display=inline&height=121&name=image.png&originHeight=87&originWidth=463&size=12701&status=done&style=none&width=645" alt="image.png"><br>ç„¶åæ‰§è¡Œä¸Šä¸‹æ–‡ä¸VOï¼Œä½œç”¨åŸŸé“¾ï¼Œthisçš„å…³ç³»æ˜¯ï¼š<br>æ¯ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œéƒ½æœ‰ä¸‰ä¸ªé‡è¦å±æ€§ï¼š</p><ul><li>å˜é‡å¯¹è±¡(<code>Variable objectï¼ŒVO</code>)</li><li>ä½œç”¨åŸŸé“¾(<code>Scope chain</code>)</li><li><code>this</code></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582215788358-fef25608-d3dd-4e04-b095-25a7a7a1506d.png#align=left&display=inline&height=124&name=image.png&originHeight=249&originWidth=340&size=19930&status=done&style=none&width=170" alt="image.png">)<img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582215790249-c0df6d34-c43b-46a3-95e4-6b833f98a441.png#align=left&display=inline&height=124&name=image.png&originHeight=249&originWidth=340&size=19930&status=done&style=none&width=170" alt="image.png">)<img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582215794216-77f5ef5b-0e64-45c1-9c9e-edcd661ef061.png#align=left&display=inline&height=124&name=image.png&originHeight=249&originWidth=340&size=19930&status=done&style=none&width=170" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582215805673-78c3d36c-89c4-44c8-952a-b89583bc24ca.png#align=left&display=inline&height=287&name=image.png&originHeight=249&originWidth=340&size=19930&status=done&style=none&width=392" alt="image.png"><br><strong>VOä¸AO</strong><br>VOæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡çš„å±æ€§ï¼ˆæŠ½è±¡æ¦‚å¿µï¼‰ï¼Œä½†æ˜¯<strong>åªæœ‰å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡å…è®¸é€šè¿‡VOçš„å±æ€§åç§°æ¥é—´æ¥è®¿é—®ï¼ˆå› ä¸ºåœ¨å…¨å±€ä¸Šä¸‹æ–‡é‡Œï¼Œå…¨å±€å¯¹è±¡è‡ªèº«å°±æ˜¯å˜é‡å¯¹è±¡ï¼‰</strong><br>AOï¼ˆ<code>activation object</code>)ï¼Œå½“å‡½æ•°è¢«è°ƒç”¨è€…æ¿€æ´»ï¼ŒAOå°±è¢«åˆ›å»ºäº†<br>å¯ä»¥ç†è§£ä¸ºï¼š</p><ul><li>åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼š<code>VO === AO</code></li><li>åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼š<code>VO === this === global</code></li></ul><p>æ€»çš„æ¥è¯´ï¼ŒVOä¸­ä¼šå­˜æ”¾ä¸€äº›å˜é‡ä¿¡æ¯ï¼ˆå¦‚å£°æ˜çš„å˜é‡ï¼Œå‡½æ•°ï¼Œ<code>arguments</code>å‚æ•°ç­‰ç­‰ï¼‰<br><strong>ä½œç”¨åŸŸé“¾</strong><br>å®ƒæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªå±æ€§ï¼ŒåŸç†å’ŒåŸå‹é“¾å¾ˆç›¸ä¼¼ï¼Œä½œç”¨å¾ˆé‡è¦ã€‚<br>è­¬å¦‚æµç¨‹ç®€è¿°ï¼š</p><pre><code>åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå˜é‡fooå¦‚æœå‡½æ•°çš„VOä¸­æ‰¾åˆ°äº†ï¼Œå°±ç›´æ¥ä½¿ç”¨å¦åˆ™å»å®ƒçš„çˆ¶çº§ä½œç”¨åŸŸé“¾ä¸­ï¼ˆ__parent__ï¼‰æ‰¾å¦‚æœçˆ¶çº§ä¸­æ²¡æ‰¾åˆ°ï¼Œç»§ç»­å¾€ä¸Šæ‰¾ç›´åˆ°å…¨å±€ä¸Šä¸‹æ–‡ä¸­ä¹Ÿæ²¡æ‰¾åˆ°å°±æŠ¥é”™</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1582215843494-1199245e-1308-4681-8caa-accf79b10687.png#align=left&display=inline&height=549&name=image.png&originHeight=426&originWidth=221&size=42937&status=done&style=none&width=285" alt="image.png"></p><p><strong>thisæŒ‡é’ˆ</strong><br>è¿™ä¹Ÿæ˜¯JSçš„æ ¸å¿ƒçŸ¥è¯†ä¹‹ä¸€ï¼Œç”±äºå†…å®¹è¿‡å¤šï¼Œè¿™é‡Œå°±ä¸å±•å¼€ï¼Œä»…æåŠéƒ¨åˆ†<br>æ³¨æ„ï¼š<strong>thisæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒçš„ä¸€ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯æŸä¸ªå˜é‡å¯¹è±¡çš„å±æ€§</strong><br>å› æ­¤:</p><ul><li>thisæ˜¯æ²¡æœ‰ä¸€ä¸ªç±»ä¼¼æœå¯»å˜é‡çš„è¿‡ç¨‹</li><li>å½“ä»£ç ä¸­ä½¿ç”¨äº†thisï¼Œè¿™ä¸ª thisçš„å€¼å°±ç›´æ¥ä»æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¸­è·å–äº†ï¼Œè€Œä¸ä¼šä»ä½œç”¨åŸŸé“¾ä¸­æœå¯»</li><li>thisçš„å€¼åªå–å†³ä¸­è¿›å…¥ä¸Šä¸‹æ–‡æ—¶çš„æƒ…å†µ</li></ul><p>æ‰€ä»¥ç»å…¸çš„ä¾‹å­ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> baz <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span><span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token punctuation">{</span>    baz<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>    foo<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>baz<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> foo <span class="token operator">=</span> bar<span class="token punctuation">.</span>foo<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¿›å…¥ç¯å¢ƒï¼šglobal</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 200ï¼Œä¸¥æ ¼æ¨¡å¼ä¸­ä¼šæŠ¥é”™ï¼ŒCannot read property 'baz' of undefined</span><span class="token comment" spellcheck="true">// è¿›å…¥ç¯å¢ƒï¼šglobal bar</span>bar<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 100</span></code></pre><p>å°±è¦æ˜ç™½äº†ä¸Šé¢thisçš„ä»‹ç»ï¼Œä¸Šè¿°ä¾‹å­å¾ˆå¥½ç†è§£<br>æ›´å¤šå‚è€ƒï¼š<br><a href="http://www.cnblogs.com/TomXu/archive/2012/01/17/2310479.html" target="_blank" rel="noopener">æ·±å…¥ç†è§£JavaScriptç³»åˆ—ï¼ˆ13ï¼‰ï¼šThis? Yes,this!</a></p><h4 id="å›æ”¶æœºåˆ¶"><a href="#å›æ”¶æœºåˆ¶" class="headerlink" title="å›æ”¶æœºåˆ¶"></a>å›æ”¶æœºåˆ¶</h4><p>JSæœ‰åƒåœ¾å¤„ç†å™¨ï¼Œæ‰€ä»¥æ— éœ€æ‰‹åŠ¨å›æ”¶å†…å­˜ï¼Œè€Œæ˜¯ç”±åƒåœ¾å¤„ç†å™¨è‡ªåŠ¨å¤„ç†ã€‚<br>ä¸€èˆ¬æ¥è¯´ï¼Œåƒåœ¾å¤„ç†å™¨æœ‰è‡ªå·±çš„å›æ”¶ç­–ç•¥ã€‚<br>è­¬å¦‚å¯¹äºé‚£äº›æ‰§è¡Œå®Œæ¯•çš„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å¤–éƒ¨å¼•ç”¨ï¼ˆè¢«å¼•ç”¨çš„è¯ä¼šå½¢æˆé—­åŒ…ï¼‰ï¼Œåˆ™ä¼šå›æ”¶ã€‚ï¼ˆå½“ç„¶ä¸€èˆ¬ä¼šæŠŠå›æ”¶åŠ¨ä½œåˆ‡å‰²åˆ°ä¸åŒçš„æ—¶é—´æ®µæ‰§è¡Œï¼Œé˜²æ­¢å½±å“æ€§èƒ½ï¼‰<br>å¸¸ç”¨çš„ä¸¤ç§åƒåœ¾å›æ”¶è§„åˆ™æ˜¯ï¼š</p><ul><li>æ ‡è®°æ¸…é™¤</li><li>å¼•ç”¨è®¡æ•°</li></ul><p>Javascriptå¼•æ“åŸºç¡€GCæ–¹æ¡ˆæ˜¯ï¼ˆ<code>simple GC</code>ï¼‰ï¼š<code>mark and sweep</code>ï¼ˆæ ‡è®°æ¸…é™¤ï¼‰ï¼Œç®€å•è§£é‡Šå¦‚ä¸‹ï¼š</p><ol><li>éå†æ‰€æœ‰å¯è®¿é—®çš„å¯¹è±¡ã€‚</li><li>å›æ”¶å·²ä¸å¯è®¿é—®çš„å¯¹è±¡ã€‚</li></ol><p>è­¬å¦‚ï¼šï¼ˆå‡ºè‡ªjavascripté«˜ç¨‹ï¼‰<br>å½“å˜é‡è¿›å…¥ç¯å¢ƒæ—¶ï¼Œä¾‹å¦‚ï¼Œåœ¨å‡½æ•°ä¸­å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå°±å°†è¿™ä¸ªå˜é‡æ ‡è®°ä¸ºâ€œè¿›å…¥ç¯å¢ƒâ€ã€‚&gt; ä»é€»è¾‘ä¸Šè®²ï¼Œæ°¸è¿œä¸èƒ½é‡Šæ”¾è¿›å…¥ç¯å¢ƒçš„å˜é‡æ‰€å ç”¨çš„å†…å­˜ï¼Œå› ä¸ºåªè¦æ‰§è¡Œæµè¿›å…¥ç›¸åº”çš„ç¯å¢ƒï¼Œå°±å¯èƒ½ä¼šç”¨åˆ°å®ƒä»¬ã€‚</p><blockquote><p>è€Œå½“å˜é‡ç¦»å¼€ç¯å¢ƒæ—¶ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºâ€œç¦»å¼€ç¯å¢ƒâ€ã€‚<br>åƒåœ¾å›æ”¶å™¨åœ¨è¿è¡Œçš„æ—¶å€™ä¼šç»™å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ‰€æœ‰å˜é‡éƒ½åŠ ä¸Šæ ‡è®°ï¼ˆå½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•æ ‡è®°æ–¹å¼ï¼‰ã€‚<br>ç„¶åï¼Œå®ƒä¼šå»æ‰ç¯å¢ƒä¸­çš„å˜é‡ä»¥åŠè¢«ç¯å¢ƒä¸­çš„å˜é‡å¼•ç”¨çš„å˜é‡çš„æ ‡è®°ï¼ˆé—­åŒ…ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç¯å¢ƒä¸­çš„ä»¥åŠç›¸å…³å¼•ç”¨çš„å˜é‡ä¼šè¢«å»é™¤æ ‡è®°ï¼‰ã€‚<br>è€Œåœ¨æ­¤ä¹‹åå†è¢«åŠ ä¸Šæ ‡è®°çš„å˜é‡å°†è¢«è§†ä¸ºå‡†å¤‡åˆ é™¤çš„å˜é‡ï¼ŒåŸå› æ˜¯ç¯å¢ƒä¸­çš„å˜é‡å·²ç»æ— æ³•è®¿é—®åˆ°è¿™äº›å˜é‡äº†ã€‚<br>æœ€åï¼Œåƒåœ¾å›æ”¶å™¨å®Œæˆå†…å­˜æ¸…é™¤å·¥ä½œï¼Œé”€æ¯é‚£äº›å¸¦æ ‡è®°çš„å€¼å¹¶å›æ”¶å®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p></blockquote><p>å…³äºå¼•ç”¨è®¡æ•°ï¼Œç®€å•ç‚¹ç†è§£ï¼š<br><strong>è·Ÿè¸ªè®°å½•æ¯ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œå½“ä¸€ä¸ªå€¼è¢«å¼•ç”¨æ—¶ï¼Œæ¬¡æ•°<code>+1</code>ï¼Œå‡æŒæ—¶<code>-1</code>ï¼Œä¸‹æ¬¡åƒåœ¾å›æ”¶å™¨ä¼šå›æ”¶æ¬¡æ•°ä¸º<code>0</code>çš„å€¼çš„å†…å­˜ï¼ˆå½“ç„¶äº†ï¼Œå®¹æ˜“å‡ºå¾ªç¯å¼•ç”¨çš„bugï¼‰</strong><br><strong>GCçš„ç¼ºé™·</strong><br>å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œjavascriptçš„GCç­–ç•¥ä¹Ÿæ— æ³•é¿å…ä¸€ä¸ªé—®é¢˜ï¼š <strong>GCæ—¶ï¼Œåœæ­¢å“åº”å…¶ä»–æ“ä½œ</strong><br>è¿™æ˜¯ä¸ºäº†å®‰å…¨è€ƒè™‘ã€‚<br>è€ŒJavascriptçš„GCåœ¨<code>100ms</code>ç”šè‡³ä»¥ä¸Š<br>å¯¹ä¸€èˆ¬çš„åº”ç”¨è¿˜å¥½ï¼Œä½†å¯¹äºJSæ¸¸æˆï¼ŒåŠ¨ç”»å¯¹è¿è´¯æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åº”ç”¨ï¼Œå°±éº»çƒ¦äº†ã€‚<br>è¿™å°±æ˜¯å¼•æ“éœ€è¦ä¼˜åŒ–çš„ç‚¹ï¼š <strong>é¿å…GCé€ æˆçš„é•¿æ—¶é—´åœæ­¢å“åº”ã€‚</strong><br><strong>GCä¼˜åŒ–ç­–ç•¥</strong><br>è¿™é‡Œä»‹ç»å¸¸ç”¨åˆ°çš„ï¼š<strong>åˆ†ä»£å›æ”¶ï¼ˆGeneration GCï¼‰</strong><br>ç›®çš„æ˜¯é€šè¿‡åŒºåˆ†â€œä¸´æ—¶â€ä¸â€œæŒä¹…â€å¯¹è±¡:</p><ul><li>å¤šå›æ”¶â€œä¸´æ—¶å¯¹è±¡â€åŒºï¼ˆ<code>young generation</code>ï¼‰</li><li>å°‘å›æ”¶â€œæŒä¹…å¯¹è±¡â€åŒºï¼ˆ<code>tenured generation</code>ï¼‰</li><li>å‡å°‘æ¯æ¬¡éœ€éå†çš„å¯¹è±¡ï¼Œä»è€Œå‡å°‘æ¯æ¬¡GCçš„è€—æ—¶ã€‚</li></ul><p>åƒnode v8å¼•æ“å°±æ˜¯é‡‡ç”¨çš„åˆ†ä»£å›æ”¶ï¼ˆå’Œjavaä¸€æ ·ï¼Œä½œè€…æ˜¯javaè™šæ‹Ÿæœºä½œè€…ã€‚ï¼‰<br>æ›´å¤šå¯ä»¥å‚è€ƒï¼š<br><a href="https://zhuanlan.zhihu.com/p/33816534" target="_blank" rel="noopener">V8 å†…å­˜æµ…æ</a></p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="å¯ä»¥æåˆ°è·¨åŸŸ"><a href="#å¯ä»¥æåˆ°è·¨åŸŸ" class="headerlink" title="å¯ä»¥æåˆ°è·¨åŸŸ"></a>å¯ä»¥æåˆ°è·¨åŸŸ</h3><p>è­¬å¦‚å‘å‡ºç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šç”¨AJAXï¼Œå¦‚æœæ¥å£è·¨åŸŸï¼Œå°±ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜<br>å¯ä»¥å‚è€ƒï¼š<br><a href="https://segmentfault.com/a/1190000012469713" target="_blank" rel="noopener">ajaxè·¨åŸŸï¼Œè¿™åº”è¯¥æ˜¯æœ€å…¨çš„è§£å†³æ–¹æ¡ˆäº†</a></p><h3 id="å¯ä»¥æåˆ°webå®‰å…¨"><a href="#å¯ä»¥æåˆ°webå®‰å…¨" class="headerlink" title="å¯ä»¥æåˆ°webå®‰å…¨"></a>å¯ä»¥æåˆ°webå®‰å…¨</h3><p>è­¬å¦‚æµè§ˆå™¨åœ¨è§£æHTMLæ—¶ï¼Œæœ‰<code>XSSAuditor</code>ï¼Œå¯ä»¥å»¶ä¼¸åˆ°webå®‰å…¨ç›¸å…³é¢†åŸŸ<br>å¯ä»¥å‚è€ƒï¼š<br><a href="https://segmentfault.com/a/1190000012693772" target="_blank" rel="noopener">AJAXè¯·æ±‚çœŸçš„ä¸å®‰å…¨ä¹ˆï¼Ÿè°ˆè°ˆWebå®‰å…¨ä¸AJAXçš„å…³ç³»ã€‚</a></p><h3 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h3><p>å¦‚å¯ä»¥æåˆ°<code>viewport</code>æ¦‚å¿µï¼Œè®²è®²ç‰©ç†åƒç´ ï¼Œé€»è¾‘åƒç´ ï¼ŒCSSåƒç´ ç­‰æ¦‚å¿µ<br>å¦‚ç†Ÿæ‚‰Hybridå¼€å‘çš„è¯å¯ä»¥æåŠä¸€ä¸‹Hybridç›¸å…³å†…å®¹ä»¥åŠä¼˜åŒ–</p><h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><p>æ„Ÿè°¢<a href="https://segmentfault.com/a/1190000013662126" target="_blank" rel="noopener">æ’’ç½‘è¦è§é±¼</a>çš„åˆ†äº«ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šé¡µé¢æ‰“åŒ…é…ç½®</title>
      <link href="/2020/02/12/Webpack/07/"/>
      <url>/2020/02/12/Webpack/07/</url>
      
        <content type="html"><![CDATA[<h1 id="webpack4-0-ä¸ƒ-ï¼šå¤šé¡µé¢æ‰“åŒ…é…ç½®"><a href="#webpack4-0-ä¸ƒ-ï¼šå¤šé¡µé¢æ‰“åŒ…é…ç½®" class="headerlink" title="webpack4.0(ä¸ƒ)ï¼šå¤šé¡µé¢æ‰“åŒ…é…ç½®"></a>webpack4.0(ä¸ƒ)ï¼šå¤šé¡µé¢æ‰“åŒ…é…ç½®</h1><p>webpack.config.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> AddAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @param { Object }  * @return { Object } */</span><span class="token keyword">const</span> makeHtml <span class="token operator">=</span> <span class="token punctuation">(</span>configs<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> pluginsDll <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>configs<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>        pluginsDll<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>            <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                filename<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.html`</span></span><span class="token punctuation">,</span>                template<span class="token punctuation">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>                chunks<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">,</span><span class="token string">'react'</span><span class="token punctuation">,</span>key<span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>file <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/.*\.dll.js$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            pluginsDll<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    filepath<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dll'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/.*\.manifest.json$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dll'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> pluginsDll<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span><span class="token punctuation">{</span>        index<span class="token punctuation">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>        list<span class="token punctuation">:</span><span class="token string">'./src/list.js'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span><span class="token punctuation">{</span>        path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    module<span class="token punctuation">:</span><span class="token punctuation">{</span>        rules<span class="token punctuation">:</span><span class="token punctuation">[</span>            <span class="token punctuation">{</span>                test<span class="token punctuation">:</span><span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>                loader<span class="token punctuation">:</span><span class="token string">'babel-loader'</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>config<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token function">makeHtml</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre><p>webpack.dll.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    mode<span class="token punctuation">:</span><span class="token string">"production"</span><span class="token punctuation">,</span>    entry<span class="token punctuation">:</span><span class="token punctuation">{</span>        react<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token string">'react-dom'</span><span class="token punctuation">,</span><span class="token string">'react-router-dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        lodash<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'lodash-es'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span><span class="token punctuation">{</span>        filename<span class="token punctuation">:</span><span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>        path <span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        library<span class="token punctuation">:</span><span class="token string">'_dll_[name]'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span> <span class="token string">"_dll_[name]"</span><span class="token punctuation">,</span>            path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"../dll/[name].manifest.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DllPluginå’ŒDllReferencePlugin</title>
      <link href="/2020/02/11/Webpack/06/"/>
      <url>/2020/02/11/Webpack/06/</url>
      
        <content type="html"><![CDATA[<h1 id="webpack4-0-å…­-ï¼šDllPluginå’ŒDllReferencePlugin"><a href="#webpack4-0-å…­-ï¼šDllPluginå’ŒDllReferencePlugin" class="headerlink" title="webpack4.0(å…­)ï¼šDllPluginå’ŒDllReferencePlugin"></a>webpack4.0(å…­)ï¼šDllPluginå’ŒDllReferencePlugin</h1><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨é¡¹ç›®å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå‘ç°æœ‰æ—¶å€™æˆ‘ä»¬åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œæ„å»ºé€Ÿåº¦å¾ˆæ…¢ï¼Œå°¤å…¶æ˜¯ä¸€äº›æˆ‘ä»¬ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯æ¬¡éƒ½ä¼šè¢«æ‰“åŒ…è¿›å»ï¼Œå¤§å¤§å»¶é•¿äº†æ„å»ºæ—¶é—´ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½å°†è¿™äº›ç¨³å®šçš„åº“å•ç‹¬æ‰“åŒ…å‡ºæ¥ï¼Œè¿™æ ·æ—¢å¯ä»¥åŠ å¿«æ„å»ºé€Ÿåº¦ï¼Œè¿˜å¯ä»¥å‡å°‘bundleçš„ä½“ç§¯ï¼Ÿ</p><h3 id="DllPluginå’ŒDllReferencePlugin"><a href="#DllPluginå’ŒDllReferencePlugin" class="headerlink" title="DllPluginå’ŒDllReferencePlugin"></a>DllPluginå’ŒDllReferencePlugin</h3><p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚<code>DLLPlugin</code> å’Œ <code>DLLReferencePlugin</code> ç”¨æŸç§æ–¹æ³•å®ç°äº†æ‹†åˆ† bundlesï¼ŒåŒæ—¶è¿˜å¤§å¤§æå‡äº†æ„å»ºçš„é€Ÿåº¦ã€‚<br>è¿™ä¸ªæ’ä»¶æ˜¯åœ¨ä¸€ä¸ªé¢å¤–çš„ç‹¬ç«‹çš„ webpack è®¾ç½®ä¸­åˆ›å»ºä¸€ä¸ªåªæœ‰ dll çš„ bundle(dll-only-bundle)ã€‚ è¿™ä¸ªæ’ä»¶ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>manifest.json</code> çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥è®© <code>DllReferencePlugin</code> æ˜ å°„åˆ°ç›¸å…³çš„ä¾èµ–ä¸Šå»çš„ã€‚</p><h4 id="DllPlugin"><a href="#DllPlugin" class="headerlink" title="DllPlugin"></a>DllPlugin</h4><p>è¯¥æ’ä»¶æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li><code>context</code> (optional): manifest æ–‡ä»¶ä¸­è¯·æ±‚çš„ä¸Šä¸‹æ–‡(context)(é»˜è®¤å€¼ä¸º webpack çš„ä¸Šä¸‹æ–‡(context))</li><li><code>name</code>: æš´éœ²å‡ºçš„ DLL çš„å‡½æ•°å ( <code>[hash]</code> &amp; <code>[name]</code> )</li><li><code>path</code>: manifest json æ–‡ä»¶çš„<strong>ç»å¯¹è·¯å¾„</strong> (è¾“å‡ºæ–‡ä»¶)</li></ul><p>ç»“æœä¼šåœ¨ç»™å®šçš„ <code>path</code> è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>manifest.json</code> çš„æ–‡ä»¶ã€‚ è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ä» <code>require</code> å’Œ <code>import</code> çš„requeståˆ°æ¨¡å— id çš„æ˜ å°„ã€‚ <code>DLLReferencePlugin</code> ä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚<br>webpack.dll.jsï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    mode<span class="token punctuation">:</span><span class="token string">"production"</span><span class="token punctuation">,</span>    entry<span class="token punctuation">:</span><span class="token punctuation">{</span>        react<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token string">'react-dom'</span><span class="token punctuation">,</span><span class="token string">'react-router-dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        lodash<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'lodash-es'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span><span class="token punctuation">{</span>        filename<span class="token punctuation">:</span><span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>        path <span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        library<span class="token punctuation">:</span><span class="token string">'_dll_[name]'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span> <span class="token string">"_dll_[name]"</span><span class="token punctuation">,</span>            path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"./dll/[name].manifest.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h4 id="DllReferencePlugin"><a href="#DllReferencePlugin" class="headerlink" title="DllReferencePlugin"></a>DllReferencePlugin</h4><p>è¿™ä¸ªæ’ä»¶æ˜¯åœ¨ webpack ä¸»é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ï¼Œ è¿™ä¸ªæ’ä»¶æŠŠåªæœ‰ dll çš„ bundle(ä»¬)(dll-only-bundle(s)) å¼•ç”¨åˆ°éœ€è¦çš„é¢„ç¼–è¯‘çš„ä¾èµ–ã€‚è¯¥æ’ä»¶æ¥å—ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><code>context</code>: (<strong>ç»å¯¹è·¯å¾„</strong>) manifest (æˆ–è€…æ˜¯å†…å®¹å±æ€§)ä¸­è¯·æ±‚çš„ä¸Šä¸‹æ–‡</li><li><code>manifest</code>: åŒ…å« <code>content</code> å’Œ <code>name</code> çš„å¯¹è±¡ï¼Œæˆ–è€…åœ¨ç¼–è¯‘æ—¶(compilation)çš„ä¸€ä¸ªç”¨äºåŠ è½½çš„ JSON manifest ç»å¯¹è·¯å¾„</li><li><code>content</code> (optional): è¯·æ±‚åˆ°æ¨¡å— id çš„æ˜ å°„ (é»˜è®¤å€¼ä¸º <code>manifest.content</code>)</li><li><code>name</code> (optional): dll æš´éœ²çš„åœ°æ–¹çš„åç§° (é»˜è®¤å€¼ä¸º <code>manifest.name</code>) (å¯å‚è€ƒ <a href="https://www.webpackjs.com/configuration/externals/" target="_blank" rel="noopener"><code>externals</code></a>)</li><li><code>scope</code> (optional): dll ä¸­å†…å®¹çš„å‰ç¼€</li><li><code>sourceType</code> (optional): dll æ˜¯å¦‚ä½•æš´éœ²çš„ (<a href="https://www.webpackjs.com/configuration/output/#output-librarytarget" target="_blank" rel="noopener">libraryTarget</a>)</li></ul><blockquote><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„æ’ä»¶ï¼šadd-asset-html-webpack-pluginã€‚å®ƒå¯ä»¥å°†ä¸€äº›èµ„æºæ–‡ä»¶ç»‘å®šåˆ°htmlä¸Šã€‚<br>è¿™é‡Œç”¨å®ƒå°±æ˜¯å°†ä¸Šé¢æ‰“åŒ…å¥½çš„ç¬¬ä¸‰æ–¹åº“ç»‘å®šåˆ°htmlä¸Šã€‚</p></blockquote><p>webpack.config.js:</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> AddAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./dll'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> pluginsDll <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">'./src/index.html'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>file <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/.*\.dll.js$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        pluginsDll<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>            <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                filepath<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./dll'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/.*\.manifest.json$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./dll'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>    mode<span class="token punctuation">:</span> <span class="token string">"production"</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    resolve<span class="token punctuation">:</span><span class="token punctuation">{</span>        extensions<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span><span class="token string">'.jsx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        mainFiles<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span><span class="token string">'index'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>        contentBase<span class="token punctuation">:</span><span class="token string">'./dist'</span><span class="token punctuation">,</span>        open<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>        hotOnly<span class="token punctuation">:</span><span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                test<span class="token punctuation">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>                exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>                use<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    plugins<span class="token punctuation">:</span> pluginsDll<span class="token punctuation">}</span></code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨fsæ¨¡å—è·å–dllæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼Œé€šè¿‡å¾ªç¯éå†ï¼Œå°†èµ„æºå…¨éƒ¨æŒ‚è½½åˆ°htmlä¸Šã€‚<br>è¿™æ ·ï¼Œå½“æ‰“åŒ…çš„æ—¶å€™ï¼Œå¦‚æœæœ¬åœ°çš„dllæ–‡ä»¶ä¸‹æœ‰äº†ç¬¬ä¸‰æ–¹åº“çš„æ–‡ä»¶ï¼Œæ‰“åŒ…çš„æ—¶å€™å°±ä¸ä¼šå†æ¬¡å‘node_moduleä¸Šå»å–ã€‚å¤§å¤§åŠ å¿«äº†æ„å»ºé€Ÿåº¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>babel</title>
      <link href="/2020/02/09/Webpack/05/"/>
      <url>/2020/02/09/Webpack/05/</url>
      
        <content type="html"><![CDATA[<h1 id="webpack4-0-å››-ï¼šbabel"><a href="#webpack4-0-å››-ï¼šbabel" class="headerlink" title="webpack4.0(å››)ï¼šbabel"></a>webpack4.0(å››)ï¼šbabel</h1><h2 id="ä»€ä¹ˆæ˜¯babel"><a href="#ä»€ä¹ˆæ˜¯babel" class="headerlink" title="ä»€ä¹ˆæ˜¯babel"></a>ä»€ä¹ˆæ˜¯babel</h2><p>ES6æ˜¯ECMAScriptåœ¨2015å¹´å‘å¸ƒçš„ä¸‹ä¸€ä»£JavaScriptè¯­æ³•ï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„è¯­æ³•å’ŒAPIï¼Œä½†æ˜¯è¿™äº›æ–°çš„è¯­æ³•å’ŒAPIåªæœ‰åœ¨æœ€æ–°çš„æµè§ˆå™¨ä¸­æ‰ä¼šå¾—åˆ°æ”¯æŒï¼Œå°±ç®—æ˜¯ç°åœ¨ä»ç„¶æœ‰ä¸€éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒES6ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè½¬æ¢å·¥å…·ï¼Œå°†ES6+çš„è¯­æ³•è½¬æ¢ä¸ºES5çš„è¯­æ³•ã€‚è€Œbabelå°±æ˜¯è¿™æ ·ä¸€ä¸ªè½¬æ¢å·¥å…·ã€‚</p><blockquote><p>æœ¬æ–‡çš„babelè®²è§£åŸºäºbabel7ã€‚</p></blockquote><h2 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h2><p>babelåœ¨æ‰§è¡Œç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šä»é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<code>.babelrc</code>ä¸­æˆ–è€…<code>babel-loader</code>çš„optionsä¸­è¯»å–å…¶é…ç½®ã€‚<code>.babelrc</code>æ˜¯ä¸€ä¸ªjsonæ ¼å¼çš„æ–‡ä»¶ï¼Œå…¶ä¸­ä¸»è¦æ˜¯å¯¹é¢„è®¾ï¼ˆpresetsï¼‰å’Œ æ’ä»¶ï¼ˆpluginsï¼‰çš„é…ç½®ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>    <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>         <span class="token punctuation">[</span>            <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>                <span class="token string">"targets"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                    <span class="token string">"edge"</span><span class="token punctuation">:</span> <span class="token string">"17"</span><span class="token punctuation">,</span>                    <span class="token string">"firefox"</span><span class="token punctuation">:</span> <span class="token string">"60"</span><span class="token punctuation">,</span>                    <span class="token string">"chrome"</span><span class="token punctuation">:</span> <span class="token string">"67"</span><span class="token punctuation">,</span>                    <span class="token string">"safari"</span><span class="token punctuation">:</span> <span class="token string">"11.1"</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token string">"useBuiltIns"</span><span class="token punctuation">:</span><span class="token string">"usage"</span><span class="token comment" spellcheck="true">//åªè½¬æ¢å·²ä½¿ç”¨çš„æ¨¡å—</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h3><p>å…³äºbabel-loaderçš„å…·ä½“é…ç½®ï¼Œè¯·æŸ¥çœ‹<a href="https://www.npmjs.com/package/babel-loader" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><blockquote><p>webpack 4.x | babel-loader 8.x | babel 7.x</p></blockquote><p>å®‰è£…ï¼š<code>npm install -D babel-loader @babel/core @babel/preset-env webpack</code><br>é…ç½®ï¼š<br>åœ¨webpack.config.jsä¸­ï¼š</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">:</span> <span class="token punctuation">{</span>        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>                exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//å¯¹äºç¬¬ä¸‰æ–¹çš„æ’ä»¶ æ— éœ€åšå¤šä½™å¤„ç†</span>                use<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>                    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>                        presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span></code></pre><p>å…³äº<code>@babel/preset-env</code>çš„é…ç½®ï¼š<a href="https://babeljs.io/docs/en/babel-preset-env" target="_blank" rel="noopener">è¯·ç§»æ­¥</a>ã€‚<br>å…¶å®<code>babel-loader</code>åªæ˜¯babelå’Œwebpackæ²Ÿé€šçš„æ¡¥æ¢ï¼ŒçœŸæ­£å¯ä»¥å°†ES6+è¯­æ³•è½¬æ¢ä¸ºES5è¯­æ³•çš„è¿˜æ˜¯<code>``@babel/preset-env</code>ã€‚<br>æŒ‰ç…§ä¸Šè¿°é…ç½®ï¼Œå·²ç»å¯ä»¥å°†ES6+çš„è¯­æ³•è½¬æ¢ä¸ºES5äº†ã€‚ä½†æ˜¯<code>@babel/preset-env</code>åªæ˜¯å°†è¯­æ³•ç¿»è¯‘æˆES5 ï¼Œåœ¨ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­ï¼Œä¸æ”¯æŒçš„APIï¼Œå¦‚Promiseã€mapç­‰ï¼Œä»ç„¶æ²¡æœ‰è¢«è¡¥å……è¿›å»ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªå·¥å…·åœ¨ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­è¡¥å……è¿™äº›æ–°çš„APIã€‚<br>è€Œ<code>@babel/polyfill</code> å’Œ <code>@babel/runtime</code>æ­£æ˜¯ç”¨æ¥åšè¿™äº›å·¥ä½œçš„ã€‚</p><h3 id="babel-polyfill"><a href="#babel-polyfill" class="headerlink" title="@babel/polyfill"></a>@babel/polyfill</h3><p>å®‰è£…ï¼š<code>npm install --save @babel/polyfill</code>ã€‚<br>ä½¿ç”¨ï¼šåœ¨é¡¹ç›®çš„å…¥å£æ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¼•å…¥å³å¯ï¼š<code>import &quot;@babel/polyfill&quot;;</code>ã€‚ç”±äº<code>@babel/polyfill</code>å¾ˆå¤§ï¼Œæ‰€ä»¥åœ¨é…åˆwebpackä½¿ç”¨çš„æ—¶å€™ï¼Œæœ€å¥½åœ¨babelrcæ–‡ä»¶ä¸­æ·»åŠ ä¸€é¡¹é…ç½®ï¼š<code>useBuiltIns: &#39;usage&#39;</code>ã€‚è¿™æ ·åœ¨æ‰“åŒ…ç¼–è¯‘çš„æ—¶å€™ï¼Œå°±ä¸ä¼šå°†ä¸ºä½¿ç”¨çš„ES6+è¯­æ³•ä¹Ÿç»™æ‰“åŒ…è¿›å»äº†ã€‚</p><h3 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="babel-plugin-transform-runtime"></a>babel-plugin-transform-runtime</h3><p>å®‰è£…ï¼šå…·ä½“é…ç½®<a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime" target="_blank" rel="noopener">è¯·ç§»æ­¥</a><br><code>npm install --save-dev @babel/plugin-transform-runtime</code><br><code>npm install --save @babel/runtime</code>ã€‚<br>é…ç½®ï¼š<br>.babelrcï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>  <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span>      <span class="token string">"@babel/plugin-transform-runtime"</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        <span class="token string">"absoluteRuntime"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token string">"corejs"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token string">"helpers"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token string">"regenerator"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token string">"useESModules"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"7.0.0-beta.0"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="babel-polyfill-å’Œ-babel-plugin-transform-runtimeçš„åŒºåˆ«"><a href="#babel-polyfill-å’Œ-babel-plugin-transform-runtimeçš„åŒºåˆ«" class="headerlink" title="@babel/polyfill å’Œ babel-plugin-transform-runtimeçš„åŒºåˆ«"></a>@babel/polyfill å’Œ babel-plugin-transform-runtimeçš„åŒºåˆ«</h3><ul><li>å‰è€…çš„åŸç†æ˜¯å½“è¿è¡Œç¯å¢ƒä¸­å¹¶æ²¡æœ‰å®ç°çš„ä¸€äº›æ–¹æ³•ï¼Œbabel-polyfillä¼šåšå…¼å®¹ã€‚åè€…æ˜¯å°†ES6è¯­æ³•è½¬æ¢ä¸ºES5çš„è¯­æ³•ï¼Œä¸ç®¡æµè§ˆå™¨æ”¯ä¸æ”¯æŒES6çš„è¯­æ³•ï¼Œéƒ½ä¼šç¼–è¯‘ï¼Œæ‰€ä»¥ä¼šæœ‰å¾ˆå¤šçš„å†—ä½™çš„ä»£ç ã€‚</li><li>å‰è€…æ˜¯åœ¨å…¨å±€ç¯å¢ƒä¸€ç§æ·»åŠ æ–¹æ³•ï¼Œä¼šé€ æˆå…¨å±€å˜é‡çš„æ±¡æŸ“ã€‚åè€…å®ƒä¸ä¼šæ±¡æŸ“å…¨å±€å¯¹è±¡å’Œå†…ç½®å¯¹è±¡çš„åŸå‹ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦Promiseï¼Œæˆ‘ä»¬åªéœ€è¦import Promise from â€˜babel-runtime/core-js/promiseâ€™å³å¯ï¼Œè¿™æ ·ä¸ä»…é¿å…æ±¡æŸ“å…¨å±€å¯¹è±¡ï¼Œè€Œä¸”å¯ä»¥å‡å°‘ä¸å¿…è¦çš„ä»£ç ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>codeSplitting</title>
      <link href="/2020/02/07/Webpack/04/"/>
      <url>/2020/02/07/Webpack/04/</url>
      
        <content type="html"><![CDATA[<h1 id="webpack4-0-ä¸‰-ï¼šcodeSplitting"><a href="#webpack4-0-ä¸‰-ï¼šcodeSplitting" class="headerlink" title="webpack4.0(ä¸‰)ï¼šcodeSplitting"></a>webpack4.0(ä¸‰)ï¼šcodeSplitting</h1><p>ä»£ç åˆ†ç¦»æ˜¯ webpack ä¸­æœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§ä¹‹ä¸€ã€‚æ­¤ç‰¹æ€§èƒ½å¤ŸæŠŠä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ bundle ä¸­ï¼Œç„¶åå¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ä»£ç åˆ†ç¦»å¯ä»¥ç”¨äºè·å–æ›´å°çš„ bundleï¼Œä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼Œå¦‚æœä½¿ç”¨åˆç†ï¼Œä¼šæå¤§å½±å“åŠ è½½æ—¶é—´ã€‚</p><p>å½“æˆ‘ä»¬åœ¨åšé¡¹ç›®çš„æ—¶å€™ï¼Œéƒ½ä¼šå¼•å…¥ä¸€äº›ç¬¬ä¸‰æ–¹çš„åº“æ¥å¸®åŠ©æˆ‘ä»¬å¼€å‘ï¼Œä¾‹å¦‚ï¼šlodashã€underscoreç­‰ç­‰ï¼Œä½†æ˜¯è¿™äº›åº“åœ¨æˆ‘ä»¬æ‰“åŒ…çš„æ—¶å€™ï¼Œä¼šè¢«é»˜è®¤æ‰“åŒ…åˆ°bundle.jsä¸­ï¼Œæå¤§çš„å¢åŠ äº†jsçš„ä½“ç§¯ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1580283884792-a88740a5-d4ca-4e91-a690-d8d5e4fb5342.png#align=left&display=inline&height=173&name=image.png&originHeight=346&originWidth=902&size=59759&status=done&style=none&width=451" alt="image.png"><br>ç›´æ¥æŠŠæˆ‘ä»¬çš„jsä½“ç§¯æå‡åˆ°äº†2.4Mï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å°†å…¶ä»main.jsä¸­åˆ†å‰²å‡ºæ¥ï¼Œå‡å°main.jsçš„ä½“ç§¯ã€‚</p><p>å¸¸è§çš„æœ‰ä¸‰ç§æ–¹å¼è¿›è¡Œä»£ç åˆ†å‰²ï¼š</p><ul><li>åœ¨entryæ‰‹åŠ¨çš„é…ç½®ä»£ç åˆ†å‰²ã€‚</li><li>ä½¿ç”¨<code>SplitChunksPlugin</code>è¿›è¡Œå…¬å…±ä»£ç æå–å’Œåˆ†å‰²ã€‚</li><li>åŠ¨æ€å¯¼å…¥ã€‚</li></ul><h3 id="entryæ‰‹åŠ¨åˆ†å‰²"><a href="#entryæ‰‹åŠ¨åˆ†å‰²" class="headerlink" title="entryæ‰‹åŠ¨åˆ†å‰²"></a>entryæ‰‹åŠ¨åˆ†å‰²</h3><pre class=" language-javascript"><code class="language-javascript">entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>    index<span class="token punctuation">:</span><span class="token string">'./index.js'</span><span class="token punctuation">,</span>    math<span class="token punctuation">:</span><span class="token string">'./math.js'</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>æ‰§è¡Œæ‰“åŒ…ä¹‹åï¼Œä¼šè¢«æ‰“åŒ…æˆä¸åŒçš„æ–‡ä»¶ã€‚<br>ç¼ºç‚¹ï¼š</p><ol><li>å¦‚æœä¸åŒçš„æ¨¡å—ä¸­å¼•å…¥æœ‰é‡å¤çš„æ¨¡å—ï¼Œé‚£ä¹ˆé‡å¤çš„æ¨¡å—å°±ä¼šè¢«å¤šæ¬¡æ‰“åŒ…ã€‚</li><li>ä¸å¤Ÿçµæ´»ï¼Œä¸èƒ½å°†æ ¸å¿ƒé€»è¾‘è¿›è¡ŒåŠ¨æ€çš„æ‹†åˆ†ã€‚</li></ol><h3 id="SplitChunksPlugin"><a href="#SplitChunksPlugin" class="headerlink" title="SplitChunksPlugin"></a>SplitChunksPlugin</h3><p><code>SplitChunksPlugin</code>æ’ä»¶å¯ä»¥å°†ç›¸åŒçš„æ¨¡å—æå–åˆ°ä¸€èµ·ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å°†æˆ‘ä»¬ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹æ’ä»¶å•ç‹¬æå–å‡ºæ¥ï¼Œä¼˜åŒ–æ‰“åŒ…ä¹‹åçš„bundle.jsçš„ä½“ç§¯ã€‚<br>å…·ä½“ä½¿ç”¨ï¼šå…·ä½“é…ç½®è¯·æŸ¥çœ‹<a href="https://www.webpackjs.com/plugins/split-chunks-plugin/#defaults" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><pre class=" language-javascript"><code class="language-javascript">optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>  splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>    chunks<span class="token punctuation">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//è¿›è¡Œä»£ç åˆ†å‰²çš„æ—¶å€™ï¼Œallï¼šé’ˆå¯¹æ‰€æœ‰çš„å¯¼å…¥  async:åªé’ˆå¯¹å¼‚æ­¥å¯¼å…¥ initial:é’ˆå¯¹åŒæ­¥ä»£ç å¯¼å…¥ã€‚</span>    minSize<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//è®¾ç½®æœ€å°é˜€å€¼ï¼Œåªæœ‰å¤§äºè¯¥é˜€å€¼ï¼Œæ‰ä¼šè¿›è¡Œä»£ç åˆ†å‰²ã€‚</span>    minChunks<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//åœ¨åˆ†å‰²æ¨¡å—ä¹‹å‰å…±äº«ä¸€ä¸ªæ¨¡å—çš„æœ€å°å—æ•°ï¼ˆè®¾ç½®ä»£ç æœ€å°‘è¢«å¼•ç”¨æ¬¡æ•°ï¼‰</span>    maxAsyncRequests<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æŒ‰éœ€åŠ è½½æ—¶çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•° è¶…è¿‡å°±ä¸ä¼šåœ¨åšä»£ç åˆ†å‰²æ‰“åŒ…</span>    maxInitialRequests<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//ä¸€ä¸ªå…¥å£ç‚¹çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°  è¶…è¿‡å°±ä¸ä¼šåšä»£ç åˆ†å‰²</span>    automaticNameDelimiter<span class="token punctuation">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ‰“åŒ…ç”Ÿæˆä¹‹åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œwebpackå°†ä½¿ç”¨å—çš„æ¥æºå’Œåç§°æ¥ç”Ÿæˆåç§°ï¼Œæ¯”å¦‚vendor ~main.jsã€‚</span>    name<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//ä½¿å¾—cacheGroupsä¸­æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶åç§°</span>    cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//ç¼“å­˜ç»„ æ‰“åŒ…åˆ†ç»„</span>      vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//é…ç½®åŒæ­¥å¯¼å…¥ </span>        test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//åªæœ‰node_moduleä¸­çš„æ‰ä¼šè¿›å…¥</span>        priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//å€¼è¶Šå¤§ ä¼˜å…ˆçº§è¶Šé«˜</span>        filename<span class="token punctuation">:</span> <span class="token string">'vendors.js'</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// minChunks: 2,</span>        priority<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// å¦‚æœæ¨¡å—å·²ç»è¢«æ‰“åŒ…äº†ï¼Œåœ¨æ­¤é‡åˆ°çš„æ—¶å€™ ç›´æ¥å¿½ç•¥ï¼Œç›´æ¥ä½¿ç”¨ä»¥æ‰“åŒ…å¥½çš„æ¨¡å—ã€‚</span>        filename<span class="token punctuation">:</span><span class="token string">'default.js'</span>      <span class="token punctuation">}</span>          <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="åŠ¨æ€å¯¼å…¥"><a href="#åŠ¨æ€å¯¼å…¥" class="headerlink" title="åŠ¨æ€å¯¼å…¥"></a>åŠ¨æ€å¯¼å…¥</h3><p>åŠ¨æ€å¯¼å…¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>ä½¿ç”¨ECMAScriptææ¡ˆçš„import()è¯­æ³•</li><li>ä½¿ç”¨webpackç‰¹å®šçš„è¯­æ³•ï¼šrequire.ensure()</li></ul><p>ç¬¬ä¸€ç§æ–¹å¼ï¼šä½¿ç”¨webpackChunkName</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment" spellcheck="true">/* webpackChunkName:"lodash" */</span> <span class="token string">"lodash"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token punctuation">:</span>_ <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span><span class="token string">'world'</span><span class="token punctuation">,</span><span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> div<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>æ‰“åŒ…ä¹‹åï¼Œä¼šåœ¨distç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>vendors~lodash.js</code>æ–‡ä»¶ï¼Œè¡¨ç¤ºå®ƒæ˜¯vendorsä¸‹é¢çš„ä¸€ä¸ªæ–‡ä»¶ã€‚ä¹‹æ‰€ä»¥å‰é¢ä¼šå¸¦ä¸€ä¸ªvendorsï¼Œè¿™æ˜¯å› ä¸ºcacheGroupæœ‰ä¸€ä¸ªé»˜è®¤é…ç½®ï¼Œå¦‚æœæƒ³è¦å»é™¤ï¼Œå°†vendorså’Œdefaulté…ç½®ä¸ºfalseå³å¯ã€‚<br>ç”±äº <code>import()</code> ä¼šè¿”å›ä¸€ä¸ª promiseï¼Œå› æ­¤å®ƒå¯ä»¥å’Œ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="noopener"><code>async</code> å‡½æ•°</a>ä¸€èµ·ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œéœ€è¦ä½¿ç”¨åƒ Babel è¿™æ ·çš„é¢„å¤„ç†å™¨å’Œ<a href="https://babeljs.io/docs/plugins/syntax-dynamic-import/#installation" target="_blank" rel="noopener">Syntax Dynamic Import Babel Plugin</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpackDevServer</title>
      <link href="/2020/01/28/Webpack/02/"/>
      <url>/2020/01/28/Webpack/02/</url>
      
        <content type="html"><![CDATA[<h1 id="webpack4-0-äºŒ-ï¼šwebpackDevServer"><a href="#webpack4-0-äºŒ-ï¼šwebpackDevServer" class="headerlink" title="webpack4.0(äºŒ)ï¼šwebpackDevServer"></a>webpack4.0(äºŒ)ï¼šwebpackDevServer</h1><p>åœ¨å¼€å‘ä¸­æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬ä¿å­˜ä»£ç çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›è¡Œæ‰“åŒ…ï¼Œå¹¶ä¸”è¿˜æ”¯æŒ Source Mapï¼Œä»¥æ–¹ä¾¿ä»£ç è°ƒè¯•ç­‰åŠŸèƒ½ï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨éœ€è¦ä½¿ç”¨åˆ° devServeräº†ã€‚</p><h3 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…ï¼š<code>webpack-dev-server</code>:</p><pre class=" language-javascript"><code class="language-javascript">å…¨å±€å®‰è£…ï¼šnpm install <span class="token operator">-</span>g webpack<span class="token operator">-</span>dev<span class="token operator">-</span>serverå±€éƒ¨å®‰è£…ï¼šnpm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server</code></pre><p>åœ¨webpack4ä¹‹åï¼ŒåŒæ—¶éœ€è¦å®‰è£…ï¼š<code>webpack-cli</code></p><pre class=" language-javascript"><code class="language-javascript">npm install webpack<span class="token operator">-</span>cli <span class="token operator">-</span>D</code></pre><p>æœ€åæˆ‘ä»¬è¿è¡Œ<code>webpack-dev-server</code>ï¼Œå°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œé»˜è®¤ç«¯å£å·æ˜¯8080ï¼Œè®¿é—®<code>http://localhost:8080/</code>å³å¯ã€‚</p><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨webpack-dev-serveræ‰“åŒ…çš„æ–‡ä»¶ä¿å­˜åœ¨ç”µè„‘å†…å­˜å½“ä¸­ï¼Œå¯ä»¥æé«˜è®¿é—®é€Ÿåº¦ã€‚</p></blockquote><p>å½“ç„¶ï¼Œè¿™ä¸ªé»˜è®¤çš„é…ç½®æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨<code>webpack.config.js</code>ä¸­ï¼š</p><pre class=" language-javascript"><code class="language-javascript">devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>    contentBase<span class="token punctuation">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æŒ‡å®šæœåŠ¡å™¨é»˜è®¤æ‰“å¼€çš„æ–‡ä»¶å¤¹</span>  open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨çª—å£</span>  port<span class="token punctuation">:</span> <span class="token string">"8081"</span><span class="token comment" spellcheck="true">//é…ç½®ç«¯å£å·</span><span class="token punctuation">}</span></code></pre><h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p>å®æ—¶é¢„è§ˆã€‚ä½¿ç”¨<code>webpack --watch</code>ï¼Œç›‘å¬æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ï¼Œå®ç°è‡ªåŠ¨æ‰“åŒ…ã€‚å½“é¡¹ç›®çš„å…¥å£æ–‡ä»¶æˆ–è€…ä¾èµ–æ–‡ä»¶å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œå®ƒä¼šé‡æ–°æ„å»ºï¼Œæ„å»ºå®Œæˆä¹‹åä¼šåˆ·æ–°é¡µé¢ã€‚ä½†æ˜¯å¦‚æœä¿®æ”¹çš„ä¸æ˜¯å…¥å£æ–‡ä»¶æˆ–è€…ä¾èµ–æ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸ä¼šé‡æ–°æ„å»ºçš„ã€‚</p><h3 id="webpack-dev-middleware"><a href="#webpack-dev-middleware" class="headerlink" title="webpack-dev-middleware"></a>webpack-dev-middleware</h3><p>æ–°å»ºä¸€ä¸ªæœåŠ¡ç«¯ï¼Œå¹¶ä¸”å°†webpackå¤„ç†è¿‡çš„æ–‡ä»¶ä¼ é€ç»™æœåŠ¡å™¨ã€‚<br>åŸç†ï¼šä½¿ç”¨webpackå’Œå…¶å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªç¼–è¯‘å™¨ï¼Œä½¿ç”¨è¯¥ä¸­é—´ä»¶ï¼Œåœ¨æœåŠ¡å™¨ä¸Šç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œé‡æ–°æ‰“åŒ…ã€‚<br>ä½¿ç”¨expresså»ºç«‹æœ¬åœ°æœåŠ¡å™¨ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//server.js</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> middleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> complier <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç¼–è¯‘å™¨</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">middleware</span><span class="token punctuation">(</span>complier<span class="token punctuation">,</span> <span class="token punctuation">{</span>    publicPath<span class="token punctuation">:</span> config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>publicPath<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre><p>ç„¶åè®¿é—®3000ç«¯å£å³å¯ã€‚</p><h3 id="HMR"><a href="#HMR" class="headerlink" title="HMR"></a>HMR</h3><p>é™¤äº†ä»¥ä¸Šæ–¹æ³•å¯ä»¥å®ç°åœ¨å…¥å£æ–‡ä»¶æˆ–è€…ä¾èµ–æ–‡ä»¶å‘ç”Ÿå˜åŠ¨æ—¶è¿›è¡Œé‡æ–°æ‰“åŒ…åŠ è½½é¡µé¢ä¹‹å¤–ï¼Œä½¿ç”¨æ¨¡å—çƒ­æ›¿æ¢æŠ€æœ¯ä¹Ÿå¯ä»¥å®ç°åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å·²æ›´æ–°çš„æ¨¡å—æ›¿æ¢æ—§æ¨¡å—ã€‚<br>æ¨¡å—çƒ­æ›¿æ¢æŠ€æœ¯é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•å¼€å¯ï¼š</p><ol><li>åœ¨å¯åŠ¨devServerçš„æ—¶å€™å¸¦ä¸Š<code>--inline</code> æˆ–è€… <code>--inline hot</code>å³å¯ã€‚</li><li>åœ¨devServerä¸­é…ç½®ï¼š</li></ol><pre class=" language-javascript"><code class="language-javascript">devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>  contentBase<span class="token punctuation">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>  open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  port<span class="token punctuation">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>  hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//é…ç½®HMR é˜»æ­¢æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°</span>  hotOnly<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//å³ä¾¿HMRä¸ç”Ÿæ•ˆ ä¹Ÿä¸è®©æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°</span><span class="token punctuation">}</span><span class="token punctuation">,</span> plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><h3 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h3><p>dev-serverä½¿ç”¨äº†éå¸¸å¼ºå¤§çš„åŒ…ï¼š<code>http-proxy-middleware</code>ï¼Œå…·ä½“ç”¨æ³•è¯·æŸ¥çœ‹<a href="https://www.npmjs.com/package/http-proxy-middleware" target="_blank" rel="noopener">ä½¿ç”¨æ–‡æ¡£</a>ã€‚<br>ä¸¾ä¸ªğŸŒ°ï¼šå¦‚æœåœ¨<code>http://localhost:3000</code>ä¸Šæœ‰åç«¯å¼€å‘æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾ç½®ä»£ç†ï¼š</p><pre class=" language-javascript"><code class="language-javascript">devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>    proxy<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token string">"/api"</span><span class="token punctuation">:</span><span class="token string">"http://localhost:3000/"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å°†è¯·æ±‚åˆ° <code>/api/users</code> ç°åœ¨ä¼šè¢«ä»£ç†åˆ°è¯·æ±‚ <code>http://localhost:3000/api/users</code>ã€‚<br>å¦‚æœä¸æƒ³å§‹ç»ˆä¼ é€’ <code>/api</code> ï¼Œåˆ™éœ€è¦é‡å†™è·¯å¾„ï¼š</p><pre class=" language-javascript"><code class="language-javascript">devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>    proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">"/api"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>      target<span class="token punctuation">:</span> <span class="token string">"http://localhost:3000"</span><span class="token punctuation">,</span>      pathRewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"^/api"</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸æ¥å—è¿è¡Œåœ¨ HTTPS ä¸Šï¼Œä¸”ä½¿ç”¨äº†æ— æ•ˆè¯ä¹¦çš„åç«¯æœåŠ¡å™¨ã€‚å¦‚æœä½ æƒ³è¦æ¥å—ï¼Œä¿®æ”¹é…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript">devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>    proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">"/api"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>      target<span class="token punctuation">:</span> <span class="token string">"http://localhost:3000"</span><span class="token punctuation">,</span>      pathRewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"^/api"</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      secure<span class="token punctuation">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æœ‰æ—¶ä½ ä¸æƒ³ä»£ç†æ‰€æœ‰çš„è¯·æ±‚ã€‚å¯ä»¥åŸºäºä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ç»•è¿‡ä»£ç†ã€‚<br>åœ¨å‡½æ•°ä¸­ä½ å¯ä»¥è®¿é—®è¯·æ±‚ä½“ã€å“åº”ä½“å’Œä»£ç†é€‰é¡¹ã€‚å¿…é¡»è¿”å› <code>false</code> æˆ–è·¯å¾„ï¼Œæ¥è·³è¿‡ä»£ç†è¯·æ±‚ã€‚<br>ä¾‹å¦‚ï¼šå¯¹äºæµè§ˆå™¨è¯·æ±‚ï¼Œä½ æƒ³è¦æä¾›ä¸€ä¸ª HTML é¡µé¢ï¼Œä½†æ˜¯å¯¹äº API è¯·æ±‚åˆ™ä¿æŒä»£ç†ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š</p><pre class=" language-javascript"><code class="language-javascript">proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token string">"/api"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    target<span class="token punctuation">:</span> <span class="token string">"http://localhost:3000"</span><span class="token punctuation">,</span>    bypass<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> proxyOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>accept<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"html"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Skipping proxy for browser request."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"/index.html"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¦‚æœæƒ³è¦ä»£ç†å¤šä¸ªç›®æ ‡è·¯å¾„å¤§åŒä¸€ç›®æ ‡å‘¢æœåŠ¡å™¨ä¸Šï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–è€…å¤šä¸ªå¯¹è±¡çš„å½¢å¼ï¼š</p><pre class=" language-javascript"><code class="language-javascript">proxy<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>  context<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/auth"</span><span class="token punctuation">,</span> <span class="token string">"/api"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  target<span class="token punctuation">:</span> <span class="token string">"http://localhost:3000"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">//æˆ–è€…</span>proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token string">"/api"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token string">"target"</span><span class="token punctuation">:</span><span class="token string">"http://localhost:3000/"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">"/auth"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token string">"target"</span><span class="token punctuation">:</span><span class="token string">"http://localhost:4000/"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨è¿›ç¨‹ä¸çº¿ç¨‹</title>
      <link href="/2020/01/19/JavaScript/process-thread/"/>
      <url>/2020/01/19/JavaScript/process-thread/</url>
      
        <content type="html"><![CDATA[<h1 id="æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹"></a>æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹</h1><h1 id="æµè§ˆå™¨"><a href="#æµè§ˆå™¨" class="headerlink" title="æµè§ˆå™¨"></a>æµè§ˆå™¨</h1><p>æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ã€‚æ¯ä¸€ä¸ªTabé¡µå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚</p><ul><li>æµè§ˆå™¨è¿›ç¨‹ï¼ˆä¸»è¿›ç¨‹ï¼‰ï¼šä¸ªäººç†è§£ä¸ºâ€œç®¡å®¶â€çš„è§’è‰²ï¼Œå®ƒæ§åˆ¶ç€æµè§ˆå™¨çš„å„ä¸ªä»»åŠ¡ï¼Œé¡µé¢å±•ç¤ºã€ç½‘ç»œè¯·æ±‚ã€å†å²å›é€€ã€å‰è¿›ç­‰ç­‰</li><li>ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹ï¼šç®¡ç†ç¬¬ä¸‰æ–¹æ’ä»¶</li><li>GPUçº¿ç¨‹ï¼šç”¨äº3Dç»˜åˆ¶</li><li>æ¸²æŸ“è¿›ç¨‹ï¼šæµè§ˆå™¨å†…æ ¸ï¼Œå¤šçº¿ç¨‹ã€‚ä¸»è¦è´Ÿè´£é¡µé¢æ¸²æŸ“ã€è„šæœ¬æ‰§è¡Œã€äº‹ä»¶å¾ªç¯ç­‰ã€‚å¯¹å‰ç«¯æ¥è¯´ï¼Œæœ€é‡è¦çš„è¿›ç¨‹ã€‚</li></ul><h4 id="æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š"><a href="#æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š" class="headerlink" title="æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š"></a>æµè§ˆå™¨å¤šè¿›ç¨‹ä¼˜åŠ¿ï¼š</h4><ul><li>é˜²æ­¢å•ä¸ªé¡µé¢æˆ–è€…æ’ä»¶å´©æºƒå½±å“æ•´ä¸ªæµè§ˆå™¨çš„è¿è¡Œã€‚</li><li>å¯ä»¥å……åˆ†åˆ©ç”¨æµè§ˆå™¨å¤šæ ¸çš„ä¼˜åŠ¿ã€‚</li><li>æ–¹ä¾¿ä½¿ç”¨æ²™ç›’æ¨¡å‹éš”ç¦»æ’ä»¶ç­‰è¿›ç¨‹ï¼Œæé«˜æµè§ˆå™¨ç¨³å®šæ€§ã€‚</li></ul><h1 id="æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰"><a href="#æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰" class="headerlink" title="æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰"></a>æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰</h1><p>æ¸²æŸ“è¿›ç¨‹æ˜¯å¤šçº¿ç¨‹çš„ã€‚å®ƒåŒ…å«ä¸€ä¸‹å‡ å¤§çº¿ç¨‹ï¼š</p><ul><li>GUIçº¿ç¨‹<ul><li>å®ƒè´Ÿè´£é¡µé¢çš„æ¸²æŸ“ã€å¸ƒå±€ã€è§£æHTMLã€CSSã€æ¸²æŸ“DOMæ ‘ã€‚</li><li>å½“é¡µé¢å‘ç”Ÿé‡ç»˜æˆ–è€…å›æµçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘è¯¥çº¿ç¨‹</li><li>å®ƒå’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥</li></ul></li><li>JSå¼•æ“çº¿ç¨‹<ul><li>è´Ÿè´£ç¨‹åºçš„è§£æå’Œæ‰§è¡Œ</li></ul></li><li>äº‹ä»¶è§¦å‘çº¿ç¨‹<ul><li>å®ƒæ§åˆ¶äº‹ä»¶å¾ªç¯ï¼Œç®¡ç†ç€ä¸€ä¸ªäº‹ä»¶<code>ä»»åŠ¡é˜Ÿåˆ—</code>TaskQueue</li><li>å½“å¼‚æ­¥ä»»åŠ¡æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¼šå°†è¯¥å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒå‡½æ•°æ”¾å…¥åˆ°JSå¼•æ“çº¿ç¨‹æ‰€åœ¨çš„<code>æ‰§è¡Œæ ˆ</code>ä¸­æ‰§è¡Œ</li></ul></li><li>å®šæ—¶è§¦å‘å™¨çº¿ç¨‹<ul><li>setTimeOut å’Œ setInterval æ‰€åœ¨çš„çº¿ç¨‹</li><li>å®šæ—¶å™¨ä»»åŠ¡çš„è®¡æ—¶ä¸æ˜¯ç”±JSå¼•æ“è®¡æ—¶çš„ï¼Œè€Œæ˜¯ç”±è¯¥çº¿ç¨‹æ§åˆ¶</li><li>å½“å®šæ—¶ä»»åŠ¡è®¡æ—¶å®Œæˆä¹‹åï¼Œä¼šé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹</li><li>W3Cåœ¨HTMLæ ‡å‡†ä¸­è§„å®šï¼Œè§„å®šè¦æ±‚setTimeoutä¸­ä½äº4msçš„æ—¶é—´é—´éš”ç®—ä¸º4msã€‚</li></ul></li><li>å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹<ul><li>ä¸€ä¸ªç‹¬ç«‹çš„ajaxè¯·æ±‚çº¿ç¨‹</li><li>å½“è¯·æ±‚å®Œæˆä¹‹åï¼Œä¼šé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹</li></ul></li></ul><h4 id="ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥"><a href="#ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥" class="headerlink" title="ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥"></a>ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥</h4><p>å› ä¸ºJSæ˜¯å¯ä»¥æ“ä½œDOMçš„ï¼Œå¦‚æœä½¿ç”¨JSæ“ä½œDOMçš„åŒæ—¶ï¼ŒGUIçº¿ç¨‹ä¹Ÿåœ¨æ¸²æŸ“DOMï¼Œé‚£ä¹ˆæ¸²æŸ“å®Œæˆä¹‹åçš„å…ƒç´ å¯èƒ½å°±ä¸æ˜¯ä¹‹å‰çš„å…ƒç´ äº†</p><h4 id="ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹"><a href="#ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹"></a>ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹</h4><ul><li>åˆ›å»ºJavaScriptè¯­è¨€çš„æ—¶å€™ï¼Œå¤šè¿›ç¨‹å¤šçº¿ç¨‹çš„æ¶æ„å¹¶ä¸æµè¡Œï¼Œç¡¬ä»¶æ”¯æŒåº¦ä¸é«˜</li><li>å¤šè¿›ç¨‹å¤šçº¿ç¨‹æ“ä½œéœ€è¦åŠ é”ï¼Œæ“ä½œæˆæœ¬è¾ƒé«˜ï¼Œè¾ƒä¸ºå¤æ‚</li><li>å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªDOMï¼Œé‚£ä¹ˆç»“æœä¼šæ˜¯ä¸å¯é¢„æ–™çš„</li><li>çº¿ç¨‹ä¹‹é—´èµ„æºå…±äº«</li></ul><h1 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h1><ul><li>JSçš„ä»»åŠ¡åˆ†ä¸ºåŒæ­¥ä»»ä½•å’Œå¼‚æ­¥ä»»åŠ¡çš„</li><li>åŒæ­¥ä»»åŠ¡éƒ½åœ¨JSå¼•æ“çš„æ‰§è¡Œæ ˆä¸Šæ‰§è¡Œ</li><li>äº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ŒTaskQueueï¼Œå½“å¼‚æ­¥ä»»åŠ¡æ»¡è¶³æ¡ä»¶æ—¶ï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹ä¼šå°†å…¶æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­ï¼Œå½“ä¸»çº¿ç¨‹ï¼ˆJSå¼•æ“çº¿ç¨‹ï¼‰æ‰§è¡Œå®Œæ‰§è¡Œæ ˆä¸­çš„ä»»åŠ¡ä¹‹åï¼Œä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼Œå°±å°†å¯æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒå‡½æ•°æ¨å…¥åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™å†æ¬¡å‘äº‹ä»¶è§¦å‘çº¿ç¨‹å‘èµ·è¯¢é—®ï¼Œç›´åˆ°æœ‰ä¸ºæ­¢ã€‚</li></ul><p><img src="http://cdn.yangkunxiao.cn/EventLoop.png#align=left&display=inline&height=706&originHeight=706&originWidth=1278&status=done&style=none&width=1278" alt=""></p><p>ä»£ç è§£é‡Šï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> timerCallback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timerCallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> httpCallback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'httpCallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'åŒæ­¥ä»»åŠ¡1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span><span class="token comment" spellcheck="true">// é€šçŸ¥å®šæ—¶å™¨çº¿ç¨‹ 1s åå°† timerCallback äº¤ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç†</span><span class="token comment" spellcheck="true">// 1s åäº‹ä»¶è§¦å‘çº¿ç¨‹å°† timerCallback åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>timerCallback<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span><span class="token comment" spellcheck="true">// é€šçŸ¥å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹å‘é€ç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚æˆåŠŸåå°† httpCallback äº¤ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç†</span><span class="token comment" spellcheck="true">// è¯·æ±‚æˆåŠŸåäº‹ä»¶è§¦å‘çº¿ç¨‹å°† httpCallback åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­</span>$<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'www.xxxx.com'</span><span class="token punctuation">,</span>httpCallback<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'åŒæ­¥ä»»åŠ¡2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//...</span><span class="token comment" spellcheck="true">// æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œå</span><span class="token comment" spellcheck="true">// è¯¢é—®äº‹ä»¶è§¦å‘çº¿ç¨‹åœ¨äº‹ä»¶äº‹ä»¶é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°</span><span class="token comment" spellcheck="true">// å¦‚æœæ²¡æœ‰ï¼Œä¸€ç›´è¯¢é—®ï¼Œç›´åˆ°æœ‰ä¸ºæ­¢</span><span class="token comment" spellcheck="true">// å¦‚æœæœ‰ï¼Œå°†å›è°ƒäº‹ä»¶åŠ å…¥æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œå›è°ƒä»£ç </span></code></pre><p>æ€»ç»“ï¼š</p><ul><li>JSå¼•æ“çº¿ç¨‹åªæ‰§è¡Œæ‰§è¡Œæ ˆä¸­çš„äº‹ä»¶</li><li>æ‰§è¡Œæ ˆä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šè¯»å–äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶</li><li>äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒäº‹ä»¶ï¼Œæ˜¯ç”±å„è‡ªçº¿ç¨‹æ’å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­çš„</li><li>å¦‚æ­¤å¾ªç¯</li></ul><h4 id="å®ä»»åŠ¡ã€å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡ã€å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡ã€å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡ã€å¾®ä»»åŠ¡</h4><p>å®ä»»åŠ¡ï¼šå¯ä»¥ç†è§£ä¸ºæµè§ˆå™¨çº§åˆ«çš„ä»»åŠ¡ã€‚ä¸»ä»£ç å—ï¼ŒsetTimeoutï¼ŒsetIntervalç­‰ï¼Œéƒ½å±äºå®ä»»åŠ¡</p><p>å¾®ä»»åŠ¡ï¼šJSå¼•æ“çº§åˆ«çš„ä»»åŠ¡ã€‚Promiseï¼Œprocess.nextTickç­‰ï¼Œå±äº<code>å¾®ä»»åŠ¡</code>ã€‚</p><p>æ‰§è¡Œé¡ºåºï¼š</p><ul><li>å½“å‰ä»£ç å—å¯¹åº”çš„å®ä»»åŠ¡</li><li>å½“å‰å®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹ä¹‹å‰ï¼Œæ‰§è¡Œå½“å‰å¯¹åˆ—çš„å¾®ä»»åŠ¡</li><li>GUIå¼•æ“æ¸²æŸ“</li><li>ä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Koa2æ´‹è‘±æ¨¡å‹</title>
      <link href="/2020/01/16/Koa2/%20Onion-Model/"/>
      <url>/2020/01/16/Koa2/%20Onion-Model/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ…è§£ææ´‹è‘±æ¨¡å‹"><a href="#æµ…è§£ææ´‹è‘±æ¨¡å‹" class="headerlink" title="æµ…è§£ææ´‹è‘±æ¨¡å‹"></a>æµ…è§£ææ´‹è‘±æ¨¡å‹</h1><p>koa2æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ç‹¬ç‰¹çš„ä¸­é—´ä»¶æ§åˆ¶æµç¨‹ã€‚koa2åŸºäºNodeV7.6.0ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨async/awaitæ¥æ›¿ä»£generatorï¼Œä½¿å¾—ä»£ç å½»åº•æ‘†è„±â€œå›è°ƒåœ°ç‹±â€ï¼Œå¯è¯»æ€§æ›´ä½³ã€‚<br><a name="KlEWq"></a></p><h3 id="æ´‹è‘±æ¨¡å‹"><a href="#æ´‹è‘±æ¨¡å‹" class="headerlink" title="æ´‹è‘±æ¨¡å‹"></a>æ´‹è‘±æ¨¡å‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€å¼ ä¸­é—´ä»¶çš„â€œç¥å›¾â€ï¼Œå®ƒå¯ä»¥æ¸…æ™°çš„è¡¨ç¤ºå‡ºï¼šä»ä»£ç è¯·æ±‚åˆ°å“åº”çš„è¿‡ç¨‹ä¸­ï¼Œä¸­é—´ä»¶çš„å·¥ä½œæµç¨‹ã€‚<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579140335664-560c41e9-c60c-4004-9c8d-8991f1396ccf.png#align=left&display=inline&height=347&name=image.png&originHeight=694&originWidth=1034&size=342796&status=done&style=none&width=517" alt="image.png"><br><a name="FNydJ"></a></p><h4 id="å°demo"><a href="#å°demo" class="headerlink" title="å°demo"></a>å°demo</h4><p>å…ˆçœ‹ä¸ªå°ğŸŒ°å§ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'koaæœåŠ¡å™¨å·²å¯åŠ¨'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//1 3 5 4 2</span></code></pre><p>å¯åŠ¨demoï¼Œè®¿é—®æœåŠ¡å™¨åœ°å€ï¼Œæ§åˆ¶å°å°±ä¼šè¾“å‡ºç­”æ¡ˆï¼š 1ã€3ã€5ã€4ã€2 ã€‚<br />ä»è¿™ä¸ªğŸŒ°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“ç¨‹åºæ‰§è¡Œé‡åˆ°await next() çš„æ—¶å€™ï¼Œä¼šæš‚åœæ‰§è¡Œå½“å‰ä»£ç å—ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œç­‰ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œå®Œä¹‹åå†å›è¿‡å¤´æ¥ç»§ç»­å¤„ç†ã€‚<br><a name="QoOvG"></a></p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å½“åœ¨ä¸€ä¸ªä¸­é—´ä»¶ä¸­è°ƒç”¨await next()æ—¶ï¼Œå½“å‰ä¸­é—´ä»¶å°±ä¼šæŠŠç¨‹åºçš„æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚å½“ä¸‹æ¸¸æ²¡æœ‰ä¸­é—´ä»¶ç­‰å¾…æ‰§è¡Œçš„æ—¶å€™ï¼Œç¨‹åºå°±ä¼šå›æº¯ä¸Šæ¸¸ï¼Œæ‰§è¡Œä¸Šæ¸¸ä¸­é—´ä»¶ç­‰å¾…æ‰§è¡Œçš„è¡Œä¸ºã€‚<br><a name="7htbI"></a></p><h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><p>koa2çš„æºç åªæœ‰å››ä¸ªæ–‡ä»¶ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹<a href="https://github.com/koajs/koa" target="_blank" rel="noopener">Koa2æºç </a></p><ul><li>application.jsï¼šå…¥å£æ–‡ä»¶ã€‚</li><li>context.jsï¼šåº”ç”¨ä¸Šä¸‹æ–‡æ–‡ä»¶ã€‚</li><li>request.jsï¼šè¯·æ±‚å¤„ç†æ–‡ä»¶ã€‚</li><li>response.jsï¼šå“åº”å¤„ç†æ–‡ä»¶ã€‚</li></ul><p>å…ˆä»å…¥å£æ–‡ä»¶çœ‹èµ·ï¼š<br><a name="M2Hls"></a></p><h4 id="application-js"><a href="#application-js" class="headerlink" title="application.js"></a>application.js</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**     * Shorthand for:     *     *    http.createServer(app.callback()).listen(...)     *     * @param {Mixed} ...     * @return {Server}     * @api public     */</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'listen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åœ¨å…¥å£æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„<code>app.listen(port)</code>ï¼Œåªæ˜¯ä¸€ä¸ªâ€œè¯­æ³•ç³–â€ï¼Œå®ƒåªæ˜¯ä½¿ç”¨æ¥ <code>this.callback()</code> æ¥ç”Ÿæˆ<code>node</code>çš„<code>httpServer</code>çš„å›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹<code>this.callback()</code></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**     * Return a request handler callback     * for node's native http server.     *     * @return {Function}     * @api public     */</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listenerCount</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> handleRequest <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> handleRequest<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œé¦–å…ˆä½¿ç”¨<code>compose</code>å°†ä¸­é—´ä»¶ç»„åˆèµ·æ¥ï¼Œ<code>compose</code>å°±æ˜¯ä¸€ä¸ªæŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œå®ƒæ¥å—ä¸­é—´ä»¶æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿”å›å‡½æ•°ä¸­ï¼Œæ¥å—åº”ç”¨ä¸Šä¸‹æ–‡<code>ctxå’Œnext</code>ï¼Œè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ã€‚<br /><a href="https://github.com/koajs/compose/blob/master/index.js" target="_blank" rel="noopener">composeæºç </a>ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token comment" spellcheck="true">/** * Expose compositor. */</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> compose<span class="token comment" spellcheck="true">/** * Compose `middleware` returning * a fully valid middleware comprised * of all those which are passed. * * @param {Array} middleware * @return {Function} * @api public */</span><span class="token keyword">function</span> compose <span class="token punctuation">(</span>middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Middleware stack must be an array!'</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> fn <span class="token keyword">of</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Middleware must be composed of functions!'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * @param {Object} context   * @return {Promise}   * @api public   */</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// last called middleware #</span>    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">function</span> dispatch <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'next() called multiple times'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      index <span class="token operator">=</span> i      <span class="token keyword">let</span> fn <span class="token operator">=</span> middleware<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> middleware<span class="token punctuation">.</span>length<span class="token punctuation">)</span> fn <span class="token operator">=</span> next      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> dispatch<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨<code>compose</code>å‡½æ•°ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯ä½¿ç”¨<code>diapatch()</code>å‡½æ•°ï¼Œéå†ä¸­é—´ä»¶æ•°ç»„ï¼Œç„¶åå°†<code>ctxå’Œdispatch(i + 1)</code>ä¼ é€’ç»™ä¸­é—´ä»¶çš„æ–¹æ³•ä¸­ã€‚å®ƒåšåˆ°äº†ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>å°†ctxåº”ç”¨æ–‡å¯¹è±¡ä¸€ç›´ä¼ é€’ä¸‹å»ã€‚</li><li>å°†ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ä½œä¸ºæœªæ¥çš„nextçš„è¿”å›å€¼ã€‚</li></ul><p>åœ¨<code>this.callback()</code>ä¸­ä¹Ÿä½¿ç”¨äº†<code>createContext()</code> å’Œ <code>handleRequest()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒä»¬åšæ¥ä»€ä¹ˆã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**     * Handle request in callback.     *     * @api private     */</span>    <span class="token function">handleRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fnMiddleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> res <span class="token operator">=</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">;</span>        res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> onerror <span class="token operator">=</span> err <span class="token operator">=</span><span class="token operator">></span> ctx<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> handleResponse <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">respond</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">onFinished</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">fnMiddleware</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Initialize a new context.     *     * @api private     */</span>    <span class="token function">createContext</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span>request <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> response <span class="token operator">=</span> context<span class="token punctuation">.</span>response <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span>app <span class="token operator">=</span> request<span class="token punctuation">.</span>app <span class="token operator">=</span> response<span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span>req <span class="token operator">=</span> request<span class="token punctuation">.</span>req <span class="token operator">=</span> response<span class="token punctuation">.</span>req <span class="token operator">=</span> req<span class="token punctuation">;</span>        context<span class="token punctuation">.</span>res <span class="token operator">=</span> request<span class="token punctuation">.</span>res <span class="token operator">=</span> response<span class="token punctuation">.</span>res <span class="token operator">=</span> res<span class="token punctuation">;</span>        request<span class="token punctuation">.</span>ctx <span class="token operator">=</span> response<span class="token punctuation">.</span>ctx <span class="token operator">=</span> context<span class="token punctuation">;</span>        request<span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>        response<span class="token punctuation">.</span>request <span class="token operator">=</span> request<span class="token punctuation">;</span>        context<span class="token punctuation">.</span>originalUrl <span class="token operator">=</span> request<span class="token punctuation">.</span>originalUrl <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>        context<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> context<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>åœ¨<code>createContext()</code>ä¸­ï¼Œè¿”å›ä¸€ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡<code>context</code>ã€‚åœ¨<code>handleRequest()</code>ä¸­ï¼Œå°†åº”ç”¨ä¸Šä¸‹æ–‡ctxå’Œä¸­é—´ä»¶è¿›è¡Œç»‘å®šã€‚<br />åœ¨Koa2ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸­é—´ä»¶çš„æ—¶å€™éœ€è¦ä½¿ç”¨<code>app.use()</code>æ¥æ³¨å†Œä¸­é—´ä»¶ï¼Œé‚£ä¹ˆ<code>app.use()</code>åˆ°åº•åšæ¥ä»€ä¹ˆå‘¢ï¼Ÿ</p><pre class=" language-javascript"><code class="language-javascript"> <span class="token comment" spellcheck="true">/**     * Use the given middleware `fn`.     *     * Old-style middleware will be converted.     *     * @param {Function} fn     * @return {Application} self     * @api public     */</span><span class="token function">use</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'middleware must be a function!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isGeneratorFunction</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token string">'Support for generators will be removed in v3. '</span> <span class="token operator">+</span>              <span class="token string">'See the documentation for examples of how to convert old middleware '</span> <span class="token operator">+</span>              <span class="token string">'https://github.com/koajs/koa/blob/master/docs/migration.md'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    fn <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'use %s'</span><span class="token punctuation">,</span> fn<span class="token punctuation">.</span>_name <span class="token operator">||</span> fn<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å»é™¤æ³¨é‡Šå’ŒéªŒè¯ï¼Œå®ƒåªåšäº†ä¸¤ä»¶äº‹ï¼š</p><ul><li>å°†ä¸­é—´ä»¶å‡½æ•°pushåˆ°ä¸­é—´ä»¶æ•°ç»„(æ ˆ)ã€‚</li><li>è¿”å›koaå®ä¾‹å¯¹è±¡ã€‚<pre class=" language-javascript"><code class="language-javascript"><span class="token function">use</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre></li></ul><p><a name="er16I"></a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‰€è°“â€œæ´‹è‘±æ¨¡å‹â€ï¼Œå°±æ˜¯å½“æ‰§è¡Œä¸­é—´ä»¶å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœç¢°åˆ°<code>await next()</code>ï¼Œå°±ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼ˆä¸Šé¢è¯´è¿‡ï¼Œä¸­é—´ä»¶æ³¨å†Œçš„æ—¶å€™ï¼Œä¼šæŠŠä¸‹ä¸€ä¸ªä¸­é—´ä»¶å½“ä½œæœªæ¥çš„next()å‡½æ•°ï¼‰ï¼Œè¿™é‡Œnext()å°±æ˜¯ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Koa2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Koa2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Koa2åŸºç¡€</title>
      <link href="/2020/01/16/Koa2/base/"/>
      <url>/2020/01/16/Koa2/base/</url>
      
        <content type="html"><![CDATA[<h1 id="Koa2å­¦ä¹ ç¬”è®°"><a href="#Koa2å­¦ä¹ ç¬”è®°" class="headerlink" title="Koa2å­¦ä¹ ç¬”è®°"></a>Koa2å­¦ä¹ ç¬”è®°</h1><p><a name="1wfVW"></a></p><h2 id="Koa2ç®€ä»‹"><a href="#Koa2ç®€ä»‹" class="headerlink" title="Koa2ç®€ä»‹"></a>Koa2ç®€ä»‹</h2><p>Koaæ˜¯ä¸€æ¬¾æ–°çš„webæ¡†æ¶ï¼Œå®ƒæ˜¯ç”±ExpressåŸç­äººé©¬æ‰“é€ ï¼Œç›¸æ¯”ä¸Expressï¼ŒKoaæ›´åŠ miniã€ç®€æ´ã€å¥å£®ã€‚å®ƒæ²¡æœ‰ç»‘å®šä»»ä½•ä¸­é—´ä»¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ‰‹æ’¸ä»»ä½•ä¸­é—´ä»¶ã€‚è€Œä¸”ï¼ŒKoa2é€šè¿‡ä½¿ç”¨async/awaitï¼Œä½¿å¾—ä»£ç çš„å¯è¯»æ€§æ›´ä½³ã€‚<br><a name="XZjHi"></a></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Koa2ä¾èµ–äºnodeV7.6.0æˆ–è€…ES2015åŠæ›´é«˜çš„ç‰ˆæœ¬å’Œasyncçš„æ”¯æŒã€‚</p><pre class=" language-javascript"><code class="language-javascript">#åˆå§‹åŒ–<span class="token keyword">package</span><span class="token punctuation">.</span>jsonnpm init#å®‰è£…npm7npm install <span class="token number">7</span>#å®‰è£…koa2npm install koa</code></pre><p><a name="2FIV5"></a></p><h3 id="async-await-å°demo"><a href="#async-await-å°demo" class="headerlink" title="async/await å°demo"></a>async/await å°demo</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test async'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>time<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">'something'</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//async awaitç®€å•æ¡ˆä¾‹</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>2sä¹‹åï¼Œä¾æ¬¡æ‰“å°<code>test async something</code>ã€‚<br />awaitå¿…é¡»å­˜åœ¨äºasyncå‡½æ•°ä¹‹å†…ï¼Œä¸”awaitåé¢çš„ä»£ç ä¼šè¢«â€œé˜»å¡â€ï¼Œç­‰å¾…awaitåé¢çš„promiseæ‰§è¡Œã€‚</p><ul><li>å¯ä»¥è®©å¼‚æ­¥é€»è¾‘ç”¨åŒæ­¥å†™æ³•å®ç°</li><li>awaitè¿”å›çš„éœ€è¦æ˜¯promiseå¯¹è±¡</li><li>å¯ä»¥é€šè¿‡å¤šå±‚ async function çš„åŒæ­¥å†™æ³•ä»£æ›¿ä¼ ç»Ÿçš„callbackåµŒå¥—<br><a name="O7S0g"></a><h3 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h3></li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å…¥é—¨ğŸŒ°</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello kaka'</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello koa'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre><p>å¯åŠ¨demoï¼Œ<code>node app.js</code>ï¼Œæ‰“å¼€<a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a>ï¼Œå³å¯çœ‹åˆ°:<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579095453796-e8cb2c09-b080-429f-a755-a6cd34c2899e.png#align=left&display=inline&height=128&name=image.png&originHeight=256&originWidth=2130&size=92159&status=done&style=none&width=1065" alt="image.png"><br><a name="3vqTK"></a></p><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><p><a name="kcrwS"></a></p><h3 id="kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨"><a href="#kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨" class="headerlink" title="kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨"></a>kaoä¸­é—´ä»¶å¼€å‘ä¸ä½¿ç”¨</h3><p>ä¸­é—´ä»¶çš„ç±»å‹æœ‰ä¸€ä¸‹å››ç§ï¼š</p><ul><li>åº”ç”¨çº§ä¸­é—´ä»¶</li><li>è·¯ç”±çº§ä¸­é—´ä»¶</li><li>é”™è¯¯å¤„ç†ä¸­é—´ä»¶</li><li>ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶<br><a name="TRa97"></a><h4 id="æ´‹è‘±æ¨¡å‹"><a href="#æ´‹è‘±æ¨¡å‹" class="headerlink" title="æ´‹è‘±æ¨¡å‹"></a>æ´‹è‘±æ¨¡å‹</h4>å½“ä¸€ä¸ªä¸­é—´ä»¶è°ƒç”¨ next() åˆ™è¯¥å‡½æ•°æš‚åœå¹¶å°†æ§åˆ¶ä¼ é€’ç»™å®šä¹‰çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚<br />å½“åœ¨ä¸‹æ¸¸æ²¡æœ‰æ›´å¤šçš„ä¸­é—´ä»¶æ‰§è¡Œåï¼Œå †æ ˆå°†å±•å¼€å¹¶ä¸”æ¯ä¸ªä¸­é—´ä»¶æ¢å¤æ‰§è¡Œå…¶ä¸Šæ¸¸è¡Œä¸ºã€‚<br />çœ‹ğŸŒ°ï¼š</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ´‹è‘±æ¨¡å‹</span><span class="token comment" spellcheck="true">// #1</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// #2</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'koaæœåŠ¡å™¨å·²å¯åŠ¨'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//1 3 5 4 2</span></code></pre><p><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579098156840-d6938d82-0e6c-4268-bd66-8e6cf529ae30.png#align=left&display=inline&height=457&name=image.png&originHeight=914&originWidth=1194&size=499102&status=done&style=none&width=597" alt="image.png"><br /></p><p><a name="8UENn"></a></p><h4 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//middleware/logger.js</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>commondata <span class="token operator">=</span> <span class="token string">'æˆ‘æ˜¯åº”ç”¨çº§ä¸­é—´ä»¶'</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"åº”ç”¨çº§ä¸­é—´ä»¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p><a name="PwNgl"></a></p><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//app.js</span><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./middleware/logger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åº”ç”¨çº§ä¸­é—´ä»¶</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'koaæœåŠ¡å™¨å·²å¯åŠ¨'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><a name="zy98m"></a></p><h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p><a name="JZ0Uj"></a></p><h3 id="åŸç”Ÿå®ç°"><a href="#åŸç”Ÿå®ç°" class="headerlink" title="åŸç”Ÿå®ç°"></a>åŸç”Ÿå®ç°</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyparser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyparser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @param { string } æ–‡ä»¶å * @return { promise } è¿”å›æ–‡ä»¶ *  */</span><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> pagePath <span class="token operator">=</span> <span class="token template-string"><span class="token string">`./html/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pagePath<span class="token punctuation">)</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pagePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * @param { string } è®¿é—®è·¯ç”± * @return { string }  html*/</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getHtml</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token string">'404.html'</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'/'</span><span class="token punctuation">:</span>            <span class="token punctuation">{</span>                page <span class="token operator">=</span> <span class="token string">'index.html'</span><span class="token punctuation">;</span>                <span class="token keyword">break</span>            <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token string">'/list'</span><span class="token punctuation">:</span>            <span class="token punctuation">{</span>                page <span class="token operator">=</span> <span class="token string">'list.html'</span><span class="token punctuation">;</span>                <span class="token keyword">break</span>            <span class="token punctuation">}</span>        <span class="token keyword">default</span><span class="token punctuation">:</span>            <span class="token punctuation">{</span>                page <span class="token operator">=</span> <span class="token string">'404.html'</span><span class="token punctuation">;</span>                <span class="token keyword">break</span>            <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">render</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> html<span class="token punctuation">}</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è¯»å–æ–‡ä»¶æ˜¯å¼‚æ­¥</span>    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getHtml</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> html<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server is running at http://127.0.0.1:3000"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>å¯åŠ¨demoä¹‹åï¼Œè®¿é—®<a href="http://localhost:3000/ï¼Œ" target="_blank" rel="noopener">http://localhost:3000/</a>å³å¯<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/705088/1579097257575-a5314b89-8a2d-465b-80a2-89b043ea75c2.png#align=left&display=inline&height=297&name=image.png&originHeight=594&originWidth=2136&size=160514&status=done&style=none&width=1068" alt="image.png"><br><a name="Vkn9O"></a></p><h3 id="koa-router"><a href="#koa-router" class="headerlink" title="koa-router"></a>koa-router</h3><p>å®‰è£…å¯¹åº”çš„koa-routerä¸­é—´ä»¶ï¼š<br /><code>npm install koa-router</code><br /><a href="https://github.com/yangkunxiao/koa2/blob/master/demo05.js" target="_blank" rel="noopener">demoæºç </a></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyparser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è®¾ç½®è·¯ç”±å‰ç¼€ </span>    prefix<span class="token punctuation">:</span><span class="token string">'/kaka'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span>next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server is running at http://127.0.0.1:3000"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><a name="OQeoY"></a></p><h2 id="è¯·æ±‚æ•°æ®å¤„ç†"><a href="#è¯·æ±‚æ•°æ®å¤„ç†" class="headerlink" title="è¯·æ±‚æ•°æ®å¤„ç†"></a>è¯·æ±‚æ•°æ®å¤„ç†</h2><p><a name="LLtOO"></a></p><h3 id="Getè¯·æ±‚"><a href="#Getè¯·æ±‚" class="headerlink" title="Getè¯·æ±‚"></a>Getè¯·æ±‚</h3><p>åœ¨koaä¸­ï¼Œè·å–GETè¯·æ±‚æ•°æ®æºå¤´æ˜¯koaä¸­requestå¯¹è±¡ä¸­çš„queryæ–¹æ³•æˆ–querystringæ–¹æ³•ï¼Œqueryè¿”å›æ˜¯æ ¼å¼åŒ–å¥½çš„å‚æ•°å¯¹è±¡ï¼Œquerystringè¿”å›çš„æ˜¯è¯·æ±‚å­—ç¬¦ä¸²ï¼Œç”±äºctxå¯¹requestçš„APIæœ‰ç›´æ¥å¼•ç”¨çš„æ–¹å¼ï¼Œæ‰€ä»¥è·å–GETè¯·æ±‚æ•°æ®æœ‰ä¸¤ä¸ªé€”å¾„ã€‚</p><ul><li>æ˜¯ä»ä¸Šä¸‹æ–‡ä¸­ç›´æ¥è·å–</li><li>æ˜¯ä»ä¸Šä¸‹æ–‡çš„requestå¯¹è±¡ä¸­è·å–</li></ul><p>çœ‹ğŸŒ°: <a href="https://github.com/yangkunxiao/koa2/blob/master/demo03.js" target="_blank" rel="noopener">æºç </a></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä½¿ç”¨ä¸­é—´ä»¶koa-bodyparser</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">;</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span>    <span class="token keyword">const</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>    <span class="token keyword">const</span> query <span class="token operator">=</span> request<span class="token punctuation">.</span>query<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿”å›çš„æ˜¯æ ¼å¼åŒ–å¥½çš„å‚æ•°å¯¹è±¡ã€‚</span>    <span class="token keyword">const</span> querystring <span class="token operator">=</span> request<span class="token punctuation">.</span>querystring<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿”å›çš„æ˜¯è¯·æ±‚å­—ç¬¦ä¸²ã€‚</span>    <span class="token comment" spellcheck="true">//ç›´æ¥ä»ctxä¸­è·å–query</span>    <span class="token keyword">const</span> ctx_query <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query<span class="token punctuation">;</span>    <span class="token keyword">const</span> ctx_querystring <span class="token operator">=</span> ctx<span class="token punctuation">.</span>querystring<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'GET'</span> <span class="token operator">&amp;&amp;</span> url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token string">`        &lt;h1>Koa2 request post demo&lt;/h1>        &lt;form method="POST"  action="/">            &lt;p>userName&lt;/p>            &lt;input name="userName" /> &lt;br/>            &lt;p>age&lt;/p>            &lt;input name="age" /> &lt;br/>            &lt;p>webSite&lt;/p>            &lt;input name='webSite' />&lt;br/>            &lt;button type="submit">submit&lt;/button>        &lt;/form>        `</span></span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// const postDate = await handlePostData(ctx);</span>        <span class="token keyword">const</span> postDate <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> postDate<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å…¶å®ƒè¯·æ±‚æ˜¾ç¤º404é¡µé¢</span>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1>404!&lt;/h1>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>        url<span class="token punctuation">,</span>        methods<span class="token punctuation">,</span>        query<span class="token punctuation">,</span>        querystring<span class="token punctuation">,</span>        ctx_query<span class="token punctuation">,</span>        ctx_querystring    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre><p><a name="8dDci"></a></p><h3 id="Postè¯·æ±‚"><a href="#Postè¯·æ±‚" class="headerlink" title="Postè¯·æ±‚"></a>Postè¯·æ±‚</h3><p>å¯¹äºPOSTè¯·æ±‚çš„å¤„ç†ï¼Œkoa2æ²¡æœ‰å°è£…è·å–å‚æ•°çš„æ–¹æ³•ï¼Œéœ€è¦é€šè¿‡è§£æä¸Šä¸‹æ–‡contextä¸­çš„åŸç”Ÿnode.jsè¯·æ±‚å¯¹è±¡reqï¼Œå°†POSTè¡¨å•æ•°æ®è§£ææˆquery stringï¼Œå†å°†query string è§£ææˆJSONæ ¼å¼ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//ä½¿ç”¨nodeä¸­çš„æ–¹å¼å¤„ç†postè¯·æ±‚æ•°æ®</span><span class="token keyword">function</span> <span class="token function">handlePostData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> querystring <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>            ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                querystring <span class="token operator">+</span><span class="token operator">=</span> data<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> bodyParse <span class="token operator">=</span> <span class="token function">parseStringData</span><span class="token punctuation">(</span>querystring<span class="token punctuation">)</span>                <span class="token function">resolve</span><span class="token punctuation">(</span>bodyParse<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">parseStringData</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> stringList <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> stringList<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        item<span class="token punctuation">[</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> item<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><a name="aKKyJ"></a></p><h3 id="ä½¿ç”¨koa-parserä¸­é—´ä»¶"><a href="#ä½¿ç”¨koa-parserä¸­é—´ä»¶" class="headerlink" title="ä½¿ç”¨koa-parserä¸­é—´ä»¶"></a>ä½¿ç”¨koa-parserä¸­é—´ä»¶</h3><p>å¯¹äºPOSTè¯·æ±‚çš„å¤„ç†ï¼Œkoa-bodyparserä¸­é—´ä»¶å¯ä»¥æŠŠkoa2ä¸Šä¸‹æ–‡çš„formDataæ•°æ®è§£æåˆ°ctx.request.bodyä¸­<br />å®‰è£…ï¼š<code>npm install koa-parser</code>ã€‚<br />ä½¿ç”¨ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> bodyParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä½¿ç”¨ä¸­é—´ä»¶koa-bodyparser</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a name="f0a8J"></a></p><h2 id="é™æ€èµ„æºå¤„ç†"><a href="#é™æ€èµ„æºå¤„ç†" class="headerlink" title="é™æ€èµ„æºå¤„ç†"></a>é™æ€èµ„æºå¤„ç†</h2><p><a name="QGNys"></a></p><h3 id="koa-staticä¸­é—´ä»¶"><a href="#koa-staticä¸­é—´ä»¶" class="headerlink" title="koa-staticä¸­é—´ä»¶"></a>koa-staticä¸­é—´ä»¶</h3><p>å®‰è£…ï¼š<code>npm install koa-static</code></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span>    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./static'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token keyword">async</span> <span class="token punctuation">(</span> ctx <span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello world'</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'static-use-middleware is starting at port 3000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><a name="ZkFRd"></a></p><h2 id="cookie-session"><a href="#cookie-session" class="headerlink" title="cookie/session"></a>cookie/session</h2><p><a name="VybS8"></a></p><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>koaæä¾›äº†ç›´æ¥æ“ä½œcookieçš„æ–¹æ³•ï¼š</p><ul><li>ctx.cookies.get(name, [options]) è¯»å–ä¸Šä¸‹æ–‡è¯·æ±‚ä¸­çš„cookie</li><li>ctx.cookies.set(name, value, [options]) åœ¨ä¸Šä¸‹æ–‡ä¸­å†™å…¥cookie</li></ul><p>ä½¿ç”¨ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * domainï¼šå†™å…¥cookieæ‰€åœ¨çš„åŸŸå     * pathï¼šå†™å…¥cookieæ‰€åœ¨çš„è·¯å¾„     * maxAgeï¼šCookieæœ€å¤§æœ‰æ•ˆæ—¶é•¿     * expiresï¼šcookieå¤±æ•ˆæ—¶é—´     * httpOnly:æ˜¯å¦åªç”¨httpè¯·æ±‚ä¸­è·å¾—     * overwirteï¼šæ˜¯å¦å…è®¸é‡å†™    */</span>   <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>            <span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"ykx"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>                domain<span class="token punctuation">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>                maxAge<span class="token punctuation">:</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">,</span>                expires<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-12-30'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                httpOnly<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>                overwrite<span class="token punctuation">:</span><span class="token boolean">true</span>            <span class="token punctuation">}</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'cookie is ready'</span>   <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">const</span> str <span class="token operator">=</span> ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> str<span class="token punctuation">;</span>       <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'cookies is none'</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a name="OvJpf"></a></p><h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>koaåŸç”Ÿåªæä¾›äº†æ“ä½œcookieçš„æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰sessionæ“ä½œã€‚æ‰€ä»¥å¯¹sessinoçš„æ“ä½œéœ€è¦è‡ªå·±å®ç°æˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚<br />å°†sessionå­˜å‚¨åˆ°æ•°æ®åº“ï¼Œéœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ï¼š</p><ul><li>koa-session-minimal é€‚ç”¨äºkoa2 çš„sessionä¸­é—´ä»¶ï¼Œæä¾›å­˜å‚¨ä»‹è´¨çš„è¯»å†™æ¥å£ ã€‚</li><li>koa-mysql-session ä¸ºkoa-session-minimalä¸­é—´ä»¶æä¾›MySQLæ•°æ®åº“çš„sessionæ•°æ®è¯»å†™æ“ä½œã€‚</li></ul><p>å®‰è£…ï¼š</p><pre class=" language-javascript"><code class="language-javascript">npm install koa<span class="token operator">-</span>session<span class="token operator">-</span>minimal koa<span class="token operator">-</span>mysql<span class="token operator">-</span>session <span class="token operator">--</span>save</code></pre><p>è¿‡ç¨‹ï¼š</p><ul><li>ç”Ÿæˆsessionï¼Œå¹¶å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</li><li>ä½¿ç”¨æ’ä»¶æ“ä½œæ•°æ®åº“ï¼Œå¹¶å°†sessionIdå’Œå¯¹åº”çš„æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</li><li>å°†æ•°æ®åº“çš„sessionIdå†™å…¥åˆ°é¡µé¢çš„cookieä¸­ã€‚</li><li>æ ¹æ®é¡µé¢cookieæºå¸¦çš„sessionIdå–å‡ºæ•°æ®åº“ä¸­å¯¹åº”çš„æ•°æ®ã€‚</li></ul><p>çœ‹ä»£ç ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-session-minimal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> MysqlSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-mysql-session"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// é…ç½®å­˜å‚¨sessionä¿¡æ¯çš„mysql</span><span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MysqlSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ•°æ®åº“ç”¨æˆ·</span>    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//å¯†ç </span>    database<span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ•°æ®åº“åç§°</span>    host<span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//æ•°æ®åº“åœ°å€</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å­˜æ”¾sessionIdçš„cookieé…ç½®</span><span class="token keyword">let</span> cookie <span class="token operator">=</span> <span class="token punctuation">{</span>    maxAge<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// cookieæœ‰æ•ˆæ—¶é•¿</span>    expires<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// cookieå¤±æ•ˆæ—¶é—´</span>    path<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å†™cookieæ‰€åœ¨çš„è·¯å¾„</span>    domain<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// å†™cookieæ‰€åœ¨çš„åŸŸå</span>    httpOnly<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ˜¯å¦åªç”¨äºhttpè¯·æ±‚ä¸­è·å–</span>    overwrite<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// æ˜¯å¦å…è®¸é‡å†™</span>    secure<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    sameSite<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    signed<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    key<span class="token punctuation">:</span> <span class="token string">'SESSION_ID'</span><span class="token punctuation">,</span>    store<span class="token punctuation">,</span>    cookie<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è®¾ç½®session</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/set'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ctx<span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token punctuation">{</span>            user_id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            count<span class="token punctuation">:</span> <span class="token number">0</span>        <span class="token punctuation">}</span>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¯»å–sessionä¿¡æ¯</span>        ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>count <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] session is starting at port 3000'</span><span class="token punctuation">)</span></code></pre><p><a name="QgQlX"></a></p><h2 id="æ¨¡ç‰ˆå¼•æ“ejs"><a href="#æ¨¡ç‰ˆå¼•æ“ejs" class="headerlink" title="æ¨¡ç‰ˆå¼•æ“ejs"></a>æ¨¡ç‰ˆå¼•æ“ejs</h2><p><a name="KPvdu"></a></p><h3 id="ejs"><a href="#ejs" class="headerlink" title="ejs"></a>ejs</h3><p>å…·ä½“ä½¿ç”¨è¯·æŸ¥çœ‹<a href="https://ejs.bootcss.com/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a><br><a name="3zFI3"></a></p><h3 id="koa2ä½¿ç”¨ejs"><a href="#koa2ä½¿ç”¨ejs" class="headerlink" title="koa2ä½¿ç”¨ejs"></a>koa2ä½¿ç”¨ejs</h3><p>å®‰è£…ï¼š</p><pre class=" language-javascript"><code class="language-javascript">#å®‰è£…koaæ¨¡ç‰ˆä½¿ç”¨ä¸­é—´ä»¶npm install koa<span class="token operator">-</span>views <span class="token operator">--</span>save#å®‰è£…ejsæ¨¡ç‰ˆå¼•æ“npm install ejs <span class="token operator">--</span>save</code></pre><p>ä½¿ç”¨ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> views <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-views'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åŠ è½½ejsæ¨¡ç‰ˆ è®¾ç½®æ¨¡ç‰ˆæ–‡ä»¶å¤¹</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./views'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>    extension<span class="token punctuation">:</span><span class="token string">'ejs'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token string">'hello ejs'</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//æ¸²æŸ“æ¨¡ç‰ˆ</span>    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>        title    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is starting at 127.0.0.1:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>viewsä¸‹çš„æ¨¡ç‰ˆï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token operator">&lt;</span>html<span class="token operator">></span><span class="token operator">&lt;</span>head<span class="token operator">></span>    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span>    <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>    <span class="token operator">&lt;</span>p<span class="token operator">></span>EJS Welcome to <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><p><a name="M5CLj"></a></p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p><a name="b2vUY"></a></p><h4 id="busboy"><a href="#busboy" class="headerlink" title="busboy"></a>busboy</h4><p>busboyç”¨æ¥è§£æPostè¯·æ±‚ï¼Œè¯»å–åŸç”Ÿnodeçš„reqä¸­çš„æ–‡ä»¶æµã€‚å…·ä½“ä½¿ç”¨è¯·<a href="https://www.npmjs.com/package/busboy" target="_blank" rel="noopener">ç§»æ­¥</a>ã€‚<br />å®‰è£…ï¼š<br /><code>npm install busboy --save</code><br />ä½¿ç”¨ï¼š<a href="https://github.com/yangkunxiao/koa2/blob/master/demo12.js" target="_blank" rel="noopener">æºç </a><br />app.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//æ–‡ä»¶ä¸Šä¼ </span><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Views <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-views'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./util/syncUpload.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">Views</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/views'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    extension<span class="token punctuation">:</span> <span class="token string">'ejs'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'static'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">upload</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">{</span>        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'static'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;img src="'</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'" style="max-width: 100%">'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre><p>ejsä¸Šä¼ æ¨¡ç‰ˆï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span><span class="token operator">&lt;</span>head<span class="token operator">></span>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"ie=edge"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>title<span class="token operator">></span>æ–‡ä»¶ä¸Šä¼ <span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span>    <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">"/upload"</span> method<span class="token operator">=</span><span class="token string">"post"</span> enctype<span class="token operator">=</span><span class="token string">"multipart/form-data"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"file"</span><span class="token operator">></span>æ–‡ä»¶<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> name<span class="token operator">=</span><span class="token string">"file"</span> id<span class="token operator">=</span><span class="token string">"file"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><p>nodeä¸Šä¼ å¤„ç†æ–‡ä»¶</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> BusBoy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'busboy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€å * @param  {string} fileName è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€å * @return {string}          æ–‡ä»¶åç¼€å */</span><span class="token keyword">function</span> <span class="token function">getFileSuffixName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> nameList <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> nameList<span class="token punctuation">[</span>nameList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * åŒæ­¥åˆ›å»ºæ–‡ä»¶ç›®å½• * @param { string } filePath æ–‡ä»¶ä¸Šä¼ è·¯å¾„ * @return { boolean }         è¿”å›ç»“æœ */</span><span class="token keyword">function</span> <span class="token function">mkdirPath</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * åŒæ­¥ä¸Šä¼ æ–‡ä»¶ * @param { ctx } Object ä¸Šä¸‹æ–‡å¯¹è±¡ * @param { options } Object é…ç½®å‚æ•° * @return { promise }   è¿”å›ä¸Šä¼ ç»“æœçš„promise */</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> req <span class="token operator">=</span> ctx<span class="token punctuation">.</span>req<span class="token punctuation">;</span>        <span class="token keyword">let</span> res <span class="token operator">=</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">;</span>        <span class="token keyword">let</span> busboy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BusBoy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> headers<span class="token punctuation">:</span> req<span class="token punctuation">.</span>headers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>            success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            path<span class="token punctuation">:</span> <span class="token keyword">null</span>        <span class="token punctuation">}</span>        busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>fieldname<span class="token punctuation">,</span> file<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> mimetype<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'File ['</span> <span class="token operator">+</span> fieldname <span class="token operator">+</span> <span class="token string">']: filename: '</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">'encoding: '</span> <span class="token operator">+</span> encoding <span class="token operator">+</span> <span class="token string">'mimetype: '</span> <span class="token operator">+</span> mimetype<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> fileName <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> <span class="token function">getFileSuffixName</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// let filePath = mkdirPath(options.path) &amp;&amp; (options.path + '/' + filename);</span>            <span class="token keyword">let</span> filePath <span class="token operator">=</span> filename<span class="token punctuation">;</span>            file<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'File ['</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">'] got '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">' bytes'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            file<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'File ['</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">'] finished '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                result<span class="token punctuation">.</span>success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                result<span class="token punctuation">.</span>path <span class="token operator">=</span> filePath<span class="token punctuation">;</span>                <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            file<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token function">reject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è§£æè¡¨å•ä¸­å…¶ä»–å­—æ®µä¿¡æ¯</span>            busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'field'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fieldname<span class="token punctuation">,</span> val<span class="token punctuation">,</span> fieldnameTruncated<span class="token punctuation">,</span> valTruncated<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> mimetype<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// console.log('è¡¨å•å­—æ®µæ•°æ® [' + fieldname + ']: value: ' + inspect(val));</span>                <span class="token comment" spellcheck="true">// result.formData[fieldname] = inspect(val);</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è§£æç»“æŸäº‹ä»¶</span>            busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶ä¸Šä¼ ç»“æŸ'</span><span class="token punctuation">)</span>                <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è§£æé”™è¯¯äº‹ä»¶</span>            busboy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶ä¸Šä¼ å‡ºé”™'</span><span class="token punctuation">)</span>                <span class="token function">reject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            file<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        req<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>busboy<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Koa2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Koa2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾ç‰‡ä¼˜åŒ–</title>
      <link href="/2020/01/13/Optimize/img/"/>
      <url>/2020/01/13/Optimize/img/</url>
      
        <content type="html"><![CDATA[<h1 id="å›¾ç‰‡ä¼˜åŒ–"><a href="#å›¾ç‰‡ä¼˜åŒ–" class="headerlink" title="å›¾ç‰‡ä¼˜åŒ–"></a>å›¾ç‰‡ä¼˜åŒ–</h1><h3 id="ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦åšå›¾ç‰‡ä¼˜åŒ–ï¼Ÿ</h3><p>Googleå®˜æ–¹çš„æœ€ä½³å®è·µä¸­å…³äºå›¾ç‰‡ä¼˜åŒ–æœ‰ä¸‹é¢è¿™æ ·ä¸€æ®µæè¿°ï¼š</p><blockquote><p>å¯¹äºç½‘é¡µæ¥è¯´ï¼Œåœ¨æ‰€ä¸‹è½½çš„å­—èŠ‚æ•°ä¸­ï¼Œå›¾ç‰‡å¾€å¾€ä¼šå å¾ˆå¤§æ¯”ä¾‹ã€‚å› æ­¤ï¼Œä¼˜åŒ–å›¾ç‰‡é€šå¸¸å¯ä»¥å“æœ‰æˆæ•ˆåœ°å‡å°‘å­—èŠ‚æ•°å’Œæ”¹è¿›æ€§èƒ½ï¼šæµè§ˆå™¨éœ€è¦ä¸‹è½½çš„å­—èŠ‚æ•°è¶Šå°‘ï¼Œå¯¹å®¢æˆ·ç«¯å¸¦å®½çš„äº‰ç”¨å°±è¶Šå°‘ï¼Œæµè§ˆå™¨ä¸‹è½½å†…å®¹å¹¶åœ¨å±å¹•ä¸Šå‘ˆç°å†…å®¹çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›ç¬¬ä¸‰æ–¹æ–¹æ³•æ¥çœ‹ä¸€ä¸‹åœ¨ä¸€ä¸ªç½‘ç«™ä¸­ï¼Œå›¾ç‰‡æ‰€å æ¯”ä¾‹çš„å¤§å°ï¼šä½¿ç”¨<a href="https://webpagetest.org/" target="_blank" rel="noopener">webTest</a>ç½‘ç«™ï¼Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ä¸€ä¸ªç½‘ç«™é¦–å±åŠ è½½æ—¶ï¼Œå›¾ç‰‡æ‰€å æ¯”ä¾‹çš„å¤§å°ã€‚è€Œä¸”ç”µå•†ç½‘ç«™ä¸­ï¼Œå›¾ç‰‡æ‰€å æ¯”ä¾‹å æ¯”æ˜¯æœ€å¤§çš„ã€‚</p><p>é€šè¿‡ä¼˜åŒ–å›¾ç‰‡å¯ä»¥å‡å°‘å®¢æˆ·ç«¯ä¸‹è½½çš„å­—èŠ‚æ•°ï¼Œæ”¹è¿›ç½‘é¡µæ€§èƒ½ã€‚</p><h3 id="å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯"><a href="#å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯" class="headerlink" title="å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯"></a>å›¾ç‰‡ç±»å‹å’Œä½¿ç”¨åœºæ™¯</h3><p>ä¸€èˆ¬å¸¸ç”¨çš„å›¾ç‰‡æ ¼å¼æœ‰é‚£ä¹ˆå‡ ç§ï¼šJPEG/JPGã€PNGã€WebPã€Base64ã€SVGã€‚</p><blockquote><p>JPEGå’ŒJPGæ ¼å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote><p>æ²¡æœ‰åŒºåˆ«ï¼Œå…¨åã€æ­£å¼æ‰©å±•åæ˜¯JPEGã€‚ä½†å› DOSã€Windows 95ç­‰æ—©æœŸç³»ç»Ÿé‡‡ç”¨çš„8.3å‘½åè§„åˆ™åªæ”¯æŒæœ€é•¿3å­—ç¬¦çš„æ‰©å±•åï¼Œä¸ºäº†å…¼å®¹é‡‡ç”¨äº†.jpgã€‚ä¹Ÿå› å†å²ä¹ æƒ¯å’Œå…¼å®¹æ€§è€ƒè™‘ï¼Œ.jpgç›®å‰æ›´æµè¡Œã€‚</p><h4 id="JPEG-JPG"><a href="#JPEG-JPG" class="headerlink" title="JPEG/JPG"></a>JPEG/JPG</h4><p>ç‰¹ç‚¹ï¼šæœ‰æŸå‹ç¼©ï¼Œä½“ç§¯å°ï¼ŒåŠ è½½å¿«ï¼Œä¸æ”¯æŒé€æ˜ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºå‘ˆç°è‰²å½©ä¸°å¯Œçš„å›¾ç‰‡ï¼Œåœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼ŒJPG å›¾ç‰‡ç»å¸¸ä½œä¸ºå¤§çš„èƒŒæ™¯å›¾ã€è½®æ’­å›¾æˆ– Banner å›¾å‡ºç°ã€‚</p><h4 id="PNG"><a href="#PNG" class="headerlink" title="PNG"></a>PNG</h4><p>ç‰¹ç‚¹ï¼šæ— æŸå‹ç¼©ï¼Œä½“ç§¯å¤§ï¼Œè´¨é‡é«˜ï¼Œæ”¯æŒé€æ˜ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šPNG åœ¨å¤„ç†çº¿æ¡å’Œé¢œè‰²å¯¹æ¯”åº¦æ–¹é¢æœ‰ä¼˜åŠ¿ï¼Œä¸»è¦ç”¨å®ƒæ¥å‘ˆç°å°çš„ Logoã€é¢œè‰²ç®€å•ä¸”å¯¹æ¯”å¼ºçƒˆçš„å›¾ç‰‡æˆ–èƒŒæ™¯ç­‰</p><h4 id="SVG"><a href="#SVG" class="headerlink" title="SVG"></a>SVG</h4><p>ç‰¹ç‚¹ï¼šæ–‡æœ¬æ–‡ä»¶ï¼Œä½“ç§¯çº¿ï¼Œä¸å¤±çœŸï¼Œå…¼å®¹æ€§å¥½ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå°† SVG å†™å…¥ç‹¬ç«‹æ–‡ä»¶åå¼•å…¥ HTML</p><p>â€‹    <code>&lt;img src=&quot;æ–‡ä»¶å.svg&quot; alt=&quot;&quot;&gt;</code></p><h4 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h4><p>ç‰¹ç‚¹ï¼šæ–‡æœ¬æ–‡ä»¶ã€ä¾èµ–ç¼–ç ã€å°å›¾æ ‡è§£å†³æ–¹æ¡ˆã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå°å›¾æ ‡ï¼Œæ›´æ–°é¢‘ç‡éå¸¸ä½ï¼Œä½œä¸ºé›ªç¢§å›¾çš„è¡¥å……ã€‚</p><h4 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h4><blockquote><p>WebP æ˜¯ Google ä¸“ä¸º Web å¼€å‘çš„ä¸€ç§æ—¨åœ¨åŠ å¿«å›¾ç‰‡åŠ è½½é€Ÿåº¦çš„å›¾ç‰‡æ ¼å¼ï¼Œå®ƒæ”¯æŒæœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©ã€‚</p></blockquote><p>ç‰¹ç‚¹ï¼šå…¨èƒ½ï¼Œä½†æ˜¯æœ‰å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šé™åˆ¶æˆ‘ä»¬ä½¿ç”¨ WebP çš„æœ€å¤§é—®é¢˜ä¸æ˜¯â€œè¿™ä¸ªå›¾ç‰‡æ˜¯å¦é€‚åˆç”¨ WebP å‘ˆç°â€ï¼Œè€Œæ˜¯â€œæµè§ˆå™¨æ˜¯å¦å…è®¸ WebPâ€ã€‚</p><h3 id="å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ"></a>å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆ</h3><h4 id="å‡å°‘å›¾ç‰‡ä½“ç§¯"><a href="#å‡å°‘å›¾ç‰‡ä½“ç§¯" class="headerlink" title="å‡å°‘å›¾ç‰‡ä½“ç§¯"></a>å‡å°‘å›¾ç‰‡ä½“ç§¯</h4><p>ä½¿ç”¨WebPçš„æ–¹å¼ï¼Œéƒ½å¯ä»¥åœ¨ä¸é™ä½å›¾ç‰‡è´¨é‡çš„æ¡ä»¶ä¸‹ï¼Œå‡å°‘å›¾ç‰‡ä½“ç§¯çš„ã€‚</p><blockquote><p>WebP çš„ä¼˜åŠ¿æ˜¯å®ƒå…·æœ‰æ›´ä¼˜çš„å›¾åƒæ•°æ®å‹ç¼©ç®—æ³•ï¼Œèƒ½å¸¦æ¥æ›´å°çš„å›¾ç‰‡ä½“ç§¯ï¼Œè€Œä¸”æ‹¥æœ‰è‚‰çœ¼è¯†åˆ«æ— å·®å¼‚çš„å›¾åƒè´¨é‡ï¼›åŒæ—¶å…·å¤‡äº†æ— æŸå’Œæœ‰æŸçš„å‹ç¼©æ¨¡å¼ã€Alpha é€æ˜ä»¥åŠåŠ¨ç”»çš„ç‰¹æ€§ï¼Œåœ¨ JPEG å’Œ PNG ä¸Šçš„è½¬åŒ–æ•ˆæœéƒ½ç›¸å½“ä¼˜ç§€ã€ç¨³å®šå’Œç»Ÿä¸€ã€‚</p></blockquote><p><a href="https://cloudconvert.com/" target="_blank" rel="noopener">cloudconvert</a>å¯ä»¥åœ¨çº¿è½¬æ¢WebPå›¾ç‰‡ã€‚</p><p>åœ¨æ·˜å®é¦–é¡µï¼Œå°±æœ‰ä¸€äº›å›¾ç‰‡å°±æ˜¯WebPç±»å‹çš„ã€‚æ·˜å®æ˜¯æ ¹æ®æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebPæ¥åŠ¨æ€çš„è®¾ç½®å›¾ç‰‡urlçš„ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebPå‘¢ï¼Ÿ</p><p>Googleå®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·å¤„ç†çš„ï¼ˆå…ˆåŠ è½½ä¸€ä¸ªWebPå›¾ç‰‡ï¼Œå¦‚æœèƒ½è·å–åˆ°å›¾ç‰‡çš„å®½åº¦å’Œé«˜åº¦ï¼Œå°±è¯´æ˜æ˜¯æ”¯æŒWebPçš„ï¼Œåä¹‹åˆ™ä¸æ”¯æŒï¼‰ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">check_webp_feature</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> kTestImages <span class="token operator">=</span> <span class="token punctuation">{</span>        lossy<span class="token punctuation">:</span> <span class="token string">"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"</span><span class="token punctuation">,</span>        lossless<span class="token punctuation">:</span> <span class="token string">"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=="</span><span class="token punctuation">,</span>        alpha<span class="token punctuation">:</span> <span class="token string">"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="</span><span class="token punctuation">,</span>        animation<span class="token punctuation">:</span> <span class="token string">"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    img<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>width <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>height <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">callback</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">callback</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"data:image/webp;base64,"</span> <span class="token operator">+</span> kTestImages<span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åŸç†ï¼šå¯¹æ¯ä¸€ç§æ ¼å¼çš„webp(æœ‰æŸï¼Œæ— æŸï¼Œalphaé€šé“ï¼ŒåŠ¨æ€)ç”Ÿæˆä¸€ä¸ªå¾ˆå°åƒç´ çš„å›¾ç‰‡ï¼Œåœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå°±ä»£è¡¨æ”¯æŒwebpã€‚</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯è®©æœåŠ¡å™¨æ¥åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebPæ ¼å¼ï¼šæœåŠ¡å™¨é€šè¿‡HTTPè¯·æ±‚å¤´çš„Acceptå­—æ®µï¼Œæ¥åˆ¤æ–­è¿”å›ä»€ä¹ˆæ ¼å¼çš„å›¾ç‰‡ã€‚å½“ Accept å­—æ®µåŒ…å« image/webp æ—¶ï¼Œå°±è¿”å› WebP æ ¼å¼çš„å›¾ç‰‡ï¼Œå¦åˆ™è¿”å›åŸå›¾ã€‚</p><p>åˆ©ç”¨SVGOå‹ç¼©svgæ–‡ä»¶çš„å¤§å°ã€‚</p><h4 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h4><h4 id="å›¾ç‰‡æ‡’åŠ è½½"><a href="#å›¾ç‰‡æ‡’åŠ è½½" class="headerlink" title="å›¾ç‰‡æ‡’åŠ è½½"></a>å›¾ç‰‡æ‡’åŠ è½½</h4><p>æ‡’åŠ è½½çš„åŸç†æ˜¯ï¼šå°†å›¾ç‰‡çš„urlèµ‹å€¼ç»™imgçš„data-urlï¼ˆå¯è‡ªå®šä¹‰ï¼‰å±æ€§ï¼Œç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œå½“å›¾ç‰‡è¿›å…¥å¯è§†åŒºåŸŸæ—¶ï¼Œå°†data-urlçš„å€¼èµ‹å€¼ç»™imgçš„urlå±æ€§ï¼Œè¿™æ—¶æ‰çœŸæ­£å‘å‡ºå›¾ç‰‡çš„httpè¯·æ±‚ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ç®€å•çš„èŠ‚æµå‡½æ•°</span><span class="token comment" spellcheck="true">//fun è¦æ‰§è¡Œçš„å‡½æ•°</span><span class="token comment" spellcheck="true">//delay å»¶è¿Ÿ</span><span class="token comment" spellcheck="true">//time  åœ¨timeæ—¶é—´å†…å¿…é¡»æ‰§è¡Œä¸€æ¬¡</span><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span>fun<span class="token punctuation">,</span> delay<span class="token punctuation">,</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> timeout<span class="token punctuation">,</span>        startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>            args <span class="token operator">=</span> arguments<span class="token punctuation">,</span>            curTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¦‚æœè¾¾åˆ°äº†è§„å®šçš„è§¦å‘æ—¶é—´é—´éš”ï¼Œè§¦å‘ handler</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>curTime <span class="token operator">-</span> startTime <span class="token operator">>=</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>            fun<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>            startTime <span class="token operator">=</span> curTime<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// æ²¡è¾¾åˆ°è§¦å‘é—´éš”ï¼Œé‡æ–°è®¾å®šå®šæ—¶å™¨</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>fun<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å®é™…æƒ³ç»‘å®šåœ¨ scroll äº‹ä»¶ä¸Šçš„ handler</span><span class="token keyword">function</span> <span class="token function">lazyload</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> imgNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">&lt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"default.jpg"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> src <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"data-src"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                img<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>                n <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// é‡‡ç”¨äº†èŠ‚æµå‡½æ•°</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>lazyload<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="å“åº”å¼å›¾ç‰‡"><a href="#å“åº”å¼å›¾ç‰‡" class="headerlink" title="å“åº”å¼å›¾ç‰‡"></a>å“åº”å¼å›¾ç‰‡</h4><blockquote><p>ä¸€ç§å¯ä»¥åœ¨ä¸åŒçš„å±å¹•å°ºå¯¸å’Œåˆ†è¾¨ç‡çš„è®¾å¤‡ä¸Šéƒ½èƒ½è‰¯å¥½å·¥ä½œä»¥åŠå…¶ä»–ç‰¹æ€§çš„å›¾ç‰‡.</p></blockquote><h4 id="è‰ºæœ¯æ–¹å‘"><a href="#è‰ºæœ¯æ–¹å‘" class="headerlink" title="è‰ºæœ¯æ–¹å‘"></a>è‰ºæœ¯æ–¹å‘</h4><p>å½“ä½ æƒ³ä¸ºä¸åŒå¸ƒå±€æä¾›ä¸åŒå‰ªè£çš„å›¾ç‰‡â€”â€”æ¯”å¦‚åœ¨æ¡Œé¢å¸ƒå±€ä¸Šæ˜¾ç¤ºå®Œæ•´çš„ã€æ¨ªå‘å›¾ç‰‡ï¼Œè€Œåœ¨æ‰‹æœºå¸ƒå±€ä¸Šæ˜¾ç¤ºä¸€å¼ å‰ªè£è¿‡çš„ã€çªå‡ºé‡ç‚¹çš„çºµå‘å›¾ç‰‡ï¼Œå¯ä»¥ç”¨  å…ƒç´ æ¥å®ç°ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>picture<span class="token operator">></span>  <span class="token operator">&lt;</span>source media<span class="token operator">=</span><span class="token string">"(max-width: 799px)"</span> srcset<span class="token operator">=</span><span class="token string">"elva-480w-close-portrait.jpg"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>source media<span class="token operator">=</span><span class="token string">"(min-width: 800px)"</span> srcset<span class="token operator">=</span><span class="token string">"elva-800w.jpg"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"elva-800w.jpg"</span> alt<span class="token operator">=</span><span class="token string">"Chris standing up holding his daughter Elva"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>picture<span class="token operator">></span></code></pre><h4 id="åˆ†è¾¨ç‡åˆ‡æ¢"><a href="#åˆ†è¾¨ç‡åˆ‡æ¢" class="headerlink" title="åˆ†è¾¨ç‡åˆ‡æ¢"></a>åˆ†è¾¨ç‡åˆ‡æ¢</h4><p>å½“ä½ æƒ³è¦ä¸ºçª„å±æä¾›æ›´å°çš„å›¾ç‰‡æ—¶ï¼Œå› ä¸ºå°å±å¹•ä¸éœ€è¦åƒæ¡Œé¢ç«¯æ˜¾ç¤ºé‚£ä¹ˆå¤§çš„å›¾ç‰‡ï¼›ä»¥åŠä½ æƒ³ä¸ºé«˜/ä½åˆ†è¾¨ç‡å±å¹•æä¾›ä¸åŒåˆ†è¾¨ç‡çš„å›¾ç‰‡æ—¶ï¼Œéƒ½å¯ä»¥é€šè¿‡ vector graphics (SVG images)ã€ srcset ä»¥åŠ sizes å±æ€§æ¥å®ç°ã€‚</p><p>åˆ†è¾¨ç‡åˆ‡æ¢ï¼šä¸åŒçš„å°ºå¯¸</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>img srcset<span class="token operator">=</span>"elva<span class="token operator">-</span>fairy<span class="token operator">-</span>320w<span class="token punctuation">.</span>jpg 320w<span class="token punctuation">,</span>             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>480w<span class="token punctuation">.</span>jpg 480w<span class="token punctuation">,</span>             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>800w<span class="token punctuation">.</span>jpg 800w"     sizes<span class="token operator">=</span>"<span class="token punctuation">(</span>max<span class="token operator">-</span>width<span class="token punctuation">:</span> 320px<span class="token punctuation">)</span> 280px<span class="token punctuation">,</span>            <span class="token punctuation">(</span>max<span class="token operator">-</span>width<span class="token punctuation">:</span> 480px<span class="token punctuation">)</span> 440px<span class="token punctuation">,</span>            800px"     src<span class="token operator">=</span><span class="token string">"elva-fairy-800w.jpg"</span> alt<span class="token operator">=</span><span class="token string">"Elva dressed as a fairy"</span><span class="token operator">></span></code></pre><p>åˆ†è¾¨ç‡åˆ‡æ¢: ç›¸åŒçš„å°ºå¯¸, ä¸åŒçš„åˆ†è¾¨ç‡</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>img srcset<span class="token operator">=</span>"elva<span class="token operator">-</span>fairy<span class="token operator">-</span>320w<span class="token punctuation">.</span>jpg<span class="token punctuation">,</span>             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>480w<span class="token punctuation">.</span>jpg <span class="token number">1</span><span class="token punctuation">.</span>5x<span class="token punctuation">,</span>             elva<span class="token operator">-</span>fairy<span class="token operator">-</span>640w<span class="token punctuation">.</span>jpg 2x"     src<span class="token operator">=</span><span class="token string">"elva-fairy-640w.jpg"</span> alt<span class="token operator">=</span><span class="token string">"Elva dressed as a fairy"</span><span class="token operator">></span></code></pre><p>ä¸€èˆ¬æƒ…å†µä¸‹å½“æˆ‘ä»¬ç»™<code>img</code>è®¾ç½®å›ºå®šçš„å®½çš„æ—¶å€™,ä¸ºäº†åœ¨ä¸åŒçš„<code>dpr</code>è®¾å¤‡ä¸Šæ˜¾ç¤ºç›¸åŒçš„å¤§å°ï¼Œå¯ä»¥é…åˆ<code>x</code>æ¥ï¼Œä¾‹å¦‚<code>1.5x</code>ä»£è¡¨dprä¸º1.5çš„è®¾å¤‡</p><h4 id="srcset-sizes-æ–°ç‰¹æ€§"><a href="#srcset-sizes-æ–°ç‰¹æ€§" class="headerlink" title="srcset/sizes/ æ–°ç‰¹æ€§"></a>srcset/sizes/<picture> æ–°ç‰¹æ€§</h4><blockquote><p>å·²ç»è¢«æ–°ç‰ˆæœ¬çš„ç°ä»£æµè§ˆå™¨å’Œç§»åŠ¨æµè§ˆå™¨æ‰€æ”¯ æŒï¼ˆåŒ…æ‹¬Edgeï¼Œè€Œä¸æ˜¯IEï¼‰ã€‚</p></blockquote><ul><li><code>srcset</code>è¯­æ³•: â€œå›¾ç‰‡è·¯å¾„ ç‰©ç†åƒç´ , å›¾ç‰‡è·¯å¾„ ç‰©ç†åƒç´ , â€¦..â€ã€‚</li><li><code>size</code>: â€œåª’ä½“æŸ¥è¯¢ cssåƒç´ â€ã€‚</li><li><code>src</code>: å½“æµè§ˆå™¨ä¸æ”¯æŒä¸Šé¢çš„å±æ€§çš„æ—¶å€™ï¼Œé»˜è®¤åŠ è½½è¿™é‡Œã€‚</li></ul><p>åŠ è½½çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æŸ¥çœ‹è®¾å¤‡å®½åº¦</li><li>æŸ¥çœ‹sizesä¸­å“ªä¸€ä¸ªåª’ä½“æŸ¥è¯¢æ¡ä»¶ä¸ºçœŸã€‚</li><li>æŸ¥çœ‹ç»™äºˆè¯¥åª’ä½“æŸ¥è¯¢çš„æ§½å¤§å°ã€‚</li><li>åŠ è½½srcsetåˆ—è¡¨ä¸­å¼•ç”¨çš„<strong>æœ€æ¥è¿‘</strong>æ‰€é€‰çš„æ§½å¤§å°çš„å›¾åƒ</li></ul><p>ä¸€èˆ¬ <code>1px = 1w</code>ã€‚</p><h3 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a>å…¶ä»–æ–¹æ¡ˆ</h3><h4 id="é›ªç¢§å›¾"><a href="#é›ªç¢§å›¾" class="headerlink" title="é›ªç¢§å›¾"></a>é›ªç¢§å›¾</h4><h4 id="base64ç¼–ç å†…è”å°å›¾ç‰‡"><a href="#base64ç¼–ç å†…è”å°å›¾ç‰‡" class="headerlink" title="base64ç¼–ç å†…è”å°å›¾ç‰‡"></a>base64ç¼–ç å†…è”å°å›¾ç‰‡</h4><h4 id="cdnåŠ é€Ÿ"><a href="#cdnåŠ é€Ÿ" class="headerlink" title="cdnåŠ é€Ÿ"></a>cdnåŠ é€Ÿ</h4>]]></content>
      
      
      <categories>
          
          <category> Optimize </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Optimize </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPç¼“å­˜</title>
      <link href="/2020/01/10/Interview/02/"/>
      <url>/2020/01/10/Interview/02/</url>
      
        <content type="html"><![CDATA[<h1 id="HTTPç¼“å­˜"><a href="#HTTPç¼“å­˜" class="headerlink" title="HTTPç¼“å­˜"></a>HTTPç¼“å­˜</h1><h3 id="HTTPæŠ¥æ–‡"><a href="#HTTPæŠ¥æ–‡" class="headerlink" title="HTTPæŠ¥æ–‡"></a>HTTPæŠ¥æ–‡</h3><p>HTTPæŠ¥æ–‡ï¼šä½œä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šè®¯æ—¶å‘é€å’Œå“åº”çš„æ•°æ®å—ã€‚æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ä¼šå‘é€è¯·æ±‚æŠ¥æ–‡ï¼ˆRequestï¼‰ï¼ŒæœåŠ¡å™¨å“åº”æµè§ˆå™¨çš„è¯·æ±‚æ—¶ï¼Œä¼šå‘é€å“åº”æŠ¥æ–‡ï¼ˆResponseï¼‰ã€‚</p><p>è¯·æ±‚æŠ¥æ–‡ï¼šåŒ…å«è¯·æ±‚æ–¹æ³•ã€ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰ã€åè®®ç‰ˆæœ¬å·ã€MIMEä¿¡æ¯ç­‰ã€‚</p><p>å“åº”æŠ¥æ–‡ï¼šåŒ…å«åè®®ç‰ˆæœ¬å·ã€å“åº”çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚</p><h3 id="ç¼“å­˜è§„åˆ™è§£æ"><a href="#ç¼“å­˜è§„åˆ™è§£æ" class="headerlink" title="ç¼“å­˜è§„åˆ™è§£æ"></a>ç¼“å­˜è§„åˆ™è§£æ</h3><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œæµè§ˆå™¨çš„ç¼“å­˜æ•°æ®åº“æ˜¯æ²¡æœ‰ç¼“å­˜çš„ï¼Œéœ€è¦å‘æœåŠ¡å™¨ç›´æ¥è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨å°†ä¼šæŠŠèµ„æºå’Œç¼“å­˜è§„åˆ™è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨å°†æŠŠèµ„æºå’Œç¼“å­˜è§„åˆ™è¿›è¡Œç¼“å­˜ã€‚å…·ä½“å¦‚å›¾æ‰€ç¤º:</p><p><img src="http://cdn.yangkunxiao.cn/HttpCache2.png#alt=http-cache1" alt=""></p><h4 id="å¼ºç¼“å­˜-from-disk-cache-200"><a href="#å¼ºç¼“å­˜-from-disk-cache-200" class="headerlink" title="å¼ºç¼“å­˜(from disk cache 200)"></a>å¼ºç¼“å­˜(from disk cache 200)</h4><p>å·²å­˜åœ¨ç¼“å­˜æ—¶ï¼Œè¯·æ±‚èµ„æºæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.yangkunxiao.cn/http-strong-cache.png#alt=http-strong-cache" alt=""></p><p>ä»ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¼ºç¼“å­˜å¦‚æœç¼“å­˜æ•°æ®åº“ä¸­å·²å­˜åœ¨æ•°æ®ä¸”æœªå¤±æ•ˆï¼Œé‚£ä¹ˆå°†ä¸ä¼šå’ŒæœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œç›´æ¥ä»èµ„æºæ•°æ®åº“ä¸­å–ã€‚</p><p>å¯¹äºå¼ºç¼“å­˜æ¥è¯´ï¼Œå“åº”å¤´å°†ä¼šæœ‰ä¸¤ä¸ªå­—ç«¯æ¥æ ‡è¯†å¤±æ•ˆè§„åˆ™ï¼š<code>Expires/Cache-Control</code>ã€‚</p><p>Expiresï¼šHttp1.0ã€‚å®ƒçš„å€¼ä¸ºæœåŠ¡ç«¯è¿”å›çš„åˆ°æœŸæ—¶é—´ã€‚å³ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶çš„æ—¶é—´å°äºè¯¥æ—¶é—´çš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚</p><p>Cache-Controlï¼šHttp1.1 ã€‚Cache-Control æ˜¯æœ€é‡è¦çš„è§„åˆ™ã€‚å¸¸è§çš„å–å€¼æœ‰privateã€publicã€no-cacheã€max-ageï¼Œno-storeï¼Œé»˜è®¤ä¸ºprivateã€‚</p><p><code>private</code>ï¼šå®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜ã€‚</p><p><code>public</code>ï¼š å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ç¼“å­˜ã€‚</p><p><code>max-age=xxx</code>ï¼šç¼“å­˜çš„å†…å®¹å°†åœ¨ xxx ç§’åå¤±æ•ˆã€‚</p><p><code>no-cache</code>ï¼šéœ€è¦ä½¿ç”¨å¯¹æ¯”ç¼“å­˜æ¥éªŒè¯ç¼“å­˜æ•°æ®ã€‚</p><p><code>no-store</code>ï¼šæ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šç¼“å­˜ï¼Œå¼ºåˆ¶ç¼“å­˜ï¼Œå¯¹æ¯”ç¼“å­˜éƒ½ä¸ä¼šè§¦å‘ã€‚</p><h4 id="å¯¹æ¯”ç¼“å­˜-304"><a href="#å¯¹æ¯”ç¼“å­˜-304" class="headerlink" title="å¯¹æ¯”ç¼“å­˜(304)"></a>å¯¹æ¯”ç¼“å­˜(304)</h4><p>å·²å­˜åœ¨ç¼“å­˜æ•°æ®æ—¶ï¼Œè¯·æ±‚èµ„æºçš„æµç¨‹ï¼š</p><p><img src="http://cdn.yangkunxiao.cn/http-negotiate-cache.png#alt=http--cache" alt=""></p><p>å¯¹æ¯”ç¼“å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œéœ€è¦è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚</p><p>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†ç¼“å­˜æ ‡è¯†ä¸æ•°æ®ä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†äºŒè€…å¤‡ä»½è‡³ç¼“å­˜æ•°æ®åº“ä¸­ã€‚</p><p>å†æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯å°†å¤‡ä»½çš„ç¼“å­˜æ ‡è¯†å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†è¿›è¡Œåˆ¤æ–­ï¼Œåˆ¤æ–­æˆåŠŸåï¼Œè¿”å›304çŠ¶æ€ç ï¼Œé€šçŸ¥å®¢æˆ·ç«¯æ¯”è¾ƒæˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚</p><p>åœ¨å¯¹æ¯”ç¼“å­˜ç”Ÿæ•ˆæ—¶ï¼ŒçŠ¶æ€ç ä¸º304ï¼Œå¹¶ä¸”æŠ¥æ–‡å¤§å°å’Œè¯·æ±‚æ—¶é—´å¤§å¤§å‡å°‘ã€‚</p><p>åŸå› æ˜¯ï¼ŒæœåŠ¡ç«¯åœ¨è¿›è¡Œæ ‡è¯†æ¯”è¾ƒåï¼Œåªè¿”å›headeréƒ¨åˆ†ï¼Œé€šè¿‡çŠ¶æ€ç é€šçŸ¥å®¢æˆ·ç«¯ä½¿ç”¨ç¼“å­˜ï¼Œä¸å†éœ€è¦å°†æŠ¥æ–‡ä¸»ä½“éƒ¨åˆ†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p><code>If-Modified-Since/Last-Modified</code>:Http1.0 ã€‚æµè§ˆå™¨åœ¨è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥å¤´ä¸­ä¼šæºå¸¦<code>Last-Modified</code>å­—ç«¯ï¼Œå‘Šè¯‰æµè§ˆå™¨æ–‡ä»¶æœ€åä¿®æ”¹çš„æ—¶é—´ã€‚å½“æµè§ˆå™¨åœ¨æ­¤è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¼šæºå¸¦<code>If-Modified-Since</code>ï¼Œå‘Šè¯‰æœåŠ¡å™¨ä¸Šæ¬¡æ–‡ä»¶ä¿®æ”¹çš„æ—¶é—´ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯¥å­—æ®µä¹‹åï¼Œå’ŒæœåŠ¡å™¨æ–‡ä»¶èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´åšå¯¹æ¯”ï¼Œåˆ¤æ–­èµ„æºæ˜¯å¦æœ‰æ”¹åŠ¨ã€‚è‹¥æ”¹åŠ¨è¿‡ï¼Œåˆ™è¿”å›200ï¼Œå¹¶å°†æ•´ä¸ªèµ„æºè¿”å›ã€‚è‹¥èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´å°äºæˆ–ç­‰äºIf-Modified-Sinceï¼Œè¯´æ˜èµ„æºæ— æ–°ä¿®æ”¹ï¼Œåˆ™å“åº”HTTP 304ï¼Œå‘ŠçŸ¥æµè§ˆå™¨ç»§ç»­ä½¿ç”¨æ‰€ä¿å­˜çš„cacheã€‚<code>Last-Modified</code>ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯æ–‡ä»¶æœ€åçš„ä¿®æ”¹æ—¶é—´ï¼Œè€Œä¸”åªèƒ½ç²¾ç¡®åˆ°<code>1s</code>ä»¥å†…</p><p><code>If-None-Match/E-tag</code>ï¼šHttp1.1 ã€‚æœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨å†³å®šï¼‰ã€‚å’ŒLast-Modifiedä¸åŒï¼ŒE-tagæ›´ç²¾ç¡®ï¼Œå®ƒæ˜¯ç±»ä¼¼äºæŒ‡çº¹ä¸€æ ·çš„ä¸œè¥¿ï¼ŒåŸºäº<code>FileEtag INode Mtime Size</code>ç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ–‡ä»¶å˜ï¼ŒæŒ‡çº¹å°±ä¼šå˜ï¼Œè€Œä¸”æ²¡æœ‰1sç²¾ç¡®åº¦çš„é™åˆ¶ã€‚</p><p><img src="http://cdn.yangkunxiao.cn/HttpCache3.png#alt=http-cache" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜å’Œå‡½æ•°å£°æ˜</title>
      <link href="/2020/01/04/JavaScript/block-scope/"/>
      <url>/2020/01/04/JavaScript/block-scope/</url>
      
        <content type="html"><![CDATA[<h1 id="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜</h1><p>æœ€è¿‘åœ¨ä¸€ä¸ªè®¨è®ºç¾¤çœ‹åˆ°ä¸€ä¸ªé¢è¯•é¢˜ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>  a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre><p>whatï¼Ÿä¸åº”è¯¥æ˜¯ï¼šfunction a(){} ã€function a(){} å—ï¼Ÿ</p><p>æœ€åä¸€ä½ç‰›äººç»™å‡ºäº†ä»–çš„ç†è§£ï¼Œè¿™é‡Œæœ¬äººåªæ˜¯ä½œå‡ºéªŒè¯ï¼ŒåŠ æ·±ç†è§£ã€‚</p><blockquote><p>æ¥ä¸‹æ¥çš„ç¯å¢ƒé»˜è®¤éƒ½æ˜¯chromeç¯å¢ƒï¼Œæ”¯æŒES6ã€‚<br>ä¸‹æ–‡æå‡ºçš„é»˜è®¤å˜é‡æŒ‡çš„æ˜¯æ²¡æœ‰ä½¿ç”¨ varã€letã€constå®šä¹‰çš„å˜é‡ã€‚</p></blockquote><h3 id="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"><a href="#å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"></a>å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡</h3><p>æˆ‘ä»¬å…ˆçœ‹è¿™æ ·ä¸€ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ReferenceError: a is not defined</span><span class="token punctuation">{</span>    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre><p>å¯èƒ½æœ‰äº›äººä¼šåƒæˆ‘ä¸€æ ·æ„Ÿåˆ°è¯§å¼‚ï¼šä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªaæ‰“å°å‡ºæ¥çš„ä¸æ˜¯undefinedï¼Ÿ<code>a = 10</code>é»˜è®¤ä¸æ˜¯ <code>var a = 10</code>å—ï¼Ÿåº”è¯¥ä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸçš„é¡¶ç«¯çš„å•Šã€‚</p><p>é‚£å¥½ï¼Œè®©æˆ‘ä»¬æŠŠ<code>window.a</code>æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€a is not defined</span>    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre><p>ç»“è®ºï¼šæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰æ‰§è¡Œäº†å£°æ˜ä»£ç ï¼Œå˜é‡æ‰ä¼šè¢«æŒ‚è½½åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šã€‚</p><p>è®©æˆ‘ä»¬åœ¨çœ‹çœ‹ä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡çš„æƒ…å†µï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  undefined</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€undefined</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre><p>ç»“è®ºï¼šå¯¹æ¯”ä¸Šä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šï¼Œä¸è¿‡å®ƒåªæ˜¯å°†å£°æ˜æå‡ï¼Œèµ‹å€¼æ“ä½œå¹¶æœªæå‡ä¸Šå»ã€‚</p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>åœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰ä»£ç æ‰§è¡Œåˆ°å£°æ˜è¯­å¥ä¹‹åï¼Œæ‰å¯ä»¥è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li><li>å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li></ul><h3 id="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜</h3><p>åœ¨å—çº§ä½œç”¨åŸŸä¸­çš„å‡½æ•°å£°æ˜å’Œå˜é‡æ˜¯ä¸åŒçš„ã€‚ä¸å¤šè¯´ï¼Œç›´æ¥æ’¸ä»£ç ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å›åˆ°ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœå—çº§ä½œç”¨åŸŸé‡Œé¢æ˜¯ä¸€ä¸ªé»˜è®¤å˜é‡ï¼Œåˆ™ç¬¬ä¸€è¡Œä»£ç ä¼šç›´æ¥æŠ¥é”™ï¼Œè€Œå‡½æ•°å£°æ˜åˆ™ä¼šæ‰“å°<code>undefined</code>ã€‚</p><p>å…¶å®åœ¨é˜®ä¸€å³°è€å¸ˆçš„<a href="">ECMAScript6å…¥é—¨</a>ä¸­å…³äºè¿™ä¸€ç‚¹å°±åšäº†æ˜ç¡®è¯´æ˜ï¼š</p><p><img src="http://cdn.yangkunxiao.cn/qw7bBH.png#align=left&display=inline&height=528&originHeight=528&originWidth=1192&status=done&style=none&width=1192" alt=""></p><p>å—çº§ä½œç”¨åŸŸå‡½æ•°ï¼Œå°±åƒé¢„å…ˆåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä½¿ç”¨<code>var</code>å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œä¸”é»˜è®¤å€¼ä¸º<code>undefined</code>ã€‚</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€è¡Œè¾“å‡ºå¤§æ¦‚æ˜¯æ¯”è¾ƒç¬¦åˆé¢„æœŸçš„ã€‚è‡³äºç¬¬äºŒè¡Œ<code>window.a=undefoned</code>ï¼Œè€Œ<code>a=function a(){}</code> ï¼Œä¸Šé¢åœ¨é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ä¸­è¯´è¿‡ï¼Œå£°æ˜å‡½æ•°aä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¸”åœ¨å…¶å—çº§ä½œç”¨åŸŸä¸­ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°é¡¶å±‚ã€‚è€Œ<code>window.a</code>ä¸ºä»€ä¹ˆä¼šä¸º<code>undefined</code>å‘¢ï¼Ÿå› ä¸ºåªæœ‰<code>window.a</code>åªæœ‰ç­‰å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜çš„å®šä¹‰çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡ä¹‹åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</p><h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>å—çº§ä½œç”¨åŸŸå‡½æ•°åœ¨ç¼–è¯‘é˜¶æ®µå°†å‡½æ•°å£°æ˜æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œå¹¶ä¸”ä¼šåœ¨å…¨å±€å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå€¼ä¸ºundefinedã€‚åŒæ—¶ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°å¯¹åº”çš„å—çº§ä½œç”¨åŸŸé¡¶å±‚ã€‚</li><li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰å®šä¹‰å£°æ˜å‡½æ•°çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li></ul><h3 id="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜</h3><p>çœ‹ğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  function a(){}</span></code></pre><p>åœ¨è¿™é‡Œï¼Œé¦–å…ˆï¼Œå—çº§ä½œç”¨åŸŸå‡½æ•°açš„å£°æ˜ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œç¬¬ä¸€è¡Œæ‰“å°æ¯”è¾ƒç¬¦åˆé¢„æœŸã€‚ç„¶ååœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œç”±äºå£°æ˜å‡½æ•°aæå‡åˆ°å—çº§ä½œç”¨åŸŸé¡¶ç«¯ï¼Œæ‰€ä»¥æ‰“å°<code>a = function a(){}</code>ï¼Œè€Œ<code>window.a</code>ç”±äºå¹¶æ²¡æœ‰æ‰§è¡Œå‡½æ•°å®šä¹‰çš„é‚£ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥ä»ç„¶ä¸º<code>undefined</code>ã€‚å½“æ‰§è¡Œåˆ°å£°æ˜å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå‡½æ•°aæ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸä¸­ã€‚å½“æ‰§è¡Œ<code>a = 10</code>çš„æ—¶å€™ï¼ŒJSå¼•æ“ä¼šè¿›è¡ŒLHSæŸ¥æ‰¾ï¼Œæ­¤æ—¶ï¼Œå£°æ˜å‡½æ•°å·²ç»è¢«åŒæ—¶æå‡åˆ°å…¨å±€ä½œç”¨åŸŸå’Œå—çº§ä½œç”¨åŸŸé¡¶ç«¯äº†ï¼Œç”±äº<code>é®è”½æ•ˆæœ</code>ï¼Œæ­¤æ—¶æŸ¥æ‰¾aåªä¼šæ‰¾åˆ°å—çº§ä½œç”¨åŸŸå†…çš„aï¼Œå¹¶ä¸ä¼šæ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸçš„aï¼Œè¿™æ—¶ï¼Œaå·²ç»è¢«å®šä¹‰ï¼Œ<code>a = 10</code>åªä¼šæ‰§è¡Œèµ‹å€¼æ“ä½œï¼Œå¹¶ä¸ä¼šè¿›è¡Œæå‡ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ğŸŒ°2ã€‚å®ƒä¼šæ›´åŠ æŠ½è±¡ï¼Œå‡†å¤‡å¥½äº†æ²¡ï¼Ÿ</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>       a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10  10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10 10</span></code></pre><p>æœ‰äº†ä¸Šé¢ä¾‹å­çš„é“ºå«ï¼Œç›¸ä¿¡å¤§å®¶å¯¹å‰ä¸¤è¡Œçš„æ‰“å°ç»“æœä¸ä¼šæœ‰ä»»ä½•ç–‘é—®äº†å§ï¼Ÿ</p><p>é‚£å¥½ï¼Œæˆ‘ä»¬ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæ‰§è¡Œ<code>a = 10</code>ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ­¤æ—¶ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜å·²ç»è¢«æå‡åˆ°é¡¶å±‚ï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰§è¡Œaï¼Œå°±æ˜¯ç›¸å½“äºèµ‹å€¼ï¼Œå°†å‡½æ•°å£°æ˜aèµ‹å€¼ä¸ºæ•°å­—aï¼Œå¯ä»¥ç†è§£å—ï¼Ÿå¦‚æœæœ‰ç–‘é—®ï¼Œå¯ä»¥çœ‹ğŸŒ°1ã€‚ç„¶åï¼Œæ‰§è¡Œåˆ°å‡½æ•°å£°æ˜è¯­å¥ï¼Œæ­¤æ—¶ï¼Œè™½ç„¶è¿™ä¸€è¡Œä»£ç æ˜¯å‡½æ•°å£°æ˜è¯­å¥ï¼Œä½†æ˜¯aï¼Œå·²ç»ä¸ºæ•°å­—10äº†ï¼Œæ‰€ä»¥ï¼Œæ‰§è¡Œ<code>function a(){}</code>ä¹‹åï¼Œaçš„å€¼10å°±ä¼šè¢«èµ‹å€¼ç»™å…¨å±€ä½œç”¨åŸŸä¸Šçš„aï¼Œæ‰€ä»¥ä¸‹é¢æ‰“å°çš„<code>window.a,a</code>éƒ½ä¸º10ï¼ï¼ï¼</p><h4 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰æ‰§è¡Œå‡½æ•°å£°æ˜è¯­å¥çš„æ—¶å€™ï¼Œæ‰ä¼šé‡å†™å¯¹åº”çš„å…¨å±€ä½œç”¨åŸŸä¸Šçš„åŒåå˜é‡ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼‚æ­¥ç¼–ç¨‹</title>
      <link href="/2020/01/03/JavaScript/async/"/>
      <url>/2020/01/03/JavaScript/async/</url>
      
        <content type="html"><![CDATA[<h1 id="JavaScriptå¼‚æ­¥ç¼–ç¨‹"><a href="#JavaScriptå¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="JavaScriptå¼‚æ­¥ç¼–ç¨‹"></a>JavaScriptå¼‚æ­¥ç¼–ç¨‹</h1><p>JavaScriptå¼‚æ­¥ç¼–ç¨‹</p><h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p>Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå®ƒæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæ›´åŠ åˆé€‚ã€å¼ºå¤§ã€‚æ‰€è°“Promiseï¼Œå°±æ˜¯ä¸€ç§å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢ä¿å­˜ç€æœªæ¥æ‰ä¼šå‘ç”Ÿçš„äº‹æƒ…ï¼ˆä¸€èˆ¬æ˜¯å¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚</p><p>Promiseæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›ä¸€ç³»åˆ—çš„APIå¯ä»¥å°†å¼‚æ­¥æ“ä½œçš„äº‹æƒ…ä»¥åŒæ­¥çš„å½¢å¼è¡¨ç°å‡ºæ¥ï¼Œæ¯”èµ·â€å›è°ƒåœ°ç‹±â€ï¼Œå®ƒçœ‹èµ·æ¥æ›´åŠ åˆé€‚ã€å¼ºå¤§ã€‚å®ƒå…·æœ‰ä»¥ä¸‹å‡ å¤§ç‰¹ç‚¹ï¼š</p><ul><li><code>Promise</code>çš„çŠ¶æ€ä¸å—ä»»ä½•å¤–ç•Œçš„å½±å“ã€‚Promiseçš„å¼‚æ­¥æ“ä½œæœ‰ä¸‰ç§çŠ¶æ€ï¼š    <code>pending</code>(æ‰§è¡Œä¸­)ã€<code>fulfilled</code>(å·²æˆåŠŸ)ã€<code>rejected</code>(å·²å¤±è´¥)ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœæ‰èƒ½å¤Ÿå†³å®š<code>Promise</code>çŠ¶æ€çš„èµ°å‘ã€‚</li><li><code>Promise</code>çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå˜ä¸å¯å†æ¬¡å˜åŠ¨ã€‚å®ƒçš„çŠ¶æ€å˜åŒ–åªæœ‰ä¸¤ç§æƒ…å†µï¼š<code>pending</code> =&gt; <code>fulfilled</code>ã€<code>pengding</code> =&gt; <code>rejected</code>ã€‚çŠ¶æ€ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸å†æ”¹å˜ï¼Œç§°ä¹‹ä¸º <code>resolved</code>(å·²å®šå‹)ã€‚</li></ul><p>Promiseä¸€æ—¦æ–°å»ºä¹‹åï¼Œå°±ä¼šç«‹å³æ‰§è¡Œã€‚è€ŒthenæŒ‡å®šçš„å›è°ƒå‡½æ•°åªæœ‰åŒæ­¥æ“ä½œæ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//æˆåŠŸå›è°ƒ</span>  <span class="token comment" spellcheck="true">//todo</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//å¤±è´¥å›è°ƒ</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//todo</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>Promise</code>æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>resolve</code>å’Œ<code>reject</code>ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚</p><p><code>resolve</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» <code>pending</code> å˜ä¸º <code>resolved</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›<code>reject</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» <code>pending</code> å˜ä¸º <code>rejected</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p><p><code>Promise</code>å®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨<code>then</code>æ–¹æ³•åˆ†åˆ«æŒ‡å®š<code>resolved</code>çŠ¶æ€å’Œ<code>rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚ä½†æ˜¯ä¸€èˆ¬é»˜è®¤ä¸æŒ‡å®š<code>rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨<code>catch</code>ã€‚</p><p><code>finally</code>ä¸ç®¡<code>promise</code>æœ€ç»ˆçš„æ‰§è¡Œç»“æœå¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œã€‚</p><p><code>all</code>ï¼šæ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p><p><code>Promise.all()</code>æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨<code>Promise.resolve</code>æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚å¦å¤–ï¼Œ<code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹</p><p>ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span> <span class="token string">'p1'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span> <span class="token string">'p2'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span> <span class="token string">'p3'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">,</span>res3<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ‰§è¡Œç»“æœï¼šp1 p2 p3</span></code></pre><p><code>p</code>çš„çŠ¶æ€ç”±p1,p2,p3å†³å®šï¼š</p><ul><li><p>åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p></li></ul><p><code>race</code>ï¼šè¯¥æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åªè¦åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p><code>allSettled</code>ï¼šè¯¥æ–¹æ³•ç”±<code>ES2020</code>å¼•å…¥ã€‚<code>Promise.allSettled()</code>æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªæœ‰ç­‰åˆ°æ‰€æœ‰è¿™äº›å‚æ•°å®ä¾‹éƒ½è¿”å›ç»“æœï¼Œä¸ç®¡æ˜¯<code>fulfilled</code>è¿˜æ˜¯<code>rejected</code>ï¼ŒåŒ…è£…å®ä¾‹æ‰ä¼šç»“æŸã€‚</p><p><code>any</code>ï¼š<code>Promise.any()</code>æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆ<code>rejected</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>rejected</code>çŠ¶æ€ã€‚è¯¥æ–¹æ³•ç›®å‰æ˜¯ä¸€ä¸ªç¬¬ä¸‰é˜¶æ®µçš„<a href="https://github.com/tc39/proposal-promise-any" target="_blank" rel="noopener">ææ¡ˆ</a> ã€‚</p><p><code>resolve</code>ï¼š<code>Promise.resolve()</code>å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ã€‚</p><ul><li><p>å‚æ•°æ˜¯ä¸€ä¸ª<code>Promise</code>å®ä¾‹ï¼šé‚£ä¹ˆ<code>Promise.resolve</code>å°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</p></li><li><p>å‚æ•°æ˜¯ä¸€ä¸ª <code>thenable</code> å®ä¾‹ï¼š<code>thenable</code>å¯¹è±¡æŒ‡çš„æ˜¯å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¯¹è±¡ã€‚ï¼š</p></li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> thenable <span class="token operator">=</span> <span class="token punctuation">{</span>  then<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><code>Promise.resolve</code>æ–¹æ³•ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ<code>thenable</code>å¯¹è±¡çš„<code>then</code>æ–¹æ³•ã€‚</p><ul><li>å‚æ•°ä¸æ˜¯å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–æ ¹æœ¬å°±ä¸æ˜¯å¯¹è±¡ï¼šå¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™<code>Promise.resolve</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º<code>resolved</code>ã€‚</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Hello</span></code></pre><p><code>reject</code>ï¼š<code>Promise.reject(reason)</code>æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸º<code>rejected</code>ã€‚</p><h4 id="Generator-yield"><a href="#Generator-yield" class="headerlink" title="Generator/yield"></a>Generator/yield</h4><p>Generator å‡½æ•°æ˜¯ ES6 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚</p><p>Generator å‡½æ•°æœ‰å¤šç§ç†è§£è§’åº¦ã€‚è¯­æ³•ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚</p><p>æ‰§è¡Œ Generator å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGenerator å‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ª<code>éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°</code>ã€‚è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå† Generator å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚</p><p>å½¢å¼ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾:</p><p>1ã€<code>function</code>å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›</p><p>2ã€å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨<code>yield</code>è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€</p><blockquote><p>Generator å‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„ï¼Œ<code>yield</code>è¡¨è¾¾å¼æ˜¯æš‚åœæ‰§è¡Œçš„æ ‡è®°ï¼Œè€Œ<code>next</code>æ–¹æ³•å¯ä»¥æ¢å¤æ‰§è¡Œã€‚</p></blockquote><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>  <span class="token keyword">yield</span> <span class="token string">'world'</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token string">'ending'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">let</span> hwg <span class="token operator">=</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:hello,done:false }</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:world,done:false }</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:ending,done:true }</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:undefined,done:true }</span></code></pre><p>æ€»ç»“ï¼šè°ƒç”¨Generatorå‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå®ƒæ˜¯å‡½æ•°å†…éƒ¨çš„æŒ‡é’ˆï¼Œä»¥åæ¯è°ƒç”¨ä¸€æ¬¡nextå‡½æ•°ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªå¸¦æœ‰valueå’Œdoneå±æ€§çš„å¯¹è±¡ã€‚<code>next</code>æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ª<code>yield</code>è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚<code>value</code>å±æ€§è¡¨ç¤ºå½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å€¼ï¼Œæ˜¯<code>yield</code>è¡¨è¾¾å¼åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›<code>done</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éå†ç»“æŸã€‚</p><p>Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>return</code>æ–¹æ³•ï¼Œå¯ä»¥è¿”å›ç»™å®šçš„å€¼ï¼Œå¹¶ä¸”ç»ˆç»“éå† Generator å‡½æ•°ã€‚</p><h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><p>ES2017 æ ‡å‡†å¼•å…¥äº† async å‡½æ•°ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚å®ƒæ˜¯Generatorçš„è¯­æ³•ç³–ã€‚<code>async</code>å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰æ›¿æ¢æˆ<code>async</code>ï¼Œå°†<code>yield</code>æ›¿æ¢æˆ<code>await</code>ã€‚</p><p><code>async</code>å‡½æ•°å¯¹ Generator å‡½æ•°çš„æ”¹è¿›ï¼Œä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ã€‚</p><ul><li>å†…ç½®æ‰§è¡Œå™¨ã€‚</li></ul><p>Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ã€‚è€Œ<code>async</code>å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>async</code>å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚</p><ul><li>è¿”å›å€¼æ˜¯ Promise</li></ul><p><code>async</code>å‡½æ•°çš„è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iterator å¯¹è±¡æ–¹ä¾¿å¤šäº†ã€‚ä½ å¯ä»¥ç”¨<code>then</code>æ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p><p>è¿›ä¸€æ­¥è¯´ï¼Œ<code>async</code>å‡½æ•°å®Œå…¨å¯ä»¥çœ‹ä½œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼ŒåŒ…è£…æˆçš„ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œ<code>await</code>å‘½ä»¤å°±æ˜¯å†…éƒ¨<code>then</code>å‘½ä»¤çš„è¯­æ³•ç³–ã€‚</p><p><code>async</code>å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚<code>async</code>å‡½æ•°å†…éƒ¨<code>return</code>è¯­å¥è¿”å›çš„å€¼ï¼Œä¼šæˆä¸º<code>then</code>æ–¹æ³•å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚</p><p><code>async</code>å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡ï¼Œå¿…é¡»ç­‰åˆ°å†…éƒ¨æ‰€æœ‰<code>await</code>å‘½ä»¤åé¢çš„ Promise å¯¹è±¡æ‰§è¡Œå®Œï¼Œæ‰ä¼šå‘ç”ŸçŠ¶æ€æ”¹å˜ï¼Œé™¤éé‡åˆ°<code>return</code>è¯­å¥æˆ–è€…æŠ›å‡ºé”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰<code>async</code>å‡½æ•°å†…éƒ¨çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œï¼Œæ‰ä¼šæ‰§è¡Œ<code>then</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p><p>ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">timeFn</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//Promise æ–°å»ºåå°±ä¼šç«‹å³æ‰§è¡Œã€‚</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span><span class="token string">'hello'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//Promiseçš„å†™æ³•</span>  <span class="token comment" spellcheck="true">// timeFn(time).then(res => {</span>  <span class="token comment" spellcheck="true">//     console.log(res);</span>  <span class="token comment" spellcheck="true">// })</span>  <span class="token comment" spellcheck="true">//async awaitçš„å†™æ³•</span>  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">timeFn</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre><p>ç¨‹åºä¼šåœ¨3sä¹‹åæ‰“å°{msg:â€™helloâ€™}</p><p><code>await</code>ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>await</code>å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚å¦‚æœä¸æ˜¯ Promise å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œ<code>await</code>å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼ˆå³å®šä¹‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆ<code>await</code>ä¼šå°†å…¶ç­‰åŒäº Promise å¯¹è±¡ã€‚</p><p>å¦‚æœ<code>await</code>åé¢çš„å¼‚æ­¥æ“ä½œå‡ºé”™ï¼Œé‚£ä¹ˆç­‰åŒäº<code>async</code>å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡è¢«<code>reject</code>ã€‚</p><p><code>await</code>å‘½ä»¤åªèƒ½ç”¨åœ¨<code>async</code>å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p><p>async å‡½æ•°çš„å®ç°åŸç†ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ...</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç­‰åŒäº</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ...</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//spawn è‡ªåŠ¨æ‰§è¡Œå™¨</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptå—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡å’Œå£°æ˜å‡½æ•°</title>
      <link href="/2020/01/03/JavaScript/block-scope-function/"/>
      <url>/2020/01/03/JavaScript/block-scope-function/</url>
      
        <content type="html"><![CDATA[<h1 id="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜</h1><p>æœ€è¿‘åœ¨ä¸€ä¸ªè®¨è®ºç¾¤çœ‹åˆ°ä¸€ä¸ªé¢è¯•é¢˜ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>  a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre><p>whatï¼Ÿä¸åº”è¯¥æ˜¯ï¼šfunction a(){} ã€function a(){} å—ï¼Ÿ</p><p>æœ€åä¸€ä½ç‰›äººç»™å‡ºäº†ä»–çš„ç†è§£ï¼Œè¿™é‡Œæœ¬äººåªæ˜¯ä½œå‡ºéªŒè¯ï¼ŒåŠ æ·±ç†è§£ã€‚</p><blockquote><p>æ¥ä¸‹æ¥çš„ç¯å¢ƒé»˜è®¤éƒ½æ˜¯chromeç¯å¢ƒï¼Œæ”¯æŒES6ã€‚</p><p>ä¸‹æ–‡æå‡ºçš„é»˜è®¤å˜é‡æŒ‡çš„æ˜¯æ²¡æœ‰ä½¿ç”¨ varã€letã€constå®šä¹‰çš„å˜é‡ã€‚</p></blockquote><h3 id="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"><a href="#å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡"></a>å—çº§ä½œç”¨åŸŸçš„é»˜è®¤å˜é‡</h3><p>æˆ‘ä»¬å…ˆçœ‹è¿™æ ·ä¸€ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ReferenceError: a is not defined</span><span class="token punctuation">{</span>    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre><p>å¯èƒ½æœ‰äº›äººä¼šåƒæˆ‘ä¸€æ ·æ„Ÿåˆ°è¯§å¼‚ï¼šä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªaæ‰“å°å‡ºæ¥çš„ä¸æ˜¯undefinedï¼Ÿ<code>a = 10</code>é»˜è®¤ä¸æ˜¯ <code>var a = 10</code>å—ï¼Ÿåº”è¯¥ä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸçš„é¡¶ç«¯çš„å•Šã€‚</p><p>é‚£å¥½ï¼Œè®©æˆ‘ä»¬æŠŠ<code>window.a</code>æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€a is not defined</span>    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre><p>ç»“è®ºï¼šæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰æ‰§è¡Œäº†å£°æ˜ä»£ç ï¼Œå˜é‡æ‰ä¼šè¢«æŒ‚è½½åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šã€‚</p><p>è®©æˆ‘ä»¬åœ¨çœ‹çœ‹ä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡çš„æƒ…å†µï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  undefined</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined  ã€undefined</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//10 10</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10 10</span></code></pre><p>ç»“è®ºï¼šå¯¹æ¯”ä¸Šä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œä½¿ç”¨<code>var</code>å£°æ˜çš„å˜é‡ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šï¼Œä¸è¿‡å®ƒåªæ˜¯å°†å£°æ˜æå‡ï¼Œèµ‹å€¼æ“ä½œå¹¶æœªæå‡ä¸Šå»ã€‚</p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>åœ¨å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ï¼Œåªæœ‰ä»£ç æ‰§è¡Œåˆ°å£°æ˜è¯­å¥ä¹‹åï¼Œæ‰å¯ä»¥è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li><li>å—çº§ä½œç”¨åŸŸä¸­é»˜è®¤å£°æ˜çš„å˜é‡ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li></ul><h3 id="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜</h3><p>åœ¨å—çº§ä½œç”¨åŸŸä¸­çš„å‡½æ•°å£°æ˜å’Œå˜é‡æ˜¯ä¸åŒçš„ã€‚ä¸å¤šè¯´ï¼Œç›´æ¥æ’¸ä»£ç ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å›åˆ°ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœå—çº§ä½œç”¨åŸŸé‡Œé¢æ˜¯ä¸€ä¸ªé»˜è®¤å˜é‡ï¼Œåˆ™ç¬¬ä¸€è¡Œä»£ç ä¼šç›´æ¥æŠ¥é”™ï¼Œè€Œå‡½æ•°å£°æ˜åˆ™ä¼šæ‰“å°<code>undefined</code>ã€‚</p><p>å…¶å®åœ¨é˜®ä¸€å³°è€å¸ˆçš„<a href="[http://es6.ruanyifeng.com/#docs/let#%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F](http://es6.ruanyifeng.com/#docs/let#å—çº§ä½œç”¨åŸŸ)">ECMAScript6å…¥é—¨</a>ä¸­å…³äºè¿™ä¸€ç‚¹å°±åšäº†æ˜ç¡®è¯´æ˜ï¼š</p><p><img src="http://cdn.yangkunxiao.cn/qw7bBH.png" alt=""></p><p>å—çº§ä½œç”¨åŸŸå‡½æ•°ï¼Œå°±åƒé¢„å…ˆåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä½¿ç”¨<code>var</code>å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œä¸”é»˜è®¤å€¼ä¸º<code>undefined</code>ã€‚</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//function a(){} function a(){}</span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€è¡Œè¾“å‡ºå¤§æ¦‚æ˜¯æ¯”è¾ƒç¬¦åˆé¢„æœŸçš„ã€‚è‡³äºç¬¬äºŒè¡Œ<code>window.a=undefoned</code>ï¼Œè€Œ<code>a=function a(){}</code> ï¼Œä¸Šé¢åœ¨é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ä¸­è¯´è¿‡ï¼Œå£°æ˜å‡½æ•°aä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¸”åœ¨å…¶å—çº§ä½œç”¨åŸŸä¸­ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°é¡¶å±‚ã€‚è€Œ<code>window.a</code>ä¸ºä»€ä¹ˆä¼šä¸º<code>undefined</code>å‘¢ï¼Ÿå› ä¸ºåªæœ‰<code>window.a</code>åªæœ‰ç­‰å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜çš„å®šä¹‰çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡ä¹‹åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</p><h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>å—çº§ä½œç”¨åŸŸå‡½æ•°åœ¨ç¼–è¯‘é˜¶æ®µå°†å‡½æ•°å£°æ˜æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œå¹¶ä¸”ä¼šåœ¨å…¨å±€å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå€¼ä¸ºundefinedã€‚åŒæ—¶ï¼Œä¹Ÿä¼šè¢«æå‡åˆ°å¯¹åº”çš„å—çº§ä½œç”¨åŸŸé¡¶å±‚ã€‚</li><li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰å®šä¹‰å£°æ˜å‡½æ•°çš„é‚£è¡Œä»£ç æ‰§è¡Œè¿‡åï¼Œæ‰ä¼šè¢«æ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸã€‚</li></ul><h3 id="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"><a href="#å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜" class="headerlink" title="å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜"></a>å—çº§ä½œç”¨åŸŸä¸­æœ‰åŒåçš„å˜é‡å’Œå‡½æ•°å£°æ˜</h3><p>çœ‹ğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a(){}  function a(){}</span></code></pre><p>åœ¨è¿™é‡Œï¼Œé¦–å…ˆï¼Œå—çº§ä½œç”¨åŸŸå‡½æ•°açš„å£°æ˜ä¼šè¢«æå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œç¬¬ä¸€è¡Œæ‰“å°æ¯”è¾ƒç¬¦åˆé¢„æœŸã€‚ç„¶ååœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œç”±äºå£°æ˜å‡½æ•°aæå‡åˆ°å—çº§ä½œç”¨åŸŸé¡¶ç«¯ï¼Œæ‰€ä»¥æ‰“å°<code>a = function a(){}</code>ï¼Œè€Œ<code>window.a</code>ç”±äºå¹¶æ²¡æœ‰æ‰§è¡Œå‡½æ•°å®šä¹‰çš„é‚£ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥ä»ç„¶ä¸º<code>undefined</code>ã€‚å½“æ‰§è¡Œåˆ°å£°æ˜å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå‡½æ•°aæ˜ å°„åˆ°å…¨å±€ä½œç”¨åŸŸä¸­ã€‚å½“æ‰§è¡Œ<code>a = 10</code>çš„æ—¶å€™ï¼ŒJSå¼•æ“ä¼šè¿›è¡ŒLHSæŸ¥æ‰¾ï¼Œæ­¤æ—¶ï¼Œå£°æ˜å‡½æ•°å·²ç»è¢«åŒæ—¶æå‡åˆ°å…¨å±€ä½œç”¨åŸŸå’Œå—çº§ä½œç”¨åŸŸé¡¶ç«¯äº†ï¼Œç”±äº<code>é®è”½æ•ˆæœ</code>ï¼Œæ­¤æ—¶æŸ¥æ‰¾aåªä¼šæ‰¾åˆ°å—çº§ä½œç”¨åŸŸå†…çš„aï¼Œå¹¶ä¸ä¼šæ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸçš„aï¼Œè¿™æ—¶ï¼Œaå·²ç»è¢«å®šä¹‰ï¼Œ<code>a = 10</code>åªä¼šæ‰§è¡Œèµ‹å€¼æ“ä½œï¼Œå¹¶ä¸ä¼šè¿›è¡Œæå‡ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ğŸŒ°2ã€‚å®ƒä¼šæ›´åŠ æŠ½è±¡ï¼Œå‡†å¤‡å¥½äº†æ²¡ï¼Ÿ</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined undefined</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined function a(){}</span>       a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10  10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//10 10</span></code></pre><p>æœ‰äº†ä¸Šé¢ä¾‹å­çš„é“ºå«ï¼Œç›¸ä¿¡å¤§å®¶å¯¹å‰ä¸¤è¡Œçš„æ‰“å°ç»“æœä¸ä¼šæœ‰ä»»ä½•ç–‘é—®äº†å§ï¼Ÿ</p><p>é‚£å¥½ï¼Œæˆ‘ä»¬ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæ‰§è¡Œ<code>a = 10</code>ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ­¤æ—¶ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¸­å‡½æ•°å£°æ˜å·²ç»è¢«æå‡åˆ°é¡¶å±‚ï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰§è¡Œaï¼Œå°±æ˜¯ç›¸å½“äºèµ‹å€¼ï¼Œå°†å‡½æ•°å£°æ˜aèµ‹å€¼ä¸ºæ•°å­—aï¼Œå¯ä»¥ç†è§£å—ï¼Ÿå¦‚æœæœ‰ç–‘é—®ï¼Œå¯ä»¥çœ‹ğŸŒ°1ã€‚ç„¶åï¼Œæ‰§è¡Œåˆ°å‡½æ•°å£°æ˜è¯­å¥ï¼Œæ­¤æ—¶ï¼Œè™½ç„¶è¿™ä¸€è¡Œä»£ç æ˜¯å‡½æ•°å£°æ˜è¯­å¥ï¼Œä½†æ˜¯aï¼Œå·²ç»ä¸ºæ•°å­—10äº†ï¼Œæ‰€ä»¥ï¼Œæ‰§è¡Œ<code>function a(){}</code>ä¹‹åï¼Œaçš„å€¼10å°±ä¼šè¢«èµ‹å€¼ç»™å…¨å±€ä½œç”¨åŸŸä¸Šçš„aï¼Œæ‰€ä»¥ä¸‹é¢æ‰“å°çš„<code>window.a,a</code>éƒ½ä¸º10ï¼ï¼ï¼</p><h4 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>å—çº§ä½œç”¨åŸŸå‡½æ•°åªæœ‰æ‰§è¡Œå‡½æ•°å£°æ˜è¯­å¥çš„æ—¶å€™ï¼Œæ‰ä¼šé‡å†™å¯¹åº”çš„å…¨å±€ä½œç”¨åŸŸä¸Šçš„åŒåå˜é‡ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…è°ˆJSå˜é‡æå‡(2020æ–°å¹´ç¬¬ä¸€æ›´)</title>
      <link href="/2020/01/01/JavaScript/variableHoisting/"/>
      <url>/2020/01/01/JavaScript/variableHoisting/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰"><a href="#æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰" class="headerlink" title="æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰"></a>æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰</h1><p>é¦–å…ˆï¼Œå…ˆä¸¢å‡ºæ¥ä¸€é“é¢˜ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœæˆ‘ä»¬ä¸äº†è§£JavaScriptä¸­çš„å˜é‡æå‡å’Œå‡½æ•°å£°æ˜æå‡ï¼Œé‚£æˆ‘ä»¬çš„ç­”æ¡ˆå¯èƒ½å°±æ˜¯è¿™æ ·çš„ï¼š</p><pre class=" language-javascript"><code class="language-javascript">undefinedReferenceError<span class="token punctuation">:</span> b is not defined<span class="token operator">...</span></code></pre><p>é‚£ä¹ˆæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬é¦–å…ˆæŠŠè¿™æ®µä»£ç è¿˜åŸï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¥½äº†ï¼Œè¿™ä¸‹çœ‹ä¸€çœ‹æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"function"</span><span class="token string">"function"</span><span class="token string">"number"</span><span class="token string">"a is not a function"</span></code></pre><h2 id="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ç‚¹ç¼–è¯‘åŸç†çš„çŸ¥è¯†ã€‚JavaScriptçš„æºä»£ç åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šç»è¿‡ä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œæ‰§è¡Œã€‚è€Œä¸”ï¼Œç¼–è¯‘é˜¶æ®µå¾€å¾€å°±åœ¨æ‰§è¡Œé˜¶æ®µçš„å‰å‡ å¾®ç§’ç”šè‡³æ›´çŸ­çš„æ—¶é—´å†…ã€‚</p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><h4 id="è¯æ³•è§£æ"><a href="#è¯æ³•è§£æ" class="headerlink" title="è¯æ³•è§£æ"></a>è¯æ³•è§£æ</h4><p>è¿™ä¸ªé˜¶æ®µä¼šå…ˆæŠŠå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªä¸ªæœ‰æ„ä¹‰çš„ä»£ç å—ï¼Œè¿™äº›ä»£ç å—ä¹Ÿè¢«ç§°ä¸ºè¯æ³•å•å…ƒã€‚å¦‚ <code>var a = 1;</code> ä¼šè¢«è§£ææˆï¼š <code>var ã€aã€=ã€1ã€;</code> ï¼Œç©ºæ ¼æ˜¯å¦ä¼šè¢«è§£ææˆè¯æ³•å•å…ƒï¼Œå°±è¦çœ‹ç©ºæ ¼åœ¨è¿™ä¸ªè¯­è¨€ä¸­æœ‰æ„ä¹‰ã€‚</p><h4 id="è¯­æ³•è§£æ"><a href="#è¯­æ³•è§£æ" class="headerlink" title="è¯­æ³•è§£æ"></a>è¯­æ³•è§£æ</h4><p>è¿™ä¸ªé˜¶æ®µä¼šæŠŠè¯æ³•è§£æç”Ÿæˆçš„è¯æ³•å•å…ƒæµè§£ææˆæœ‰å…ƒç´ é€çº§åµŒå¥—æ‰€ç»„æˆçš„ç¨‹åºè¯­æ³•æ ‘ï¼ŒASTã€‚è‡³äºASTçš„ç»“æ„æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªç½‘ç«™ï¼Œå¤§å®¶å¯ä»¥å»è¯•è¯•: <a href="https://esprima.org/demo/parse.html#" target="_blank" rel="noopener">ç½‘ç«™1</a>ã€<a href="https://resources.jointjs.com/demos/javascript-ast" target="_blank" rel="noopener">ç½‘ç«™2</a>ã€‚</p><h4 id="ä»£ç ç”Ÿæˆ"><a href="#ä»£ç ç”Ÿæˆ" class="headerlink" title="ä»£ç ç”Ÿæˆ"></a>ä»£ç ç”Ÿæˆ</h4><p>è¿™ä¸ªé˜¶æ®µå°±æ˜¯å°†è¯­æ³•è§£æé˜¶æ®µç”Ÿæˆçš„ASTè½¬è¯‘æˆå¯æ‰§è¡Œçš„ä»£ç ã€‚</p><h3 id="å˜é‡æå‡"><a href="#å˜é‡æå‡" class="headerlink" title="å˜é‡æå‡"></a>å˜é‡æå‡</h3><h4 id="LHSæŸ¥è¯¢"><a href="#LHSæŸ¥è¯¢" class="headerlink" title="LHSæŸ¥è¯¢"></a>LHSæŸ¥è¯¢</h4><p>åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆå°†æ ‡è¯†ç¬¦å’Œå‡½æ•°å£°æ˜ç»™æå‡åˆ°å…¶å¯¹åº”çš„ä½œç”¨åŸŸçš„é¡¶ç«¯ã€‚æ ‡è¯†ç¬¦è§£æçš„æ—¶å€™ï¼Œä¼šè¿›è¡ŒLHSæŸ¥è¯¢ï¼Œåœ¨LHSæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœæ ‡è¯†ç¬¦ä¸€ç›´æ‰¾ä¸åˆ°å£°æ˜çš„ä½ç½®ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šåœ¨å…¨å±€ç¯å¢ƒç”Ÿæˆä¸€ä¸ªå…¨å±€å˜é‡ã€‚</p><blockquote><p>LHS ï¼š æŒ‡çš„æ˜¯èµ‹å€¼æ“ä½œçš„å·¦ç«¯ã€‚<br>æ ‡è¯†ç¬¦è§£æï¼šè¯·æŸ¥çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ã€‚</p></blockquote><h4 id="RHSæŸ¥è¯¢"><a href="#RHSæŸ¥è¯¢" class="headerlink" title="RHSæŸ¥è¯¢"></a>RHSæŸ¥è¯¢</h4><p>è¯´åˆ°LHSæŸ¥è¯¢ï¼Œå°±ä¸å¾—ä¸æå¯¹åº”çš„RHSæŸ¥è¯¢ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»çœ‹å‡ºRHSçš„æ„æ€äº†æŠŠï¼Œå®ƒæŒ‡çš„æ˜¯èµ‹å€¼æ“ä½œçš„æºå¤´ã€‚RHSæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„æ ‡è¯†ç¬¦ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼šReferenceErrorã€‚</p><h3 id="å‡½æ•°æå‡"><a href="#å‡½æ•°æå‡" class="headerlink" title="å‡½æ•°æå‡"></a>å‡½æ•°æå‡</h3><p>å‡½æ•°æå‡å’Œå˜é‡æå‡è¿˜æœ‰ç‚¹ä¸ä¸€æ ·ã€‚å‡½æ•°æå‡ï¼Œåªä¼šæå‡å‡½æ•°å£°æ˜ï¼Œè€Œä¸ä¼šæå‡å‡½æ•°è¡¨è¾¾å¼ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//fn is not a function </span><span class="token comment" spellcheck="true">//å‡½æ•°è¡¨è¾¾å¼</span><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//å‡½æ•°å£°æ˜</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>è¿™é‡Œæˆ‘æŠŠä»£ç è¿˜åŸï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//å‡½æ•°å£°æ˜</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">var</span> fn<span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>è¿™ä¸‹æ˜ç™½ä¸ºä»€ä¹ˆæ‰§è¡Œå‡½æ•°fnçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™äº†å§ã€‚</p><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>ç°åœ¨ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯å¯¹å˜é‡å’Œå‡½æ•°å£°æ˜çš„æå‡æœºåˆ¶å·²ç»æœ‰ä¸€å®šçš„äº†è§£äº†ï¼Ÿé‚£ä¹ˆè®©æˆ‘ä»¬åœ¨æ·±åº¦å®æˆ˜ä¸€ä¸‹ã€‚</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>        f <span class="token operator">=</span> a<span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"yideng1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä»£ç å—ä¸­ï¼Œåªæœ‰ä½¿ç”¨ <code>var</code> å£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜æ˜¯å¯ä»¥æå‡çš„ï¼Œä½†æ˜¯å‡½æ•°å£°æ˜åªèƒ½å°†å‡½æ•°çš„åå­—æå‡å‡ºå»ã€‚ </p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"undefined"</span><span class="token string">"undefined"</span><span class="token string">"function"</span></code></pre><p>åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼šä»£ç å—ä¸­ï¼Œåªæœ‰ä½¿ç”¨ <code>var</code> å£°æ˜çš„å˜é‡å¯ä»¥æå‡å‡ºå»ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"undefined"</span><span class="token string">"f is not defined "</span></code></pre><p>å†æ¥çœ‹ä¸€ä¸ªé¢˜ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function</span>    <span class="token comment" spellcheck="true">// var f = 3;</span>    f <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//number</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function</span>    <span class="token comment" spellcheck="true">// var s = 3;</span>    s <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå‡½æ•°fæ˜¯å…·åå‡½æ•°ï¼Œå‡½æ•°sæ˜¯å‡½æ•°è¡¨è¾¾å¼ã€‚å…·åå‡½æ•°ä¸­ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨æ”¹å˜å‡½æ•°åï¼Œè€Œå‡½æ•°è¡¨è¾¾å¼ï¼Œå¦‚æœæœ‰å‡½æ•°åï¼Œåˆ™å®ƒçš„å‡½æ•°ååªèƒ½ä½œç”¨åœ¨å…¶è‡ªèº«ä½œç”¨åŸŸä¸­ï¼Œä¸”ä¸å¯æ”¹å˜æ”¹å˜å‡½æ•°åã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSå˜é‡æå‡</title>
      <link href="/2020/01/01/JavaScript/variable-hoisting/"/>
      <url>/2020/01/01/JavaScript/variable-hoisting/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰"><a href="#æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰" class="headerlink" title="æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰"></a>æµ…è°ˆJSå˜é‡æå‡ï¼ˆ2020æ–°å¹´ç¬¬ä¸€ç« ï¼‰</h1><p>é¦–å…ˆï¼Œå…ˆä¸¢å‡ºæ¥ä¸€é“é¢˜ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœæˆ‘ä»¬ä¸äº†è§£JavaScriptä¸­çš„å˜é‡æå‡å’Œå‡½æ•°å£°æ˜æå‡ï¼Œé‚£æˆ‘ä»¬çš„ç­”æ¡ˆå¯èƒ½å°±æ˜¯è¿™æ ·çš„ï¼š</p><pre class=" language-javascript"><code class="language-javascript">undefinedReferenceError<span class="token punctuation">:</span> b is not defined<span class="token operator">...</span></code></pre><p>é‚£ä¹ˆæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬é¦–å…ˆæŠŠè¿™æ®µä»£ç è¿˜åŸï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¥½äº†ï¼Œè¿™ä¸‹çœ‹ä¸€çœ‹æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"function"</span><span class="token string">"function"</span><span class="token string">"number"</span><span class="token string">"a is not a function"</span></code></pre><h2 id="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæå‡ï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ç‚¹ç¼–è¯‘åŸç†çš„çŸ¥è¯†ã€‚JavaScriptçš„æºä»£ç åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šç»è¿‡ä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œæ‰§è¡Œã€‚è€Œä¸”ï¼Œç¼–è¯‘é˜¶æ®µå¾€å¾€å°±åœ¨æ‰§è¡Œé˜¶æ®µçš„å‰å‡ å¾®ç§’ç”šè‡³æ›´çŸ­çš„æ—¶é—´å†…ã€‚</p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><h4 id="è¯æ³•è§£æ"><a href="#è¯æ³•è§£æ" class="headerlink" title="è¯æ³•è§£æ"></a>è¯æ³•è§£æ</h4><p>è¿™ä¸ªé˜¶æ®µä¼šå…ˆæŠŠå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªä¸ªæœ‰æ„ä¹‰çš„ä»£ç å—ï¼Œè¿™äº›ä»£ç å—ä¹Ÿè¢«ç§°ä¸ºè¯æ³•å•å…ƒã€‚å¦‚ <code>var a = 1;</code> ä¼šè¢«è§£ææˆï¼š <code>var ã€aã€=ã€1ã€;</code> ï¼Œç©ºæ ¼æ˜¯å¦ä¼šè¢«è§£ææˆè¯æ³•å•å…ƒï¼Œå°±è¦çœ‹ç©ºæ ¼åœ¨è¿™ä¸ªè¯­è¨€ä¸­æœ‰æ„ä¹‰ã€‚</p><h4 id="è¯­æ³•è§£æ"><a href="#è¯­æ³•è§£æ" class="headerlink" title="è¯­æ³•è§£æ"></a>è¯­æ³•è§£æ</h4><p>è¿™ä¸ªé˜¶æ®µä¼šæŠŠè¯æ³•è§£æç”Ÿæˆçš„è¯æ³•å•å…ƒæµè§£ææˆæœ‰å…ƒç´ é€çº§åµŒå¥—æ‰€ç»„æˆçš„ç¨‹åºè¯­æ³•æ ‘ï¼ŒASTã€‚è‡³äºASTçš„ç»“æ„æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªç½‘ç«™ï¼Œå¤§å®¶å¯ä»¥å»è¯•è¯•: <a href="https://esprima.org/demo/parse.html#" target="_blank" rel="noopener">ç½‘ç«™1</a>ã€<a href="https://resources.jointjs.com/demos/javascript-ast" target="_blank" rel="noopener">ç½‘ç«™2</a>ã€‚</p><h4 id="ä»£ç ç”Ÿæˆ"><a href="#ä»£ç ç”Ÿæˆ" class="headerlink" title="ä»£ç ç”Ÿæˆ"></a>ä»£ç ç”Ÿæˆ</h4><p>è¿™ä¸ªé˜¶æ®µå°±æ˜¯å°†è¯­æ³•è§£æé˜¶æ®µç”Ÿæˆçš„ASTè½¬è¯‘æˆå¯æ‰§è¡Œçš„ä»£ç ã€‚</p><h3 id="å˜é‡æå‡"><a href="#å˜é‡æå‡" class="headerlink" title="å˜é‡æå‡"></a>å˜é‡æå‡</h3><h4 id="LHSæŸ¥è¯¢"><a href="#LHSæŸ¥è¯¢" class="headerlink" title="LHSæŸ¥è¯¢"></a>LHSæŸ¥è¯¢</h4><p>åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆå°†æ ‡è¯†ç¬¦å’Œå‡½æ•°å£°æ˜ç»™æå‡åˆ°å…¶å¯¹åº”çš„ä½œç”¨åŸŸçš„é¡¶ç«¯ã€‚æ ‡è¯†ç¬¦è§£æçš„æ—¶å€™ï¼Œä¼šè¿›è¡ŒLHSæŸ¥è¯¢ï¼Œåœ¨LHSæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœæ ‡è¯†ç¬¦ä¸€ç›´æ‰¾ä¸åˆ°å£°æ˜çš„ä½ç½®ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šåœ¨å…¨å±€ç¯å¢ƒç”Ÿæˆä¸€ä¸ªå…¨å±€å˜é‡ã€‚</p><blockquote><p>LHS ï¼š æŒ‡çš„æ˜¯èµ‹å€¼æ“ä½œçš„å·¦ç«¯ã€‚<br>æ ‡è¯†ç¬¦è§£æï¼šè¯·æŸ¥çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ã€‚</p></blockquote><h4 id="RHSæŸ¥è¯¢"><a href="#RHSæŸ¥è¯¢" class="headerlink" title="RHSæŸ¥è¯¢"></a>RHSæŸ¥è¯¢</h4><p>è¯´åˆ°LHSæŸ¥è¯¢ï¼Œå°±ä¸å¾—ä¸æå¯¹åº”çš„RHSæŸ¥è¯¢ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»çœ‹å‡ºRHSçš„æ„æ€äº†æŠŠï¼Œå®ƒæŒ‡çš„æ˜¯èµ‹å€¼æ“ä½œçš„æºå¤´ã€‚RHSæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„æ ‡è¯†ç¬¦ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼šReferenceErrorã€‚</p><h3 id="å‡½æ•°æå‡"><a href="#å‡½æ•°æå‡" class="headerlink" title="å‡½æ•°æå‡"></a>å‡½æ•°æå‡</h3><p>å‡½æ•°æå‡å’Œå˜é‡æå‡è¿˜æœ‰ç‚¹ä¸ä¸€æ ·ã€‚å‡½æ•°æå‡ï¼Œåªä¼šæå‡å‡½æ•°å£°æ˜ï¼Œè€Œä¸ä¼šæå‡å‡½æ•°è¡¨è¾¾å¼ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//fn is not a function </span><span class="token comment" spellcheck="true">//å‡½æ•°è¡¨è¾¾å¼</span><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//å‡½æ•°å£°æ˜</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>è¿™é‡Œæˆ‘æŠŠä»£ç è¿˜åŸï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//å‡½æ•°å£°æ˜</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">var</span> fn<span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>è¿™ä¸‹æ˜ç™½ä¸ºä»€ä¹ˆæ‰§è¡Œå‡½æ•°fnçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™äº†å§ã€‚</p><h3 id="å—çº§ä½œç”¨åŸŸ"><a href="#å—çº§ä½œç”¨åŸŸ" class="headerlink" title="å—çº§ä½œç”¨åŸŸ"></a>å—çº§ä½œç”¨åŸŸ</h3><p>å—çº§ä½œç”¨åŸŸæ˜¯åœ¨ES6ä¸­æå‡ºçš„ä¸€ä¸ªæ¦‚å¿µï¼ŒES5ä¸­æ˜¯æ²¡æœ‰å—çº§ä½œç”¨åŸŸçš„ï¼Œåªæœ‰å…¨å±€ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸã€‚<br>æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸ªæ¡ˆä¾‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span><span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>        yideng <span class="token operator">=</span> a<span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"yideng1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//function</span></code></pre><p>è¿˜æ˜¯æŠŠè¿™æ®µä»£ç è¿˜åŸä¸€ä¸‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a<span class="token punctuation">,</span>flag<span class="token punctuation">,</span>fn<span class="token punctuation">;</span><span class="token operator">...</span><span class="token operator">...</span></code></pre><p>æˆ–è®¸æœ‰äººä¼šé—®ï¼šä¸ºä»€ä¹ˆaå’Œå‡½æ•°fnä¼šè¢«æåˆ°æœ€é¡¶ç«¯ï¼Ÿå˜é‡aå’Œå‡½æ•°fnéƒ½æ˜¯åœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œå…¶ä¸­aæ˜¯é€šè¿‡varè¿›è¡Œå£°æ˜çš„ï¼Œå‡½æ•°fnæ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜ã€‚è€Œéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå—çº§ä½œç”¨åŸŸæ˜¯é˜»æŒ¡ä¸äº†varå£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜çš„æå‡çš„ã€‚ä½†æ˜¯ï¼Œå£°æ˜å‡½æ•°ã€‚<br>æ›´è¿›ä¸€æ­¥</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>    a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//5 5</span>    a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//5 0</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//5 5</span></code></pre><p>å¤§å®¶çœ‹åˆ°è¿™ä¸ªç­”æ¡ˆæ˜¯ä¸æ˜¯å¾ˆç–‘æƒ‘ï¼Ÿå½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªç­”æ¡ˆçš„æ—¶å€™ï¼Œå†…å¿ƒä¹Ÿæ˜¯ä¸€ä¸‡ä¸ªğŸ¦™å¥”è…¾è€Œè¿‡ã€‚<br>æˆ‘ä»¬ä¸Šé¢è¯´è¿‡ï¼Œå—çº§ä½œç”¨åŸŸä¸­ï¼Œåªæœ‰varå£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜å¯ä»¥ç›´æ¥æåˆ°å…¨å±€ä½œç”¨åŸŸã€‚å—çº§ä½œç”¨åŸŸä¸­çš„ä¸å®ç”¨varå£°æ˜çš„å˜é‡ï¼Œä¹Ÿä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä½†æ˜¯åªæœ‰åœ¨å—çº§ä½œç”¨åŸŸä¸­è¿è¡Œä¹‹åï¼Œæ‰ä¼šåå°„åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šã€‚<br>è€Œä¸”å—çº§ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸå®Œå…¨ä¸åŒï¼šå‡½æ•°ä½œç”¨åŸŸä¼šåœ¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œé‡å†™windowã€‚è€Œå—çº§ä½œç”¨åŸŸä¹‹åè¿›è¡Œä¸€æ¬¡æœ‰æ„ä¹‰çš„é‡å†™ã€‚æ‰€è°“æœ‰æ„ä¹‰çš„é‡å†™ï¼Œå°±æ˜¯åœ¨å¤–å±‚ä½œç”¨åŸŸæ²¡æœ‰å£°æ˜å’Œèµ‹å€¼ã€‚<br>åœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œå‡½æ•°å£°æ˜ä¼šæå‡åˆ°å½“å‰ä½œç”¨åŸŸé¡¶å±‚ï¼Œè‡³äºä¼šä¸ä¼šé‡å†™å¤–å±‚å˜é‡ï¼Œé‚£å°±è¦çœ‹æ˜¯å¦æœ‰å®é™…æ„ä¹‰ã€‚</p><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>ç°åœ¨ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯å¯¹å˜é‡å’Œå‡½æ•°çš„æå‡æœºåˆ¶å·²ç»æœ‰ä¸€å®šçš„äº†è§£äº†ï¼Ÿé‚£ä¹ˆè®©æˆ‘ä»¬åœ¨æ·±åº¦å®æˆ˜ä¸€ä¸‹ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//'use strict'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>        f <span class="token operator">=</span> a<span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"yideng1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨ES6éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä»£ç å—ä¸­ï¼Œåªæœ‰ä½¿ç”¨ <code>var</code> å£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜æ˜¯å¯ä»¥æå‡çš„ï¼Œä½†æ˜¯å‡½æ•°å£°æ˜åªèƒ½å°†å‡½æ•°çš„åå­—æå‡å‡ºå»ã€‚<br>ES5éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå„ä¸ªæµè§ˆå™¨è¡¨ç°ä¸ä¸€æ ·ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"undefined"</span><span class="token string">"undefined"</span><span class="token string">"function"</span></code></pre><p>åœ¨ES6ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼šä»£ç å—ä¸­ï¼Œåªæœ‰ä½¿ç”¨ <code>var</code> å£°æ˜çš„å˜é‡å¯ä»¥æå‡å‡ºå»ã€‚<br>ES5ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œç›´æ¥æŠ¥é”™ã€‚å› ä¸ºES5å‡½æ•°ä¸å…è®¸åœ¨å—çº§ä½œç”¨åŸŸä¸­å£°æ˜å‡½æ•°ã€‚å‡½æ•°çš„å£°æ˜åªèƒ½åœ¨å‡½æ•°ä½œç”¨åŸŸæˆ–è€…é¡¶çº§ä½œç”¨åŸŸä¸­ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"undefined"</span><span class="token string">"ReferenceError:f is not defined "</span><span class="token comment" spellcheck="true">//æŠ¥é”™</span></code></pre><p>å†æ¥çœ‹ä¸€ä¸ªé¢˜ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function</span>    <span class="token comment" spellcheck="true">// var f = 3;</span>    f <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//number</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function</span>    <span class="token comment" spellcheck="true">// var s = 3;</span>    s <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå‡½æ•°fæ˜¯å…·åå‡½æ•°ï¼Œå‡½æ•°sæ˜¯å‡½æ•°è¡¨è¾¾å¼ã€‚å…·åå‡½æ•°ä¸­ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨æ”¹å˜å‡½æ•°åï¼Œè€Œå‡½æ•°è¡¨è¾¾å¼ï¼Œå¦‚æœæœ‰å‡½æ•°åï¼Œåˆ™å®ƒçš„å‡½æ•°ååªèƒ½ä½œç”¨åœ¨å…¶è‡ªèº«ä½œç”¨åŸŸä¸­ï¼Œä¸”ä¸å¯æ”¹å˜æ”¹å˜å‡½æ•°åã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web Worker(2019æœ€åä¸€æ›´)</title>
      <link href="/2019/12/31/JavaScript/webWorker/"/>
      <url>/2019/12/31/JavaScript/webWorker/</url>
      
        <content type="html"><![CDATA[<h1 id="web-Workerçš„ä½¿ç”¨"><a href="#web-Workerçš„ä½¿ç”¨" class="headerlink" title="web Workerçš„ä½¿ç”¨"></a>web Workerçš„ä½¿ç”¨</h1><h2 id="web-Worker"><a href="#web-Worker" class="headerlink" title="web Worker"></a>web Worker</h2><h3 id="ä»€ä¹ˆæ˜¯web-Worker"><a href="#ä»€ä¹ˆæ˜¯web-Worker" class="headerlink" title="ä»€ä¹ˆæ˜¯web Worker"></a>ä»€ä¹ˆæ˜¯web Worker</h3><p>JavaScriptæ˜¯å•çº¿ç¨‹çš„ã€‚æ‰€æœ‰çš„ä»»åŠ¡åªèƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œï¼Œä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œåé¢çš„åªèƒ½ç­‰å¾…ã€‚è€Œä¸”ç°åœ¨è®¡ç®—æœºå¤§å¤šéƒ½æ˜¯å¤šæ ¸çš„ï¼Œå•çº¿ç¨‹ä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨è®¡ç®—æœºçš„èµ„æºã€‚<br />web Workeræ˜¯HTML5 æå‡ºçš„JavaScriptå¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å¤§è®¡ç®—é‡çš„æ“ä½œäº¤ç»™web workerå»è¿ç®—ï¼Œè€Œä¸å¿…â€œå†»ç»“â€é¡µé¢ã€‚</p><h3 id="web-Workerçš„ä½œç”¨"><a href="#web-Workerçš„ä½œç”¨" class="headerlink" title="web Workerçš„ä½œç”¨"></a>web Workerçš„ä½œç”¨</h3><p>ä¸ºJavaScriptåˆ›å»ºå¤šçº¿ç¨‹ã€‚å…è®¸ä¸»çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹ï¼Œå°†ä¸»çº¿ç¨‹çš„å¤æ‚çš„ä»»åŠ¡åˆ†é…ç»™å­çº¿ç¨‹å»æ‰§è¡Œã€‚åœ¨ä¸»çº¿ç¨‹è¿è¡Œçš„åŒæ—¶ï¼Œå­çº¿ç¨‹ä¹Ÿåœ¨åå°æ‰§è¡Œï¼ŒäºŒè€…äº’ä¸å½±å“ã€‚ç­‰å­çº¿ç¨‹å¤„ç†å®Œæˆä¹‹åï¼Œå†å°†ç»“æœä¼ é€’ç»™ä¸»çº¿ç¨‹ã€‚è¿™æ ·ï¼Œå­çº¿ç¨‹åˆ†æ‹…äº†ä¸»çº¿ç¨‹çš„è´Ÿè½½ï¼Œè®©ä¸»çº¿ç¨‹çš„è¿è¡Œâ€œé¡ºç•…â€èµ·æ¥ï¼Œä¸ä¼šè¢«é˜»å¡ã€‚</p><h3 id="web-Workerçš„ä½¿ç”¨é™åˆ¶"><a href="#web-Workerçš„ä½¿ç”¨é™åˆ¶" class="headerlink" title="web Workerçš„ä½¿ç”¨é™åˆ¶"></a>web Workerçš„ä½¿ç”¨é™åˆ¶</h3><ul><li>åŒæºé™åˆ¶ã€‚åˆ†é…çš„workerçº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶ï¼Œå¿…é¡»å’Œä¸»çº¿ç¨‹åŒæºã€‚</li><li>DOMé™åˆ¶ã€‚workerçº¿ç¨‹æ‰€åœ¨çš„è„šæœ¬æ–‡ä»¶ï¼Œæ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨çš„ç½‘é¡µçš„DOMå¯¹è±¡ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>location</code> å’Œ <code>navigator</code> å¯¹è±¡ã€‚</li><li>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯ã€‚ä¸»çº¿ç¨‹å’Œworkerçº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨æ¶ˆæ¯è¿›è¡Œé€šè®¯ã€‚</li><li>è„šæœ¬é™åˆ¶ã€‚workerçº¿ç¨‹ä¸­ä¸å…è®¸ä½¿ç”¨ <code>alert</code> å’Œ <code>confirm</code> ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>XMLHttpRequest</code> å¯¹è±¡ã€‚</li><li>æ–‡ä»¶é™åˆ¶ã€‚workerçº¿ç¨‹ä¸èƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå®ƒæ‰€åŠ è½½çš„è„šæœ¬æ–‡ä»¶ï¼Œå¿…é¡»æ¥æºäºç½‘ç»œã€‚</li></ul><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><h3 id="ä¸»çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹" class="headerlink" title="ä¸»çº¿ç¨‹"></a>ä¸»çº¿ç¨‹</h3><p>ä¸»çº¿ç¨‹æ–°å»ºworkerçº¿ç¨‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//new Worker(jsUrl, options);</span><span class="token keyword">let</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'child.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>Worker</code> æ„é€ å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œè¯¥è„šæœ¬æ–‡ä»¶å°±æ˜¯è¦Workerçº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¿…é¡»æ¥è‡ªç½‘ç»œï¼Œå¦åˆ™åˆ™ä¼šå¤±è´¥ã€‚Workeræ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯å¯¹è±¡å½¢å¼ï¼Œå®ƒçš„ä¸€ä¸ªä½œç”¨å°±æ˜¯æŒ‡å®šWorkerçš„åç§°ã€‚</p><h4 id="ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯"><a href="#ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯" class="headerlink" title="ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯"></a>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹é€šè®¯</h4><p>ä¸»çº¿ç¨‹è°ƒç”¨ <code>worker.postMessage()</code> æ–¹æ³•ï¼Œå‘å­çº¿ç¨‹ä¼ é€’æ•°æ®ã€‚</p><pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹é€šä¿¡!'</span><span class="token punctuation">)</span>ï¼›<span class="token comment" spellcheck="true">//or</span>worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  type<span class="token punctuation">:</span> <span class="token string">'common'</span><span class="token punctuation">,</span>  message<span class="token punctuation">:</span> <span class="token string">"å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹é€šä¿¡!"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶"><a href="#ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶" class="headerlink" title="ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶"></a>ä¸»çº¿ç¨‹æŒ‡å®šç›‘å¬äº‹ä»¶</h4><p>ä¸»çº¿ç¨‹ä½¿ç”¨ <code>worker.onmessage()</code> æ–¹æ³•ï¼Œç›‘å¬ä»å­çº¿ç¨‹å‘é€çš„æ•°æ®ï¼š</p><pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ä¸»çº¿ç¨‹æ”¶åˆ°å­çº¿ç¨‹å‘çš„æ¶ˆæ¯ï¼ï¼ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h4><p>ä¸»çº¿ç¨‹ä¸­å¯ä»¥ç›‘å¬workeræ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œworkerå°±ä¼šè§¦å‘ä¸»çº¿ç¨‹çš„ <code>onerror</code> æ–¹æ³•ã€‚</p><pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//e.lineno ï¼šé”™è¯¯ä»£ç çš„è¡Œæ•°</span>  <span class="token comment" spellcheck="true">//e.filename ï¼šå‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶</span>  <span class="token comment" spellcheck="true">//e.message ï¼šé”™è¯¯è¯¦ç»†ä¿¡æ¯</span><span class="token punctuation">}</span></code></pre><h4 id="ç»ˆæ­¢æ‰§è¡Œ"><a href="#ç»ˆæ­¢æ‰§è¡Œ" class="headerlink" title="ç»ˆæ­¢æ‰§è¡Œ"></a>ç»ˆæ­¢æ‰§è¡Œ</h4><p>å½“ä»»åŠ¡å®Œæˆä»¥åï¼Œä¸»çº¿ç¨‹å¯ä»¥é€šè¿‡ <code>worker.terminate()</code> æ–¹æ³•ï¼Œç»ˆæ­¢workerçš„æ‰§è¡Œã€‚</p><pre class=" language-javascript"><code class="language-javascript">worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="workerçº¿ç¨‹"><a href="#workerçº¿ç¨‹" class="headerlink" title="workerçº¿ç¨‹"></a>workerçº¿ç¨‹</h3><h4 id="workerç›‘å¬å‡½æ•°"><a href="#workerç›‘å¬å‡½æ•°" class="headerlink" title="workerç›‘å¬å‡½æ•°"></a>workerç›‘å¬å‡½æ•°</h4><p>åœ¨workerä¸­ï¼Œä½¿ç”¨ç›‘å¬å‡½æ•°ï¼Œæ¥è·å–ä¸»çº¿ç¨‹å‘é€çš„æ•°æ®ï¼š</p><pre class=" language-javascript"><code class="language-javascript">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`å­çº¿ç¨‹æ¥æ”¶æ¶ˆæ¯ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`æˆ‘æ”¶åˆ°ä½ å‘çš„æ¶ˆæ¯äº†! ä½ å‘çš„æ¶ˆæ¯æ˜¯ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ <code>self</code> ä»£è¡¨å­çº¿ç¨‹è‡ªèº«ï¼Œå³å­çº¿ç¨‹çš„å…¨å±€å¯¹è±¡ã€‚</p><h4 id="workerçº¿ç¨‹åŠ è½½è„šæœ¬"><a href="#workerçº¿ç¨‹åŠ è½½è„šæœ¬" class="headerlink" title="workerçº¿ç¨‹åŠ è½½è„šæœ¬"></a>workerçº¿ç¨‹åŠ è½½è„šæœ¬</h4><p>å¦‚æœæˆ‘ä»¬åœ¨workerä¸­éœ€è¦å¼•å…¥å…¶ä»–è„šæœ¬æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ <code>importScripts()</code>  æ–¹æ³•å¯¼å…¥ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'underscore.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯¼å…¥ä¹‹åï¼Œå°±å¯ä»¥åœ¨workerçº¿ç¨‹ä¸­ä½¿ç”¨äº†ã€‚</p><h4 id="å…³é—­worker"><a href="#å…³é—­worker" class="headerlink" title="å…³é—­worker"></a>å…³é—­worker</h4><p>å½“workeræ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¯ä»¥å°†å…¶å…³é—­ï¼š</p><pre class=" language-javascript"><code class="language-javascript">self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºç¡€</title>
      <link href="/2019/12/24/Webpack/01/"/>
      <url>/2019/12/24/Webpack/01/</url>
      
        <content type="html"><![CDATA[<h1 id="webpack4-0-ä¸€-ï¼šåŸºç¡€"><a href="#webpack4-0-ä¸€-ï¼šåŸºç¡€" class="headerlink" title="webpack4.0(ä¸€)ï¼šåŸºç¡€"></a>webpack4.0(ä¸€)ï¼šåŸºç¡€</h1><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h4 id="context"><a href="#context" class="headerlink" title="context"></a>context</h4><p>åŸºç¡€ç›®å½•ï¼Œç»å¯¹è·¯å¾„ï¼Œç”¨æˆ·è®¾ç½®ä»é…ç½®æ–‡ä»¶ä¸­è§£æå…¥å£æ–‡ä»¶å’ŒåŠ è½½å™¨ã€‚<br>å¦‚ï¼š</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    context<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span>'js<span class="token punctuation">)</span><span class="token punctuation">,</span>  entry<span class="token punctuation">:</span><span class="token string">'./main.js'</span><span class="token punctuation">}</span></code></pre><p>ç­‰åŒäºï¼š</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  entry<span class="token punctuation">:</span>'<span class="token punctuation">.</span><span class="token operator">/</span>js<span class="token operator">/</span>main<span class="token punctuation">.</span>js<span class="token punctuation">}</span></code></pre><p>contexté…ç½®å¯ä»¥ä¸è¦ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾ã€‚ä½†æ˜¯å¦‚æœè¦ä½¿ç”¨çš„è¯ï¼Œå»ºè®®æ·»åŠ ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºå‘Šè¯‰webpackæ˜¯ä»å½“å‰ç›®å½•ä¸‹å“ªä¸ªæ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾ã€‚</p><h4 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h4><p>webpackä¸­æœ‰å¤šç§å®šä¹‰å…¥å£çš„å½¢å¼ã€‚</p><h5 id="å•å…¥å£å†™æ³•"><a href="#å•å…¥å£å†™æ³•" class="headerlink" title="å•å…¥å£å†™æ³•"></a>å•å…¥å£å†™æ³•</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span><span class="token string">'./src/main.js'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre><h5 id="å¯¹è±¡è¯­æ³•"><a href="#å¯¹è±¡è¯­æ³•" class="headerlink" title="å¯¹è±¡è¯­æ³•"></a>å¯¹è±¡è¯­æ³•</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span><span class="token punctuation">{</span>    main<span class="token punctuation">:</span><span class="token string">'./src/main.js'</span><span class="token punctuation">,</span>    venders<span class="token punctuation">:</span><span class="token string">'./src/venders.js'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre><h4 id="output"><a href="#output" class="headerlink" title="output"></a>output</h4><p>é…ç½®<code>output</code>å¯ä»¥æŒ‡å®šwebpackå¦‚ä½•å‘ç¡¬ç›˜ä¸­å†™å…¥ï¼Œæ³¨æ„çš„æ˜¯ï¼šwebpackå¯ä»¥é…ç½®å¤šä¸ªå…¥å£æ–‡ä»¶ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªè¾“å‡ºé…ç½®ã€‚</p><p>åœ¨webpackä¸­ï¼Œoutputæœ€ä½çš„é…ç½®è¦æ±‚å°±æ˜¯ï¼š</p><ul><li>filenameï¼šç”¨äºæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶å</li><li>pathï¼šç”¨äºæŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„è·¯å¾„</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>  output<span class="token punctuation">:</span><span class="token punctuation">{</span>    filename<span class="token punctuation">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre><h4 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h4><p><code>mode</code>æ¨¡å—ç”¨äºå‘Šè¯‰webpackä½¿ç”¨ç›¸åº”çš„æ¨¡å¼è¿›è¡Œä¼˜åŒ–ã€‚</p><ul><li>developmentï¼šå¼€å‘ç¯å¢ƒã€‚ä¼šå°† <code>process.env.NODE_ENV</code> çš„å€¼è®¾ä¸º <code>development</code>ã€‚å¯ç”¨ <code>NamedChunksPlugin</code> å’Œ <code>NamedModulesPlugin</code>ã€‚</li><li>productionï¼šç”Ÿäº§ç¯å¢ƒã€‚ä¼šå°† <code>process.env.NODE_ENV</code> çš„å€¼è®¾ä¸º <code>production</code>ã€‚å¯ç”¨ <code>FlagDependencyUsagePlugin</code>, <code>FlagIncludedChunksPlugin</code>, <code>ModuleConcatenationPlugin</code>, <code>NoEmitOnErrorsPlugin</code>, <code>OccurrenceOrderPlugin</code>, <code>SideEffectsFlagPlugin</code> å’Œ <code>UglifyJsPlugin</code>ã€‚</li></ul><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“webpackå¯ä»¥å¯¹èµ„æºè¿›è¡Œæ‰“åŒ…çš„ã€‚ä½†æ˜¯webpackåªèƒ½å¤„ç†jsæ¨¡å—ï¼Œå¯¹äºå…¶ä»–æ¨¡å—çš„å¤„ç†ï¼Œå°±éœ€è¦ç”¨loaderå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ã€‚loaderå¯ä»¥ä½¿ä½ åœ¨importæˆ–è€…â€œåŠ è½½â€æ¨¡å—çš„æ—¶å€™ï¼Œè¿›è¡Œé¢„ç¼–è¯‘ã€‚loader å¯ä»¥å°†æ–‡ä»¶ä»ä¸åŒçš„è¯­è¨€ï¼ˆå¦‚ TypeScriptï¼‰è½¬æ¢ä¸º JavaScriptï¼Œæˆ–å°†å†…è”å›¾åƒè½¬æ¢ä¸º data URLã€‚loader ç”šè‡³å…è®¸ä½ ç›´æ¥åœ¨ JavaScript æ¨¡å—ä¸­ <code>import</code> CSSæ–‡ä»¶ï¼</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  module<span class="token punctuation">:</span><span class="token punctuation">{</span>    rules<span class="token punctuation">:</span><span class="token punctuation">[</span>      <span class="token punctuation">{</span>        test<span class="token punctuation">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>        use<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h5 id="ç¼–å†™ä¸€ä¸ªloader"><a href="#ç¼–å†™ä¸€ä¸ªloader" class="headerlink" title="ç¼–å†™ä¸€ä¸ªloader"></a>ç¼–å†™ä¸€ä¸ªloader</h5><p>loaderå·¥å…·åº“ï¼š<code>loader-utils</code>ã€é…åˆ<code>schema-utils</code>ï¼Œ</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'loader-utils'</span><span class="token punctuation">;</span><span class="token keyword">import</span> validateOptions <span class="token keyword">from</span> <span class="token string">'schema-utils'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//loaderçš„APIè¯·å‚è€ƒï¼šhttps://webpack.docschina.org/api/loaders/</span></code></pre><p>æ‰€è°“ loader åªæ˜¯ä¸€ä¸ªå¯¼å‡ºä¸ºå‡½æ•°çš„ JavaScript æ¨¡å—ã€‚</p><ul><li>æ–°å»ºä¸€ä¸ªjsæ–‡ä»¶ï¼š</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//loader-utils å®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„å·¥å…·ï¼Œä½†æœ€å¸¸ç”¨çš„ä¸€ç§å·¥å…·æ˜¯è·å–ä¼ é€’ç»™ loader çš„é€‰é¡¹</span><span class="token keyword">const</span> loadersUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªloader</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//contentæ˜¯æ–‡ä»¶å†…å®¹</span>  <span class="token keyword">const</span> options <span class="token operator">=</span> loadersUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'--------content'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">'--------options'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//åŒæ­¥loader</span>    <span class="token comment" spellcheck="true">// return '{};' + content</span>    <span class="token comment" spellcheck="true">/**     * this.callback() å‚æ•°ï¼š     * error:Error | nullï¼Œå½“loaderå‡ºé”™æ—¶å‘å¤–è·‘å‡ºä¸€ä¸ªError     * content:ç»è¿‡loaderå¤„ç†è¿‡çš„å†…å®¹     * sourceMapï¼šä¸ºæ–¹ä¾¿è°ƒè¯•ç”Ÿæˆçš„ç¼–è¯‘åå†…å®¹çš„source map     * astï¼šæœ¬æ¬¡ç¼–è¯‘ç”Ÿæˆçš„ASTé™æ€è¯­æ³•æ ‘ï¼Œä¹‹åæ‰§è¡Œçš„loaderå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªASTï¼Œå¯ä»¥çœå»é‡å¤ç”ŸæˆASTçš„è¿‡ç¨‹     *      */</span>    <span class="token comment" spellcheck="true">// this.callback(null, '{};' + content)</span>   <span class="token comment" spellcheck="true">//å¼‚æ­¥ ä½¿ç”¨promise</span>    <span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token function">resolve</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// let data = await timeout(1000);</span>    <span class="token comment" spellcheck="true">// return data</span>    <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><ul><li>åœ¨<code>webpack.config.js</code>ä¸­ä½¿ç”¨è¯¥loaderï¼š</li></ul><pre class=" language-javascript"><code class="language-javascript">rules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>  test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>  exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>  use<span class="token punctuation">:</span> <span class="token punctuation">{</span>    loader<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./loaders/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>        test<span class="token punctuation">:</span> <span class="token number">1</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><ul><li>å¦‚æœæœ‰å¤šä¸ªloaderï¼Œå¯ä»¥åœ¨<code>webpack.config.js</code>ä¸­è¿™æ ·é…ç½®ï¼š</li></ul><pre><code>resolveLoader:{    modules:[        &#39;node_modules&#39;,        path.resolve(__dirname,&#39;loaders&#39;)//loadersä»£è¡¨ä½ å­˜æ”¾loadersçš„æ–‡ä»¶å¤¹    ]}</code></pre><h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><p><img src="http://cdn.yangkunxiao.cn/sZosgl.jpg#align=left&display=inline&height=1610&originHeight=1610&originWidth=1150&status=done&style=none&width=1150" alt=""></p><p>webpackäº‹ä»¶æµï¼š</p><ul><li>é¦–å…ˆï¼Œ<code>webpack</code>ä¼šè¯»å–ä½ åœ¨å‘½ä»¤è¡Œå’Œ<code>webpack.config.js</code>çš„é…ç½®ï¼Œåˆå§‹åŒ–æœ¬æ¬¡æ„å»ºçš„å‚æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œé…ç½®ä¸­çš„æ’ä»¶å®ä¾‹åŒ–ï¼Œç”Ÿäº§<code>compiler</code>ä¼ å…¥<code>apply</code>æ–¹æ³•ä¸­ï¼Œä¸º<code>webpackäº‹ä»¶æµ</code>æŒ‚ä¸Šè‡ªå®šä¹‰é’©å­ã€‚</li><li>æ¥ä¸‹æ¥åˆ°äº†è§£æå…¥å£æ–‡ä»¶é˜¶æ®µï¼Œ<code>webpack</code>ä¼šæ ¹æ®<code>entry</code>ä¾æ¬¡è¯»å–å…¥å£æ–‡ä»¶ã€‚</li><li><code>webpack</code>å¼€å§‹ç¼–è¯‘(<code>conpilation</code>)ï¼Œå¯¹äºæ¯ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œéƒ½ä¼šå…ˆæ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰çš„<code>loader</code>å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œç¼–è¯‘(<code>buildModule</code>)ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¼ å…¥äº‹ä»¶å›è°ƒçš„<code>compliation</code>ä¸Šæ‹¿åˆ°<code>module</code>çš„<code>resource</code>ã€<code>loader</code>ç­‰ä¿¡æ¯ã€‚ä¹‹åï¼Œå†å°†ç¼–è¯‘å¥½çš„æ–‡ä»¶å†…å®¹ä½¿ç”¨<code>acorn</code>è§£æç”ŸæˆAST(é™æ€è¯­æ³•æ ‘ï¼Œ<code>normalModuleLoader</code>)ã€‚åˆ†ææ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä¾æ¬¡æ‹‰å–ä¾èµ–æ¨¡å—ï¼Œå¹¶é‡å¤ä»¥ä¸Šè¿‡ç¨‹ã€‚æœ€åå°†requireè¯­æ³•æ›¿æ¢ä¸º<code>__webpack_require__</code>æ¥æ¨¡æ‹Ÿæ¨¡å—åŒ–æ“ä½œã€‚</li><li>emité˜¶æ®µï¼Œæ‰€æœ‰æ–‡ä»¶çš„ç¼–è¯‘åŠè½¬åŒ–éƒ½å·²ç»å®Œæˆï¼ŒåŒ…å«äº†æœ€ç»ˆè¾“å‡ºçš„èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼ å…¥äº‹ä»¶å›è°ƒçš„<code>compilation.assets</code> ä¸Šæ‹¿åˆ°æ‰€éœ€æ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬å³å°†è¾“å‡ºçš„èµ„æºã€ä»£ç å—<code>Chunk</code>ç­‰ç­‰ä¿¡æ¯ã€‚</li></ul><p>æˆ‘ä»¬å°†webpackäº‹ä»¶æµç†è§£ä¸ºwebpackæ„å»ºè¿‡ç¨‹ä¸­çš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œä»–ä»¬åˆ†åˆ«è¡¨ç¤ºç€ä¸åŒçš„æ„å»ºå‘¨æœŸå’ŒçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥åƒåœ¨æµè§ˆå™¨ä¸Šç›‘å¬clickäº‹ä»¶ä¸€æ ·ç›‘å¬äº‹ä»¶æµä¸Šçš„äº‹ä»¶ï¼Œå¹¶ä¸”ä¸ºå®ƒä»¬æŒ‚è½½äº‹ä»¶å›è°ƒã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰äº‹ä»¶å¹¶åœ¨åˆé€‚æ—¶æœºè¿›è¡Œå¹¿æ’­ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨äº†webpackè‡ªå¸¦çš„æ¨¡å— <code>Tapable</code> è¿›è¡Œç®¡ç†çš„ã€‚æˆ‘ä»¬ä¸éœ€è¦è‡ªè¡Œå®‰è£… <code>Tapable</code> ï¼Œåœ¨webpackè¢«å®‰è£…çš„åŒæ—¶å®ƒä¹Ÿä¼šä¸€å¹¶è¢«å®‰è£…ï¼Œå¦‚éœ€ä½¿ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ä»¶é‡Œç›´æ¥ <code>require</code> å³å¯ã€‚</p><p>Tapableçš„åŸç†å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨å‰ç«¯è¿›é˜¶è¿‡ç¨‹ä¸­éƒ½ä¼šç»å†çš„EventEmitï¼Œé€šè¿‡å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼å®ç°ï¼Œå®ƒçš„éƒ¨åˆ†æ ¸å¿ƒä»£ç å¯ä»¥æ¦‚æ‹¬æˆä¸‹é¢è¿™æ ·ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">SyncHook</span><span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// è®¢é˜…äº‹ä»¶</span>    <span class="token function">tap</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å‘å¸ƒ</span>    <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>hook <span class="token operator">=</span><span class="token operator">></span> <span class="token function">hook</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è¯·å‚è€ƒï¼š<a href="https://juejin.im/post/5abf33f16fb9a028e46ec352" target="_blank" rel="noopener">https://juejin.im/post/5abf33f16fb9a028e46ec352</a></p><h4 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h4><p>resolve.alias æ˜¯é€šè¿‡åˆ«åæ¥å°†åŸå¯¼å…¥è·¯å¾„æ˜ å°„æˆä¸€ä¸ªæ–°çš„å¯¼å…¥è·¯å¾„ã€‚æ¯”å¦‚å¦‚ä¸‹é…ç½®ï¼š</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  entry<span class="token punctuation">:</span> <span class="token string">'./js/main.js'</span><span class="token punctuation">,</span>  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>    filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// å°†è¾“å‡ºçš„æ–‡ä»¶éƒ½æ”¾åœ¨distç›®å½•ä¸‹</span>    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>      components<span class="token punctuation">:</span> <span class="token string">'./src/components'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¦‚ä¸Šä»£ç é…ç½®ï¼Œå½“æˆ‘é€šè¿‡ import xxx from â€˜components/xxxâ€™ å¯¼å…¥æ—¶ï¼Œå®é™…ä¸Šè¢«aliasæ›¿æ¢æˆäº†<br>import xxx from â€˜./src/components/xxxâ€™;</p><h4 id="extensions"><a href="#extensions" class="headerlink" title="extensions"></a>extensions</h4><p>åœ¨ä½¿ç”¨ import å¯¼å…¥æ–‡ä»¶æ—¶ï¼Œæœ‰æ—¶å€™æ²¡æœ‰å¸¦å…¥æ–‡ä»¶çš„åç¼€åï¼Œwebpackä¼šè‡ªåŠ¨å¸¦ä¸Šåç¼€å»è®¿é—®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œé‚£ä¹ˆé»˜è®¤çš„åç¼€åä¸º<br>[â€˜.jsâ€™, â€˜.jsonâ€™]; å³ï¼š<br>extensions: [â€˜.jsâ€™, â€˜.jsonâ€™]; å¦‚æœæˆ‘ä»¬æƒ³è‡ªå·±é…ç½®.vueåç¼€åï¼Œé˜²æ­¢åœ¨å¯¼å…¥æ–‡ä»¶æ—¶å€™ä¸éœ€è¦åŠ ä¸Šåç¼€ï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨webpackåšå¦‚ä¸‹é…ç½®:</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  entry<span class="token punctuation">:</span> <span class="token string">'./js/main.js'</span><span class="token punctuation">,</span>  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>    filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// å°†è¾“å‡ºçš„æ–‡ä»¶éƒ½æ”¾åœ¨distç›®å½•ä¸‹</span>    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>      components<span class="token punctuation">:</span> <span class="token string">'./src/components'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="Externals"><a href="#Externals" class="headerlink" title="Externals"></a>Externals</h4><p>Externals ç”¨æ¥å‘Šè¯‰webpackåœ¨æ„å»ºä»£ç æ—¶ä½¿ç”¨äº†ä¸å¤„ç†åº”ç”¨çš„æŸäº›ä¾èµ–åº“ï¼Œä¾ç„¶å¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡AMDï¼ŒCMDæˆ–windowå…¨å±€æ–¹å¼è®¿é—®ã€‚<br>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨htmlé¡µé¢ä¸­å¼•å…¥äº†jqueryæºæ–‡ä»¶åï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span><span class="token operator">&lt;</span>head<span class="token operator">></span>  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>title<span class="token operator">></span>Title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"http://code.jquery.com/jquery-1.12.0.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>  <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">"dist/main.css"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> type<span class="token operator">=</span><span class="token string">"text/css"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span>  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"dist/bundle.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><p>ä½†æ˜¯æˆ‘ä»¬æƒ³åœ¨æ¨¡å—åŒ–çš„æºä»£ç é‡Œå¯¼å…¥å’Œä½¿ç”¨jqueryï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šéœ€è¦å®‰è£…ä¸‹ jqueryä¾èµ–åŒ…ï¼Œnpm install â€“save jquery, ç„¶åæˆ‘ä»¬ç¼–å†™å¦‚ä¸‹ä»£ç è¿›è¡Œä½¿ç”¨ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ„å»ºæ‰“åŒ…åæˆ‘ä»¬ä¼šå‘ç°è¾“å‡ºçš„æ–‡ä»¶é‡Œé¢åŒ…å«jqueryçš„å†…å®¹ï¼Œè¿™å¯¼è‡´äº†jqueryåº“å¼•å…¥äº†ä¸¤æ¬¡ï¼Œå¹¶ä¸”å¯¼è‡´äº†bundle.jsæ–‡ä»¶å˜å¾—æ›´å¤§ï¼Œæµªè´¹åŠ è½½æµé‡ã€‚å› æ­¤ Externals é…ç½®é¡¹å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚<br>é€šè¿‡externals å¯ä»¥å‘Šè¯‰webpackåœ¨javascriptè¿è¡Œç¯å¢ƒä¸­å·²ç»å†…ç½®äº†å“ªäº›å…¨å±€å˜é‡ï¼Œä¸ç”¨å°†è¿™äº›ä»£ç æ‰“åŒ…åˆ°ä»£ç é‡Œé¢å»ã€‚<br>å› æ­¤æˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹é…ç½®ï¼š</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token keyword">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  externals<span class="token punctuation">:</span> <span class="token punctuation">{</span>    jquery<span class="token punctuation">:</span> <span class="token string">'jQuery'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="ä»€ä¹ˆæ˜¯ASTï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ASTï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ASTï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ASTï¼Ÿ</h4><p>è¯·å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000016231512#comment-area" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016231512#comment-area</a></p><p>è½¬æ¢æˆASTçš„ç›®çš„å°±æ˜¯å°†æˆ‘ä»¬ä¹¦å†™çš„å­—ç¬¦ä¸²æ–‡ä»¶è½¬æ¢æˆè®¡ç®—æœºæ›´å®¹æ˜“è¯†åˆ«çš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·æ›´å®¹æ˜“æå–å…¶ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œè€Œè¿™æ£µæ ‘åœ¨è®¡ç®—æœºä¸Šçš„è¡¨ç°å½¢å¼ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå•çº¯çš„Objectã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptå¼ºåˆ¶ç±»å‹è½¬æ¢</title>
      <link href="/2019/12/20/JavaScript/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/"/>
      <url>/2019/12/20/JavaScript/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><p>åœ¨è¯´JavaScriptçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹JavaScriptä¸­çš„æ•°æ®ç±»å‹æœ‰å“ªäº›ã€‚JavaScriptä¸­ç±»å‹åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p><ul><li>åŸå§‹æ•°æ®ç±»å‹ï¼šnullã€undefinedã€boolã€stringã€numberã€booleanä»¥åŠsymbolï¼ˆes6æå‡ºï¼‰</li><li>å¯¹è±¡æ•°æ®ç±»å‹ï¼šObjectï¼ˆfunctionã€date ç­‰å±äºObjectçš„å­ç±»å‹ï¼‰</li></ul><p>é‚£ä¹ˆè¿™ä¸¤ç§æ•°æ®ç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p>åŸå§‹æ•°æ®ç±»å‹åœ¨å†…å­˜ä¸­çš„å­˜æ”¾åœ°ç‚¹æ˜¯å­˜æ”¾åœ¨æ ˆä¸­ï¼Œæ‰€ä»¥åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å€¼ä¼ é€’ã€‚</p><p>è€Œå¯¹è±¡æ•°æ®ç±»å‹çš„å­˜æ”¾æ–¹å¼æ˜¯ï¼šçœŸå®æ•°æ®å­˜æ”¾åœ¨å †ä¸­ï¼Œè€Œåœ¨æ ˆä¸­å­˜æ”¾çš„æ˜¯æŒ‡å‘å®é™…æ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œå³å †çš„æŒ‡é’ˆã€‚</p><p>è¿™ä¹Ÿå°±æ˜¯å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’ã€‚</p><h3 id="å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢"><a href="#å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢"></a>å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„è½¬æ¢</h3><h4 id="ToString"><a href="#ToString" class="headerlink" title="ToString"></a>ToString</h4><p>å®ƒè´Ÿè´£å¤„ç†éå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²çš„è½¬æ¢ã€‚</p><p>åŸºæœ¬ç±»å‹å€¼çš„è½¬æ¢è§„åˆ™æ˜¯ï¼šnullè½¬æ¢ä¸ºâ€nullâ€ï¼Œundefinedè½¬æ¢ä¸ºâ€undefinedâ€,å¸ƒå°”è½¬æ¢æˆå¯¹åº”çš„æ•°å­—ï¼štrueè½¬æ¢ä¸º1ï¼Œfalseè½¬æ¢ä¸º0ã€‚æ•°å­—ç›´æ¥è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p><p>å¯¹åº”å¯¹è±¡ï¼Œé™¤éå¯¹è±¡å†…éƒ¨å®šä¹‰äº†tostringæ–¹æ³•ï¼Œå¦åˆ™toString()ï¼ˆObject.prototype.toString()ï¼‰è¿”å›å…¶å†…éƒ¨å±æ€§[[class]]çš„å€¼ã€‚å¦‚æœå†…éƒ¨è‡ªå®šä¹‰äº†toStringæ–¹æ³•ï¼Œåˆ™è°ƒç”¨è¯¥å†…éƒ¨æ–¹æ³•å¹¶ä½¿ç”¨å…¶è¿”å›å€¼ã€‚</p><p>å¯¹è±¡çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºstringæ˜¯é€šè¿‡<code>Toprimitive</code>æŠ½è±¡æ“ä½œæ¥å®Œæˆçš„ã€‚</p><blockquote><p>ToPrimitive(input,PreferredType?)ï¼šå…¶ä¸­PreferredTypeä¸ºnumberæˆ–è€…stringã€‚</p><p>å¦‚æœinputæ˜¯åŸå§‹å€¼ï¼Œåˆ™è¿”å›è¯¥åŸå§‹å€¼å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœinputä¸æ˜¯åŸå§‹å€¼ï¼Œåˆ™è°ƒç”¨valueOf()æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›åŸå§‹å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›å€¼ã€‚</p><p>å¦‚æœvalueOf()è¿”å›çš„ä¸æ˜¯åŸå§‹å€¼ï¼Œåˆ™è°ƒç”¨toString()æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›åŸå§‹å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›çš„åŸå§‹å€¼ã€‚</p><p>å¦åˆ™ï¼ŒæŠ¥é”™TypeError</p></blockquote><p>JSONå­—ç¬¦ä¸²åŒ–</p><p>å·¥å…·å‡½æ•°JSON.stringifyå¯ä»¥å°†JSONå¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå†…éƒ¨ä¹Ÿæ˜¯è°ƒç”¨äº†ToStringã€‚</p><p>JSON.stringifyä½¿ç”¨è§„åˆ™ï¼šå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œä½¿ç”¨JSON.stringifyå’Œä½¿ç”¨toStringè¿”å›ç»“æœä¸€æ ·ã€‚å¯¹äºæ‰€æœ‰å®‰å…¨çš„JSONå€¼ï¼Œéƒ½å¯ä»¥ä½¿ç”¨JSON.stringifyæ–¹æ³•ï¼Œæ‰€è°“çš„JSONå®‰å…¨å€¼æ˜¯æŒ‡ï¼šé™¤äº†undefinedã€symbolã€functionä»¥åŠåŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p>JSON.stringifyæ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼šå¯ä»¥ä¸ºå­—ç¬¦ä¸²æ•°ç»„æˆ–è€…å‡½æ•°ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œåˆ™æ ¹æ®æ•°ç»„å†…çš„å…ƒç´ ï¼Œè¿”å›æŒ‡å®šçš„å¯¹è±¡å±æ€§å’Œå±æ€§å€¼ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œåˆ™ä¸ºè¿‡æ»¤å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œkeyã€valueï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è‡ªè¡Œè®¾å®šè¿”å›å€¼ã€‚å¦‚æœä¸éœ€è¦æŸä¸ªå±æ€§ï¼Œè¿”å›undefinedå³å¯è¿‡æ»¤ã€‚</p><p>JSON.stringifyæ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šç”¨äºæŒ‡å®šè¾“å‡ºå­—ç¬¦ä¸²çš„è¾“å‡ºæ ¼å¼ã€‚</p><p>å¦‚æœå¯¹è±¡å†…éƒ¨æœ‰è‡ªå®šä¹‰çš„toJSONæ–¹æ³•ï¼Œåˆ™ä½¿ç”¨è¯¥æ–¹æ³•ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  a<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>  b<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// toJSON:function(){</span>  <span class="token comment" spellcheck="true">//     return 0</span>  <span class="token comment" spellcheck="true">// }</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> str <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿‡æ»¤å‡½æ•°</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">100</span>  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> value  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> o <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿˜åŸå‡½æ•°</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">1</span>  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> value  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ToNumber"><a href="#ToNumber" class="headerlink" title="ToNumber"></a>ToNumber</h4><p>ç”¨æ¥å°†éæ•°å­—å¤„ç†æˆæ•°å­—ã€‚è½¬æ¢æ–¹å¼éµå¾ªToPrimitiveï¼Œ</p><h4 id="ToBoolean"><a href="#ToBoolean" class="headerlink" title="ToBoolean"></a>ToBoolean</h4><p>JavaScriptä¸­çš„å€¼å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>å¯ä»¥è¢«å¼ºåˆ¶è½¬æ¢ä¸ºfalseçš„å€¼ï¼Œå¦‚ï¼šundefinedã€nullã€falseã€+0ã€-0ã€NaNå’Œâ€â€</li><li>å…¶ä»–å¯ä»¥è¢«è½¬æ¢ä¸ºtrueçš„å€¼</li></ul><p>å‡å€¼å¯¹è±¡ï¼šå°è£…äº†å‡å€¼çš„å¯¹è±¡ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span></code></pre><p>å®ƒä»¬çš„å€¼ä¸ºtrueï¼Œä½†æ˜¯å¦‚æœå¯¹å…¶è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œåˆ™ç»“æœä¸ºfalseã€‚</p><h3 id="å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><h4 id="éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢</h4><h5 id="å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢"><a href="#å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢"></a>å­—ç¬¦ä¸²å’Œæ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢</h5><p>è¿ç®—ç¬¦ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "420"</span>c <span class="token operator">+</span> d<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 42</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "1,23,4"</span></code></pre><blockquote><p>æ ¹æ® ES5 è§„èŒƒ 11.6.1 èŠ‚ï¼Œå¦‚æœæŸä¸ªæ“ä½œæ•°æ˜¯å­—ç¬¦ä¸²æˆ–è€…èƒ½å¤Ÿé€šè¿‡ä»¥ä¸‹æ­¥éª¤è½¬æ¢ä¸ºå­—ç¬¦ä¸² çš„è¯ï¼Œ+ å°†è¿›è¡Œæ‹¼æ¥æ“ä½œã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°æ˜¯å¯¹è±¡(åŒ…æ‹¬æ•°ç»„)ï¼Œåˆ™é¦–å…ˆå¯¹å…¶è°ƒç”¨ ToPrimitive æŠ½è±¡æ“ä½œ(è§„èŒƒ 9.1 èŠ‚)ï¼Œè¯¥æŠ½è±¡æ“ä½œå†è°ƒç”¨ [[DefaultValue]](è§„èŒƒ 8.12.8 èŠ‚)ï¼Œä»¥æ•°å­—ä½œä¸ºä¸Šä¸‹æ–‡ã€‚ </p></blockquote><h5 id="å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰"><a href="#å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰" class="headerlink" title="å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰"></a>å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰</h5><p>å®½æ¾ç›¸ç­‰(loose equals)== å’Œä¸¥æ ¼ç›¸ç­‰(strict equals)=== éƒ½ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦â€œç›¸ç­‰â€ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ¤æ–­æ¡ä»¶ä¸Šã€‚</p><ul><li>== åœ¨ç›¸ç­‰æ¯”è¾ƒä¸­ï¼Œå…è®¸è¿›è¡Œç±»å‹è½¬æ¢</li><li>=== ä¸å…è®¸ç±»å‹è½¬æ¢</li></ul><h5 id="æŠ½è±¡ç›¸ç­‰"><a href="#æŠ½è±¡ç›¸ç­‰" class="headerlink" title="æŠ½è±¡ç›¸ç­‰"></a>æŠ½è±¡ç›¸ç­‰</h5><ul><li>å¦‚æœè¡¨è¾¾å¼ä¸¤ç«¯éƒ½æ˜¯nullã€undefinedï¼Œåˆ™ä¸ºtrueã€‚</li><li>å¦‚æœNaNåœ¨å…¶ä¸­ä¸€ç«¯ï¼Œåˆ™è¿”å›falseã€‚</li><li>å¦‚æœæ˜¯stringã€numberã€booleanå¹¶ä¸”ç±»å‹ä¸ä¸€è‡´ï¼Œåˆ™å…ˆä½¿ç”¨ToNumberè½¬æ¢ä¸ºnumberåœ¨æ¯”è¾ƒã€‚</li><li>å¦‚æœæ˜¯å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨ToPrimitiveï¼Œè·å–åŸå§‹å€¼å†æ¯”è¾ƒã€‚</li></ul><h4 id="æ˜¾ç¤ºç±»å‹è½¬æ¢"><a href="#æ˜¾ç¤ºç±»å‹è½¬æ¢" class="headerlink" title="æ˜¾ç¤ºç±»å‹è½¬æ¢"></a>æ˜¾ç¤ºç±»å‹è½¬æ¢</h4><h5 id="å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢"><a href="#å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢"></a>å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token string">"3.14"</span><span class="token punctuation">;</span><span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span> c <span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "42"</span>d<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 3.14</span></code></pre><p>String(..) éµå¾ªå‰é¢è®²è¿‡çš„ ToString è§„åˆ™ï¼Œå°†å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²åŸºæœ¬ç±»å‹ã€‚Number(..) éµå¾ª å‰é¢è®²è¿‡çš„ ToNumber è§„åˆ™ï¼Œå°†å€¼è½¬æ¢ä¸ºæ•°å­—åŸºæœ¬ç±»å‹ã€‚ </p><h5 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h5><p>å­—ä½è¿ç®—ç¬¦åªé€‚ç”¨äº 32 ä½æ•´æ•°ï¼Œè¿ç®—ç¬¦ä¼šå¼ºåˆ¶æ“ä½œæ•°ä½¿ç”¨ 32 ä½ æ ¼å¼ã€‚è¿™æ˜¯é€šè¿‡æŠ½è±¡æ“ä½œ ToInt32 æ¥å®ç°çš„ </p><blockquote><p>ToInt32:å…ˆè¯•ç”¨ToNumberè½¬æ¢ä¸ºæ•°å­—ï¼Œå†æ‰§è¡ŒToInt32ã€‚</p></blockquote><p>ï½ï½ï¼š~~ ä¸­çš„ç¬¬ä¸€ä¸ª ~ æ‰§è¡Œ ToInt32 å¹¶åè½¬å­—ä½ã€‚ç„¶åç¬¬äºŒä¸ª ~ å†è¿›è¡Œä¸€æ¬¡å­—ä½åè½¬ï¼Œå³å°†æ‰€æœ‰ å­—ä½åè½¬å›åŸå€¼</p><p>parseIntï¼šåªæ”¯æŒå­—ç¬¦ä¸²è§£ææˆæ•°å­—ã€‚</p><blockquote><p>~~å’ŒparseIntçš„åŒºåˆ«ï¼š</p><p>1ã€è§£ææˆæ•°å­—å…è®¸å­—ç¬¦ä¸²ä¸­æœ‰éæ•°å­—å­—ç¬¦ï¼Œä»å·¦åˆ°å³ä¾æ¬¡è§£æï¼Œé‡åˆ°éæ•°å­—å­—ç¬¦åœæ­¢è§£æ</p><p>2ã€å¼ºåˆ¶è½¬æ¢æˆæ•°å­—ï¼Œä¸å…è®¸å­˜åœ¨éæ•°å­—å­—ç¬¦ï¼Œå¦åˆ™è½¬æ¢å¤±è´¥NaN</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡æ’ä¸é‡ç»˜</title>
      <link href="/2019/12/17/JavaScript/repaint-reflow/"/>
      <url>/2019/12/17/JavaScript/repaint-reflow/</url>
      
        <content type="html"><![CDATA[<h1 id="é‡æ’å’Œé‡ç»˜"><a href="#é‡æ’å’Œé‡ç»˜" class="headerlink" title="é‡æ’å’Œé‡ç»˜"></a>é‡æ’å’Œé‡ç»˜</h1><h4 id="æµè§ˆå™¨æ„å»ºé¡µé¢å¸ƒå±€"><a href="#æµè§ˆå™¨æ„å»ºé¡µé¢å¸ƒå±€" class="headerlink" title="æµè§ˆå™¨æ„å»ºé¡µé¢å¸ƒå±€"></a>æµè§ˆå™¨æ„å»ºé¡µé¢å¸ƒå±€</h4><ul><li>æ„å»ºDOMæ ‘ï¼ˆparseï¼‰ï¼šæ¸²æŸ“å¼•æ“è§£æhtmlæ–‡æ¡£ï¼Œé¦–å…ˆå°†æ ‡ç­¾è½¬æ¢æˆDOMæ ‘ä¸­çš„<code>DOM node</code>ï¼Œç„¶åç”Ÿæˆå†…å®¹æ ‘ï¼ˆ<code>Content Tree/DOM Tree</code>ï¼‰ã€‚åŒæ—¶ï¼Œä¹Ÿä¼šè¿›è¡ŒCSSè§£æï¼Œæ„å»º<code>CSS Rules Tree</code>ã€‚</li><li>æ„å»ºæ¸²æŸ“æ ‘ï¼ˆrender treeï¼‰ï¼šå°† <code>CSS Rules Tree</code>ä¾é™„äº<code>DOM Tree</code> ä¹‹ä¸Šï¼Œå½¢æˆ<code>Render Tree</code>ã€‚</li><li>æ„å»ºå¸ƒå±€æ¸²æŸ“æ ‘ï¼ˆ<code>reflow/layout</code>ï¼‰ï¼šä»æ ¹èŠ‚ç‚¹é€’å½’è°ƒç”¨ï¼Œè®¡ç®—æ¯ä¸€ä¸ªå…ƒç´ çš„å¤§å°ã€ä½ç½®ç­‰ï¼Œç»™å‡ºæ¯ä¸ªèŠ‚ç‚¹æ‰€åº”è¯¥åœ¨å±å¹•ä¸Šå‡ºç°çš„ç²¾ç¡®åæ ‡ã€‚</li><li>ç»˜åˆ¶æ¸²æŸ“æ ‘ï¼ˆ<code>paint/repaint</code>ï¼‰ï¼šéå†æ¸²æŸ“æ ‘ï¼Œä½¿ç”¨UIå±‚æ¥ç»˜åˆ¶æ¯ä¸ªèŠ‚ç‚¹ã€‚</li></ul><p><img src="http://cdn.yangkunxiao.cn/jzdh0T.png#alt=%E6%9E%84%E5%BB%BA%E5%B8%83%E5%B1%80" alt=""></p><h4 id="é‡ç»˜-repaint-redraw"><a href="#é‡ç»˜-repaint-redraw" class="headerlink" title="é‡ç»˜(repaint / redraw)"></a>é‡ç»˜(repaint / redraw)</h4><p>é‡ç»˜æ˜¯æŒ‡ä¸€ä¸ªå…ƒç´ å¤–è§‚çš„æ”¹å˜æ‰€è§¦å‘çš„æµè§ˆå™¨è¡Œä¸ºï¼Œæµè§ˆå™¨ä¼šæ ¹æ®å…ƒç´ çš„æ–°å±æ€§é‡æ–°ç»˜åˆ¶ï¼Œä½¿å…ƒç´ å‘ˆç°æ–°çš„å¤–è§‚ã€‚</p><p>è§¦å‘é‡ç»˜çš„æ¡ä»¶ï¼šæ”¹å˜å…ƒç´ å¤–è§‚å±æ€§ã€‚å¦‚ï¼šcolorï¼Œbackground-colorç­‰ã€‚</p><h4 id="é‡æ’-é‡æ„-å›æµ-reflow"><a href="#é‡æ’-é‡æ„-å›æµ-reflow" class="headerlink" title="é‡æ’(é‡æ„/å›æµ/reflow)"></a>é‡æ’(é‡æ„/å›æµ/reflow)</h4><p>å½“æ¸²æŸ“æ ‘ä¸­çš„ä¸€éƒ¨åˆ†(æˆ–å…¨éƒ¨)å› ä¸ºå…ƒç´ çš„è§„æ¨¡å°ºå¯¸ï¼Œå¸ƒå±€ï¼Œéšè—ç­‰æ”¹å˜è€Œéœ€è¦é‡æ–°æ„å»º, è¿™å°±ç§°ä¸ºå›æµ(<strong>reflow</strong>)ã€‚æ¯ä¸ªé¡µé¢è‡³å°‘éœ€è¦ä¸€æ¬¡å›æµï¼Œå°±æ˜¯åœ¨é¡µé¢ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™ã€‚</p><p>é‡æ’å‘ç”Ÿçš„æ ¹æœ¬åŸç†å°±æ˜¯<strong>å…ƒç´ çš„å‡ ä½•å±æ€§</strong>å‘ç”Ÿäº†æ”¹å˜ã€‚å¦‚ï¼š</p><ul><li>æ·»åŠ æˆ–åˆ é™¤å¯è§çš„DOMå…ƒç´ </li><li>å…ƒç´ ä½ç½®æ”¹å˜</li><li>å…ƒç´ æœ¬èº«çš„å°ºå¯¸å‘ç”Ÿæ”¹å˜</li><li>å†…å®¹æ”¹å˜</li><li>é¡µé¢æ¸²æŸ“å™¨åˆå§‹åŒ–</li><li>æµè§ˆå™¨çª—å£å¤§å°å‘ç”Ÿæ”¹å˜</li><li>è¯»å–æŸäº›å…ƒç´ å±æ€§ï¼šï¼ˆoffsetLeft/Top/Height/Width,ã€€clientTop/Left/Width/Height,ã€€scrollTop/Left/Width/Height,ã€€width/height,ã€€getComputedStyle(),ã€€currentStyle(IE)ã€€)</li></ul><h4 id="é‡æ’å’Œé‡ç»˜çš„å…³ç³»"><a href="#é‡æ’å’Œé‡ç»˜çš„å…³ç³»" class="headerlink" title="é‡æ’å’Œé‡ç»˜çš„å…³ç³»"></a>é‡æ’å’Œé‡ç»˜çš„å…³ç³»</h4><p>åœ¨å›æµçš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šä½¿æ¸²æŸ“æ ‘ä¸­å—åˆ°å½±å“çš„éƒ¨åˆ†å¤±æ•ˆï¼Œå¹¶é‡æ–°æ„é€ è¿™éƒ¨åˆ†æ¸²æŸ“æ ‘ï¼Œå®Œæˆå›æµåï¼Œæµè§ˆå™¨ä¼šé‡æ–°ç»˜åˆ¶å—å½±å“çš„éƒ¨åˆ†åˆ°å±å¹•ä¸­ï¼Œè¯¥è¿‡ç¨‹ç§°ä¸ºé‡ç»˜ã€‚</p><p>æ‰€ä»¥ï¼šé‡æ’å¿…å®šä¼šå¼•èµ·é‡ç»˜ï¼Œä½†æ˜¯é‡ç»˜ä¸ä¸€å®šå¼•èµ·é‡æ’ã€‚</p><blockquote><p>é‡ç»˜å’Œé‡æ’çš„ä»£ä»·å¾ˆé«˜ï¼Œè€—æ—¶ï¼Œä¼šé€ æˆæµè§ˆå™¨çš„å¡é¡¿</p></blockquote><h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><ul><li><p>æµè§ˆå™¨è‡ªå·±çš„ä¼˜åŒ–ï¼šæµè§ˆå™¨ä¼šç»´æŠ¤1ä¸ªé˜Ÿåˆ—ï¼ŒæŠŠæ‰€æœ‰ä¼šå¼•èµ·å›æµã€é‡ç»˜çš„æ“ä½œæ”¾å…¥è¿™ä¸ªé˜Ÿåˆ—ï¼Œç­‰é˜Ÿåˆ—ä¸­çš„æ“ä½œåˆ°äº†ä¸€å®šçš„æ•°é‡æˆ–è€…åˆ°äº†ä¸€å®šçš„æ—¶é—´é—´éš”ï¼Œæµè§ˆå™¨å°±ä¼šflushé˜Ÿåˆ—ï¼Œè¿›è¡Œä¸€ä¸ªæ‰¹å¤„ç†ã€‚è¿™æ ·å°±ä¼šè®©å¤šæ¬¡çš„å›æµã€é‡ç»˜å˜æˆä¸€æ¬¡å›æµé‡ç»˜ã€‚</p></li><li><p>å¼€å‘è€…è‡ªå·±çš„ä¼˜åŒ–ï¼šå°½é‡å‡å°‘é‡ç»˜é‡æ’çš„æ¬¡æ•°ï¼Œåˆå¹¶å¤šæ¬¡çš„DOMä¿®æ”¹å’Œæ ·å¼ä¿®æ”¹ï¼Œå‡å°‘å¯¹styleæ ·å¼çš„è¯·æ±‚</p><ul><li>ç›´æ¥æ”¹å˜å…ƒç´ çš„className</li></ul></li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">.</span>active <span class="token punctuation">{</span>    padding<span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>    border<span class="token operator">-</span>left<span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>    border<span class="token operator">-</span>right<span class="token punctuation">:</span> 2px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// javascript</span><span class="token keyword">var</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.el'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>el<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'active'</span><span class="token punctuation">;</span></code></pre><ul><li>displayï¼šnoneï¼›å…ˆè®¾ç½®å…ƒç´ ä¸ºdisplayï¼šnoneï¼›ç„¶åè¿›è¡Œé¡µé¢å¸ƒå±€ç­‰æ“ä½œï¼›è®¾ç½®å®Œæˆåå°†å…ƒç´ è®¾ç½®ä¸ºdisplayï¼šblockï¼›è¿™æ ·çš„è¯å°±åªå¼•å‘ä¸¤æ¬¡é‡ç»˜å’Œé‡æ’ï¼›</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#mylist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span><span class="token function">appendNode</span><span class="token punctuation">(</span>ul<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>ul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span></code></pre><ul><li>å‡å°‘é‡ç»˜é‡æ’</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.el'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>borderLeft <span class="token operator">=</span> <span class="token string">'1px'</span><span class="token punctuation">;</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>borderRight <span class="token operator">=</span> <span class="token string">'2px'</span><span class="token punctuation">;</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>padding <span class="token operator">=</span> <span class="token string">'5px'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ›¿æ¢ä¸º</span><span class="token keyword">var</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.el'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">'border-left: 1px; border-right: 2px; padding: 5px'</span><span class="token punctuation">;</span></code></pre><ul><li>å¦‚æœéœ€è¦åˆ›å»ºå¤šä¸ªDOMèŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨DocumentFragmentåˆ›å»ºå®Œåä¸€æ¬¡æ€§çš„åŠ å…¥documentï¼›</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>li<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'apple'</span><span class="token punctuation">;</span>fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>li<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'watermelon'</span><span class="token punctuation">;</span>fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>å°†åŸå§‹å…ƒç´ æ‹·è´åˆ°ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ä¸­ï¼Œæ“ä½œè¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åè¦†ç›–åŸå§‹å…ƒç´ </li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> old <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#mylist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> clone <span class="token operator">=</span> old<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">appendNode</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>old<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> old<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>ç¼“å­˜å¸ƒå±€ä¿¡æ¯ï¼Œå‡å°‘å¯¹styleçš„å¤šæ¬¡è¯·æ±‚</li></ul><pre class=" language-javascript"><code class="language-javascript">div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> div<span class="token punctuation">.</span>offsetLeft <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> div<span class="token punctuation">.</span>offsetTop <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ›¿æ¢ä¸º</span>current <span class="token operator">=</span> div<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token operator">++</span>current <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token operator">++</span>current <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span></code></pre><ul><li>å°½é‡ä¸è¦ä½¿ç”¨tableå¸ƒå±€ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML5æ‹–æ‹½äº‹ä»¶</title>
      <link href="/2019/12/15/JavaScript/drag/"/>
      <url>/2019/12/15/JavaScript/drag/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç½‘é¡µä¸­ï¼Œæ‹–æ”¾æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„ä¸€ä¸ªç”¨æˆ·ç•Œé¢æ¨¡å¼ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é¼ æ ‡ç‚¹å‡»ç›®æ ‡å…ƒç´ ä¸æ”¾ï¼Œç§»åŠ¨é¼ æ ‡ä½ç½®ï¼Œç„¶åæ¾å¼€é¼ æ ‡ï¼Œå³å¯å°†ç›®æ ‡å…ƒç´ ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåŒºåŸŸã€‚å®ƒçš„å®ç°å…¶å®å¾ˆç®€å•ã€‚ä»¥ä¸‹ä»‹ç»ä¸¤ç§å¸¸è§çš„å®ç°æ–¹æ³•ã€‚</p><h4 id="ä½¿ç”¨onmouseäº‹ä»¶å®ç°æ‹–æ”¾"><a href="#ä½¿ç”¨onmouseäº‹ä»¶å®ç°æ‹–æ”¾" class="headerlink" title="ä½¿ç”¨onmouseäº‹ä»¶å®ç°æ‹–æ”¾"></a>ä½¿ç”¨onmouseäº‹ä»¶å®ç°æ‹–æ”¾</h4><p>é€šè¿‡ç›‘å¬é¼ æ ‡äº‹ä»¶å®ç°å…ƒç´ æ‹–æ”¾ï¼šå¿…é¡»å€Ÿç”¨<code>onmousedown</code>ã€<code>onmousemove</code>ã€<code>onmouseup</code>ä¸‰ä¸ªäº‹ä»¶å®ç°ï¼Œä¸”ä¸‰è€…çš„é¡ºåºä¸èƒ½ä¹±ã€‚</p><ul><li>onmousedownï¼šé¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œä¸€èˆ¬ç”¨åœ¨æ‹–æ”¾å…ƒç´ ä¸Šã€‚</li><li>onmousemoveï¼šé¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼Œä¸€èˆ¬ç”¨åœ¨documentæˆ–è€…windowä¸Šã€‚</li><li>onmouseupï¼šé¼ æ ‡æŠ¬èµ·äº‹ä»¶ï¼ŒåŒä¸Šã€‚</li></ul><p>å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//è·å–æ‹–æ”¾å…ƒç´ </span><span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è®°å½•é¼ æ ‡ç‚¹å‡»ä½ç½®å’Œå…ƒç´ è¾¹ç•Œçš„è·ç¦»</span><span class="token keyword">var</span> dirX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>dirY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ç»™å…ƒç´ æ·»åŠ ç›‘å¬äº‹ä»¶</span>img<span class="token punctuation">.</span>onmousedown <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  dirX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>    dirY <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>  document<span class="token punctuation">.</span>onmousemove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è®°å½•é¼ æ ‡ç§»åŠ¨è·ç¦»</span>    <span class="token keyword">let</span> moveX<span class="token punctuation">,</span> moveY<span class="token punctuation">;</span>     moveX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> dirX<span class="token punctuation">;</span>    moveY <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> dirY<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å¤„ç†è¾¹ç•Œé—®é¢˜</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>moveX <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      moveX <span class="token operator">=</span> <span class="token number">0</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>moveX <span class="token operator">></span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span>      moveX <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetWidth    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>moveY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      moveY <span class="token operator">=</span> <span class="token number">0</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>moveY <span class="token operator">></span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>      moveY <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetHeight    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å®æ—¶çš„æ”¹å˜å…ƒç´ ä½ç½®</span>    img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> moveX <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>    img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> moveY <span class="token operator">+</span> <span class="token string">'px'</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//ç›‘å¬é¼ æ ‡æŠ¬èµ·äº‹ä»¶</span>  document<span class="token punctuation">.</span>onmouseup <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//äº‹ä»¶å–æ¶ˆ</span>    document<span class="token punctuation">.</span>onmouseup <span class="token operator">=</span> document<span class="token punctuation">.</span>onmousemove <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="ä½¿ç”¨HTML5Dragå®ç°æ‹–æ”¾"><a href="#ä½¿ç”¨HTML5Dragå®ç°æ‹–æ”¾" class="headerlink" title="ä½¿ç”¨HTML5Dragå®ç°æ‹–æ”¾"></a>ä½¿ç”¨HTML5Dragå®ç°æ‹–æ”¾</h4><p>æ‹–æ‹½å…ƒç´ æ—¶ï¼Œå°†ä¾æ¬¡å‘ç”Ÿä»¥ä¸‹äº‹ä»¶ï¼š</p><ul><li>ondragstart</li><li>ondragï¼šæ‹–æ‹½æœŸé—´æŒç»­è§¦å‘è¯¥äº‹ä»¶</li><li>ondragend</li></ul><p>åœ¨ç›®æ ‡å…ƒç´ ï¼ˆæ”¾ç½®ç›®æ ‡å…ƒç´ ï¼‰ä¸Šå°†ä¼šå‘ç”Ÿä»¥ä¸‹äº‹ä»¶ï¼š</p><ul><li>ondragenterï¼šå…ƒç´ è¿›å…¥ç›®æ ‡å…ƒç´ </li><li>ondragoverï¼šå…ƒç´ åœ¨ç›®æ ‡å…ƒç´ ä¹‹ä¸­ç§»åŠ¨</li><li>ondragleave/ondropï¼šå…ƒç´ ç¦»å¼€ç›®æ ‡å…ƒç´ /é¼ æ ‡æŠ¬èµ·</li></ul><p><strong>dataTransfer</strong> å¯¹è±¡ï¼šä½¿ç”¨è¯¥å¯¹è±¡è¿›è¡Œæ•°æ®ä¼ è¾“</p><ul><li>setDataï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¼ è¾“æ•°æ®çš„ç±»å‹ï¼štext æˆ–è€… URLï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®å€¼</li><li>getDataï¼šæ¥æ”¶å€¼ï¼Œåªå‘ç”Ÿåœ¨ondrop</li></ul><p><strong>dropEffect</strong>ä¸<strong>effectAllowed</strong> ï¼šé€šè¿‡<strong>dataTransfer</strong>å¯¹è±¡è¿˜å¯ä»¥ç¡®å®šè¢«æ‹–æ‹½å…ƒç´ ä»¥åŠæ”¾ç½®ç›®æ ‡çš„å…ƒç´ èƒ½å¤Ÿæ¥å—ä»€ä¹ˆæ“ä½œã€‚å…¶ä¸­<strong>dropEffect</strong>å¯ä»¥çŸ¥é“è¢«æ‹–æ‹½å…ƒç´ å¯ä»¥æ‰§è¡Œé‚£ç§æ”¾ç½®è¡Œä¸ºã€‚<strong>effectAllowed</strong>å¯ä»¥çŸ¥é“å…è®¸æ‹–æ‹½å…ƒç´ æ‰§è¡Œå“ªç§<strong>dropEffect</strong>ã€‚</p><p><strong>effectAllowed</strong>æœ‰å››ç§å€¼ï¼š</p><ul><li>â€œnoneâ€:ä¸èƒ½æŠŠæ‹–åŠ¨çš„å…ƒç´ æ”¾åœ¨è¿™é‡Œã€‚è¿™æ˜¯é™¤æ–‡æœ¬æ¡†ä¹‹å¤–æ‰€æœ‰å…ƒç´ çš„é»˜è®¤å€¼ã€‚</li><li>â€œmoveâ€:åº”è¯¥æŠŠæ‹–åŠ¨çš„å…ƒç´ ç§»åŠ¨åˆ°æ”¾ç½®ç›®æ ‡ã€‚</li><li>â€œcopyâ€:åº”è¯¥æŠŠæ‹–åŠ¨çš„å…ƒç´ å¤åˆ¶åˆ°æ”¾ç½®ç›®æ ‡ã€‚</li><li>â€œlinkâ€:è¡¨ç¤ºæ”¾ç½®ç›®æ ‡ä¼šæ‰“å¼€æ‹–åŠ¨çš„å…ƒç´ (ä½†æ‹–åŠ¨çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªé“¾æ¥ï¼Œæœ‰ URL)ã€‚ </li></ul><blockquote><p>è¦ä½¿ç”¨ dropEffect å±æ€§ï¼Œå¿…é¡»åœ¨ ondragenter äº‹ä»¶å¤„ç†ç¨‹åºä¸­é’ˆå¯¹æ”¾ç½®ç›®æ ‡æ¥è®¾ç½®å®ƒã€‚ </p></blockquote><p><strong>effectAllowed</strong>çš„å±æ€§å€¼å¦‚ä¸‹ï¼š</p><ul><li>â€œuninitializedâ€:æ²¡æœ‰ç»™è¢«æ‹–åŠ¨çš„å…ƒç´ è®¾ç½®ä»»ä½•æ”¾ç½®è¡Œä¸ºã€‚ </li><li>â€œnoneâ€:è¢«æ‹–åŠ¨çš„å…ƒç´ ä¸èƒ½æœ‰ä»»ä½•è¡Œä¸ºã€‚</li><li>â€œcopyâ€:åªå…è®¸å€¼ä¸ºâ€copyâ€çš„ dropEffectã€‚</li><li>â€œlinkâ€:åªå…è®¸å€¼ä¸ºâ€linkâ€çš„ dropEffectã€‚ </li><li>â€œmoveâ€:åªå…è®¸å€¼ä¸ºâ€moveâ€çš„ dropEffectã€‚</li><li>â€œcopyLinkâ€:å…è®¸å€¼ä¸ºâ€copyâ€å’Œâ€linkâ€çš„ dropEffectã€‚ </li><li>â€œcopyMoveâ€:å…è®¸å€¼ä¸ºâ€copyâ€å’Œâ€moveâ€çš„ dropEffectã€‚ </li><li>â€œlinkMoveâ€:å…è®¸å€¼ä¸ºâ€linkâ€å’Œâ€moveâ€çš„ dropEffectã€‚ </li><li>â€œallâ€:å…è®¸ä»»æ„ dropEffectã€‚ </li></ul><blockquote><p>å¿…é¡»åœ¨ ondragstart äº‹ä»¶å¤„ç†ç¨‹åºä¸­è®¾ç½® effectAllowed å±æ€§</p></blockquote><p>ä½¿ç”¨HTML5Dragäº‹ä»¶æ¥å®ç°è‡ªç”±æ‹–æ‹½ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> EventUtil <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * ç»‘å®šäº‹ä»¶     * @param { type } = { äº‹ä»¶ç±»å‹ }       * @param { callback }  = { å›è°ƒå‡½æ•° }      * @param { bool }   = { æŒ‡å®šäº‹ä»¶æ˜¯å¦åœ¨æ•è·æˆ–å†’æ³¡é˜¶æ®µæ‰§è¡Œã€‚true - äº‹ä»¶å¥æŸ„åœ¨æ•è·é˜¶æ®µæ‰§è¡Œã€‚é»˜è®¤ï¼Œäº‹ä»¶å¥æŸ„åœ¨å†’æ³¡é˜¶æ®µæ‰§è¡Œ }     * */</span>    addHandler<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>            el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> bool<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">attactEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//é»˜è®¤ä½¿ç”¨DOM0çº§çš„äº‹ä»¶</span>            el<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> callback<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span></code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è®°å½•é¼ æ ‡ç‚¹å‡»ä½ç½®å’Œè¾¹ç•Œçš„è·ç¦»</span><span class="token keyword">var</span> dirX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>dirY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">var</span> dirX<span class="token punctuation">,</span> dirY<span class="token punctuation">;</span>EventUtil<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token string">'dragstart'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'å¼€å§‹æ‹–æ‹½'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  dirX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>  dirY <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dirX<span class="token punctuation">,</span> dirY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>EventUtil<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'dragenter'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿›å…¥ç›®æ ‡å…ƒç´ '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>EventUtil<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'dragover'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// console.log('åœ¨ç›®æ ‡å…ƒç´ ä¸­ç§»åŠ¨');</span>  <span class="token comment" spellcheck="true">//è®¡ç®—é¼ æ ‡ç§»åŠ¨è·ç¦»</span>  <span class="token keyword">let</span> moveX <span class="token operator">=</span> moveY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  moveX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> dirX<span class="token punctuation">;</span>  moveY <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> dirY<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//è¾¹ç•Œå¤„ç†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>moveX <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    moveX <span class="token operator">=</span> <span class="token number">0</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>moveX <span class="token operator">></span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    moveX <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetWidth  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>moveY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    moveY <span class="token operator">=</span> <span class="token number">0</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>moveY <span class="token operator">></span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerHeight <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    moveY <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetHeight  <span class="token punctuation">}</span>  img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> moveX <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>  img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> moveY <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//é˜»æ­¢é»˜è®¤è¡Œä¸º</span>  EventUtil<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>EventUtil<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'dragleave'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç¦»å¼€ç›®æ ‡å…ƒç´ '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>EventUtil<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'drop'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//è®¾ç½®ç£å¸æ•ˆæœ</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">></span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">-</span> img<span class="token punctuation">.</span>offsetWidth <span class="token operator">+</span> <span class="token string">'px'</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// console.log(e,'drop');</span>  <span class="token comment" spellcheck="true">// let data = e.dataTransfer.getData('text');</span>  <span class="token comment" spellcheck="true">// console.log('drop');</span>  <span class="token comment" spellcheck="true">// EventUtil.removeHandler()</span>  <span class="token comment" spellcheck="true">// e.target.appendChild(document.getElementById(data))</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="http://cdn.yangkunxiao.cn/%E6%8B%96%E6%8B%BD%E4%BA%8B%E4%BB%B6.png" alt="æ‹–æ”¾äº‹ä»¶æµç¨‹"></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…è°ˆJavaScriptå¼‚æ­¥ç¼–ç¨‹</title>
      <link href="/2019/12/07/JavaScript/JavaScript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
      <url>/2019/12/07/JavaScript/JavaScript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>JavaScriptå¼‚æ­¥ç¼–ç¨‹</p><h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p>Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå®ƒæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæ›´åŠ åˆé€‚ã€å¼ºå¤§ã€‚æ‰€è°“Promiseï¼Œå°±æ˜¯ä¸€ç§å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢ä¿å­˜ç€æœªæ¥æ‰ä¼šå‘ç”Ÿçš„äº‹æƒ…ï¼ˆä¸€èˆ¬æ˜¯å¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚</p><p>Promiseæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›ä¸€ç³»åˆ—çš„APIå¯ä»¥å°†å¼‚æ­¥æ“ä½œçš„äº‹æƒ…ä»¥åŒæ­¥çš„å½¢å¼è¡¨ç°å‡ºæ¥ï¼Œæ¯”èµ·â€å›è°ƒåœ°ç‹±â€ï¼Œå®ƒçœ‹èµ·æ¥æ›´åŠ åˆé€‚ã€å¼ºå¤§ã€‚å®ƒå…·æœ‰ä»¥ä¸‹å‡ å¤§ç‰¹ç‚¹ï¼š</p><ul><li><code>Promise</code>çš„çŠ¶æ€ä¸å—ä»»ä½•å¤–ç•Œçš„å½±å“ã€‚Promiseçš„å¼‚æ­¥æ“ä½œæœ‰ä¸‰ç§çŠ¶æ€ï¼š    <code>pending</code>(æ‰§è¡Œä¸­)ã€<code>fulfilled</code>(å·²æˆåŠŸ)ã€<code>rejected</code>(å·²å¤±è´¥)ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœæ‰èƒ½å¤Ÿå†³å®š<code>Promise</code>çŠ¶æ€çš„èµ°å‘ã€‚</li><li><code>Promise</code>çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå˜ä¸å¯å†æ¬¡å˜åŠ¨ã€‚å®ƒçš„çŠ¶æ€å˜åŒ–åªæœ‰ä¸¤ç§æƒ…å†µï¼š<code>pending</code> =&gt; <code>fulfilled</code>ã€<code>pengding</code> =&gt; <code>rejected</code>ã€‚çŠ¶æ€ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸å†æ”¹å˜ï¼Œç§°ä¹‹ä¸º <code>resolved</code>(å·²å®šå‹)ã€‚</li></ul><p>Promiseä¸€æ—¦æ–°å»ºä¹‹åï¼Œå°±ä¼šç«‹å³æ‰§è¡Œã€‚è€ŒthenæŒ‡å®šçš„å›è°ƒå‡½æ•°åªæœ‰åŒæ­¥æ“ä½œæ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//æˆåŠŸå›è°ƒ</span>  <span class="token comment" spellcheck="true">//todo</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//å¤±è´¥å›è°ƒ</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//todo</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>Promise</code>æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>resolve</code>å’Œ<code>reject</code>ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚</p><p><code>resolve</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» <code>pending</code> å˜ä¸º <code>resolved</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›<code>reject</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» <code>pending</code> å˜ä¸º <code>rejected</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p><p><code>Promise</code>å®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨<code>then</code>æ–¹æ³•åˆ†åˆ«æŒ‡å®š<code>resolved</code>çŠ¶æ€å’Œ<code>rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚ä½†æ˜¯ä¸€èˆ¬é»˜è®¤ä¸æŒ‡å®š<code>rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨<code>catch</code>ã€‚</p><p><code>finally</code>ä¸ç®¡<code>promise</code>æœ€ç»ˆçš„æ‰§è¡Œç»“æœå¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œã€‚</p><p><code>all</code>ï¼šæ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p><p><code>Promise.all()</code>æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨<code>Promise.resolve</code>æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚å¦å¤–ï¼Œ<code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹</p><p>ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span> <span class="token string">'p1'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span> <span class="token string">'p2'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span> <span class="token string">'p3'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">,</span>res3<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ‰§è¡Œç»“æœï¼šp1 p2 p3</span></code></pre><p><code>p</code>çš„çŠ¶æ€ç”±p1,p2,p3å†³å®šï¼š</p><ul><li><p>åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p></li></ul><p><code>race</code>ï¼šè¯¥æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åªè¦åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p><code>allSettled</code>ï¼šè¯¥æ–¹æ³•ç”±<code>ES2020</code>å¼•å…¥ã€‚<code>Promise.allSettled()</code>æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªæœ‰ç­‰åˆ°æ‰€æœ‰è¿™äº›å‚æ•°å®ä¾‹éƒ½è¿”å›ç»“æœï¼Œä¸ç®¡æ˜¯<code>fulfilled</code>è¿˜æ˜¯<code>rejected</code>ï¼ŒåŒ…è£…å®ä¾‹æ‰ä¼šç»“æŸã€‚</p><p><code>any</code>ï¼š<code>Promise.any()</code>æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆ<code>rejected</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>rejected</code>çŠ¶æ€ã€‚è¯¥æ–¹æ³•ç›®å‰æ˜¯ä¸€ä¸ªç¬¬ä¸‰é˜¶æ®µçš„<a href="https://github.com/tc39/proposal-promise-any" target="_blank" rel="noopener">ææ¡ˆ</a> ã€‚</p><p><code>resolve</code>ï¼š<code>Promise.resolve()</code>å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ã€‚</p><ul><li><p>å‚æ•°æ˜¯ä¸€ä¸ª<code>Promise</code>å®ä¾‹ï¼šé‚£ä¹ˆ<code>Promise.resolve</code>å°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</p></li><li><p>å‚æ•°æ˜¯ä¸€ä¸ª <code>thenable</code> å®ä¾‹ï¼š<code>thenable</code>å¯¹è±¡æŒ‡çš„æ˜¯å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¯¹è±¡ã€‚ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> thenable <span class="token operator">=</span> <span class="token punctuation">{</span>  then<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><code>Promise.resolve</code>æ–¹æ³•ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ<code>thenable</code>å¯¹è±¡çš„<code>then</code>æ–¹æ³•ã€‚</p></li><li><p>å‚æ•°ä¸æ˜¯å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–æ ¹æœ¬å°±ä¸æ˜¯å¯¹è±¡ï¼šå¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™<code>Promise.resolve</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º<code>resolved</code>ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Hello</span></code></pre></li></ul><p><code>reject</code>ï¼š<code>Promise.reject(reason)</code>æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸º<code>rejected</code>ã€‚</p><h4 id="Generator-yield"><a href="#Generator-yield" class="headerlink" title="Generator/yield"></a>Generator/yield</h4><p>Generator å‡½æ•°æ˜¯ ES6 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚</p><p>Generator å‡½æ•°æœ‰å¤šç§ç†è§£è§’åº¦ã€‚è¯­æ³•ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚</p><p>æ‰§è¡Œ Generator å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGenerator å‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ª<code>éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°</code>ã€‚è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå† Generator å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚</p><p>å½¢å¼ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾:</p><p>1ã€<code>function</code>å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›</p><p>2ã€å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨<code>yield</code>è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€</p><blockquote><p> Generator å‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„ï¼Œ<code>yield</code>è¡¨è¾¾å¼æ˜¯æš‚åœæ‰§è¡Œçš„æ ‡è®°ï¼Œè€Œ<code>next</code>æ–¹æ³•å¯ä»¥æ¢å¤æ‰§è¡Œã€‚</p></blockquote><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>  <span class="token keyword">yield</span> <span class="token string">'world'</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token string">'ending'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">let</span> hwg <span class="token operator">=</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:hello,done:false }</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:world,done:false }</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:ending,done:true }</span>hwg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//{ value:undefined,done:true }</span></code></pre><p>æ€»ç»“ï¼šè°ƒç”¨Generatorå‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå®ƒæ˜¯å‡½æ•°å†…éƒ¨çš„æŒ‡é’ˆï¼Œä»¥åæ¯è°ƒç”¨ä¸€æ¬¡nextå‡½æ•°ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªå¸¦æœ‰valueå’Œdoneå±æ€§çš„å¯¹è±¡ã€‚<code>next</code>æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ª<code>yield</code>è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚<code>value</code>å±æ€§è¡¨ç¤ºå½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å€¼ï¼Œæ˜¯<code>yield</code>è¡¨è¾¾å¼åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›<code>done</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éå†ç»“æŸã€‚</p><p>Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>return</code>æ–¹æ³•ï¼Œå¯ä»¥è¿”å›ç»™å®šçš„å€¼ï¼Œå¹¶ä¸”ç»ˆç»“éå† Generator å‡½æ•°ã€‚</p><h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><p>ES2017 æ ‡å‡†å¼•å…¥äº† async å‡½æ•°ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚å®ƒæ˜¯Generatorçš„è¯­æ³•ç³–ã€‚<code>async</code>å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰æ›¿æ¢æˆ<code>async</code>ï¼Œå°†<code>yield</code>æ›¿æ¢æˆ<code>await</code>ã€‚</p><p><code>async</code>å‡½æ•°å¯¹ Generator å‡½æ•°çš„æ”¹è¿›ï¼Œä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ã€‚</p><ul><li><p>å†…ç½®æ‰§è¡Œå™¨ã€‚</p><p>Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ã€‚è€Œ<code>async</code>å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>async</code>å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚</p></li><li><p>è¿”å›å€¼æ˜¯ Promise</p><p><code>async</code>å‡½æ•°çš„è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iterator å¯¹è±¡æ–¹ä¾¿å¤šäº†ã€‚ä½ å¯ä»¥ç”¨<code>then</code>æ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p></li></ul><p>è¿›ä¸€æ­¥è¯´ï¼Œ<code>async</code>å‡½æ•°å®Œå…¨å¯ä»¥çœ‹ä½œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼ŒåŒ…è£…æˆçš„ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œ<code>await</code>å‘½ä»¤å°±æ˜¯å†…éƒ¨<code>then</code>å‘½ä»¤çš„è¯­æ³•ç³–ã€‚</p><p><code>async</code>å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚<code>async</code>å‡½æ•°å†…éƒ¨<code>return</code>è¯­å¥è¿”å›çš„å€¼ï¼Œä¼šæˆä¸º<code>then</code>æ–¹æ³•å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚</p><p><code>async</code>å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡ï¼Œå¿…é¡»ç­‰åˆ°å†…éƒ¨æ‰€æœ‰<code>await</code>å‘½ä»¤åé¢çš„ Promise å¯¹è±¡æ‰§è¡Œå®Œï¼Œæ‰ä¼šå‘ç”ŸçŠ¶æ€æ”¹å˜ï¼Œé™¤éé‡åˆ°<code>return</code>è¯­å¥æˆ–è€…æŠ›å‡ºé”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰<code>async</code>å‡½æ•°å†…éƒ¨çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œï¼Œæ‰ä¼šæ‰§è¡Œ<code>then</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p><p>ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">timeFn</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//Promise æ–°å»ºåå°±ä¼šç«‹å³æ‰§è¡Œã€‚</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        msg<span class="token punctuation">:</span><span class="token string">'hello'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//Promiseçš„å†™æ³•</span>  <span class="token comment" spellcheck="true">// timeFn(time).then(res => {</span>  <span class="token comment" spellcheck="true">//     console.log(res);</span>  <span class="token comment" spellcheck="true">// })</span>  <span class="token comment" spellcheck="true">//async awaitçš„å†™æ³•</span>  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">timeFn</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code></pre><p>ç¨‹åºä¼šåœ¨3sä¹‹åæ‰“å°{msg:â€™helloâ€™}</p><p><code>await</code>ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>await</code>å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚å¦‚æœä¸æ˜¯ Promise å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œ<code>await</code>å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼ˆå³å®šä¹‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆ<code>await</code>ä¼šå°†å…¶ç­‰åŒäº Promise å¯¹è±¡ã€‚</p><p>å¦‚æœ<code>await</code>åé¢çš„å¼‚æ­¥æ“ä½œå‡ºé”™ï¼Œé‚£ä¹ˆç­‰åŒäº<code>async</code>å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡è¢«<code>reject</code>ã€‚</p><p><code>await</code>å‘½ä»¤åªèƒ½ç”¨åœ¨<code>async</code>å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p><p>async å‡½æ•°çš„å®ç°åŸç†ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ...</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç­‰åŒäº</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ...</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//spawn è‡ªåŠ¨æ‰§è¡Œå™¨</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨ä¸­çš„è¿›ç¨‹ã€çº¿ç¨‹å’ŒEvent Loop</title>
      <link href="/2019/12/01/JavaScript/EventLoop/"/>
      <url>/2019/12/01/JavaScript/EventLoop/</url>
      
        <content type="html"><![CDATA[<p>#æµè§ˆå™¨</p><p>æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ã€‚æ¯ä¸€ä¸ªTabé¡µå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚</p><ul><li>ä¸»è¿›ç¨‹ï¼šä¸ªäººç†è§£é—®â€œç®¡å®¶â€çš„è§’è‰²ï¼Œå®ƒæ§åˆ¶ç€æµè§ˆå™¨çš„å„ä¸ªä»»åŠ¡ï¼Œé¡µé¢å±•ç¤ºã€ç½‘ç»œè¯·æ±‚ã€å†å²å›é€€ã€å‰è¿›ç­‰ç­‰</li><li>ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹ï¼šç®¡ç†ç¬¬ä¸‰æ–¹æ’ä»¶</li><li>GPUçº¿ç¨‹ï¼šç”¨äº3Dç»˜åˆ¶</li><li>æ¸²æŸ“è¿›ç¨‹ï¼šå¯¹å‰ç«¯æ¥è¯´ï¼Œæœ€é‡è¦çš„è¿›ç¨‹ã€‚</li></ul><h1 id="æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰"><a href="#æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰" class="headerlink" title="æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰"></a>æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰</h1><p>æ¸²æŸ“è¿›ç¨‹æ˜¯å¤šçº¿ç¨‹çš„ã€‚å®ƒåŒ…å«ä¸€ä¸‹å‡ å¤§çº¿ç¨‹ï¼š</p><ul><li>GUIçº¿ç¨‹<ul><li>å®ƒè´Ÿè´£é¡µé¢çš„æ¸²æŸ“ã€å¸ƒå±€ã€‚</li><li>å½“é¡µé¢å‘ç”Ÿé‡ç»˜æˆ–è€…å›æµçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘è¯¥çº¿ç¨‹</li><li>å®ƒå’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥</li></ul></li><li>JSå¼•æ“çº¿ç¨‹<ul><li>è´Ÿè´£ç¨‹åºçš„è§£æå’Œæ‰§è¡Œ</li></ul></li><li>äº‹ä»¶è§¦å‘çº¿ç¨‹<ul><li>å®ƒæ§åˆ¶äº‹ä»¶å¾ªç¯ï¼Œç®¡ç†ç€ä¸€ä¸ªäº‹ä»¶ä»»åŠ¡é˜Ÿåˆ—TaskQueue</li><li>å½“å¼‚æ­¥ä»»åŠ¡æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¼šå°†è¯¥å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒå‡½æ•°æ”¾å…¥åˆ°JSå¼•æ“çº¿ç¨‹æ‰€åœ¨çš„æ‰§è¡Œæ ˆä¸­æ‰§è¡Œ</li></ul></li><li>å®šæ—¶è§¦å‘å™¨çº¿ç¨‹<ul><li>setTimeOut å’Œ setInterval æ‰€åœ¨çš„çº¿ç¨‹</li><li>å®šæ—¶å™¨ä»»åŠ¡çš„è®¡æ—¶ä¸æ˜¯ç”±JSå¼•æ“è®¡æ—¶çš„ï¼Œè€Œæ˜¯ç”±è¯¥çº¿ç¨‹æ§åˆ¶</li><li>å½“å®šæ—¶ä»»åŠ¡è®¡æ—¶å®Œæˆä¹‹åï¼Œä¼šé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹</li></ul></li><li>å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹<ul><li>ä¸€ä¸ªç‹¬ç«‹çš„ajaxè¯·æ±‚çº¿ç¨‹</li><li>å½“è¯·æ±‚å®Œæˆä¹‹åï¼Œä¼šé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹</li></ul></li></ul><h4 id="ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥"><a href="#ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥" class="headerlink" title="ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥"></a>ä¸ºä»€ä¹ˆGUIçº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹äº’æ–¥</h4><p>å› ä¸ºJSæ˜¯å¯ä»¥æ“ä½œDOMçš„ï¼Œå¦‚æœä½¿ç”¨JSæ“ä½œDOMçš„åŒæ—¶ï¼ŒGUIçº¿ç¨‹ä¹Ÿåœ¨æ¸²æŸ“DOMï¼Œé‚£ä¹ˆæ¸²æŸ“å®Œæˆä¹‹åçš„å…ƒç´ å¯èƒ½å°±ä¸æ˜¯ä¹‹å‰çš„å…ƒç´ äº†</p><h4 id="ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹"><a href="#ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹"></a>ä¸ºä»€ä¹ˆJSå¼•æ“æ˜¯å•çº¿ç¨‹</h4><ul><li>åˆ›å»ºJavaScriptè¯­è¨€çš„æ—¶å€™ï¼Œå¤šè¿›ç¨‹å¤šçº¿ç¨‹çš„æ¶æ„å¹¶ä¸æµè¡Œï¼Œç¡¬ä»¶æ”¯æŒåº¦ä¸é«˜</li><li>å¤šè¿›ç¨‹å¤šçº¿ç¨‹æ“ä½œéœ€è¦åŠ é”ï¼Œæ“ä½œæˆæœ¬è¾ƒé«˜ï¼Œè¾ƒä¸ºå¤æ‚</li><li>å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªDOMï¼Œé‚£ä¹ˆç»“æœä¼šæ˜¯ä¸å¯é¢„æ–™çš„</li></ul><h1 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h1><ul><li>JSçš„ä»»åŠ¡åˆ†ä¸ºåŒæ­¥ä»»ä½•å’Œå¼‚æ­¥ä»»åŠ¡çš„</li><li>åŒæ­¥ä»»åŠ¡éƒ½åœ¨JSå¼•æ“çš„æ‰§è¡Œæ ˆä¸Šæ‰§è¡Œ</li><li>äº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ŒTaskQueueï¼Œå½“å¼‚æ­¥ä»»åŠ¡æ»¡è¶³æ¡ä»¶æ—¶ï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹ä¼šå°†å…¶æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­ï¼Œå½“ä¸»çº¿ç¨‹ï¼ˆJSå¼•æ“çº¿ç¨‹ï¼‰æ‰§è¡Œå®Œæ‰§è¡Œæ ˆä¸­çš„ä»»åŠ¡ä¹‹åï¼Œä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼Œå°±å°†å¯æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒå‡½æ•°æ¨å…¥åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™å†æ¬¡å‘äº‹ä»¶è§¦å‘çº¿ç¨‹å‘èµ·è¯¢é—®ï¼Œç›´åˆ°æœ‰ä¸ºæ­¢ã€‚</li></ul><p><img src="http://cdn.yangkunxiao.cn/EventLoop.png" alt="Event Loop"></p><p>ä»£ç è§£é‡Šï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> timerCallback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timerCallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> httpCallback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'httpCallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'åŒæ­¥ä»»åŠ¡1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span><span class="token comment" spellcheck="true">// é€šçŸ¥å®šæ—¶å™¨çº¿ç¨‹ 1s åå°† timerCallback äº¤ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç†</span><span class="token comment" spellcheck="true">// 1s åäº‹ä»¶è§¦å‘çº¿ç¨‹å°† timerCallback åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>timerCallback<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span><span class="token comment" spellcheck="true">// é€šçŸ¥å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹å‘é€ç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚æˆåŠŸåå°† httpCallback äº¤ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç†</span><span class="token comment" spellcheck="true">// è¯·æ±‚æˆåŠŸåäº‹ä»¶è§¦å‘çº¿ç¨‹å°† httpCallback åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­</span>$<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'www.xxxx.com'</span><span class="token punctuation">,</span>httpCallback<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åŒæ­¥ä»»åŠ¡</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'åŒæ­¥ä»»åŠ¡2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//...</span><span class="token comment" spellcheck="true">// æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œå</span><span class="token comment" spellcheck="true">// è¯¢é—®äº‹ä»¶è§¦å‘çº¿ç¨‹åœ¨äº‹ä»¶äº‹ä»¶é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°</span><span class="token comment" spellcheck="true">// å¦‚æœæ²¡æœ‰ï¼Œä¸€ç›´è¯¢é—®ï¼Œç›´åˆ°æœ‰ä¸ºæ­¢</span><span class="token comment" spellcheck="true">// å¦‚æœæœ‰ï¼Œå°†å›è°ƒäº‹ä»¶åŠ å…¥æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œå›è°ƒä»£ç </span></code></pre><p>æ€»ç»“ï¼š</p><ul><li>JSå¼•æ“çº¿ç¨‹åªæ‰§è¡Œæ‰§è¡Œæ ˆä¸­çš„äº‹ä»¶</li><li>æ‰§è¡Œæ ˆä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šè¯»å–äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶</li><li>äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒäº‹ä»¶ï¼Œæ˜¯ç”±å„è‡ªçº¿ç¨‹æ’å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­çš„</li><li>å¦‚æ­¤å¾ªç¯</li></ul><h4 id="å®ä»»åŠ¡ã€å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡ã€å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡ã€å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡ã€å¾®ä»»åŠ¡</h4><p>å®ä»»åŠ¡ï¼šå¯ä»¥ç†è§£ä¸ºæµè§ˆå™¨çº§åˆ«çš„ä»»åŠ¡ã€‚ä¸»ä»£ç å—ï¼ŒsetTimeoutï¼ŒsetIntervalç­‰ï¼Œéƒ½å±äºå®ä»»åŠ¡</p><p>å¾®ä»»åŠ¡ï¼šJSå¼•æ“çº§åˆ«çš„ä»»åŠ¡ã€‚Promiseï¼Œprocess.nextTickç­‰ï¼Œå±äº<code>å¾®ä»»åŠ¡</code>ã€‚</p><p>æ‰§è¡Œé¡ºåºï¼š</p><ul><li>å½“å‰ä»£ç å—å¯¹åº”çš„å®ä»»åŠ¡</li><li>å½“å‰å®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹ä¹‹å‰ï¼Œæ‰§è¡Œå½“å‰å¯¹åˆ—çš„å¾®ä»»åŠ¡</li><li>GUIå¼•æ“æ¸²æŸ“</li><li>ä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯¦è§£JSçš„forå¾ªç¯</title>
      <link href="/2019/12/01/JavaScript/for/"/>
      <url>/2019/12/01/JavaScript/for/</url>
      
        <content type="html"><![CDATA[<h4 id="for"><a href="#for" class="headerlink" title="for"></a>for</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr1<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'l'</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> arr1<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>forå¾ªç¯å¯ä»¥ä½¿ç”¨<code>break</code>å’Œ<code>continue</code></p><h4 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a>for in</h4><ul><li>for-in åªèƒ½éå†â€œå¯æšä¸¾çš„å±æ€§â€  å¯ä»¥ä½¿ç”¨æŸ¥çœ‹æ˜¯å¦å¯æšä¸¾<code>Object.getOwnPropertyDescriptor(object,property)</code></li><li>å®ƒå®é™…ä¸Šéå†çš„æ˜¯å¯¹è±¡çš„å±æ€§ï¼Œè€Œä¸æ˜¯â€œç´¢å¼•å€¼â€ï¼Œ æ‰€ä»¥for inå¯ä»¥éå†å¯¹è±¡</li><li>éå†åŸå‹ä¸Šçš„å±æ€§(å¯ä»¥é…åˆ Object.hasOwnProperty())</li><li>for inéå†çš„é¡ºåºå¹¶ä¸ç¡®å®š</li><li>æ€§èƒ½ï¼šæ¯æ¬¡è¿­ä»£æ“ä½œä¼šåŒæ—¶æœç´¢å®ä¾‹æˆ–è€…åŸå‹å±æ€§ï¼Œ for-in å¾ªç¯çš„æ¯æ¬¡è¿­ä»£éƒ½ä¼šäº§ç”Ÿæ›´å¤šå¼€é”€ï¼Œå› æ­¤è¦æ¯”å…¶ä»–å¾ªç¯ç±»å‹æ…¢</li></ul><pre class=" language-javascript"><code class="language-javascript">Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> arr1<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`arr1[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arr1<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h4><ul><li>forEach æ–¹æ³•ä¸ºæ•°ç»„ä¸­å«æœ‰æœ‰æ•ˆå€¼çš„æ¯ä¸€é¡¹æ‰§è¡Œä¸€æ¬¡ callback å‡½æ•°</li><li>é‚£äº›å·²åˆ é™¤ï¼ˆä½¿ç”¨ delete æ–¹æ³•ç­‰æƒ…å†µï¼‰æˆ–è€…ä»æœªèµ‹å€¼çš„é¡¹å°†è¢«è·³è¿‡ï¼ˆä¸åŒ…æ‹¬é‚£äº›å€¼ä¸º undefined æˆ– null çš„é¡¹ï¼‰</li><li>ä¸èƒ½ä½¿ç”¨break å’Œ continue</li><li>forEach çš„é€Ÿåº¦ä¸å¦‚ for</li></ul><pre class=" language-javascript"><code class="language-javascript">arr1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">,</span>arr1<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">,</span>arr1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>çœ‹ğŸŒ°ï¼šmacç”µè„‘ã€chromeæµè§ˆå™¨çš„æ‰§è¡Œç¯å¢ƒä¸‹</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'for'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">100000</span> <span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'for'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è€—æ—¶çº¦8.5s</span>arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'foreach'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'foreach'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è€—æ—¶çº¦10.34s</span></code></pre><h4 id="for-of"><a href="#for-of" class="headerlink" title="for of"></a>for of</h4><ul><li><p>for of æ˜¯ç”¨æ¥éå†å¯è¿­ä»£å¯¹è±¡çš„ï¼Œjs å¼•æ“æ˜¯é€šè¿‡åˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰ <code>Symbol.iterator</code> æ¥åˆ¤æ–­çš„ï¼Œ</p><ul><li>[][Symbol.iterator]</li><li>{}[Symbol.iterator]</li></ul></li><li><p>è¿­ä»£å™¨ï¼šæœ‰next()æ–¹æ³•çš„å¯¹è±¡ï¼Œnext()æ–¹æ³•è¿”å›ï¼šdoneå’Œvalueï¼Œdoneæ ‡ç¤ºæ˜¯å¦éå†å®Œï¼Œvalueå°±æ˜¯å½“å‰çš„å€¼</p></li><li><p>è·Ÿ forEach ç›¸æ¯”ï¼Œå®ƒå¯ä»¥æ­£ç¡®å“åº” break, continue, returnã€‚</p></li><li><p>for-of å¾ªç¯ä¸ä»…æ”¯æŒæ•°ç»„ï¼Œè¿˜æ”¯æŒå¤§å¤šæ•°ç±»æ•°ç»„å¯¹è±¡ï¼Œä¾‹å¦‚ DOM nodelist å¯¹è±¡ã€‚</p></li><li><p>for-of å¾ªç¯ä¹Ÿæ”¯æŒå­—ç¬¦ä¸²éå†ï¼Œå®ƒå°†å­—ç¬¦ä¸²è§†ä¸ºä¸€ç³»åˆ— Unicode å­—ç¬¦æ¥è¿›è¡Œéå†</p></li><li><p>for-ofå¾ªç¯ä¸æ”¯æŒæ™®é€šå¯¹è±¡ï¼Œä½†å¦‚æœä½ æƒ³è¿­ä»£ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œä½ å¯ä»¥ç”¨for-in å¾ªç¯</p></li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>item<span class="token punctuation">,</span>index<span class="token punctuation">]</span> <span class="token keyword">of</span> arr1<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">,</span><span class="token string">'===========for of'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ—¢ç„¶çŸ¥é“äº†<code>for of</code>çš„å·¥ä½œåŸç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œè®©å¯¹è±¡å¯ä»¥è¢«<code>for of</code>éå†å‘¢ï¼Ÿ</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">createIterator</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">let</span> propKeys <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> propKey <span class="token keyword">of</span> propKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">yield</span> <span class="token punctuation">[</span>propKey<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  name<span class="token punctuation">:</span><span class="token string">'kaka'</span><span class="token punctuation">,</span>  age<span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">}</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token function">createIterator</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span><span class="token string">'=========forof'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tree-shaking</title>
      <link href="/2019/11/30/Webpack/03/"/>
      <url>/2019/11/30/Webpack/03/</url>
      
        <content type="html"><![CDATA[<h4 id="jsï¼štree-shaking"><a href="#jsï¼štree-shaking" class="headerlink" title="jsï¼štree-shaking"></a>jsï¼štree-shaking</h4><ul><li><p>å®ƒæ˜¯æŒ‡å¸®åŠ©å¼€å‘è€…æ¶ˆé™¤ä¸åŒæ¨¡å—ä¹‹é—´çš„ä¸€äº›æ— æ•ˆä»£ç çš„featureã€‚åœ¨webpackä¸­ï¼Œä¹Ÿæ˜¯æœ‰tree-shakingåŠŸèƒ½çš„ï¼Œä½†æ˜¯å®ƒçš„åŠŸèƒ½ååˆ†ç®€å•ç²—æš´ï¼šåªå¯»æ‰¾<code>import</code>å¼•å…¥è¿›æ¥çš„å˜é‡æ˜¯å¦å‡ºç°è¿‡åœ¨æ¨¡å—å†…ï¼Œéå¸¸ç®€å•ç²—æš´ã€‚å› ä¸ºåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…ç»å¸¸ä¼šçŠ¯è¿™ç§é”™è¯¯ï¼šä¸€äº›æ¨¡å—æ›¾ç»å¼•å…¥äº†è¿›æ¥ï¼Œä½†æ˜¯åæ¥å´æ²¡æœ‰ä½¿ç”¨åˆ°ï¼Œå¿˜è®°åˆ é™¤äº†ï¼Œè¿™å°±ä¼šå¯¼è‡´æ‰“åŒ…çš„æ—¶å€™ï¼Œwebpackè‡ªå¸¦çš„tree-shakingåŠŸèƒ½æ— æ³•å°†è¿™äº›æ— æ•ˆçš„featureå»é™¤ã€‚</p></li><li><p>è¿™æ˜¯æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€äº›ç¬¬ä¸‰æ–¹æ’ä»¶å»åšè¿™ä¸ªäº‹æƒ…ï¼š</p><pre class=" language-base"><code class="language-base">npm install --save-dev webpack-deep-scope-plugin//åœ¨webpack.config.jsä¸­å¼•ç”¨const WebpackDeepScopeAnalysisPlugin = require('webpack-deep-scope-plugin').default;module.export = {    ......    plugins:[        new WebpackDeepScopeAnalysisPlugin()    ]}</code></pre><p>è¯¦æƒ…è¯·å‚è€ƒï¼š<a href="https://diverse.space/2018/05/better-tree-shaking-with-scope-analysis" target="_blank" rel="noopener">https://diverse.space/2018/05/better-tree-shaking-with-scope-analysis</a></p></li></ul><h4 id="css-tree-shaking"><a href="#css-tree-shaking" class="headerlink" title="css:tree-shaking"></a>css:tree-shaking</h4><ul><li><p>spaï¼š<a href="https://www.npmjs.com/package/purifycss-webpack" target="_blank" rel="noopener">purifycss-webpack</a>è¯¥æ’ä»¶ä¼šæŠŠæ‰€æœ‰æœªè¢«å¼•ç”¨çš„csså…¨éƒ¨å»é™¤</p><pre class=" language-javascript"><code class="language-javascript">productionï¼šnpm install <span class="token operator">--</span>save<span class="token operator">-</span>dev purifycss<span class="token operator">-</span>webpack<span class="token comment" spellcheck="true">//åœ¨webpack.config.jsä¸­å¼•ç”¨</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æŸ¥æ‰¾æ–‡ä»¶</span><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> PurifyCSSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'purifycss-webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span><span class="token keyword">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token operator">...</span>    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>        <span class="token keyword">new</span> <span class="token class-name">PurifyCSSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// Give paths to parse for rules. These should be absolute!</span>      paths<span class="token punctuation">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist/*.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre></li><li><p>mpaï¼š<a href="https://www.npmjs.com/package/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a>å°†cssä»jsä¸­æŠ½ç¦»å‡ºæ¥</p><blockquote><p>æ³¨æ„ï¼šå®ƒå’Œstyle-loader äº’æ–¥ï¼Œ ä¸èƒ½åŒæ—¶å¼€å¯ï¼Œä¸”HMR(çƒ­æ›´æ–°çš„æ—¶å€™ä¹Ÿä¸æ”¯æŒ) ï¼Œ åªç”¨äºå¼€å‘ç¯å¢ƒã€‚</p></blockquote><pre class=" language-javascript"><code class="language-javascript">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin<span class="token punctuation">;</span><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span><span class="token keyword">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token operator">...</span><span class="token operator">...</span>  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      test<span class="token punctuation">:</span> <span class="token regex">/\.css$/i</span><span class="token punctuation">,</span>      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token comment" spellcheck="true">// 'style-loader',</span>        <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//å’Œstyle-loader äº’æ–¥ ä¸èƒ½åŒæ—¶å¼€å¯ HMR(çƒ­æ›´æ–°çš„æ—¶å€™ä¹Ÿä¸æ”¯æŒ)  åªç”¨äºå¼€å‘ç¯å¢ƒ</span>          loader<span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>            publicPath<span class="token punctuation">:</span> <span class="token string">'../'</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span>        <span class="token punctuation">}</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•å…ƒæµ‹è¯•</title>
      <link href="/2019/11/30/Mocha/index/"/>
      <url>/2019/11/30/Mocha/index/</url>
      
        <content type="html"><![CDATA[<h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><p>å•å…ƒæµ‹è¯•æ˜¯æŒ‡å¯¹è½¯ä»¶ä¸­æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥éªŒè¯ï¼Œä¹Ÿç§°ä½œæ¨¡å—æµ‹è¯•ã€‚åœ¨nodeJsä¸­é€šå¸¸æ˜¯æŒ‡å¯¹æŸä¸ªå‡½æ•°æˆ–è€…APIè¿›è¡Œæ­£ç¡®éªŒè¯ï¼Œä»¥ä¿è¯ä»£ç çš„å¯ç”¨æ€§ã€‚</p><p>å•å…ƒæµ‹è¯•æœ‰å¾ˆå¤šç§ï¼Œå¸¸è§çš„æœ‰ï¼šè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼ˆBDDï¼‰å’Œ æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰ã€‚</p><ul><li>è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼ˆBDDï¼‰ï¼šè¡Œä¸ºé©±åŠ¨å¼€å‘å…³æ³¨çš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æœ€ç»ˆå®ç°æ˜¯å¦å’Œç”¨æˆ·æœŸæœ›ä¸€è‡´ã€‚</li><li>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰ï¼šæµ‹è¯•é©±åŠ¨å¼€å‘çš„ç›®çš„æ˜¯å–å¾—å¿«é€Ÿåé¦ˆï¼Œä½¿æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å¯ç”¨çš„ã€‚</li></ul><h4 id="Mocha"><a href="#Mocha" class="headerlink" title="Mocha"></a>Mocha</h4><p>Mochaæ˜¯ç°åœ¨æœ€æµè¡Œçš„ä¸€ç§å•å…ƒæµ‹è¯•æ¡†æ¶ã€‚MochaåŠŸèƒ½æ¯”è¾ƒä¸°å¯Œï¼Œæ”¯æŒBDDã€TDD</p><p>é£æ ¼çš„æµ‹è¯•ï¼Œè€Œä¸”æ”¯æŒå¼‚æ­¥ã€åŒæ­¥çš„æµ‹è¯•ã€‚</p><p>å®‰è£…ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g mochaor<span class="token function">npm</span> <span class="token function">install</span> -S mocha</code></pre><h4 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h4><p>åˆ›å»ºä¸€ä¸ªdemo01.jsæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­åŒ…å«ä¸€ä¸ªæ±‚å’Œå‡½æ•°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">...</span>rest<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> rest<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> a <span class="token operator">+</span> b    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    add<span class="token punctuation">}</span></code></pre><p>å†åˆ›å»ºä¸€ä¸ªtestçš„æ–‡ä»¶å¤¹ï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> lib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../demo01.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> should <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'should'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Math'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'#add'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'add(0,0) should return 0'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//ä½¿ç”¨assertæ–­è¨€åº“</span>            <span class="token comment" spellcheck="true">// assert.strictEqual(0,lib.add(0,0));</span>            <span class="token comment" spellcheck="true">//ä½¿ç”¨should.jsæ–­è¨€åº“è¿›è¡Œæµ‹è¯•</span>            lib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'add(1,-1) should return 0'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// assert.strictEqual(0,lib.add(1,-1))</span>            lib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'add(1,1) should return 2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// assert.strictEqual(2,lib.add(1,1))</span>            lib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>describe(moduleName,testDetail):æè¿°å°†è¦æµ‹è¯•çš„æ¨¡å—ã€‚</p><p>it(info,function()):æµ‹è¯•è¯­å¥æ”¾åœ¨å›è°ƒå‡½æ•°ä¸­ï¼š</p><ul><li>info æ˜¯æ­£ç¡®è¾“å‡ºæ—¶çš„ç®€å•è¯­å¥æè¿°</li><li>ä¸€ä¸ªitå¯¹åº”ä¸€ä¸ªå®é™…çš„å¯èƒ½æƒ…å†µ</li></ul><p>å…³äºassetsçš„æ›´å¤šçš„APIï¼Œå¯å‚è€ƒ<a href="https://nodejs.org/dist/latest/docs/api/assert.html#assert_assert" target="_blank" rel="noopener">node.jså®˜ç½‘</a></p><p>å…³äºshould.jsçš„æ›´å¤šçš„APIï¼Œå¯å‚è€ƒ<a href="https://shouldjs.github.io/" target="_blank" rel="noopener">should.jså®˜ç½‘</a></p><p>ç„¶åï¼Œåœ¨package.jsonä¸­å†™ä¸€ä¸‹å‘½ä»¤ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"mocha"</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œå‘½ä»¤ï¼Œmochaå³å¯è‡ªåŠ¨æ‰§è¡Œtestæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æµ‹è¯•è„šæœ¬ã€‚</p><h4 id="å¼‚æ­¥æµ‹è¯•"><a href="#å¼‚æ­¥æµ‹è¯•" class="headerlink" title="å¼‚æ­¥æµ‹è¯•"></a>å¼‚æ­¥æµ‹è¯•</h4><p>ä½¿ç”¨Mochaè¿›è¡Œå¼‚æ­¥æµ‹è¯•ï¼Œåªéœ€è¦åœ¨æµ‹è¯•å®Œæˆä¹‹åå›è°ƒä¸€ä¸ªå›è°ƒå‡½æ•°å³å¯ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//å¼‚æ­¥æµ‹è¯•</span><span class="token keyword">function</span> <span class="token function">asyncFn</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    asyncFn<span class="token punctuation">}</span></code></pre><p>æµ‹è¯•ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> lib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../demo03.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'async.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should wait 1000ms'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            lib<span class="token punctuation">.</span><span class="token function">asyncFn</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h4 id="è·¯ç”±æµ‹è¯•"><a href="#è·¯ç”±æµ‹è¯•" class="headerlink" title="è·¯ç”±æµ‹è¯•"></a>è·¯ç”±æµ‹è¯•</h4><p>éœ€è¦å€Ÿç”¨<code>supertest</code>åº“å¯¹åç«¯çš„APIæ¥å£è¿›è¡Œæµ‹è¯•.</p><p>å®‰è£…ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev supertest</code></pre><p>supertestæ”¯æŒå„ç§æ¡†æ¶ã€‚æœ¬ä¾‹ä»¥Expressä¸ºä¾‹ï¼š</p><pre><code>//æµ‹è¯•è·¯ç”±const express = require(&#39;express&#39;);const app = express();app.get(&#39;/user&#39;,(req,res) =&gt; {    res.status(200).json({        name:&#39;ykx&#39;,        age:24    })});module.exports = app;</code></pre><p>expressè®¾ç½®äº†ä¸€ä¸ªè¿”å›jsonæ ¼å¼çš„/userè·¯ç”±ï¼Œé€šè¿‡getè¯·æ±‚ï¼Œè¿”å›ç”¨æˆ·åå’Œå¹´é¾„ã€‚</p><p>æµ‹è¯•ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'supertest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../demo04.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'GET /user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should an name with age'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span><span class="token string">'ykx'</span><span class="token punctuation">,</span>            age<span class="token punctuation">:</span><span class="token number">24</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>done<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h4 id="æµ‹è¯•è¦†ç›–ç‡"><a href="#æµ‹è¯•è¦†ç›–ç‡" class="headerlink" title="æµ‹è¯•è¦†ç›–ç‡"></a>æµ‹è¯•è¦†ç›–ç‡</h4><p>æµ‹è¯•è¦†ç›–ç‡ä¸€èˆ¬åŒ…å«å››ä¸ªç»´åº¦ï¼š</p><ul><li>è¡Œè¦†ç›–ç‡ï¼šæ˜¯å¦æ¯ä¸€è¡Œéƒ½æ‰§è¡Œäº†</li><li>å‡½æ•°è¦†ç›–ç‡ï¼šæ˜¯å¦æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ‰§è¡Œäº†</li><li>åˆ†æ”¯è¦†ç›–ç‡ï¼šæ˜¯å¦æ¯ä¸ªifä»£ç å—éƒ½æ‰§è¡Œäº†</li><li>è¯­å¥è¦†ç›–ç‡ã€‚æ˜¯å¦æ¯ä¸ªè¯­å¥éƒ½æ‰§è¡Œäº†</li></ul><p>åœ¨NodeJsä¸­å¯ä»¥ä½¿ç”¨<code>Istanbul</code>ä»£ç è¦†ç›–ç‡å·¥å…·ã€‚</p><p>å®‰è£…ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g istanbul</code></pre><p>ç„¶ååœ¨package.jsonä¸­å»é…ç½®å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token string">"scripts"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>  <span class="token string">"test"</span><span class="token keyword">:</span> <span class="token string">"mocha"</span>,  <span class="token string">"cover"</span><span class="token keyword">:</span><span class="token string">"istanbul cover node_modules/mocha/bin/_mocha test/"</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œ<code>npm run cover</code>å‘½ä»¤ï¼Œä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆcoverageæ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«æ‰€æœ‰çš„æµ‹è¯•æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mocha </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mocha </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLè‡ªç„¶è¿æ¥æŸ¥è¯¢</title>
      <link href="/2019/11/24/Mysql/naturalJoin/"/>
      <url>/2019/11/24/Mysql/naturalJoin/</url>
      
        <content type="html"><![CDATA[<h4 id="ä»€ä¹ˆæ˜¯è‡ªç„¶è¿æ¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è‡ªç„¶è¿æ¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è‡ªç„¶è¿æ¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è‡ªç„¶è¿æ¥ï¼Ÿ</h4><p>é€šè¿‡mysqlè‡ªå·±åˆ¤æ–­å®Œæˆè¿æ¥è¿‡ç¨‹,ä¸éœ€è¦æŒ‡å®šè¿æ¥æ¡ä»¶ï¼Œmysqlä¼šæ ¹æ®å¤šä¸ªè¡¨å†…çš„ç›¸åŒå­—æ®µä½œä¸ºè¿æ¥æ¡ä»¶ã€‚</p><h4 id="è‡ªç„¶è¿æ¥çš„åˆ†ç±»"><a href="#è‡ªç„¶è¿æ¥çš„åˆ†ç±»" class="headerlink" title="è‡ªç„¶è¿æ¥çš„åˆ†ç±»"></a>è‡ªç„¶è¿æ¥çš„åˆ†ç±»</h4><p>è‡ªç„¶è¿æ¥åˆ†ä¸ºï¼š<strong><em>å†…è‡ªç„¶è¿æ¥</em></strong>ï¼ˆinner natural joinï¼‰å’Œ <strong><em>å¤–è‡ªç„¶è¿æ¥</em></strong>ã€‚å…¶ä¸­<strong><em>å¤–è‡ªç„¶è¿æ¥</em></strong>åˆå¯åˆ†ä¸º<strong><em>å·¦å¤–è‡ªç„¶è¿æ¥</em></strong>ï¼ˆleft natural join ï¼‰å’Œ <strong><em>å³å¤–è‡ªç„¶è¿æ¥</em></strong>ï¼ˆright natural joinï¼‰ã€‚</p><p>æ³¨æ„ï¼šè‡ªç„¶è¿æ¥æ²¡æœ‰åˆ¤æ–­è¯­å¥ï¼ï¼ï¼</p><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><p>å‡å¦‚å­˜åœ¨ä¸¤å¼ è¡¨ï¼štab1å’Œtab2</p><ul><li><p>å†…è‡ªç„¶è¿æ¥</p><pre class=" language-javascript"><code class="language-javascript">select <span class="token operator">*</span> <span class="token keyword">from</span> tab1 natural join tab2<span class="token punctuation">;</span></code></pre><p>å†…è‡ªç„¶è¿æ¥ç›¸å½“äº<strong>usingä¸ºåˆ¤æ–­è¯­å¥çš„å†…è¿æ¥ï¼š</strong>å³ï¼š</p><pre class=" language-javascript"><code class="language-javascript">select <span class="token operator">*</span> <span class="token keyword">from</span> tbl_name1 inner join tbl_name2 using<span class="token punctuation">;</span></code></pre></li><li><p>å·¦å¤–è‡ªç„¶è¿æ¥</p><pre class=" language-javascript"><code class="language-javascript">select <span class="token operator">*</span> <span class="token keyword">from</span> tab1 natural left join tab2<span class="token punctuation">;</span></code></pre><p>ç›¸å½“äºusingä¸ºåˆ¤æ–­è¯­å¥çš„å·¦å¤–è¿æ¥ï¼š</p><pre class=" language-javascript"><code class="language-javascript">select <span class="token operator">*</span> <span class="token keyword">from</span> tab1 left outer join tab2 using<span class="token punctuation">;</span></code></pre></li><li><p>å³å¤–è‡ªç„¶è¿æ¥</p><pre class=" language-javascript"><code class="language-javascript">select <span class="token operator">*</span> <span class="token keyword">from</span> tab1 natural right join tab2<span class="token punctuation">;</span></code></pre><p>ç›¸å½“äºusingä¸ºåˆ¤æ–­è¯­å¥çš„å³å¤–è¿æ¥ï¼š</p><pre class=" language-javascript"><code class="language-javascript">select <span class="token operator">*</span> <span class="token keyword">from</span> tab1 natural right join tab2<span class="token punctuation">;</span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 8.0+é‡ç½®å¯†ç </title>
      <link href="/2019/11/24/Mysql/resetPassWord/"/>
      <url>/2019/11/24/Mysql/resetPassWord/</url>
      
        <content type="html"><![CDATA[<h4 id="å…³é—­æ•°æ®åº“"><a href="#å…³é—­æ•°æ®åº“" class="headerlink" title="å…³é—­æ•°æ®åº“"></a>å…³é—­æ•°æ®åº“</h4><p>1ã€åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> /usr/local/mysql/support-files mysql.server stop</code></pre><p>2ã€åœ¨è®¿è¾¾ä¸­æ‰¾åˆ°å®‰è£…å¥½çš„mysqlï¼Œå…³é—­mysqlè¿è¡Œã€‚</p><h4 id="è·³è¿‡éªŒè¯"><a href="#è·³è¿‡éªŒè¯" class="headerlink" title="è·³è¿‡éªŒè¯"></a>è·³è¿‡éªŒè¯</h4><pre class=" language-bash"><code class="language-bash">// è¿›å…¥æ•°æ®åº“æŒ‡ä»¤æ–‡ä»¶<span class="token function">cd</span> /usr/local/mysql/bin// è·³è¿‡æƒé™è®¤è¯<span class="token function">sudo</span> ./mysqld_safe --skip-grant-tables</code></pre><h4 id="å…å¯†ç è¿›å…¥æ•°æ®åº“"><a href="#å…å¯†ç è¿›å…¥æ•°æ®åº“" class="headerlink" title="å…å¯†ç è¿›å…¥æ•°æ®åº“"></a>å…å¯†ç è¿›å…¥æ•°æ®åº“</h4><p>åœ¨ä¸Šè¿°æŒ‡ä»¤è¿è¡Œåï¼Œæ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼ŒåŒæ—¶ä¿æŒåŸæ¥é‚£ä¸ªç»ˆç«¯ä¹Ÿå¼€ç€ï¼Œåœ¨æ–°çš„ç»ˆç«¯è¾“å…¥æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><pre class=" language-bash"><code class="language-bash">//  æ‰§è¡ŒmysqlæŒ‡ä»¤/usr/local/mysql/bin/mysql// è¿›å…¥åä¸º<span class="token operator">&lt;</span>mysql<span class="token operator">></span>çš„æ•°æ®åº“use mysql<span class="token punctuation">;</span>æŠŠä¹‹å‰å¯†ç æ¸…ç©ºï¼šupdate user <span class="token keyword">set</span> authentication_string<span class="token operator">=</span><span class="token string">''</span>  where user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span>// åˆ·æ–°æƒé™flush privileges<span class="token punctuation">;</span>// ä¿®æ”¹å¯†ç  ä½†ä¸é€‚ç”¨äº8.0+çš„ç‰ˆæœ¬// <span class="token keyword">set</span> password <span class="token keyword">for</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">'æ–°çš„å¯†ç '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>// 8.0+ç‰ˆæœ¬ä¿®æ”¹å¯†ç ALTER user <span class="token string">'root'</span>@<span class="token string">'localhost'</span> indentified by <span class="token string">'æ–°å¯†ç '</span><span class="token punctuation">;</span>//åˆ·æ–°ä¸€ä¸‹flush privileges<span class="token punctuation">;</span>// é€€å‡ºmysql<span class="token keyword">exit</span></code></pre><p>mysqlå¸¸ç”¨å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash">1ã€è¿›å…¥æœ¬åœ°æ•°æ®åº“ï¼š/usr/local/mysql/bin/mysql -u root -p æ ¹æ®æç¤ºè¾“å…¥å¯†ç 2ã€è¿›å…¥è¿œç¨‹æ•°æ®åº“ï¼šå‡è®¾è¿œç¨‹ä¸»æœºçš„IPä¸ºï¼š23.106.134.88ï¼Œç”¨æˆ·åä¸ºroot,å¯†ç ä¸º123456ï¼šmysql -h23.106.134.88 -u root -p æ ¹æ®æç¤ºè¾“å…¥å¯†ç ã€‚3ã€å¯åŠ¨mysqlæœåŠ¡ï¼š<span class="token function">sudo</span> /usr/local/mysql/support-files/mysql.server start<span class="token punctuation">;</span>4ã€ç»ˆæ­¢mysqlæœåŠ¡ï¼š<span class="token function">sudo</span> /usr/local/mysql/support-files/mysql.server stop<span class="token punctuation">;</span>5ã€é‡å¯mysqlæœåŠ¡ï¼š<span class="token function">sudo</span> /usr/local/mysql/support-files/mysql.server restart<span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESCæœåŠ¡å™¨Linuxä¸‹å®‰è£…mysql</title>
      <link href="/2019/11/24/Linux/mysql/"/>
      <url>/2019/11/24/Linux/mysql/</url>
      
        <content type="html"><![CDATA[<p>1ã€é‡å¯æœåŠ¡å™¨ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># reboot</span></code></pre><p>2ã€æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£…mysqlæœåŠ¡ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum list installed | grep mysql</span></code></pre><p>å¦‚æœæ˜¾ç¤ºä¸€ä¸‹å†…å®¹ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰å®‰è£…ï¼š-bash: gerp: command not found<br>3ã€ä¸‹è½½mysqlå®‰è£…åŒ…ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rpm -ivh http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm</span></code></pre><p>4ã€å®‰è£…mysqlï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum install -y mysql-server</span>æˆ–è€…<span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum install mysql-community-server</span></code></pre><p>5ã€è®¾ç½®å¼€æœºå¯åŠ¨ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl enable mysqld.service</span></code></pre><p>6ã€æŸ¥çœ‹æœåŠ¡æ˜¯å¦åŠ å…¥å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl list-unit-files | grep mysqld</span></code></pre><p>7ã€æŸ¥çœ‹mysqlçš„é»˜è®¤ä¸´æ—¶å¯†ç ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl list-unit-files | grep mysqld</span></code></pre><p>8ã€rootç”¨æˆ·ç™»å½•mysqlæ•°æ®åº“ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@sir-xiao server<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mysql -u root -p </span>Enter password: æ ¹æ®æç¤º è¾“å…¥å¯†ç </code></pre><p>9ã€ä¿®æ”¹rootç”¨æˆ·å¯†ç ï¼š</p><pre class=" language-bash"><code class="language-bash">mysql<span class="token operator">></span> use  mysqlï¼›----åˆ‡æ¢åˆ°mysql dbmysql<span class="token operator">></span> UPDATE user SET authentication_string <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'newpass'</span><span class="token punctuation">)</span> WHERE user <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>---æ–°ç‰ˆæœ¬mysqlæ‰§è¡Œmysql<span class="token operator">></span> UPDATE user SET Password <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'newpass'</span><span class="token punctuation">)</span> WHERE user <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>---è€ç‰ˆæœ¬mysqlæ‰§è¡Œmysql<span class="token operator">></span> flush privileges<span class="token punctuation">;</span>---å‘½ä»¤ç«‹å³æ‰§è¡Œç”Ÿæ•ˆ</code></pre><p>10ã€å¿˜è®°å¯†ç é‡ç½®å¯†ç ï¼š</p><pre class=" language-bash"><code class="language-bash">1ã€æŸ¥æ‰¾mysqlçš„å¯åŠ¨æ–‡ä»¶ï¼š<span class="token punctuation">[</span>root@sir-xiao etc<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># whereis  my</span>2ã€vim /etc/my.cnfä¿®æ”¹my.cnfå¯åŠ¨å‚æ•°ï¼Œåœ¨æ–‡ä»¶çš„æœ€åå¢åŠ ï¼Œmysqlå¯åŠ¨å‚æ•°â€”â€” --skip-grant-tablesã€‚å¯åŠ¨mysqlæ—¶ä¸å¯åŠ¨æˆæƒè¡¨ grant-tables<span class="token punctuation">[</span>root@sir-xiao etc<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vi /etc/my.cnf skip-grant-tables</span><span class="token punctuation">[</span>root@sir-xiao etc<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># :wq</span>viæ¨¡å¼Enterè¿›å…¥ï¼ŒæŒ‰â€œiâ€é”®ï¼Œç¼–è¾‘æ–‡ä»¶ï¼ŒæŒ‰â€œescâ€é”®ï¼Œè¾“å…¥:wqå†™å…¥ä¿å­˜é€€å‡ºï¼Œ:q ä¸ä¿å­˜é€€å‡º3ã€é‡å¯mysqlæœåŠ¡4ã€ä¿®æ”¹å¯†ç ï¼šåŒä¸Š5ã€å¯†ç ä¿®æ”¹æˆåŠŸåéœ€è¦è¿›å…¥viæ¨¡å¼ä¸‹é‡æ–°ç¼–è¾‘/etc/my.cnfå»æ‰å¢åŠ çš„skip-grant-tables é‡å¯mysqlæœåŠ¡ï¼Œå°±å¯ä»¥ç”¨å¯†ç ç™»å½•äº†</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NginxåŒåŸŸåä¸‹é…ç½®å¤šé¡¹ç›®</title>
      <link href="/2019/11/23/Nginx/multiProject/"/>
      <url>/2019/11/23/Nginx/multiProject/</url>
      
        <content type="html"><![CDATA[<h4 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><pre class=" language-bash"><code class="language-bash">build: <span class="token punctuation">{</span>    index: path.resolve<span class="token punctuation">(</span>__dirname, <span class="token string">'../dist/index.html'</span><span class="token punctuation">)</span>,    // Paths    assetsRoot: path.resolve<span class="token punctuation">(</span>__dirname, <span class="token string">'../dist'</span><span class="token punctuation">)</span>,    assetsSubDirectory: <span class="token string">'static'</span>,    assetsPublicPath: <span class="token string">'/admin/'</span>,    productionSourceMap: true,    devtool: <span class="token string">'#source-map'</span>,    productionGzip: true,    productionGzipExtensions: <span class="token punctuation">[</span><span class="token string">'js'</span>, <span class="token string">'css'</span><span class="token punctuation">]</span>,    bundleAnalyzerReport: process.env.npm_config_report  <span class="token punctuation">}</span></code></pre><p>æŠŠ assetsPublicPathä¿®æ”¹ä¸ºä½ åœ¨nginxé…ç½®çš„è·¯å¾„ã€‚</p><h4 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a>router.js</h4><pre class=" language-bash"><code class="language-bash">//baseè¦å’Œä¸Šé¢é…ç½®çš„assetsPublicPathé…ç½®çš„ä¸€æ · mode:<span class="token string">'history'</span>, base: <span class="token string">'/admin/'</span>,</code></pre><h4 id="é…ç½®nginxï¼š"><a href="#é…ç½®nginxï¼š" class="headerlink" title="é…ç½®nginxï¼š"></a>é…ç½®nginxï¼š</h4><pre class=" language-bash"><code class="language-bash">keepalive_timeout  65<span class="token punctuation">;</span><span class="token function">gzip</span>  on<span class="token punctuation">;</span>//å¼€å¯Gzipå‹ç¼©gzip_disable <span class="token string">'msie6'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">#ä¸ä½¿ç”¨gzip IE6</span>gzip_min_length 100k<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">#gzipå‹ç¼©æœ€å°æ–‡ä»¶å¤§å°ï¼Œè¶…å‡ºè¿›è¡Œå‹ç¼©ï¼ˆè‡ªè¡Œè°ƒèŠ‚ï¼‰</span>gzip_buffers 4 16k<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">#buffer ä¸ç”¨ä¿®æ”¹</span>gzip_comp_level 3<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">#å‹ç¼©çº§åˆ«:1-10ï¼Œæ•°å­—è¶Šå¤§å‹ç¼©çš„è¶Šå¥½ï¼Œæ—¶é—´ä¹Ÿè¶Šé•¿</span>server <span class="token punctuation">{</span>    listen 80<span class="token punctuation">;</span>    server_name www.xxx.cn<span class="token punctuation">;</span>//é…ç½®ä½ çš„åŸŸå    location /<span class="token punctuation">{</span>//é…ç½®é»˜è®¤çš„é¡¹ç›®         root /data/www/web<span class="token punctuation">;</span>         try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>         index index.html index.htm<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">#proxy_pass http://127.0.0.1:8080;</span>     <span class="token punctuation">}</span>     location ^~/admin<span class="token punctuation">{</span>//é…ç½® åŸŸå/admin å¯¹åº”çš„é¡¹ç›®         <span class="token function">alias</span> /data/www/admin/<span class="token punctuation">;</span>//åˆ«å é…ç½®é¡¹ç›®æ–‡ä»¶è·¯å¾„         try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>         index index.html index.htm<span class="token punctuation">;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>-e <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>//é˜²æ­¢äºŒçº§è·¯ç”±ä¸‹é¡µé¢reloadç©ºç™½é¡µé¢             rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /admin/index.html last<span class="token punctuation">;</span>             <span class="token keyword">break</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>         <span class="token comment" spellcheck="true">#proxy_pass http://127.0.0.1:8080;</span>     <span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxä¸‹é…ç½®Vueé¡¹ç›®</title>
      <link href="/2019/11/23/Nginx/vue/"/>
      <url>/2019/11/23/Nginx/vue/</url>
      
        <content type="html"><![CDATA[<p>1ã€é…ç½®é€‰æ‹©ï¼š</p><ul><li>Linuxç³»ç»Ÿï¼šCentos 6.5 x64</li><li>Nginxç‰ˆæœ¬ï¼š1.7.8</li></ul><p>2ã€å®‰è£…nginxï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /usr/local//ä¸‹è½½nginx<span class="token function">wget</span> http://nginx.org/download/nginx-1.7.8.tar.gz<span class="token function">cd</span> nginx-1.7.8<span class="token function">make</span><span class="token function">make</span> <span class="token function">install</span></code></pre><p>3ã€å¼€å¯nginxæœåŠ¡ï¼š</p><pre class=" language-bash"><code class="language-bash">/usr/local/nginx-1.7.8/sbin/nginxé‡å¯æˆ–å…³é—­è¿›ç¨‹ï¼š/usr/local/nginx-1.7.8/sbin/nginx -s reload/usr/local/nginx-1.7.8/sbin/nginx -s stop</code></pre><p>4ã€å…³é—­é˜²ç«å¢™ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">service</span> iptables stop</code></pre><p>5ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p><pre class=" language-bash"><code class="language-bash">usr/local/nginx-1.7.8/conf/nginx.confserver <span class="token punctuation">{</span>    listen 80<span class="token punctuation">;</span>//ç›‘å¬80ç«¯å£    server_name www.yangkunxiao.cn<span class="token punctuation">;</span>   //é¡¹ç›®å¯¹åº”åŸŸå    location /<span class="token punctuation">{</span>     root /data/www/dist<span class="token punctuation">;</span>     //é¡¹ç›®å­˜æ”¾è·¯å¾„     try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>    //vueé¡¹ç›®é…ç½®historyæ¨¡å¼     index index.html index.htm<span class="token punctuation">;</span>    //é¡¹ç›®é¦–é¡µåç§°     <span class="token comment" spellcheck="true">#proxy_pass http://127.0.0.1:8080;   //åŸŸåå¯¹åº”URLï¼Œè¿™ä¸ªURLå¯¹åº”çš„å°±æ˜¯http://m.horace.spaceï¼Œå¯é€šè¿‡åŸŸåç›´æ¥è®¿é—®</span>    <span class="token punctuation">}</span>    location /assets/<span class="token punctuation">{</span>//é…ç½®èµ„æºæ–‡ä»¶å¤¹        root /usr/<span class="token punctuation">;</span>//èµ„æºæ–‡ä»¶å¤¹è·¯å¾„        autoindex on<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre><p>7ã€å¤šä¸ªé¡¹ç›®é…ç½®å¤šä¸ªserviceå³å¯<br>6ã€é‡å¯å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxä¸‹é…ç½®é™æ€èµ„æº</title>
      <link href="/2019/11/23/Nginx/staticSource/"/>
      <url>/2019/11/23/Nginx/staticSource/</url>
      
        <content type="html"><![CDATA[<p>1ã€æŸ¥çœ‹nginxå®‰è£…è·¯å¾„ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">whereis</span> nginx</code></pre><p>2ã€æ–°å»ºé™æ€èµ„æºå­˜å‚¨æ–‡ä»¶å¤¹ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> assets</code></pre><p>3ã€è¿›å…¥nginxç›®å½•ä¸­ï¼Œä¿®æ”¹nginx.confæ–‡ä»¶ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> nginx: /usr/local/nginx/confvim nginx.confå…·ä½“é…ç½®å¦‚ä¸‹ï¼šserver <span class="token punctuation">{</span>    listen 80<span class="token punctuation">;</span>    server_name www.yangkunxiao.cn<span class="token punctuation">;</span>    location /<span class="token punctuation">{</span>     root /data/www/dist<span class="token punctuation">;</span>     try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>     index index.html index.htm<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">#proxy_pass http://127.0.0.1:8080;</span>    <span class="token punctuation">}</span>    location /assets/<span class="token punctuation">{</span>        root /usr/<span class="token punctuation">;</span>        autoindex on<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre><p>4ã€ä¿å­˜å¹¶é‡å¯nginx</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpå’ŒmySql</title>
      <link href="/2019/11/22/Php/mysql/"/>
      <url>/2019/11/22/Php/mysql/</url>
      
        <content type="html"><![CDATA[<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>é€šè¿‡PHPï¼Œå¼€å‘è€…å¯ä»¥å’Œæ•°æ®åº“ç›¸è¿ã€‚<br>åœ¨PHP5.0ç‰ˆæœ¬ä»¥åï¼Œå®˜æ–¹æ¨èä¸€ä¸‹ä¸¤ç§æ–¹å¼è¿›è¡ŒPHPå’Œæ•°æ®åº“çš„è¿æ¥ï¼š</p><ul><li>MySQLi extension (â€œiâ€ æ„ä¸º improved)ï¼šMySQLi åªé’ˆå¯¹ MySQL æ•°æ®åº“</li><li>PDO (PHP Data Objects)ï¼šPDO åº”ç”¨åœ¨ 12 ç§ä¸åŒæ•°æ®åº“ä¸­<br>å› ä¸ºæˆ‘è¿™é‡Œåªå®‰è£…äº†mySqlï¼Œæ‰€ä»¥æœ¬æ–‡æ —å­å‡ä»¥ç¬¬ä¸€ç§æ–¹å¼è¿›è¡Œæ“ä½œã€‚</li></ul><h4 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h4><p>åœ¨è®¿é—®æ•°æ®åº“ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ•°æ®åº“çš„è¿æ¥</p><pre class=" language-bash"><code class="language-bash"><span class="token variable">$serverName</span> <span class="token operator">=</span> <span class="token string">'localhost'</span><span class="token punctuation">;</span>//æ•°æ®åº“åœ°å€<span class="token variable">$serverRoot</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>//æ•°æ®åº“ç™»å½•åç§°<span class="token variable">$passWord</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>//æ•°æ®åº“å¯†ç <span class="token variable">$dbName</span> <span class="token operator">=</span> <span class="token string">"myDB"</span><span class="token punctuation">;</span><span class="token variable">$conn</span> <span class="token operator">=</span> new mysqli<span class="token punctuation">(</span><span class="token variable">$serverName</span>,<span class="token variable">$userName</span>,<span class="token variable">$userPassword</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//è¿æ¥å¤±è´¥if<span class="token punctuation">(</span><span class="token variable">$conn</span>-<span class="token operator">></span>connect_error<span class="token punctuation">)</span><span class="token punctuation">{</span>    die<span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“è¿æ¥å¤±è´¥ï¼š"</span><span class="token keyword">.</span><span class="token variable">$conn</span>-<span class="token operator">></span>connect_error<span class="token punctuation">)</span><span class="token punctuation">}</span>mysqli_set_charset<span class="token punctuation">(</span><span class="token variable">$this</span>-<span class="token operator">></span>conn, <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//è®¾ç½®å­—ç¬¦ç¼–ç ä¸ºutf8æ ¼å¼ å¦åˆ™æ±‰å­—å¯èƒ½å‡ºç°ä¹±ç çš„æƒ…å†µ//æ•°æ®åº“æ“ä½œå®Œæˆä¹‹å ä¸€å®šè®°å¾—å…³é—­æ•°æ®åº“çš„è¿æ¥<span class="token variable">$conn</span>-<span class="token operator">></span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="æ“ä½œæ•°æ®åº“"><a href="#æ“ä½œæ•°æ®åº“" class="headerlink" title="æ“ä½œæ•°æ®åº“"></a>æ“ä½œæ•°æ®åº“</h4><p>1ã€åˆ›å»ºæ•°æ®åº“ï¼š<code>$sql = &quot;CREATE DATABASE IF NOT EXISTS dbname&quot;</code><br>2ã€åˆ›å»ºè¡¨ï¼šä¸Šé¢çš„è¿æ¥è¯­å¥è¦ä¿®æ”¹ä¸‹ï¼ŒåŠ ä¸ªå‚æ•°ï¼Œç”¨æ¥é€‰æ‹©æ•°æ®åº“ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token variable">$conn</span> <span class="token operator">=</span> new mysqli<span class="token punctuation">(</span><span class="token variable">$serverName</span>,<span class="token variable">$userName</span>,<span class="token variable">$userPassword</span>,<span class="token variable">$dbName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"CREATE TABLE MyGuests (id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY, firstname VARCHAR(30) NOT NULL,lastname VARCHAR(30) NOT NULL,email VARCHAR(50),reg_date TIMESTAMP)"</span><span class="token punctuation">;</span></code></pre><p>å±æ€§è¯´æ˜ï¼š</p><ul><li>NOT NULL - æ¯ä¸€è¡Œéƒ½å¿…é¡»å«æœ‰å€¼ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰ï¼Œnull å€¼æ˜¯ä¸å…è®¸çš„ã€‚</li><li>DEFAULT value - è®¾ç½®é»˜è®¤å€¼</li><li>UNSIGNED - ä½¿ç”¨æ— ç¬¦å·æ•°å€¼ç±»å‹ï¼Œ0 åŠæ­£æ•°</li><li>AUTO INCREMENT - è®¾ç½® MySQL å­—æ®µçš„å€¼åœ¨æ–°å¢è®°å½•æ—¶æ¯æ¬¡è‡ªåŠ¨å¢é•¿ 1</li><li>PRIMARY KEY - è®¾ç½®æ•°æ®è¡¨ä¸­æ¯æ¡è®°å½•çš„å”¯ä¸€æ ‡è¯†ã€‚ é€šå¸¸åˆ—çš„ PRIMARY KEY è®¾ç½®ä¸º ID æ•°å€¼ï¼Œä¸ AUTO_INCREMENT ä¸€èµ·ä½¿ç”¨ã€‚<br>æ¯ä¸ªè¡¨éƒ½åº”è¯¥æœ‰ä¸€ä¸ªä¸»é”®(æœ¬åˆ—ä¸º â€œidâ€ åˆ—)ï¼Œä¸»é”®å¿…é¡»åŒ…å«å”¯ä¸€çš„å€¼</li></ul><p>3ã€æ’å…¥æ•°æ®ï¼š<code>$sql=&#39;INSERT INTO table_name (column1, column2, column3,...)VALUES (value1, value2, value3,...)&#39;</code><br>4ã€æ’å…¥å¤šæ¡æ•°æ®ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"INSERT INTO student (column1, column2, column3,...)VALUES (value1, value2, value3,...);"</span><span class="token punctuation">;</span><span class="token variable">$sql</span>.<span class="token operator">=</span><span class="token string">"INSERT INTO student (column1, column2, column3,...)VALUES (value1, value2, value3,...);"</span><span class="token punctuation">;</span><span class="token variable">$sql</span>.<span class="token operator">=</span><span class="token string">"INSERT INTO student (column1, column2, column3,...)VALUES (value1, value2, value3,...);"</span><span class="token punctuation">;</span></code></pre><p>æ³¨æ„ï¼šsqlè¯­å¥ä¹‹é—´ç”¨;éš”å¼€</p><p>5ã€æŸ¥è¯¢æ•°æ®ï¼š<code>$sql = &#39;SELECT * FROM  myDB;&#39;</code><br>6ã€æ›´æ–°æ•°æ®ï¼š<br><code>UPDATE table_nameSET column1=value, column2=value2,...WHERE some_column=some_value</code><br>7ã€åˆ é™¤æ•°æ®ï¼š<code>DELETE FROM table_nameWHERE some_column = some_value</code></p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
          <category> mySql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> mySql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpåŸºç¡€</title>
      <link href="/2019/11/22/Php/base/"/>
      <url>/2019/11/22/Php/base/</url>
      
        <content type="html"><![CDATA[<h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><p>ï¼ˆå…¨ç§°ï¼šPHPï¼šHypertext Preprocessorï¼Œå³â€PHPï¼šè¶…æ–‡æœ¬é¢„å¤„ç†å™¨â€ï¼‰æ˜¯ä¸€ç§é€šç”¨å¼€æºè„šæœ¬è¯­è¨€ã€‚</p><h4 id="PHPçš„ä½œç”¨"><a href="#PHPçš„ä½œç”¨" class="headerlink" title="PHPçš„ä½œç”¨"></a>PHPçš„ä½œç”¨</h4><ul><li>PHP å¯ä»¥ç”ŸæˆåŠ¨æ€é¡µé¢å†…å®¹</li><li>PHP å¯ä»¥åˆ›å»ºã€æ‰“å¼€ã€è¯»å–ã€å†™å…¥ã€å…³é—­æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶<ul><li>PHP å¯ä»¥æ”¶é›†è¡¨å•æ•°æ®</li><li>PHP å¯ä»¥å‘é€å’Œæ¥æ”¶ cookies</li><li>PHP å¯ä»¥æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ‚¨çš„æ•°æ®åº“ä¸­çš„æ•°æ®</li><li>PHP å¯ä»¥é™åˆ¶ç”¨æˆ·è®¿é—®æ‚¨çš„ç½‘ç«™ä¸Šçš„ä¸€äº›é¡µé¢</li><li>PHP å¯ä»¥åŠ å¯†æ•°æ®</li></ul></li></ul><h4 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h4><pre><code>&lt;?php    $x=5;    $y=6;    $z=$x+$y;    echo $z;?&gt;</code></pre><h4 id="å˜é‡ä½œç”¨åŸŸ"><a href="#å˜é‡ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡ä½œç”¨åŸŸ"></a>å˜é‡ä½œç”¨åŸŸ</h4><p>PHPæœ‰å››ç§ä¸åŒçš„å˜é‡ä½œç”¨åŸŸï¼š</p><ul><li>localï¼šå±€éƒ¨ä½œç”¨åŸŸã€‚åœ¨ PHP å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œä»…èƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®</li><li>globalï¼šå…¨å±€ä½œç”¨åŸŸã€‚åœ¨æ‰€æœ‰å‡½æ•°å¤–éƒ¨å®šä¹‰çš„å˜é‡ï¼Œæ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸã€‚é™¤äº†å‡½æ•°å¤–ï¼Œå…¨å±€å˜é‡å¯ä»¥è¢«è„šæœ¬ä¸­çš„ä»»ä½•éƒ¨åˆ†è®¿é—®ï¼Œè¦åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œéœ€è¦ä½¿ç”¨ global å…³é”®å­—ã€‚</li><li>staticï¼šå½“ä¸€ä¸ªå‡½æ•°å®Œæˆæ—¶ï¼Œå®ƒçš„æ‰€æœ‰å˜é‡é€šå¸¸éƒ½ä¼šè¢«åˆ é™¤ã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æŸä¸ªå±€éƒ¨å˜é‡ä¸è¦è¢«åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨static</li><li>parameterï¼šå‚æ•°ä½œç”¨åŸŸã€‚å‚æ•°æ˜¯é€šè¿‡è°ƒç”¨ä»£ç å°†å€¼ä¼ é€’ç»™å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚å‚æ•°æ˜¯åœ¨å‚æ•°åˆ—è¡¨ä¸­å£°æ˜çš„ï¼Œä½œä¸ºå‡½æ•°å£°æ˜çš„ä¸€éƒ¨åˆ†</li></ul><h4 id="å±€éƒ¨å’Œå…¨å±€ä½œç”¨åŸŸ"><a href="#å±€éƒ¨å’Œå…¨å±€ä½œç”¨åŸŸ" class="headerlink" title="å±€éƒ¨å’Œå…¨å±€ä½œç”¨åŸŸ"></a>å±€éƒ¨å’Œå…¨å±€ä½œç”¨åŸŸ</h4><pre><code>$x = 5;//å…¨å±€å˜é‡function test(){    global $x;//ä½¿ç”¨globalå…³é”®å­— ä½¿ç”¨å…¨å±€å˜é‡    static $n = 0;//å±€éƒ¨å˜é‡    $y = 10;//å±€éƒ¨å˜é‡    $n++;    echo &#39;x: &#39;.$x.&#39;&lt;br/&gt;&#39;;    echo &#39;y: &#39;.$y.&#39;&lt;br/&gt;&#39;;    echo $n.&#39;&lt;br /&gt;&#39;;};test();test();test();</code></pre><h4 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h4><p>å¸¸é‡å€¼è¢«å®šä¹‰åï¼Œåœ¨è„šæœ¬çš„å…¶ä»–ä»»ä½•åœ°æ–¹éƒ½ä¸èƒ½è¢«æ”¹å˜ã€‚å¸¸é‡æ˜¯ä¸€ä¸ªç®€å•å€¼çš„æ ‡è¯†ç¬¦ã€‚è¯¥å€¼åœ¨è„šæœ¬ä¸­ä¸èƒ½æ”¹å˜ã€‚<br>ä¸€ä¸ªå¸¸é‡ç”±è‹±æ–‡å­—æ¯ã€ä¸‹åˆ’çº¿ã€å’Œæ•°å­—ç»„æˆ,ä½†æ•°å­—ä¸èƒ½ä½œä¸ºé¦–å­—æ¯å‡ºç°ã€‚ (å¸¸é‡åä¸éœ€è¦åŠ  $ ä¿®é¥°ç¬¦)ã€‚<br>è®¾ç½®å¸¸é‡ï¼Œä½¿ç”¨ define() å‡½æ•°ï¼Œå‡½æ•°è¯­æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>bool define ( string $name , mixed $value [, bool $case_insensitive = false ] )<br>è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°:</p></blockquote><ul><li>nameï¼šå¿…é€‰å‚æ•°ï¼Œå¸¸é‡åç§°ï¼Œå³æ ‡å¿—ç¬¦</li><li>valueï¼šå¿…é€‰å‚æ•°ï¼Œå¸¸é‡çš„å€¼</li><li>case_insensitive ï¼šå¯é€‰å‚æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º TRUEï¼Œè¯¥å¸¸é‡åˆ™å¤§å°å†™ä¸æ•æ„Ÿã€‚é»˜è®¤æ˜¯å¤§å°å†™æ•æ„Ÿçš„</li></ul><pre><code>&lt;?phpdefine(&quot;GREETING&quot;, &quot;æ¬¢è¿è®¿é—® Runoob.com&quot;);echo GREETING;    // è¾“å‡º &quot;æ¬¢è¿è®¿é—® Runoob.com&quot;echo &#39;&lt;br&gt;&#39;;echo greeting;   // è¾“å‡º &quot;greeting&quot;?&gt;</code></pre><h4 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h4><ul><li>å­—ç¬¦ä¸²</li><li>æ•´å‹ï¼šæ•´æ•°æ˜¯ä¸€ä¸ªæ²¡æœ‰å°æ•°çš„æ•°å­—</li><li>æµ®ç‚¹å‹ï¼šæµ®ç‚¹æ•°æ˜¯å¸¦å°æ•°éƒ¨åˆ†çš„æ•°å­—ï¼Œæˆ–æ˜¯æŒ‡æ•°å½¢å¼ã€‚</li><li>å¸ƒå°”å‹</li><li>æ•°ç»„</li><li>å¯¹è±¡ï¼šåœ¨ PHP ä¸­ï¼Œå¯¹è±¡å¿…é¡»å£°æ˜ã€‚é¦–å…ˆï¼Œä½ å¿…é¡»ä½¿ç”¨classå…³é”®å­—å£°æ˜ç±»å¯¹è±¡ã€‚ç±»æ˜¯å¯ä»¥åŒ…å«å±æ€§å’Œæ–¹æ³•çš„ç»“æ„ã€‚ç„¶åæˆ‘ä»¬åœ¨ç±»ä¸­å®šä¹‰æ•°æ®ç±»å‹ï¼Œç„¶ååœ¨å®ä¾‹åŒ–çš„ç±»ä¸­ä½¿ç”¨æ•°æ®ç±»å‹</li><li>NULL</li></ul>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢æ­å»º</title>
      <link href="/2019/11/22/Hexo/index/"/>
      <url>/2019/11/22/Hexo/index/</url>
      
        <content type="html"><![CDATA[<h4 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h4><p>Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><ul><li><p>Nodeï¼ˆæœ¬æ–‡ä¸åšå¤šä½™å™è¿°ï¼‰</p></li><li><p>Gitï¼ˆæœ¬æ–‡ä¸åšå¤šä½™å™è¿°ï¼‰</p></li><li><p>Hexo<br><code>$ npm install -g hexo-cli</code><br>å®‰è£…å®Œæˆåï¼Œåˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰“å¼€Git Bashï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š</p><pre><code>$ hexo init &lt;folder&gt;$ cd &lt;folder&gt;$ npm install</code></pre><p>æ–°å»ºå®Œæˆä¹‹åï¼Œæ‰“å¼€æ–°å»ºçš„é¡¹ç›®ï¼ŒæŸ¥çœ‹é¡¹ç›®ç›®å½•ï¼š</p></li><li><p>publicï¼šæ‰§è¡Œhexo generateå‘½ä»¤ï¼Œç”Ÿæˆçš„HTMLé™æ€æ–‡ä»¶</p></li><li><p>scaffoldsï¼šæ¨¡ç‰ˆæ–‡ä»¶å¤¹</p></li><li><p>sourceï¼šèµ„æºæ–‡ä»¶å¤¹ï¼Œæ–‡ç« æºç ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹çš„markdownå’Œhtmlæ–‡ä»¶å‡ä¼šè¢«hexoå¤„ç†ã€‚è¯¥é¡µé¢å¯¹åº”repoçš„æ ¹ç›®å½•ï¼Œ404æ–‡ä»¶ã€favicon.icoæ–‡ä»¶ï¼ŒCNAMEæ–‡ä»¶ç­‰éƒ½åº”è¯¥æ”¾è¿™é‡Œ</p><ul><li>_dataï¼šä½ çš„æ•°æ®æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ï¼š<ul><li>friends.jsonï¼šå­˜æ”¾å‹æƒ…é“¾æ¥çš„æ•°æ®</li><li>musics.jsonï¼šå­˜æ”¾éŸ³ä¹æ’­æ”¾å™¨çš„æ•°æ®</li></ul></li><li>_postsï¼šæ–‡ç« å­˜æ”¾æ–‡ä»¶å¤¹</li><li>categoriesï¼šåˆ†ç±»</li><li>tagsï¼šæ ‡ç­¾<ul><li>themsï¼šä¸»é¢˜æ–‡ä»¶å¤¹ï¼ŒHexo ä¼šæ ¹æ®ä¸»é¢˜æ¥ç”Ÿæˆé™æ€é¡µé¢ã€‚ä»¥æˆ‘å½“å‰ä½¿ç”¨çš„meteryä¸»é¢˜ä¸ºä¾‹</li><li>langauagesï¼šå­˜æ”¾è¯­è¨€ç›¸å…³è®¾ç½®çš„ymlæ–‡ä»¶</li><li>layoutï¼šå­˜æ”¾æ–‡ç« çš„ejsæ¨¡ç‰ˆï¼Œå¯ä»¥åœ¨é‡Œé¢ä¿®æ”¹ç›¸å…³çš„HTMLã€CSSã€JSç­‰</li><li>sourceï¼šè¯¥ä¸»é¢˜ä¸‹ä½¿ç”¨çš„èµ„æºæ–‡ä»¶å¤¹</li><li>_config.ymlï¼šè¯¥ä¸»é¢˜çš„é…ç½®æ–‡ä»¶</li></ul></li></ul></li></ul><ul><li>_config.ymlï¼šè¯¥é¡¹ç›®çš„é…ç½®æ–‡ä»¶</li><li>db.jsonï¼šsourceè§£ææ‰€å¾—åˆ°çš„</li><li>package.jsonï¼šé¡¹ç›®æ‰€éœ€æ¨¡å—é¡¹ç›®çš„é…ç½®ä¿¡æ¯</li></ul><h4 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><ul><li>GitHubä¸Šæ–°å»ºä¸€ä¸ªé¡¹ç›®</li><li>æœ¬åœ°Git Bashä¸Šé…ç½®githubè´¦æˆ·ä¿¡æ¯<ul><li><code>git config --global user.name &#39;yourName&#39;</code></li><li><code>git config --global user.email &#39;yourEmail&#39;</code><ul><li>åˆ›å»ºSSH</li><li>åœ¨gitbashä¸­è¾“å…¥ï¼š</li><li><code>ssh-keygen -t rsa -C &quot;youremail@example.com</code>ï¼Œç”Ÿæˆsshã€‚</li><li><code>cd ~/.ssh</code> æ‰¾åˆ°id_rsa.pub</li><li><code>cat id_rsa.pub</code>å¤åˆ¶å…¶ä¸­çš„å†…å®¹åˆ°githubä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ SSH KEY</li></ul></li></ul></li></ul><ul><li>ä¿®æ”¹_config.yml<pre><code>deploy:type: gitrepo: https://github.com/YourgithubName/YourgithubName.github.io.gitbranch: master</code></pre></li><li>å›åˆ°Git Bash<pre><code>npm i hexo-serverhexo cleanhexo generatehexo server</code></pre></li><li>ä¸Šä¼ åˆ°GitHub<pre><code>npm install hexo-deployer-git --savehexo cleanhexo generatehexo deploy</code></pre>æ³¨æ„deployçš„è¿‡ç¨‹ä¸­è¦è¾“å…¥ä½ çš„usernameåŠpasswardã€‚<br>ç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <a href="http://yourgithubname.github.io" target="_blank" rel="noopener">http://yourgithubname.github.io</a> å°±å¯ä»¥çœ‹åˆ°ä½ çš„ä¸ªäººåšå®¢ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾</title>
      <link href="/2019/11/21/JavaScript/ScopeChain/"/>
      <url>/2019/11/21/JavaScript/ScopeChain/</url>
      
        <content type="html"><![CDATA[<h4 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h4><p>åœ¨JavaScriptä¸­çš„ä½œç”¨åŸŸæœ‰<strong><em>å…¨å±€ä½œç”¨åŸŸ</em></strong>ã€<strong><em>å±€éƒ¨ä½œç”¨åŸŸ</em></strong>ï¼ˆåœ¨JavaScriptä¸­å±€éƒ¨ä½œç”¨åŸŸå³æ˜¯<strong><em>å‡½æ•°ä½œç”¨åŸŸ</em></strong>ï¼‰ä»¥åŠ<strong><em>å—çº§ä½œç”¨åŸŸ</em></strong>ã€‚</p><ul><li><p>å…¨å±€ä½œç”¨åŸŸï¼šåœ¨æœ€å¤–å±‚å‡½æ•°å®šä¹‰çš„å˜é‡å³æ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸï¼Œå¯¹äºä»»æ„å‡½æ•°æ¥è¯´ï¼Œéƒ½å¯ä»¥è®¿é—®åˆ°ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//1</span>  <span class="token punctuation">}</span>  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre></li></ul><ul><li><p>å±€éƒ¨ä½œç”¨åŸŸï¼šå’Œå…¨å±€ä½œç”¨åŸŸç›¸åï¼Œå±€éƒ¨ä½œç”¨åŸŸçš„å˜é‡å³æ˜¯åœ¨ç‰¹å®šä»£ç å—ä¸­æ‰èƒ½è¿‡è®¿é—®ï¼Œå¯¹äºå¤–éƒ¨æ˜¯ä¸èƒ½å¤Ÿè®¿é—®çš„ã€‚æ³¨æ„ï¼šåœ¨å‡½æ•°å†…éƒ¨å®šä¹‰å˜é‡çš„æ—¶å€™ï¼Œå¦‚æœä¸ç”¨varï¼Œé‚£ä¹ˆä½ å£°æ˜çš„å°±æ˜¯å…¨å±€å˜é‡äº†ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//1</span>  <span class="token punctuation">}</span>  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//b is not defined</span><span class="token punctuation">}</span></code></pre></li><li><p>å—çº§ä½œç”¨åŸŸï¼šåœ¨ä»£ç å—ä¸­ä½¿ç”¨<strong><em>let</em></strong>å®šä¹‰çš„å˜é‡ï¼Œåªèƒ½åœ¨å½“å‰ä»£ç å—ä¸­è¿›è¡Œè®¿é—®ã€‚å—çº§ä½œç”¨åŸŸå¯ä»¥å½¢æˆæš‚æ—¶æ€§æ­»åŒºã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//1-9</span>  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//undefined</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></li></ul><h4 id="ä½œç”¨åŸŸé“¾"><a href="#ä½œç”¨åŸŸé“¾" class="headerlink" title="ä½œç”¨åŸŸé“¾"></a>ä½œç”¨åŸŸé“¾</h4><p>ä¸ªäººç†è§£ï¼Œä½œç”¨åŸŸå°±æ˜¯åœ¨å‡½æ•°å†…éƒ¨å¯ä»¥è®¿é—®å¤–éƒ¨å˜é‡çš„æœºåˆ¶ï¼Œä½¿ç”¨é“¾å¼æŸ¥æ‰¾å“ªäº›å˜é‡å¯ä»¥è¢«å‡½æ•°å†…éƒ¨è®¿é—®ã€‚è¯´èµ·ä½œç”¨åŸŸé“¾ï¼Œé‚£ä¹ˆä¸å¾—ä¸è¯´<strong><em>æ‰§è¡Œç¯å¢ƒ</em></strong>äº†ã€‚</p><h4 id="æ‰§è¡Œç¯å¢ƒï¼ˆExecution-Contextï¼‰"><a href="#æ‰§è¡Œç¯å¢ƒï¼ˆExecution-Contextï¼‰" class="headerlink" title="æ‰§è¡Œç¯å¢ƒï¼ˆExecution Contextï¼‰"></a>æ‰§è¡Œç¯å¢ƒï¼ˆExecution Contextï¼‰</h4><p>ECæ˜¯JavaScriptä¸­ä¸€ä¸ªæœ€ä¸ºé‡è¦çš„æ¦‚å¿µã€‚ECå®šä¹‰äº†å˜é‡å’Œå‡½æ•°æœ‰æƒè®¿é—®çš„å…¶ä»–æ•°æ®ã€‚JavaScriptä¸­ï¼Œå‡½æ•°åœ¨è¿è¡Œæ—¶éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œå¹¶ä¸”JSå¼•æ“è¿˜ä¼šäº§ç”Ÿä¸€ä¸ªä¸å½“å‰ECç›¸å…³è”çš„<strong><em>å˜é‡å¯¹è±¡</em></strong>ï¼ˆVariable Objectï¼Œå³VOï¼‰ã€‚ECä¸­æ‰€æœ‰å®šä¹‰çš„å˜é‡å’Œæ–¹æ³•éƒ½åŒ…å«åœ¨VOä¸­ã€‚å…¨å±€æ‰§è¡Œç¯å¢ƒæ˜¯æœ€å¤–å›´çš„æ‰§è¡Œç¯å¢ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œå…œåº•â€çš„æ‰§è¡Œç¯å¢ƒã€‚</p><p>JSå¼•æ“åœ¨è¿›å…¥ä¸€æ®µå¯æ‰§è¡Œçš„ä»£ç æ—¶ï¼Œéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä¸ªåˆå§‹åŒ–å·¥ä½œï¼š</p><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª<strong><em>å…¨å±€å¯¹è±¡</em></strong>(Global Objectï¼Œå³GO)ï¼Œå°†Mathã€Stringã€Dataç­‰å¸¸ç”¨çš„jså¯¹è±¡ä½œä¸ºå…¶å±æ€§ï¼Œä½†æ˜¯è¿™ä¸ªGOåœ¨å…¨å±€æ˜¯ä¸å¯è§çš„ï¼Œä¸å¯ç›´æ¥è®¿é—®çš„ã€‚å› æ­¤å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªå±æ€§windowï¼Œå¹¶å°†windowæŒ‡å‘äº†è‡ªèº«ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å…¨å±€é€šè¿‡è®¿é—®windowï¼Œæ¥è®¿é—®GOçš„å±æ€§å’Œæ–¹æ³•äº†ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> globalObject <span class="token operator">=</span> <span class="token punctuation">{</span>  Math<span class="token punctuation">,</span>  String<span class="token punctuation">,</span>  Data<span class="token punctuation">,</span>  Function<span class="token punctuation">,</span>  <span class="token operator">...</span>  window<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">}</span></code></pre><p>å…¶æ¬¡ï¼ŒJSå¼•æ“ä¼šåˆ›å»ºä¸€ä¸ª<strong><em>æ‰§è¡Œç¯å¢ƒæ ˆ</em></strong>ï¼ˆExecution Context Stack å³ECSï¼‰ï¼Œä¸æ­¤åŒæ—¶è¿˜ä¼šåˆ›å»ºä¸€ä¸ªå…¨å±€ç¯å¢ƒECã€‚å½“JSçš„æ‰§è¡Œæµæ‰§è¡Œåˆ°ä¸€ä¸ªå‡½æ•°æ—¶ï¼ŒJSå¼•æ“å°±ä¼šæŠŠè¯¥å‡½æ•°çš„ECæ¨åˆ°ECSä¸­ï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œä¹‹åï¼Œå†æŠŠECä»ECSä¸­å¼¹å‡ºï¼Œå°†æ‰§è¡Œæµçš„æ§åˆ¶æƒäº¤è¿˜ç»™ä¸Šä¸€å±‚çš„ECã€‚ECMAScriptçš„æ‰§è¡Œæµå°±æ˜¯ç”±è¿™ç§æœºåˆ¶æ§åˆ¶ç€ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> ecStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ‰§è¡Œåˆ°å‡½æ•°fn</span>ecStock<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>EC<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ‰§è¡Œå®Œfn</span>ecStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span>EC<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æœ€åï¼ŒJSå¼•æ“ä¼šåˆ›é€ ä¸€ä¸ªå’ŒECç›¸å…³è¿çš„å˜é‡å¯¹è±¡VOã€‚å¦‚æœè¿™ä¸ªç¯å¢ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™å°†å…¶<strong><em>æ´»åŠ¨å¯¹è±¡</em></strong>ï¼ˆAction Objectï¼Œå³AOï¼‰ä½œä¸ºå…¶å˜é‡å¯¹è±¡ã€‚åˆå§‹æ—¶AOåªåŒ…å«ä¸€ä¸ªå˜é‡ï¼Œå³argumentsã€‚ä½œç”¨åŸŸé“¾çš„ä¸‹ä¸€ä¸ªå˜é‡å¯¹è±¡æ¥è‡ªäºå¤–éƒ¨åŒ…å«ç¯å¢ƒï¼Œè€Œä¸‹ä¸€ä¸ªå˜é‡å¯¹è±¡æ¥è‡ªä¸‹ä¸€ä¸ªåŒ…å«ç¯å¢ƒï¼Œè¿™æ ·ä¸€ç›´å»¶ä¼¸åˆ°å…¨å±€ç¯å¢ƒã€‚å…¨å±€å˜é‡å¯¹è±¡ï¼ˆGOï¼‰å§‹ç»ˆéƒ½æ˜¯ä½œç”¨åŸŸé“¾çš„æœ€åä¸€ä¸ªå¯¹è±¡ã€‚</p><p>æ¯ä¸€ä¸ªå‡½æ•°åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªä¸ä¹‹å…³è”çš„<strong><em>[[scopes]]</em></strong>å±æ€§ï¼Œè¯¥scopeæ€»æ˜¯æŒ‡å‘å®šä¹‰å‡½æ•°æ—¶çš„æ‰§è¡Œç¯å¢ƒECã€‚ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="http://cdn.yangkunxiao.cn/xv64Ki.png" alt="scopes"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡½æ•°fnçš„[[scopes]][0]å³æ˜¯å®ƒçš„æ‰§è¡Œç¯å¢ƒï¼ŒGOã€‚</p><p>å†çœ‹ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span></code></pre><p><img src="http://cdn.yangkunxiao.cn/KL9FAg.png" alt="scopes"></p><p>fnä¸­å§‹ç»ˆéƒ½æ²¡æœ‰å®šä¹‰å˜é‡aï¼Œé‚£ä¹ˆJSå¼•æ“å°±ä¼šæ²¿ç€Scope Chainä¸€ç›´å‘ä¸Šå¯»æ‰¾aï¼Œæœ€ç»ˆåœ¨GOä¸­æ‰¾åˆ°äº†aã€‚</p><h4 id="ä½œç”¨åŸŸé“¾-1"><a href="#ä½œç”¨åŸŸé“¾-1" class="headerlink" title="ä½œç”¨åŸŸé“¾"></a>ä½œç”¨åŸŸé“¾</h4><p>å½“JavaScriptçš„ä»£ç å—åœ¨è¿è¡Œæ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸ä¹‹ç›¸å…³çš„ä½œç”¨åŸŸé“¾ã€‚</p><blockquote><p>ä½œç”¨åŸŸé“¾çš„ä½œç”¨å°±æ˜¯ä¿è¯å½“å‰ç¯å¢ƒå¯¹å…¶æœ‰æƒè®¿é—®çš„å˜é‡å’Œæ–¹æ³•è¿›è¡Œæœ‰åºçš„è®¿é—® â€”â€”JavaScripté«˜çº§ç¨‹åºè®¾è®¡</p></blockquote><p>ä½œç”¨åŸŸé“¾çš„å‰ç«¯ï¼ˆä¹Ÿå°±æ˜¯å¼€å¤´ï¼‰å°±æ˜¯å½“å‰æ‰§è¡Œç¯å¢ƒECçš„å˜é‡å¯¹è±¡ï¼Œå®ƒçš„å˜é‡å¯¹è±¡æ¥è‡ªäºå®ƒçš„å¤–éƒ¨åŒ…å«ç¯å¢ƒï¼Œå†ä¸‹ä¸€ä¸ªå˜é‡å¯¹è±¡åŒæ—¶ä¹Ÿæ¥è‡ªå†ä¸‹ä¸€ä¸ªå¤–éƒ¨åŒ…å«ç¯å¢ƒï¼Œè¿™æ ·ä¸€ç›´å»¶ä¼¸åˆ°å…¨å±€æ‰§è¡Œç¯å¢ƒï¼ŒåŒæ—¶ï¼ŒGOä¹Ÿæ˜¯ä½œç”¨åŸŸé“¾çš„æœ€åä¸€ä¸ªå¯¹è±¡ã€‚</p><h4 id="æ ‡è¯†ç¬¦è§£æ"><a href="#æ ‡è¯†ç¬¦è§£æ" class="headerlink" title="æ ‡è¯†ç¬¦è§£æ"></a>æ ‡è¯†ç¬¦è§£æ</h4><p>å½“åœ¨æŸä¸ªç¯å¢ƒä¸­ä¸ºäº†è¯»å–æˆ–å†™å…¥ä»è€Œå¼•å…¥ä¸€ä¸ªæ ‡è¯†ç¬¦æ—¶ï¼Œå¿…é¡»é€šè¿‡æœç´¢æ¥ç¡®å®šè¯¥æ ‡è¯†ç¬¦ä»£è¡¨äº†ä»€ä¹ˆã€‚æœç´¢è¿‡ç¨‹ä»å½“æœŸä½œç”¨åŸŸé“¾çš„å‰ç«¯å¼€å§‹ï¼Œå‘ä¸Šé€çº§æœç´¢ï¼Œå¦‚æœåœ¨å±€éƒ¨ç¯å¢ƒä¸­æŸ¥æ‰¾åˆ°äº†è¯¥æ ‡è¯†ç¬¦çš„å®šä¹‰ï¼Œåˆ™åœæ­¢æœç´¢â€˜å¦åˆ™å°†ä¸€ç›´æ²¿ç€ä½œç”¨åŸŸé“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°GOä¸Šã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</p><h4 id="å»¶é•¿ä½œç”¨åŸŸ"><a href="#å»¶é•¿ä½œç”¨åŸŸ" class="headerlink" title="å»¶é•¿ä½œç”¨åŸŸ"></a>å»¶é•¿ä½œç”¨åŸŸ</h4><p>è™½ç„¶ä½œç”¨åŸŸåªæœ‰ä¸¤ç§ï¼šå…¨å±€å’Œå±€éƒ¨ï¼ˆå‡½æ•°ï¼‰ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å…¶ä»–åŠæ³•å¯ä»¥ç”¨æ¥å»¶é•¿ä½œç”¨åŸŸé“¾ã€‚å…¶ä¸»è¦æ€è·¯å°±æ˜¯ï¼šæœ‰äº›è¯­å¥å¯ä»¥åœ¨ä½œç”¨åŸŸé“¾çš„å‰ç«¯ä¸´æ—¶å¢åŠ ä¸€ä¸ªå˜é‡å¯¹è±¡ï¼Œè¯¥å˜é‡å¯¹è±¡åœ¨ä»£ç æ‰§è¡Œåå°±è¢«é”€æ¯ã€‚</p><p>1ã€try-catchè¯­å¥çš„catchå—</p><p>2ã€withè¯­å¥</p><h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿä¸ªäººç†è§£å°±æ˜¯ç”±äºå‡½æ•°çš„åµŒå¥—ï¼Œå¹¶ä¸”å¯¹å¤–æä¾›è®¿é—®æ¥å£å°±ä¼šäº§ç”Ÿé—­åŒ…ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> b  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//2</span></code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå‡½æ•°fnæ‰§è¡Œå®Œä¹‹åï¼Œåº”è¯¥<strong><em>JSçš„åƒåœ¾å›æ”¶æœºåˆ¶</em></strong>è¢«æ ‡è®°â€œç­‰å¾…æ¸…é™¤â€ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æœºåˆ¶æ‰§è¡Œçš„æ—¶å€™è¢«æ¸…é™¤ï¼Œä½†æ˜¯ç”±äºè¿”å›å‡½æ•°ä¸­å¼•ç”¨äº†fnä¸­çš„å˜é‡bï¼Œæ‰€ä»¥å‡½æ•°fnå¹¶ä¸ä¼šè¢«æ¸…é™¤ï¼Œè€Œæ˜¯ä¸€ç›´ä¿å­˜ç€å†…å­˜ä¸­ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•å¼•ç”¨ï¼Œæ‰ä¼šè¢«æ¸…é™¤ã€‚</p><p>ä»ä¸Šé¢çš„ğŸŒ°æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œé—­åŒ…æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><ul><li>é—­åŒ…å¯ä»¥ä½¿å¾—ç¨‹åºåœ¨å‡½æ•°å¤–éƒ¨å¯ä»¥è®¿é—®åˆ°å‡½æ•°å†…éƒ¨çš„å˜é‡</li><li>é—­åŒ…å¯ä»¥åœ¨å†…å­˜ä¸­ç»´æŒä¸€ä¸ªå˜é‡</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> i    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>    <span class="token keyword">return</span> array<span class="token punctuation">}</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span></code></pre><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœŸå¾…çš„ç»“æœå°±æ˜¯è¿”å›0å’Œ1,ä½†æ˜¯ç»“æœå‡ºäººæ„æ–™ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å…¶å®æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹arr[0]æ‰§è¡Œæ—¶ï¼Œå®ƒçš„scope chainï¼š</p><p><img src="http://cdn.yangkunxiao.cn/r0f77m.png" alt="scopes"></p><p>æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼Œæ­¤æ—¶arr[0]ä¸­å¹¶æ²¡æœ‰içš„å®šä¹‰ï¼Œå®ƒä¼šæ²¿ç€ä½œç”¨åŸŸé“¾å‘ä¸Šæ‰¾iï¼Œé‚£ä¹ˆå°±ä¼šæ‰¾åˆ°fnä¸­çš„iï¼Œä½†æ˜¯æ­¤æ—¶ï¼Œiå·²ç»å˜æˆ10äº†ã€‚</p><p>ä»æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼š</p><blockquote><p>JSçš„å‡½æ•°ä¸­çš„å˜é‡çš„å€¼ä¸æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ç¡®å®šçš„ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å†å»å¯»æ‰¾çš„ã€‚</p></blockquote><p>å¦‚æœæˆ‘ä»¬æƒ³è®©ä¸Šé¢çš„ğŸŒ°æŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„æ‰§è¡Œï¼Œé‚£ä¹ˆè€ƒè™‘ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//å‡½æ•°å‚æ•°çš„ä¼ é€’æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œä¼šåˆ›å»ºiçš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨å˜é‡i</span>      <span class="token keyword">return</span> num    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> array<span class="token punctuation">}</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨åŸç”ŸJavaScriptå®ç°callã€applyå’Œbind</title>
      <link href="/2019/11/21/JavaScript/change-this/"/>
      <url>/2019/11/21/JavaScript/change-this/</url>
      
        <content type="html"><![CDATA[<h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>åœ¨JavaScriptä¸­thisçš„æŒ‡å‘é—®é¢˜ä¸­æåˆ°ï¼Œä½œä¸ºå¯¹è±¡æ–¹æ³•çš„è°ƒç”¨ã€‚å‡½æ•°è¿˜å¯ä»¥ä½œä¸ºæŸä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿™æ—¶thiså°±æŒ‡è¿™ä¸ªä¸Šçº§å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„ï¼Œè°è°ƒç”¨ï¼Œthiså°±æŒ‡å‘è°ã€‚</p><blockquote><p>å®ç°æ–¹æ³•ï¼šåœ¨ä¼ å…¥çš„å‚æ•°ä¸­ä¼ å…¥ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œæœ€ååˆ é™¤è¯¥æ–¹æ³•ï¼ˆä¸ºäº†ä¿æŒå¯¹è±¡çš„å‰åä¸€è‡´æ€§ï¼‰ã€‚</p></blockquote><h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><pre class=" language-bash"><code class="language-bash">var obj <span class="token operator">=</span> <span class="token punctuation">{</span>    age <span class="token punctuation">;</span> 10<span class="token punctuation">}</span>var fn <span class="token operator">=</span> function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    this.value <span class="token operator">=</span> 100<span class="token punctuation">;</span><span class="token punctuation">}</span>/**å°†newCallç»‘å®šåœ¨Functionçš„åŸå‹ä¸Š context:ä¸Šä¸‹æ–‡ å³this<span class="token punctuation">..</span>.rest ES6è¯­æ³•ç³– ç”¨æ¥å–ä»£arguments*/Function.prototype.newCall <span class="token operator">=</span> function<span class="token punctuation">(</span>context,<span class="token punctuation">..</span>.rest<span class="token punctuation">)</span><span class="token punctuation">{</span>    if<span class="token punctuation">(</span> context instanceof Object <span class="token punctuation">)</span><span class="token punctuation">{</span>        context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span>    <span class="token punctuation">}</span>else<span class="token punctuation">{</span>        context <span class="token operator">=</span> Object.create<span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    //ä½¿ç”¨symbal é¿å…åŸæ¥çš„contextä¸Šæœ‰å‡½æ•°fn    const fn <span class="token operator">=</span> Symbal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span> <span class="token operator">=</span> this<span class="token punctuation">;</span>//æ­¤æ—¶this è°è°ƒç”¨ æŒ‡å‘è°    context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">..</span>.rest<span class="token punctuation">)</span><span class="token punctuation">;</span>//context è°ƒç”¨fn,æ”¹å˜thisæŒ‡å‘    delete context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">;</span>//åˆ é™¤fnå±æ€§ ä¿æŒåŸå¯¹è±¡çš„ç»Ÿä¸€<span class="token punctuation">}</span>var fun <span class="token operator">=</span> function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console.log<span class="token punctuation">(</span>this.age<span class="token punctuation">)</span><span class="token punctuation">;</span>//10    // fn.newCall<span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>    //console.log<span class="token punctuation">(</span>this.value<span class="token punctuation">)</span><span class="token punctuation">;</span> 100<span class="token punctuation">}</span>fun.newCall<span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><p>å’Œcallç±»ä¼¼ï¼Œåªæ˜¯ä¼ å‚çš„ä¸åŒï¼Œä¸å¤šè¯´ ï¼Œç›´æ¥ä¸Šä»£ç ï¼š </p><pre class=" language-bash"><code class="language-bash">Function.prototype.newCall <span class="token operator">=</span> function<span class="token punctuation">(</span>context,parames<span class="token punctuation">)</span><span class="token punctuation">{</span>    if<span class="token punctuation">(</span> context instanceof Object <span class="token punctuation">)</span><span class="token punctuation">{</span>        context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span>    <span class="token punctuation">}</span>else<span class="token punctuation">{</span>        context <span class="token operator">=</span> Object.create<span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    //ä½¿ç”¨symbal é¿å…åŸæ¥çš„contextä¸Šæœ‰å‡½æ•°fn    const fn <span class="token operator">=</span> Symbal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span> <span class="token operator">=</span> this<span class="token punctuation">;</span>//æ­¤æ—¶this è°è°ƒç”¨ æŒ‡å‘è°    context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">(</span>parames<span class="token punctuation">)</span><span class="token punctuation">;</span>//context è°ƒç”¨fn,æ”¹å˜thisæŒ‡å‘    delete context<span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">;</span>//åˆ é™¤fnå±æ€§ ä¿æŒåŸå¯¹è±¡çš„ç»Ÿä¸€<span class="token punctuation">}</span></code></pre><h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><p>bindå’Œcallã€applyçš„åŒºåˆ«ï¼Œè¿™é‡Œä¸å†å¤šåšèµ˜è¿°ã€‚ç›´æ¥ä¸Šä»£ç ï¼š</p><pre class=" language-bash"><code class="language-bash">Function.prototype.bind <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>context,<span class="token punctuation">..</span>.innerArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>  var self <span class="token operator">=</span> this  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">..</span>.finnalyArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> self.call<span class="token punctuation">(</span>context,<span class="token punctuation">..</span>.innerArgs,<span class="token punctuation">..</span>.finnalyArgs<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptåŸå‹ã€åŸå‹é“¾å’Œç»§æ‰¿</title>
      <link href="/2019/11/21/JavaScript/prototype/"/>
      <url>/2019/11/21/JavaScript/prototype/</url>
      
        <content type="html"><![CDATA[<h4 id="åŸå‹å¯¹è±¡"><a href="#åŸå‹å¯¹è±¡" class="headerlink" title="åŸå‹å¯¹è±¡"></a>åŸå‹å¯¹è±¡</h4><p>æ— è®ºæˆ‘ä»¬ä»€ä¹ˆæ—¶å€™åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå®ƒéƒ½ä¼šæœ‰ä¸€ä¸ªå±æ€§prototypeï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œè¯¥åŸå‹å¯¹è±¡æ‰€æ‹¥æœ‰çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯è¢«å‡½æ•°çš„å®ä¾‹æ‰€å…±äº«ã€‚ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>todo <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'todo'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> newFn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//æŸ¥çœ‹fnæ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newFn<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//'a'</span>newFn<span class="token punctuation">.</span><span class="token function">todo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ‰€æœ‰çš„åŸå‹å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨æ‹¥æœ‰ä¸€ä¸ªå±æ€§constructor(æ„é€ å‡½æ•°)ï¼Œè¿™ä¸ªå±æ€§åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆã€‚å³ï¼š</p><pre class=" language-javascript"><code class="language-javascript">fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> fn<span class="token punctuation">;</span></code></pre><blockquote><p>å½“è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹åï¼Œè¯¥å®ä¾‹çš„å†…éƒ¨å°†åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ˆå†…éƒ¨å±æ€§ï¼‰ï¼ŒæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚ECMA-262ç¬¬5ç‰ˆä¸­ç®¡è¿™ä¸ªæŒ‡é’ˆå«[[Prototype]]ã€‚è™½ç„¶åœ¨è„šæœ¬ä¸­æ²¡æœ‰æ ‡å‡†çš„æ–¹å¼è®¿é—®[[Prototype]]ï¼Œä½†Firefoxã€Safariå’ŒChromeåœ¨æ¯ä¸ªå¯¹è±¡ä¸Šéƒ½æ”¯æŒä¸€ä¸ªå±æ€§__proto__ï¼›è€Œåœ¨å…¶ä»–å®ç°ä¸­ï¼Œè¿™ä¸ªå±æ€§å¯¹è„šæœ¬åˆ™æ˜¯å®Œå…¨ä¸å¯è§çš„ã€‚â€”â€”JavaScripté«˜çº§ç¨‹åºè®¾è®¡</p></blockquote><p><img src="http://cdn.yangkunxiao.cn/prototype.png" alt=""></p><p>è¯¥å±æ€§æ˜¯å®ä¾‹å’Œæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œå’Œæ„é€ å‡½æ•°å¹¶æ— ç›´æ¥å…³è”ï¼Œå…¶å®å®ä¾‹ä¹‹æ‰€ä»¥å¯ä»¥è°ƒç”¨æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸Šé¢çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿæ˜¯é€šè¿‡è¯¥å±æ€§å®ç°çš„ã€‚</p><p>å°ç»“ï¼š</p><ul><li>æ‰€æœ‰çš„å¼•ç”¨ç±»å‹éƒ½å¯ä»¥è‡ªç”±çš„æ‰©å±•å…¶å±æ€§ï¼ˆé™¤nullï¼‰</li><li>æ‰€æœ‰çš„å¼•ç”¨ç±»å‹éƒ½æœ‰_proto_å±æ€§ï¼ˆé™¤nullï¼‰</li><li>æ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰prototypeå±æ€§</li><li>æ‰€æœ‰çš„å¼•ç”¨ç±»å‹çš„_proto_éƒ½æŒ‡å‘å®ƒä»¬çš„æ„é€ å‡½æ•°çš„prototype</li><li>å½“å¯»æ‰¾ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§æ—¶ï¼Œå¦‚æœåœ¨å½“å‰å¯¹è±¡æ‰¾ä¸åˆ°è¯¥å±æ€§çš„å®šä¹‰ï¼Œå°±ä¼šæ²¿ç€_proro_ä¸€ç›´å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢æˆ–è€…æ‰¾åˆ°Object.prototype(å³null)ä¸ºæ­¢ã€‚</li></ul><p>æ³¨æ„ï¼šå¤§å®¶å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œå‡½æ•°æ—¢æœ‰prototypeå±æ€§ï¼Œä¹Ÿæœ‰_proto_å±æ€§ã€‚ä¸‹é¢å°±é’ˆå¯¹å‡½æ•°åšä¸€ä¸ªè§£é‡Šï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> Fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'yellow'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>Fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>todo <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'todo'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> fn1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>fn1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//Fn.prototype</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>fn1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//Object.prototye</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>fn1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//null</span></code></pre><blockquote><p>è¯·è®°ä½ï¼šä¸€åˆ‡å¼•ç”¨ç±»å‹éƒ½æœ‰ä¸€ä¸ªéšå¼åŸå‹Object.prototypeã€‚</p></blockquote><p><img src="http://cdn.yangkunxiao.cn/scopeChain.jpeg" alt="åŸå‹é“¾"></p><h4 id="åŸå‹å¯¹è±¡çš„é—®é¢˜"><a href="#åŸå‹å¯¹è±¡çš„é—®é¢˜" class="headerlink" title="åŸå‹å¯¹è±¡çš„é—®é¢˜"></a>åŸå‹å¯¹è±¡çš„é—®é¢˜</h4><p>åŸå‹å¯¹è±¡æœ€å¤§çš„é—®é¢˜å°±æ˜¯å› å…¶å…±äº«æ€§æ‰€å¯¼è‡´çš„ã€‚çœ‹ä¸ªğŸŒ°ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//åŸå‹</span><span class="token keyword">var</span> Fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'yellow'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>Fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>todo <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'todo'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> fn1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fn1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fn2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ["red", "yellow", "blue"]</span></code></pre><h4 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸå‹å¯¹è±¡"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸå‹å¯¹è±¡" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸå‹å¯¹è±¡"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸå‹å¯¹è±¡</h4><p>é¦–å…ˆï¼Œçœ‹ä¸€æ®µä»£ç ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//æ–°å»ºä¸€ä¸ªæ„é€ å‡½æ•° </span><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">drink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'drink'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> Person<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>eat <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'eat'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>person<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«åœ¨Personå’ŒPerson.prototyeä¸ŠæŒ‚è½½äº† eat å’Œ drink å‡½æ•°ï¼Œç„¶åä½¿ç”¨ new å…³é”®å­—å¯¹æ„é€ å‡½æ•° Person è¿›è¡Œäº†å®ä¾‹åŒ–ã€‚</p><p>å¯¹äº drink å‡½æ•°ï¼šæ¯è¿›è¡Œä¸€æ¬¡å®ä¾‹åŒ–ï¼Œéƒ½è¦é‡æ–°åœ¨å†…å­˜ä¸­å ç”¨ä¸€äº›èµ„æºã€‚</p><p>å¯¹äº eat å‡½æ•°ï¼šæˆ‘ä»¬å°† eat å‡½æ•°æŒ‚è½½åœ¨ Person çš„åŸå‹ä¸Šï¼ŒPerson çš„å®ä¾‹æ¯æ¬¡åªéœ€è¦è°ƒç”¨åŸå‹ä¸Šçš„æ–¹æ³•å³å¯ï¼ŒèŠ‚çº¦äº†å†…å­˜å ç”¨ã€‚</p><h4 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h4><p>ECMAScriptä¸­å®ç°ç»§æ‰¿çš„ä¸»è¦å°±æ˜¯ä¾é åŸå‹é“¾æ¥å®ç°çš„ã€‚</p><h4 id="åŸå‹é“¾ç»§æ‰¿"><a href="#åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿"></a>åŸå‹é“¾ç»§æ‰¿</h4><p>æœ€ä¸ºECMAScriptæœ€ä¸»è¦çš„ç»§æ‰¿æ–¹æ³•ï¼Œå…¶åŸºæœ¬æ€æƒ³å°±æ˜¯è®©ä¸€ä¸ªå¼•ç”¨ç±»å‹ç»§æ‰¿å¦ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ï¼Œæ¯ä¸€ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆconstructorï¼Œæ¯ä¸€ä¸ªæ„é€ å‡½æ•°éƒ½å¯ä»¥ç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œæ¯ä¸€ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘åŸå‹å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆ_proto_ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> Fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> Test <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Fn<span class="token punctuation">;</span>fn<span class="token punctuation">.</span>_proto_ <span class="token operator">=</span><span class="token operator">></span> Fn<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span></code></pre><p>å¦‚æœæ­¤æ—¶æˆ‘ä»¬è®©ä¸€ä¸ªFnçš„åŸå‹å¯¹è±¡æŒ‡å‘å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹å‘¢ï¼Ÿ</p><pre><code>Fn.prototype = new Test();</code></pre><p>é‚£ä¹ˆæ­¤æ—¶ï¼ŒåŸå‹å¯¹è±¡å°±ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªåŸå‹çš„æŒ‡é’ˆï¼Œå¦ä¸€ä¸ªåŸå‹ä¹Ÿä¼šåŒ…å«ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªæ„é€ å‡½æ•°çš„æŒ‡é’ˆã€‚å¦‚æ­¤å±‚å±‚é€’è¿›ï¼Œå³æ„æˆäº†åŸå‹é“¾ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span>SuperType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>Fun <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//ç»§æ‰¿äº†SuperType</span>SubType<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//"red,blue,green,black"</span><span class="token keyword">var</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//"red,blue,green,black"</span></code></pre><blockquote><p>ä¼˜ç‚¹ï¼šå¯ä»¥é€šè¿‡ instanceOf å’Œ isPrototypeOf æ£€æµ‹</p><p>ç¼ºç‚¹ï¼š</p><p>1ã€çˆ¶ç±»å‹ä¸­çš„ç§æœ‰å±æ€§ä¼šå˜ä¸ºå­ç±»å‹ä¸­çš„å…¬æœ‰å±æ€§</p><p>2ã€åˆ›å»ºå­ç±»å‹çš„æ—¶å€™ï¼Œä¸èƒ½åƒçˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ä¸­ä¼ é€’å‚æ•°ã€‚</p></blockquote><h4 id="æ„é€ å‡½æ•°ç»§æ‰¿"><a href="#æ„é€ å‡½æ•°ç»§æ‰¿" class="headerlink" title="æ„é€ å‡½æ•°ç»§æ‰¿"></a>æ„é€ å‡½æ•°ç»§æ‰¿</h4><blockquote><p>JavaScriptè§„å®šï¼Œæ¯ä¸€ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªprototypeå±æ€§ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­çš„æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•éƒ½ä¼šè¢«æ„é€ å‡½æ•°çš„å®ä¾‹æ‰€ç»§æ‰¿ã€‚</p></blockquote><p>æ„é€ å‡½æ•°çš„ç»§æ‰¿æ˜¯é€šè¿‡newå…³é”®å­—ï¼Œç”Ÿæˆå®ä¾‹å®Œæˆçš„ã€‚ä½¿ç”¨newå…³é”®å­—ç”Ÿæˆå®ä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šæŠŠthisç»‘å®šåˆ°å®ä¾‹ä¸Šï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>åœ¨å†…å­˜ä¸­å…ˆç”Ÿæˆä¸€ä¸ªobjectçš„å®ä¾‹å¯¹è±¡ï¼Œ</p></li><li><p>å°†å®ä¾‹å¯¹è±¡çš„_proto_æŒ‡å‘æ„é€ å‡½æ•°çš„prototypeï¼ˆå³æ„é€ å‡½æ•°çš„åŸå‹ï¼‰ï¼Œ</p></li><li><p>è¿è¡Œæ„é€ å‡½æ•°ï¼Œ</p></li><li><p>æ£€æŸ¥è¿”å›å€¼ï¼Œå¦‚æœè¿”å›å€¼ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™æ— è§†è¯¥è¿”å›å€¼ï¼Œè€Œå°†ç”Ÿæˆçš„å¯¹è±¡è¿”å›ã€‚å¦‚æœä¸ºå¼•ç”¨ç±»å‹ï¼Œåˆ™å°†è¯¥è¿”å›å€¼è¿”å›ã€‚</p></li></ol><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>SuperType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">'ykx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subtype</span><span class="token punctuation">(</span><span class="token string">'lhd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span></code></pre><blockquote><p>ä¼˜ç‚¹ï¼š</p><p>1ã€å®ä¾‹åŒ–å­ç±»å‹çš„æ—¶å€™å¯ä»¥ä¼ å‚</p><p>2ã€çˆ¶ç±»å‹ä¸­çš„å±æ€§ä¸ä¼šå˜ä¸ºå…¬å…±çš„å±æ€§</p><p>ç¼ºç‚¹ï¼šè™½ç„¶æ„é€ å‡½æ•°å®ç°ç»§æ‰¿çš„æ–¹å¼æ¯”è¾ƒå¥½ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ã€‚æ„é€ å‡½æ•°ç»§æ‰¿å­˜åœ¨å†…å­˜æµªè´¹çš„æƒ…å†µï¼Œæ¯ç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œéƒ½ä¼šå ç”¨ä¸€äº›å†…å­˜ã€‚</p></blockquote><h4 id="å¯„ç”Ÿå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿå¼ç»§æ‰¿"></a>å¯„ç”Ÿå¼ç»§æ‰¿</h4><p>å¯„ç”Ÿå¼ç»§æ‰¿æœ‰ç‚¹ç±»ä¼¼ä¸å·¥å‚æ¨¡å¼ï¼Œå³ä»…åˆ›å»ºä¸€ä¸ªå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨æŸç§æ–¹å¼å¢å¼ºå¯¹è±¡ï¼Œæœ€åå†è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">inhertprototype</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> child <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">creata</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>child<span class="token punctuation">.</span>say <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> child<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token keyword">var</span> boy <span class="token operator">=</span> <span class="token function">inhertprototype</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span>boy<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ä¸ºå¯¹è±¡æ·»åŠ å‡½æ•°ï¼Œä¸èƒ½å¤Ÿä½¿å‡½æ•°å¾—åˆ°æ›´å¤šçš„å¤ç”¨ï¼Œé™ä½äº†æ•ˆç‡ï¼Œç±»ä¼¼äºæ„é€ å‡½æ•°ã€‚</p><h4 id="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"></a>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Man</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>eat <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>something<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token string">'å²çš„'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'æ­£åœ¨åƒ: '</span> <span class="token operator">+</span> something<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>Man<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>drink <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>something<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'æ­£åœ¨å–:'</span> <span class="token operator">+</span> something<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Boy</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>Man<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>age<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç»„åˆç»§æ‰¿</span><span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/**ä¸æ¨èä½¿ç”¨ Boy.prototype = new Man();//ç»„åˆç»§æ‰¿å› ä¸ºåœ¨JavaScriptä¸­æ²¡æœ‰æ˜¾å¼çš„constructorï¼Œæ‰€ä»¥ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–çš„æ—¶å€™ è¯¥å‡½æ•°ä¼šè¢«è°ƒç”¨ä¸€æ¬¡*/</span><span class="token keyword">function</span> inhertprototype <span class="token punctuation">(</span>child<span class="token punctuation">,</span>parent<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> child<span class="token punctuation">;</span>child<span class="token punctuation">.</span>prototype <span class="token operator">=</span> prototype<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//Boy.prototype = Object.create(Man.prototype);</span><span class="token comment" spellcheck="true">//Boy.prototype.constructor = Boy;//é¿å…åŸå‹é”™ä¹±</span><span class="token function">inhertprototype</span><span class="token punctuation">(</span>Boy<span class="token punctuation">,</span>Man<span class="token punctuation">)</span><span class="token keyword">var</span> boy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boy</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">'ykx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>boy<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>boy<span class="token punctuation">.</span><span class="token function">drink</span><span class="token punctuation">(</span><span class="token string">'water'</span><span class="token punctuation">)</span></code></pre><p>åŸå‹é”™ä¹±ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>SuperType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span>Sub<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>SuperType<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20191113175800937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI1MTM0NzIx,size_16,color_FFFFFF,t_70" alt="åŸå‹é”™ä¹±"></p><p>æ­£ç¡®çš„ç»§æ‰¿ç»“æœåº”è¯¥å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20191113175921976.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI1MTM0NzIx,size_16,color_FFFFFF,t_70" alt="åŸå‹æ­£å¸¸"></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptæ•°æ®ç±»å‹</title>
      <link href="/2019/11/21/JavaScript/dataType/"/>
      <url>/2019/11/21/JavaScript/dataType/</url>
      
        <content type="html"><![CDATA[<p>JavaScriptä¸­æœ‰ä¸€ä¸‹ä¸ƒç§æ•°æ®ç±»å‹ï¼šNumberã€Stringã€Nullã€Undefinedã€Boolã€Objectä»¥åŠSymbalã€‚</p><h4 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h4><p>Numberã€Stringã€Nullã€Undefinedã€Boolã€‚<br>JavaScriptçš„åŸºæœ¬æ•°æ®ç±»å‹çš„è®¿é—®æ˜¯æŒ‰å€¼è®¿é—®çš„ï¼Œå› ä¸ºåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æ˜¯ä¿å­˜åœ¨æ ˆä¸­çš„ã€‚</p><h4 id="å¼•ç”¨æ•°æ®ç±»å‹"><a href="#å¼•ç”¨æ•°æ®ç±»å‹" class="headerlink" title="å¼•ç”¨æ•°æ®ç±»å‹"></a>å¼•ç”¨æ•°æ®ç±»å‹</h4><p>Objectã€Functionã€Arrayç­‰ã€‚<br>JavaScriptçš„å¼•ç”¨æ•°æ®ç±»å‹çš„è®¿é—®æ˜¯æŒ‰å¼•ç”¨è®¿é—®çš„ï¼Œå¼•ç”¨æ•°æ®ç±»å‹çš„å€¼æ˜¯å­˜æ”¾åœ¨æ ˆå’Œå †ä¸­çš„ï¼šæŒ‡é’ˆå­˜æ”¾åœ¨æ ˆä¸­ï¼Œå€¼å­˜æ”¾åœ¨å †ä¸­ã€‚æ ˆåŒºå†…å­˜ä¿å­˜å˜é‡æ ‡è¯†ç¬¦å’ŒæŒ‡å‘å †å†…å­˜ä¸­è¯¥å¯¹è±¡çš„æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯è¯¥å¯¹è±¡åœ¨å †å†…å­˜çš„åœ°å€ã€‚</p><h4 id="æ•°æ®ç±»å‹çš„åŒºåˆ†"><a href="#æ•°æ®ç±»å‹çš„åŒºåˆ†" class="headerlink" title="æ•°æ®ç±»å‹çš„åŒºåˆ†"></a>æ•°æ®ç±»å‹çš„åŒºåˆ†</h4><ol><li>typeof æ£€æŸ¥</li></ol><pre class=" language-bash"><code class="language-bash">typeof   123ã€€ã€€ //Numbertypeof   <span class="token string">'abc'</span>ã€€ã€€//Stringtypeof    <span class="token boolean">true</span>       //Booleantypeof    undefined   //Undefinedtypeof    null        //Object     typeof    <span class="token punctuation">{</span> <span class="token punctuation">}</span>           //Objecttypeof    <span class="token punctuation">[</span> <span class="token punctuation">]</span>           //Objecttypeof    console.log<span class="token punctuation">(</span><span class="token punctuation">)</span>       //Function</code></pre><p>å¯ä»¥çœ‹å‡º typeof æ˜¯æ£€æŸ¥ä¸å‡ºæ¥ nullã€{} ã€[] çš„ã€‚<br>æ¨èä½¿ç”¨ä¸€ä¸‹æ–¹æ³•ï¼š</p><pre class=" language-bash"><code class="language-bash">åˆ¤æ–­åŸºæœ¬ç±»å‹ï¼šObject.prototype.toString.call<span class="token punctuation">(</span>null<span class="token punctuation">)</span> //<span class="token string">"[object Null]"</span>Object.prototype.toString.call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> //<span class="token string">"[object Array]"</span>Object.prototype.toString.call<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> //<span class="token string">"[object Object]"</span>Object.prototype.toString.call<span class="token punctuation">(</span>123<span class="token punctuation">)</span> //<span class="token string">"[object Number]"</span>Object.prototype.toString.call<span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span> //<span class="token string">"[object String]"</span>Object.prototype.toString.call<span class="token punctuation">(</span>undefined<span class="token punctuation">)</span> //<span class="token string">"[object Undefined]"</span>Object.prototype.toString.call<span class="token punctuation">(</span>true<span class="token punctuation">)</span> //<span class="token string">"[object Boolean]"</span>åˆ¤æ–­å¼•ç”¨ç±»å‹ï¼šFunction fn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console.log<span class="token punctuation">(</span>â€œtestâ€<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>Object.prototype.toString.call<span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>//<span class="token string">"[object Function]"</span>var <span class="token function">date</span> <span class="token operator">=</span> new Date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Object.prototype.toString.call<span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>//<span class="token string">"[object Date]"</span>var reg <span class="token operator">=</span> /<span class="token punctuation">[</span>hbc<span class="token punctuation">]</span>at/gi<span class="token punctuation">;</span>Object.prototype.toString.call<span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>//<span class="token string">"[object RegExp]"</span></code></pre><h4 id="æ•°æ®åŒ…è£…ç±»å‹"><a href="#æ•°æ®åŒ…è£…ç±»å‹" class="headerlink" title="æ•°æ®åŒ…è£…ç±»å‹"></a>æ•°æ®åŒ…è£…ç±»å‹</h4><p>æ•°æ®åŒ…è£…ç±»å‹åŒ…å«ï¼šNumberã€Stringã€Booleanã€‚æ•°æ®åŒ…è£…ç±»å‹æ˜¯ç‰¹æ®Šçš„å¼•ç”¨ç±»å‹ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨åå°åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ•°æ®åŒ…è£…ç±»å‹å¯¹è±¡ï¼Œç”¨æ¥ä½¿åŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥è®¿é—®å¯¹è±¡ä¸Šçš„æ–¹æ³•å’Œå±æ€§ã€‚<br>ä¸¾ä¸ªğŸŒ°ï¼š</p><pre class=" language-bash"><code class="language-bash">var str <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>str.split<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//åå°åˆ›å»ºå¯¹åº”çš„æ•°æ®åŒ…è£…ç±»å‹var str <span class="token operator">=</span> new String<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>//åˆ›å»ºstrå¯¹è±¡str.split<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//æ‰§è¡Œæ–¹æ³•str <span class="token operator">=</span> null//é”€æ¯str</code></pre><p>è€Œä¸”ï¼Œé€šè¿‡æ„é€ å‡½æ•°å’Œå¯¹è±¡å­—é¢é‡åˆ›å»ºçš„å¯¹è±¡æ˜¯ä¸ä¸€æ ·çš„ï¼š</p><pre class=" language-bash"><code class="language-bash">var str <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>typeof str // stringvar str1 <span class="token operator">=</span> new String<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>typeof str1 // object</code></pre><p>å…¶ä»–çš„ Boolean å’Œ Number ä¹Ÿå’Œ String ç±»ä¼¼ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨Object-prototype-toString-call"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨Object-prototype-toString-call" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨Object.prototype.toString.call()?"></a>ä¸ºä»€ä¹ˆä½¿ç”¨Object.prototype.toString.call()?</h4><p>å› ä¸ºtoStringæ–¹æ³•æ˜¯ObjectåŸå‹ä¸Šçš„æ–¹æ³•ï¼Œè€ŒArrayã€functionç­‰ç±»å‹ä½œä¸ºObjectçš„å®ä¾‹ï¼Œéƒ½é‡å†™äº†toStringæ–¹æ³•ã€‚ä¸åŒçš„å¯¹è±¡çš„è°ƒç”¨toStringæ–¹æ³•çš„æ—¶å€™ï¼Œè°ƒç”¨çš„éƒ½æ˜¯é‡å†™çš„toStringæ–¹æ³•ï¼Œè€Œä¸æ˜¯ObjectåŸå‹é“¾ä¸Šçš„æ–¹æ³•ã€‚æ‰€ä»¥å¦‚æœè¦å¾—åˆ°å¯¹è±¡çš„å…·ä½“çš„ç±»å‹ï¼Œéœ€è¦è°ƒç”¨ObjectåŸå‹ä¸Šçš„toStringæ–¹æ³•ï¼Œå³ä½¿ç”¨callå°†toStringçš„thisæŒ‡å‘æ”¹å˜ã€‚</p><pre class=" language-bash"><code class="language-bash">var fun <span class="token operator">=</span> function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    alert<span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console.log<span class="token punctuation">(</span>fun.toString<span class="token punctuation">(</span><span class="token punctuation">))</span>//è¿”å›çš„æ˜¯ å‡½æ•°çš„å­—ç¬¦ä¸²å½¢å¼delete Function.prototype.toString<span class="token punctuation">;</span>console.log<span class="token punctuation">(</span>fun.toString<span class="token punctuation">(</span><span class="token punctuation">))</span>// è¿”å›çš„æ˜¯<span class="token punctuation">[</span>object Function<span class="token punctuation">]</span></code></pre><p>å› ä¸ºåˆ é™¤äº†Function.prototypeä¸Šçš„toStringæ–¹æ³•ä¹‹åï¼Œæ ¹æ®åŸå‹é“¾ï¼Œå®ƒä¼šæ²¿ç€åŸå‹é“¾æŸ¥æ‰¾åˆ°Object.prototype.toStringæ–¹æ³•</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³å¤šå›¾ç‰‡å‹ç¼©ä¸Šä¼ å’ŒiOSç«¯å›¾ç‰‡ä¸Šä¼ é€‰æ‹©90åº¦çš„é—®é¢˜</title>
      <link href="/2019/11/20/JavaScript/multiImageUpload/"/>
      <url>/2019/11/20/JavaScript/multiImageUpload/</url>
      
        <content type="html"><![CDATA[<p>é€»è¾‘æ€è·¯ï¼š<br>1ã€ç›‘å¬inputæ–‡ä»¶å€¼çš„changeäº‹ä»¶<br>2ã€è·å–æ–‡ä»¶åˆ—è¡¨<br>3ã€ä½¿ç”¨FileReader()å‡½æ•°è¯»å–å›¾ç‰‡ä¿¡æ¯ï¼Œå¹¶è½¬ä¸ºbase64æ ¼å¼<br>4ã€æ ¹æ®é¢„è®¾çš„é˜€å€¼ï¼Œåˆ¤æ–­æ˜¯å¦å‹ç¼©<br>5ã€å¦‚æœä¸å‹ç¼©ï¼Œå°†å›¾ç‰‡è½¬ä¸ºblobæ ¼å¼ï¼Œä½¿ç”¨FormData()å‡½æ•°ï¼Œä¸Šä¼ å›¾ç‰‡<br>6ã€å¦‚æœå‹ç¼©å›¾ç‰‡ï¼Œä½¿ç”¨canvasé‡æ–°ç»˜åˆ¶å›¾ç‰‡ï¼Œæ ¹æ®éœ€è¦ï¼Œé€‰æ‹©æ˜¯å¦ä½¿ç”¨ç“¦ç‰‡canvas<br>7ã€ä½¿ç”¨Exif.jsï¼Œè·å–å›¾ç‰‡æ–¹å‘ä¿¡æ¯ï¼Œç¡®å®šæ˜¯å¦éœ€è¦ä½¿ç”¨canvasçš„rotate()å‡½æ•°è¿›è¡Œæ—‹è½¬å›¾ç‰‡<br>8ã€ä¸Šä¼ å›¾ç‰‡</p><h4 id="è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼š"><a href="#è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼š" class="headerlink" title="è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼š"></a>è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼š</h4><pre class=" language-bash"><code class="language-bash">//æ¨è<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">'file'</span> id<span class="token operator">=</span><span class="token string">'upload'</span> accept<span class="token operator">=</span><span class="token string">'image/gif,image/jpeg,image/png,image/jpg'</span> @change<span class="token operator">=</span><span class="token string">'upload'</span> <span class="token operator">></span>//ä¸æ¨èä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹æ³•ï¼Œè¯¥å½¢å¼åœ¨Chromeæµè§ˆå™¨ä¸­ï¼Œé€‰æ‹©æ–‡ä»¶å¼¹æ¡†ä¼šæ»ç•™ä¸€æ®µæ—¶é—´æ‰å¼¹å‡º<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">'file'</span> name<span class="token operator">=</span><span class="token string">'file'</span> class<span class="token operator">=</span><span class="token string">'element'</span> accept<span class="token operator">=</span><span class="token string">'image/*'</span><span class="token operator">></span></code></pre><h4 id="å¼•å…¥exif-js"><a href="#å¼•å…¥exif-js" class="headerlink" title="å¼•å…¥exif.js"></a>å¼•å…¥exif.js</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">import</span> Exif from <span class="token string">'exif-js'</span></code></pre><h4 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h4><pre class=" language-bash"><code class="language-bash">upload<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> files <span class="token operator">=</span> e.target.files <span class="token operator">||</span> e.dataTransfer.files<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>files.length<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    this.picValue <span class="token operator">=</span> files<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">;</span>    this.imgPreview<span class="token punctuation">(</span>this.picValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>,//å›¾ç‰‡é¢„è§ˆã€å¤„ç†ã€ä¸Šä¼ imgPreview<span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> self <span class="token operator">=</span> this<span class="token punctuation">;</span>    <span class="token keyword">let</span> Orientation<span class="token punctuation">;</span>    //å»è·å–æ‹ç…§æ—¶çš„ä¿¡æ¯ï¼Œè§£å†³æ‹å‡ºæ¥çš„ç…§ç‰‡æ—‹è½¬é—®é¢˜    Exif.getData<span class="token punctuation">(</span>file, function<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Orientation <span class="token operator">=</span> Exif.getTag<span class="token punctuation">(</span>this, <span class="token string">'Orientation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    // alert<span class="token punctuation">(</span>Orientation,<span class="token string">'console.log(Orientation)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    debugger    // çœ‹æ”¯æŒä¸æ”¯æŒFileReader    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file <span class="token operator">||</span> <span class="token operator">!</span>window.FileReader<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    // alert<span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>    // åˆ›å»ºä¸€ä¸ªreader    <span class="token keyword">let</span> reader <span class="token operator">=</span> new FileReader<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    // å°†å›¾ç‰‡2å°†è½¬æˆ base64 æ ¼å¼    reader.readAsDataURL<span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>    // è¯»å–æˆåŠŸåçš„å›è°ƒ    reader.onloadend <span class="token operator">=</span> function<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> this.result<span class="token punctuation">;</span>        <span class="token keyword">let</span> img <span class="token operator">=</span> new Image<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        img.onload <span class="token operator">=</span> function<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> data <span class="token operator">=</span> self.compress<span class="token punctuation">(</span>img, Orientation<span class="token punctuation">)</span><span class="token punctuation">;</span>            /*self.headerImage <span class="token operator">=</span> data<span class="token punctuation">;</span>  */            var blob <span class="token operator">=</span> self.dataURItoBlob<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            var fd <span class="token operator">=</span> new FormData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            fd.append<span class="token punctuation">(</span><span class="token string">"file"</span>, blob, <span class="token string">'image.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            fd.fileName <span class="token operator">=</span> blob<span class="token punctuation">;</span>            console.log<span class="token punctuation">(</span>fd, <span class="token string">'fd'</span><span class="token punctuation">)</span>            axios.post<span class="token punctuation">(</span><span class="token string">'/sunrise-gateway/oss/ossUpload'</span>, fd<span class="token punctuation">)</span>.then<span class="token punctuation">((</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> res            <span class="token punctuation">}</span><span class="token punctuation">)</span>.then<span class="token punctuation">((</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                console.log<span class="token punctuation">(</span>res, <span class="token string">'res'</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>res.data.code <span class="token operator">==</span> <span class="token string">'000000'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    self.list.push<span class="token punctuation">(</span><span class="token punctuation">..</span>.res.data.data<span class="token punctuation">)</span><span class="token punctuation">;</span>                    self.objUrl <span class="token operator">=</span> res.data.data<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">;</span>                    self.picNum++<span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    MessageBox.alert<span class="token punctuation">(</span><span class="token string">'ä¸Šä¼ å¤±è´¥0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                Indicator.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>.catch<span class="token punctuation">((</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                Indicator.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                MessageBox.alert<span class="token punctuation">(</span><span class="token string">'ä¸Šä¼ å¤±è´¥1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            // alert<span class="token punctuation">(</span>blob<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        img.src <span class="token operator">=</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>,//base64è½¬blobdataURItoBlob<span class="token punctuation">(</span>base64Data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    var byteString<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>base64Data.split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span>.indexOf<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span> <span class="token operator">>=</span> 0<span class="token punctuation">)</span> <span class="token punctuation">{</span>        byteString <span class="token operator">=</span> atob<span class="token punctuation">(</span>base64Data.split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        byteString <span class="token operator">=</span> unescape<span class="token punctuation">(</span>base64Data.split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    var mimeString <span class="token operator">=</span> base64Data.split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span>.split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span>.split<span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">;</span>    var ia <span class="token operator">=</span> new Uint8Array<span class="token punctuation">(</span>byteString.length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>var i <span class="token operator">=</span> 0<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> byteString.length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ia<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> byteString.charCodeAt<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> new Blob<span class="token punctuation">(</span><span class="token punctuation">[</span>ia<span class="token punctuation">]</span>, <span class="token punctuation">{</span>        type: mimeString    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>,//å›¾ç‰‡æ—‹è½¬rotateImg<span class="token punctuation">(</span>img, direction, canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span>    //æœ€å°ä¸æœ€å¤§æ—‹è½¬æ–¹å‘ï¼Œå›¾ç‰‡æ—‹è½¬4æ¬¡åå›åˆ°åŸæ–¹å‘    const min_step <span class="token operator">=</span> 0<span class="token punctuation">;</span>    const max_step <span class="token operator">=</span> 3<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>img <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    //imgçš„é«˜åº¦å’Œå®½åº¦ä¸èƒ½åœ¨imgå…ƒç´ éšè—åè·å–ï¼Œå¦åˆ™ä¼šå‡ºé”™    <span class="token keyword">let</span> height <span class="token operator">=</span> img.height<span class="token punctuation">;</span>    <span class="token keyword">let</span> width <span class="token operator">=</span> img.width<span class="token punctuation">;</span>    <span class="token keyword">let</span> step <span class="token operator">=</span> 2<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>step <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        step <span class="token operator">=</span> min_step<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> <span class="token string">'right'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        step++<span class="token punctuation">;</span>        //æ—‹è½¬åˆ°åŸä½ç½®ï¼Œå³è¶…è¿‡æœ€å¤§å€¼        step <span class="token operator">></span> max_step <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>step <span class="token operator">=</span> min_step<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        step--<span class="token punctuation">;</span>        step <span class="token operator">&lt;</span> min_step <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>step <span class="token operator">=</span> max_step<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    //æ—‹è½¬è§’åº¦ä»¥å¼§åº¦å€¼ä¸ºå‚æ•°    <span class="token keyword">let</span> degree <span class="token operator">=</span> step * 90 * Math.PI / 180<span class="token punctuation">;</span>    <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas.getContext<span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    switch <span class="token punctuation">(</span>step<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> 0:            canvas.width <span class="token operator">=</span> width<span class="token punctuation">;</span>            canvas.height <span class="token operator">=</span> height<span class="token punctuation">;</span>            ctx.drawImage<span class="token punctuation">(</span>img, 0, 0<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> 1:            canvas.width <span class="token operator">=</span> height<span class="token punctuation">;</span>            canvas.height <span class="token operator">=</span> width<span class="token punctuation">;</span>            ctx.rotate<span class="token punctuation">(</span>degree<span class="token punctuation">)</span><span class="token punctuation">;</span>            ctx.drawImage<span class="token punctuation">(</span>img, 0, -height<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> 2:            canvas.width <span class="token operator">=</span> width<span class="token punctuation">;</span>            canvas.height <span class="token operator">=</span> height<span class="token punctuation">;</span>            ctx.rotate<span class="token punctuation">(</span>degree<span class="token punctuation">)</span><span class="token punctuation">;</span>            ctx.drawImage<span class="token punctuation">(</span>img, -width, -height<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> 3:            canvas.width <span class="token operator">=</span> height<span class="token punctuation">;</span>            canvas.height <span class="token operator">=</span> width<span class="token punctuation">;</span>            ctx.rotate<span class="token punctuation">(</span>degree<span class="token punctuation">)</span><span class="token punctuation">;</span>            ctx.drawImage<span class="token punctuation">(</span>img, -width, 0<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>,//å›¾ç‰‡å‹ç¼©compress<span class="token punctuation">(</span>img, Orientation<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document.createElement<span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas.getContext<span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    //ç“¦ç‰‡canvas    <span class="token keyword">let</span> tCanvas <span class="token operator">=</span> document.createElement<span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> tctx <span class="token operator">=</span> tCanvas.getContext<span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> initSize <span class="token operator">=</span> img.src.length<span class="token punctuation">;</span>    <span class="token keyword">let</span> width <span class="token operator">=</span> img.width<span class="token punctuation">;</span>    <span class="token keyword">let</span> height <span class="token operator">=</span> img.height<span class="token punctuation">;</span>    //å¦‚æœå›¾ç‰‡å¤§äºå››ç™¾ä¸‡åƒç´ ï¼Œè®¡ç®—å‹ç¼©æ¯”å¹¶å°†å¤§å°å‹è‡³400ä¸‡ä»¥ä¸‹    <span class="token keyword">let</span> ratio<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">((</span>ratio <span class="token operator">=</span> width * height / 4000000<span class="token punctuation">)</span> <span class="token operator">></span> 1<span class="token punctuation">)</span> <span class="token punctuation">{</span>        // console.log<span class="token punctuation">(</span><span class="token string">'å¤§äº400ä¸‡åƒç´ '</span><span class="token punctuation">)</span>        ratio <span class="token operator">=</span> Math.sqrt<span class="token punctuation">(</span>ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>        width /<span class="token operator">=</span> ratio<span class="token punctuation">;</span>        height /<span class="token operator">=</span> ratio<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        ratio <span class="token operator">=</span> 1<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    canvas.width <span class="token operator">=</span> width<span class="token punctuation">;</span>    canvas.height <span class="token operator">=</span> height<span class="token punctuation">;</span>    //é“ºåº•è‰²    ctx.fillStyle <span class="token operator">=</span> <span class="token string">'#fff'</span><span class="token punctuation">;</span>    ctx.fillRect<span class="token punctuation">(</span>0, 0, canvas.width, canvas.height<span class="token punctuation">)</span><span class="token punctuation">;</span>    //å¦‚æœå›¾ç‰‡åƒç´ å¤§äº100ä¸‡åˆ™ä½¿ç”¨ç“¦ç‰‡ç»˜åˆ¶    <span class="token keyword">let</span> count<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">((</span>count <span class="token operator">=</span> width * height / 1000000<span class="token punctuation">)</span> <span class="token operator">></span> 1<span class="token punctuation">)</span> <span class="token punctuation">{</span>        // console.log<span class="token punctuation">(</span><span class="token string">'è¶…è¿‡100Wåƒç´ '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        count <span class="token operator">=</span> ~~<span class="token punctuation">(</span>Math.sqrt<span class="token punctuation">(</span>count<span class="token punctuation">)</span> + 1<span class="token punctuation">)</span><span class="token punctuation">;</span> //è®¡ç®—è¦åˆ†æˆå¤šå°‘å—ç“¦ç‰‡        //è®¡ç®—æ¯å—ç“¦ç‰‡çš„å®½å’Œé«˜        <span class="token keyword">let</span> nw <span class="token operator">=</span> ~~<span class="token punctuation">(</span>width / count<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> nh <span class="token operator">=</span> ~~<span class="token punctuation">(</span>height / count<span class="token punctuation">)</span><span class="token punctuation">;</span>        tCanvas.width <span class="token operator">=</span> nw<span class="token punctuation">;</span>        tCanvas.height <span class="token operator">=</span> nh<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> 0<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>let j <span class="token operator">=</span> 0<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> j++<span class="token punctuation">)</span> <span class="token punctuation">{</span>                tctx.drawImage<span class="token punctuation">(</span>img, i * nw * ratio, j * nh * ratio, nw * ratio, nh * ratio, 0, 0, nw, nh<span class="token punctuation">)</span><span class="token punctuation">;</span>                ctx.drawImage<span class="token punctuation">(</span>tCanvas, i * nw, j * nh, nw, nh<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        ctx.drawImage<span class="token punctuation">(</span>img, 0, 0, width, height<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    //ä¿®å¤iosä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™ è¢«æ—‹è½¬çš„é—®é¢˜    <span class="token keyword">if</span> <span class="token punctuation">(</span>Orientation <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> Orientation <span class="token operator">!=</span> 1<span class="token punctuation">)</span> <span class="token punctuation">{</span>        switch <span class="token punctuation">(</span>Orientation<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> 6: //éœ€è¦é¡ºæ—¶é’ˆï¼ˆå‘å·¦ï¼‰90åº¦æ—‹è½¬                this.rotateImg<span class="token punctuation">(</span>img, <span class="token string">'left'</span>, canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> 8: //éœ€è¦é€†æ—¶é’ˆï¼ˆå‘å³ï¼‰90åº¦æ—‹è½¬                this.rotateImg<span class="token punctuation">(</span>img, <span class="token string">'right'</span>, canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> 3: //éœ€è¦180åº¦æ—‹è½¬                this.rotateImg<span class="token punctuation">(</span>img, <span class="token string">'right'</span>, canvas<span class="token punctuation">)</span><span class="token punctuation">;</span> //è½¬ä¸¤æ¬¡                this.rotateImg<span class="token punctuation">(</span>img, <span class="token string">'right'</span>, canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    //è¿›è¡Œæœ€å°å‹ç¼©        <span class="token keyword">let</span> ndata <span class="token operator">=</span> canvas.toDataURL<span class="token punctuation">(</span><span class="token string">'image/jpeg'</span>, 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>    tCanvas.width <span class="token operator">=</span> tCanvas.height <span class="token operator">=</span> canvas.width <span class="token operator">=</span> canvas.height <span class="token operator">=</span> 0<span class="token punctuation">;</span>    <span class="token keyword">return</span> ndata<span class="token punctuation">;</span><span class="token punctuation">}</span>,</code></pre><p>å¤‡æ³¨ï¼š<br>canvas.toDataURL() æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«å›¾ç‰‡å±•ç¤ºçš„ data URI ã€‚å¯ä»¥ä½¿ç”¨ type å‚æ•°å…¶ç±»å‹ï¼Œé»˜è®¤ä¸º image/png æ ¼å¼ã€‚å›¾ç‰‡çš„åˆ†è¾¨ç‡ä¸º96dpiã€‚</p><p>åœ¨æŒ‡å®šå›¾ç‰‡æ ¼å¼ä¸º image/jpeg æˆ– image/webpçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä» 0 åˆ° 1 çš„åŒºé—´å†…é€‰æ‹©å›¾ç‰‡çš„è´¨é‡ã€‚å¦‚æœè¶…å‡ºå–å€¼èŒƒå›´ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼ 0.92ã€‚å…¶ä»–å‚æ•°ä¼šè¢«å¿½ç•¥ã€‚</p><p>è¿”å›å€¼ï¼šåŒ…å«dataURIçš„DOMStringã€‚</p><p> DataURIæ ¼å¼ï¼šdata:[<mediatype>][;base64],<data>ã€‚å…¶ä¸­mediatypeå£°æ˜äº†æ–‡ä»¶ç±»å‹ï¼Œéµå¾ªMIMEè§„åˆ™ï¼Œå¦‚â€œimage/pngâ€ã€â€œtext/plainâ€ï¼›ä¹‹åæ˜¯ç¼–ç ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ¶‰åŠ base64ï¼›ç´§æ¥ç€å°±æ˜¯æ–‡ä»¶ç¼–ç åçš„å†…å®¹äº†ã€‚</p><p>URIï¼ˆUniform Resource Identifierï¼‰:ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦,æœåŠ¡å™¨èµ„æºåè¢«ç§°ä¸ºç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦.å¦‚ï¼š<code>img src=&#39;images/image.png&#39;</code></p><p>URLï¼ˆUniform Resource Locatorï¼‰:ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œæè¿°äº†ä¸€å°ç‰¹å®šæœåŠ¡å™¨ä¸ŠæŸèµ„æºçš„ç‰¹å®šä½ç½®ã€‚å¦‚:</p><pre><code>img src=&#39;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABSUlEQVQ4Ee1VPUsDQRB9s3dBRCRNQvCjkDQW/hJ/gb9AOwWDoIXFgYXYXGP+hYW1/gIr7WzsE8VGxZBcwt04dznCJWw2twtWutXMmzdvlrd7t4SZVbvi1ZihZuCFqT9A/B7Qd5FI44RpPcQpE1oC1IsEq5jRBeGyc0zXaV8mvhbyOREurIRMZMZhp0VthYB9mXBi4jrUztIev1bNbKg6CMxvIWwg5GWVDOHNZ7lX6l/wrG+Fzbh/ca1bf9QWBhKtHznobgtjKF92ZBL3TUWpRbK7LhiVCY8kY3xK/iTiexNcEywSXxKBrfHvrdBN2JRsp4BoQ3dbtHLT4K+JqxWw8vr4YDaf+vR+SmXRWw99lT9N96VaypIYtwgoyWyJRtiX3T+X7TXxROcxGeAo5chlyNcBVxrb2JVpTUHsz4IQi/DL6wPucENxqvoDx69PXP8OKn4AAAAASUVORK5CYII=&#39;/</code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macå¼€å¯æœ¬åœ°æœåŠ¡å™¨</title>
      <link href="/2019/11/20/Other/server/"/>
      <url>/2019/11/20/Other/server/</url>
      
        <content type="html"><![CDATA[<h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><p>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª IMAP/POP3/SMTP ä»£ç†æœåŠ¡å™¨ã€‚</p><pre class=" language-bash"><code class="language-bash">å®‰è£…ï¼šæœç´¢è½¯ä»¶ï¼šbrew search nginxå®‰è£…è½¯ä»¶ï¼šbrew <span class="token function">install</span> nginxå¸è½½è½¯ä»¶ï¼šbrew uninstall nginxå‡çº§brewï¼šsudo brew updateæŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼šsudo brew info nginxæŸ¥çœ‹å·²ç»å®‰è£…çš„è½¯ä»¶ï¼šbrew list</code></pre><p>nginxå¸¸ç”¨å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash">nginx -v //æŸ¥çœ‹ä¸‹å®‰è£…å¥½çš„nginxç‰ˆæœ¬<span class="token function">sudo</span> nginx  // å¯åŠ¨nginx<span class="token function">sudo</span> nginx              //å¯åŠ¨nginx<span class="token function">sudo</span> nginx -s reload    //ä¿®æ”¹é…ç½®åé‡æ–°åŠ è½½ç”Ÿæ•ˆ<span class="token comment" spellcheck="true">#ç®€å•è§£é‡Šä¸‹ï¼Œä¸Šé¢è¿™ç§æ–¹æ³•é‡å¯ï¼Œnginxåœ¨é‡å¯çš„æ—¶å€™ä¸ä¼šä¸­æ–­æœåŠ¡ï¼Œå› ä¸º  nginxåœ¨å¯åŠ¨åï¼Œä¼šæœ‰ä¸€ä¸ªmasterè¿›ç¨‹å’Œå¤šä¸ªworkerè¿›ç¨‹ï¼Œé‡å¯æ˜¯ä¼šå…ˆç”Ÿæˆæ–°çš„workerè¿›ç¨‹å»æ¥å—reloadå‘½ä»¤ï¼Œç­‰è€çš„workerè¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œmasterè¿›ç¨‹åœ¨å…³é—­ä»–ä»¬ï¼Œæ‰€ä»¥æœåŠ¡å™¨ä¸ä¼šä¸­æ–­ã€‚</span><span class="token function">sudo</span> nginx -s  reopen   //é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶<span class="token function">sudo</span> nginx -s stop  //å¿«é€Ÿåœæ­¢nginx<span class="token function">sudo</span> nginx -s quit  //å®Œæ•´æœ‰åºçš„åœæ­¢nginx<span class="token function">sudo</span> nginx -t     //æµ‹è¯•å½“å‰é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</code></pre><p>nginxå¸¸è§ç›®å½•ï¼š</p><pre class=" language-bash"><code class="language-bash">/usr/local/Cellar/  <span class="token comment" spellcheck="true">#nginxé»˜è®¤å®‰è£…çš„ç›®å½•,æ‰€æœ‰ä½¿ç”¨brewå®‰è£…çš„è½¯ä»¶é»˜è®¤éƒ½åœ¨è¿™é‡Œ</span>/usr/local/Cellar/nginx/1.8.0/html  ï¼ƒé»˜è®¤çš„è®¿é—®ç›®å½•ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„ç½‘ç«™æ ¹ç›®å½•/usr/local/etc/nginx/     <span class="token comment" spellcheck="true"># nginx.confæ‰€åœ¨çš„ç›®å½•</span>ä¿®æ”¹é»˜è®¤è·¯å¾„ä»nginx/htmlæ”¹æˆä½ è‡ªå·±æ”¾ç½®ä»£ç çš„è·¯å¾„vim /usr/local/etc/nginx/nginx.conf</code></pre><p>æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±å¾ˆæ˜ç¡®äº†ï¼ŒæŠŠlisten 80ä¸‹é¢çš„ä¸¤ä¸ª root htmlä¸­çš„è·¯å¾„ï¼Œæ”¹æˆæˆ‘ä»¬è‡ªå·±æ”¾ä»£ç çš„æ–‡ä»¶å¤¹ã€‚ä¾‹å¦‚åœ¨æ¡Œé¢ä¸‹é¢æ–°å»ºä¸€ä¸ªhomeçš„æ–‡ä»¶å¤¹ï¼Œå†åœ¨ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªwwwçš„æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆè·¯å¾„å°±æ˜¯ï¼šæ¡Œé¢:homewwwï¼ŒæŠŠtask1.htmlæ”¾è¿›å»ï¼Œç„¶åä¿®æ”¹é…ç½®ä¿®æ”¹å®Œæˆåï¼Œç‚¹å‡»Escé”®<code>Â·shift+: è¾“å…¥ï¼šwq</code>ï¼Œä¿å­˜ä¿®æ”¹ã€‚</p><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><p>æ‰“å¼€ç»ˆç«¯ï¼Œå¼€å¯Apache:</p><pre class=" language-bash"><code class="language-bash">//å¼€å¯apache:  <span class="token function">sudo</span> apachectl start//é‡å¯apache:  <span class="token function">sudo</span> apachectl restart//å…³é—­apache:  <span class="token function">sudo</span> apachectl stop//æŸ¥çœ‹apacheç‰ˆæœ¬ <span class="token function">sudo</span> apachectl -v</code></pre><p>å›è½¦ä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œä¹Ÿå°±æ˜¯ä½ ç”µè„‘çš„å¯†ç ï¼Œ<a href="http://127.0.0.1/æµ‹è¯•ä¸€ä¸‹ã€‚" target="_blank" rel="noopener">http://127.0.0.1/æµ‹è¯•ä¸€ä¸‹ã€‚</a><br>ç‚¹å‡»Finder,ç„¶åCommand+Shift+G,å‰å¾€ApacheæœåŠ¡å™¨çš„æ–‡ä»¶è·¯å¾„(/Library/WebServer/Documents)ï¼Œåœ¨æ­¥éª¤1ä¸­åªè¾“å…¥ä¸€ä¸ª<a href="http://127.0.0.1å…¶å®é»˜è®¤æ‰“å¼€çš„æ˜¯index.html.en(htmlæ˜¯ä¸€ä¸ªç½‘é¡µæ–‡ä»¶)ï¼Œè¯¥æ–‡ä»¶çš„å†…å®¹å°±æ˜¯åœ¨æ­¥éª¤1ä¸­æµ‹è¯•æ—¶æµè§ˆå™¨æ‰€æ˜¾ç¤ºçš„å†…å®¹" target="_blank" rel="noopener">http://127.0.0.1å…¶å®é»˜è®¤æ‰“å¼€çš„æ˜¯index.html.en(htmlæ˜¯ä¸€ä¸ªç½‘é¡µæ–‡ä»¶)ï¼Œè¯¥æ–‡ä»¶çš„å†…å®¹å°±æ˜¯åœ¨æ­¥éª¤1ä¸­æµ‹è¯•æ—¶æµè§ˆå™¨æ‰€æ˜¾ç¤ºçš„å†…å®¹</a></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vueä½¿ç”¨webpackä¼˜åŒ–æ„å»ºæµç¨‹</title>
      <link href="/2019/11/20/Vue/webpack%E6%9E%84%E5%BB%BA/"/>
      <url>/2019/11/20/Vue/webpack%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>åˆè¡·ï¼šå¦‚æœæˆ‘ä»¬çš„ Vue é¡¹ç›®æ¯”è¾ƒå¤§ï¼æˆ–è€…è¯´é¡¹ç›®ä¸­å¼•å…¥äº†è®¸å¤šç¬¬ä¸‰æ–¹åº“ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œ npm run build æ„å»ºé¡¹ç›®çš„æ—¶å€™ä¼šæå…¶çš„æ…¢ï¼æ¯”å¦‚æˆ‘ç°åœ¨çš„é¡¹ç›®å°±æ¯æ¬¡æ‰“åŒ…å°±è¦ 83sã€‚<br>ä¸‹é¢æä¾›ä¸€äº›æ–¹æ³•ç”¨æ¥æä¾›ä¼˜åŒ–æ‰“åŒ…é€Ÿåº¦ï¼š</p><h4 id="resolve-modules"><a href="#resolve-modules" class="headerlink" title="resolve.modules"></a>resolve.modules</h4><p>æ€è·¯ï¼šwebpack çš„ resolve.modules æ˜¯ç”¨æ¥é…ç½®æ¨¡å—åº“ï¼ˆå³ node_modulesï¼‰æ‰€åœ¨çš„ä½ç½®ã€‚å½“ js é‡Œå‡ºç° import â€˜vueâ€™ è¿™æ ·ä¸æ˜¯ç›¸å¯¹ã€ä¹Ÿä¸æ˜¯ç»å¯¹è·¯å¾„çš„å†™æ³•æ—¶ï¼Œå®ƒä¾¿ä¼šåˆ° node_modules ç›®å½•ä¸‹å»æ‰¾ã€‚åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œwebpack ä¼šé‡‡ç”¨å‘ä¸Šé€’å½’æœç´¢çš„æ–¹å¼å»å¯»æ‰¾ã€‚ä½†é€šå¸¸é¡¹ç›®ç›®å½•é‡Œåªæœ‰ä¸€ä¸ª node_modulesï¼Œä¸”æ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•ã€‚ä¸ºäº†å‡å°‘æœç´¢èŒƒå›´ï¼Œå¯æˆ‘ä»¬ä»¥ç›´æ¥å†™æ˜ node_modules çš„å…¨è·¯å¾„ã€‚</p><pre><code>æ‰“å¼€ build/webpack.base.conf.js æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼šmodule.exports = {  resolve: {    extensions: [&#39;.js&#39;, &#39;.vue&#39;, &#39;.json&#39;],    modules: [      resolve(&#39;src&#39;),      resolve(&#39;node_modules&#39;)    ],    alias: {      &#39;vue$&#39;: &#39;vue/dist/vue.esm.js&#39;,      &#39;@&#39;: resolve(&#39;src&#39;),    }  },</code></pre><h4 id="webpack-parallel-uglify-plugin"><a href="#webpack-parallel-uglify-plugin" class="headerlink" title="webpack-parallel-uglify-plugin"></a>webpack-parallel-uglify-plugin</h4><p>åŸç†ï¼šwebpacké»˜è®¤æä¾›äº†UglifyJSæ’ä»¶æ¥å‹ç¼©JSä»£ç ï¼Œä½†æ˜¯å®ƒä½¿ç”¨çš„æ˜¯å•çº¿ç¨‹å‹ç¼©ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªjsæ–‡ä»¶éœ€è¦è¢«å‹ç¼©ï¼Œå®ƒéœ€è¦ä¸€ä¸ªä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚æ‰€ä»¥è¯´åœ¨æ­£å¼ç¯å¢ƒæ‰“åŒ…å‹ç¼©ä»£ç é€Ÿåº¦éå¸¸æ…¢(å› ä¸ºå‹ç¼©JSä»£ç éœ€è¦å…ˆæŠŠä»£ç è§£ææˆç”¨ObjectæŠ½è±¡è¡¨ç¤ºçš„ASTè¯­æ³•æ ‘ï¼Œå†å»åº”ç”¨å„ç§è§„åˆ™åˆ†æå’Œå¤„ç†ASTï¼Œå¯¼è‡´è¿™ä¸ªè¿‡ç¨‹è€—æ—¶éå¸¸å¤§)ã€‚æºç ï¼š</p><pre><code>module.exports = {  plugins: [    new webpack.optimize.UglifyJsPlugin({      sourceMap: true,      compress: {        warnings: false      }    }),  ]}</code></pre><p>æˆ‘ä»¬å¯ä»¥æ”¹ç”¨ webpack-parallel-uglify-plugin æ’ä»¶ï¼Œå®ƒå¯ä»¥å¹¶è¡Œè¿è¡Œ UglifyJS æ’ä»¶ï¼Œä»è€Œæ›´åŠ å……åˆ†ã€åˆç†çš„ä½¿ç”¨ CPU èµ„æºï¼Œä»è€Œå¤§å¤§å‡å°‘æ„å»ºæ—¶é—´ã€‚<br>å½“webpackæœ‰å¤šä¸ªJSæ–‡ä»¶éœ€è¦è¾“å‡ºå’Œå‹ç¼©æ—¶å€™ï¼ŒåŸæ¥ä¼šä½¿ç”¨UglifyJSå»ä¸€ä¸ªä¸ªå‹ç¼©å¹¶ä¸”è¾“å‡ºï¼Œä½†æ˜¯ParallelUglifyPluginæ’ä»¶åˆ™ä¼šå¼€å¯å¤šä¸ªå­è¿›ç¨‹ï¼ŒæŠŠå¯¹å¤šä¸ªæ–‡ä»¶å‹ç¼©çš„å·¥ä½œåˆ†åˆ«ç»™å¤šä¸ªå­è¿›ç¨‹å»å®Œæˆï¼Œä½†æ˜¯æ¯ä¸ªå­è¿›ç¨‹è¿˜æ˜¯é€šè¿‡UglifyJSå»å‹ç¼©ä»£ç ã€‚æ— éå°±æ˜¯å˜æˆäº†å¹¶è¡Œå¤„ç†è¯¥å‹ç¼©äº†ï¼Œå¹¶è¡Œå¤„ç†å¤šä¸ªå­ä»»åŠ¡ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚</p><pre><code>å®‰è£…ï¼šnpm i webpack-parallel-uglify-pluginæ‰“å¼€ build/webpack.prod.conf.js æ–‡ä»¶ï¼Œå¹¶ä½œå¦‚ä¸‹ä¿®æ”¹ï¼šconst ParallelUglifyPlugin = require(&#39;webpack-parallel-uglify-plugin&#39;);// åˆ æ‰webpackæä¾›çš„UglifyJSæ’ä»¶    //new UglifyJsPlugin({    //  uglifyOptions: {    //    compress: {    //      warnings: false    //    }    //  },    //  sourceMap: config.build.productionSourceMap,    //  parallel: true    //}),    // å¢åŠ  webpack-parallel-uglify-pluginæ¥æ›¿æ¢    new ParallelUglifyPlugin({      cacheDir: &#39;.cache/&#39;,      uglifyJS:{        output: {          comments: false        },        compress: {          warnings: false,          drop_debugger: true,          drop_console: true        }      }    }),</code></pre><h4 id="HappyPack"><a href="#HappyPack" class="headerlink" title="HappyPack"></a>HappyPack</h4><p>åŸç†ï¼šç”±äºè¿è¡Œåœ¨ Node.js ä¹‹ä¸Šçš„ Webpack æ˜¯å•çº¿ç¨‹æ¨¡å‹çš„ï¼Œæ‰€ä»¥ Webpack éœ€è¦å¤„ç†çš„äº‹æƒ…åªèƒ½ä¸€ä»¶ä¸€ä»¶åœ°åšï¼Œä¸èƒ½å¤šä»¶äº‹ä¸€èµ·åšã€‚è€Œ HappyPack çš„å¤„ç†æ€è·¯æ˜¯ï¼šå°†åŸæœ‰çš„ webpack å¯¹ loader çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä»å•ä¸€è¿›ç¨‹çš„å½¢å¼æ‰©å±•å¤šè¿›ç¨‹æ¨¡å¼ï¼Œä»è€ŒåŠ é€Ÿä»£ç æ„å»ºã€‚</p><pre><code>å®‰è£…ï¼šnpm i happypackæ‰“å¼€ build/webpack.base.conf.js æ–‡ä»¶ï¼Œå¹¶ä½œå¦‚ä¸‹ä¿®æ”¹ï¼šconst HappyPack = require(&#39;happypack&#39;);const os = require(&#39;os&#39;);const happyThreadPool = HappyPack.ThreadPool({ size: os.cpus().length });module.exports = {  module: {    rules: [      {        test: /.js$/,        //æŠŠå¯¹.js çš„æ–‡ä»¶å¤„ç†äº¤ç»™idä¸ºhappyBabel çš„HappyPack çš„å®ä¾‹æ‰§è¡Œ        loader: &#39;happypack/loader?id=happyBabel&#39;,        include: [resolve(&#39;src&#39;)],        //æ’é™¤node_modules ç›®å½•ä¸‹çš„æ–‡ä»¶        exclude: /node_modules/      },    ]  },  plugins: [    new HappyPack({        //ç”¨idæ¥æ ‡è¯† happypackå¤„ç†é‚£é‡Œç±»æ–‡ä»¶      id: &#39;happyBabel&#39;,      //å¦‚ä½•å¤„ç†  ç”¨æ³•å’Œloader çš„é…ç½®ä¸€æ ·      loaders: [{        loader: &#39;babel-loader?cacheDirectory=true&#39;,      }],      //å…±äº«è¿›ç¨‹æ±       threadPool: happyThreadPool,      //å…è®¸ HappyPack è¾“å‡ºæ—¥å¿—      verbose: true,    })  ]}</code></pre><h4 id="DllPlugin-å’Œ-DllReferencePlugin"><a href="#DllPlugin-å’Œ-DllReferencePlugin" class="headerlink" title="DllPlugin å’Œ DllReferencePlugin"></a>DllPlugin å’Œ DllReferencePlugin</h4><p>åŸç†ï¼šæˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–ä¸­é€šå¸¸ä¼šå¼•ç”¨å¤§é‡çš„ npm åŒ…ï¼Œè€Œè¿™äº›åŒ…åœ¨æ­£å¸¸çš„å¼€å‘è¿‡ç¨‹ä¸­å¹¶ä¸ä¼šè¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯åœ¨æ¯ä¸€æ¬¡æ„å»ºè¿‡ç¨‹ä¸­å´éœ€è¦åå¤çš„å°†å…¶è§£æï¼Œè€Œä¸‹é¢ä»‹ç»çš„ä¸¤ä¸ªæ’ä»¶å°±æ˜¯ç”¨æ¥è§„é¿æ­¤ç±»æŸè€—çš„ï¼š<br>DllPlugin æ’ä»¶ï¼šä½œç”¨æ˜¯é¢„å…ˆç¼–è¯‘ä¸€äº›æ¨¡å—ã€‚<br>DllReferencePlugin æ’ä»¶ï¼šå®ƒçš„æ‰€ç”¨åˆ™æ˜¯æŠŠè¿™äº›é¢„å…ˆç¼–è¯‘å¥½çš„æ¨¡å—å¼•ç”¨èµ·æ¥ã€‚<br>æ³¨æ„ï¼šDllPlugin å¿…é¡»è¦åœ¨ DllReferencePlugin æ‰§è¡Œå‰å…ˆæ‰§è¡Œä¸€æ¬¡ã€‚</p><pre><code>1ã€åœ¨ build æ–‡ä»¶å¤¹ä¸­æ–°å»º webpack.dll.conf.js æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼ˆä¸»è¦æ˜¯é…ç½®ä¸‹éœ€è¦æå‰ç¼–è¯‘æ‰“åŒ…çš„åº“ï¼‰ï¼šconst path = require(&#39;path&#39;);const webpack = require(&#39;webpack&#39;);module.exports = {  entry: {    vendor: [&#39;vue/dist/vue.common.js&#39;,            &#39;vue-router&#39;,            &#39;axios&#39;,            &#39;vuex&#39;,            &#39;element-ui&#39;]  },  output: {    path: path.join(__dirname, &#39;../static/js&#39;),    filename: &#39;[name].dll.js&#39;,    library: &#39;[name]_library&#39;       // vendor.dll.jsä¸­æš´éœ²å‡ºçš„å…¨å±€å˜é‡å  },  plugins: [    new webpack.DllPlugin({      path: path.join(__dirname, &#39;.&#39;, &#39;[name]-manifest.json&#39;),      name: &#39;[name]_library&#39;    }),    new webpack.optimize.UglifyJsPlugin({      compress: {        warnings: false      }    })  ]};2ã€ç¼–è¾‘ package.json æ–‡ä»¶ï¼Œæ·»åŠ ä¸€æ¡ç¼–è¯‘å‘½ä»¤ï¼š    dll: webpack --config webpack.dll.conf.jsæ¥ç€æ‰§è¡Œ npm run dll å‘½ä»¤æ¥ç”Ÿæˆ vendor.dll.jsã€‚æ³¨æ„ï¼šå¦‚æœä¹‹åè¿™äº›éœ€è¦é¢„ç¼–è¯‘çš„åº“åˆæœ‰å˜åŠ¨ï¼Œåˆ™éœ€å†æ¬¡æ‰§è¡Œ npm run dll å‘½ä»¤æ¥é‡æ–°ç”Ÿæˆ vendor.dll.js3ã€index.html è¿™è¾¹å°† vendor.dll.js å¼•å…¥è¿›æ¥ï¼š&lt;script src=â€˜./static/js/vendor.dll.jsâ€™&gt;&lt;/script&gt;4ã€æ‰“å¼€ build/webpack.base.conf.js æ–‡ä»¶ï¼Œç¼–è¾‘æ·»åŠ å¦‚ä¸‹é«˜äº®é…ç½®ï¼Œä½œç”¨æ˜¯é€šè¿‡ DLLReferencePlugin æ¥ä½¿ç”¨ DllPlugin ç”Ÿæˆçš„ DLL Bundleã€‚const webpack = require(&#39;webpack&#39;);module.exports = {  context: path.resolve(__dirname, &#39;../&#39;),  entry: {    app: &#39;./src/main.js&#39;  },  //.....  plugins: [     // æ·»åŠ DllReferencePluginæ’ä»¶     new webpack.DllReferencePlugin({       context: path.resolve(__dirname, &#39;..&#39;),       manifest: require(&#39;./vendor-manifest.json&#39;)     }),  ]}</code></pre>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
